<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Herbdocs â€“ distributed</title><link>/tags/distributed/</link><description>Recent content in distributed on Herbdocs</description><generator>Hugo -- gohugo.io</generator><atom:link href="/tags/distributed/index.xml" rel="self" type="application/rss+xml"/><item><title>Docs: åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•</title><link>/docs/41.%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%80%E8%87%B4%E6%80%A7%E7%AE%97%E6%B3%95/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/docs/41.%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%80%E8%87%B4%E6%80%A7%E7%AE%97%E6%B3%95/</guid><description>
&lt;h1 id="åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ&lt;/h1>
&lt;h2 id="cap">CAP&lt;/h2>
&lt;p>Cï¼šä¸€è‡´æ€§&lt;/p>
&lt;p>Aï¼šå¯ç”¨æ€§&lt;/p>
&lt;p>Pï¼šåˆ†åŒºå®¹é”™æ€§&lt;/p>
&lt;p>CPæˆ–è€…AP&lt;/p>
&lt;h2 id="base-ç†è®º">&lt;strong>BASE ç†è®º&lt;/strong>&lt;/h2>
&lt;p>BASEç†è®ºæŒ‡çš„æ˜¯åŸºæœ¬å¯ç”¨ Basically Availableï¼Œè½¯çŠ¶æ€Soft Stateï¼Œæœ€ç»ˆä¸€è‡´æ€§ Eventual Consistencyï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯å³ä¾¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œä½†åº”è¯¥é‡‡ç”¨é€‚åˆçš„æ–¹å¼ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚&lt;/p>
&lt;p>BASEï¼ŒBasically Available Soft State Eventual Consistency çš„ç®€å†™ï¼š&lt;/p>
&lt;p>&lt;strong>BA&lt;/strong>ï¼šBasically Available åŸºæœ¬å¯ç”¨ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°æ•…éšœçš„æ—¶å€™ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ï¼Œå³ä¿è¯æ ¸å¿ƒå¯ç”¨ã€‚&lt;/p>
&lt;p>&lt;strong>S&lt;/strong>ï¼šSoft State è½¯çŠ¶æ€ï¼Œå…è®¸ç³»ç»Ÿå­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œè€Œè¯¥ä¸­é—´çŠ¶æ€ä¸ä¼šå½±å“ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§ã€‚&lt;/p>
&lt;p>&lt;strong>E&lt;/strong>ï¼šConsistency æœ€ç»ˆä¸€è‡´æ€§ï¼Œç³»ç»Ÿä¸­çš„æ‰€æœ‰æ•°æ®å‰¯æœ¬ç»è¿‡ä¸€å®šæ—¶é—´åï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚&lt;/p>
&lt;p>BASE ç†è®ºæœ¬è´¨ä¸Šæ˜¯å¯¹ CAP ç†è®ºçš„å»¶ä¼¸ï¼Œæ˜¯å¯¹ CAP ä¸­ AP æ–¹æ¡ˆçš„ä¸€ä¸ªè¡¥å……ã€‚&lt;/p>
&lt;h2 id="xaç®€å•ä»‹ç»">XAç®€å•ä»‹ç»&lt;/h2>
&lt;p>XAæ˜¯ç”±X / Openå‘å¸ƒçš„è§„èŒƒï¼Œç”¨äºDTPï¼ˆåˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†ï¼‰ã€‚&lt;/p>
&lt;p>DTPåˆ†å¸ƒå¼æ¨¡å‹ä¸»è¦å«æœ‰&lt;/p>
&lt;ul>
&lt;li>APï¼š åº”ç”¨ç¨‹åº&lt;/li>
&lt;li>TM: äº‹åŠ¡ç®¡ç†å™¨&lt;/li>
&lt;li>RM: èµ„æºç®¡ç†å™¨(å¦‚æ•°æ®åº“)&lt;/li>
&lt;li>CRM: é€šè®¯èµ„æºç®¡ç†å™¨ï¼ˆå¦‚æ¶ˆæ¯é˜Ÿåˆ—ï¼‰&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>XAä¸»è¦å°±æ˜¯TMå’ŒRMä¹‹é—´çš„é€šè®¯æ¡¥æ¢ã€‚&lt;/strong>&lt;/p>
&lt;h2 id="åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•å‰æ">åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•å‰æ&lt;/h2>
&lt;h3 id="æ‹œå åº­å°†å†›é—®é¢˜">æ‹œå åº­å°†å†›é—®é¢˜&lt;/h3>
&lt;p>å£«å…µï¼ˆä¿¡æ¯é€šé“ï¼‰å¯ä»¥ä¼ªé€ è™šå‡ä¿¡æ¯&lt;/p>
&lt;h2 id="åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•è€ƒè™‘çš„åŸåˆ™">&lt;strong>åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•è€ƒè™‘çš„åŸåˆ™&lt;/strong>&lt;/h2>
&lt;ul>
&lt;li>safety : åœ¨éæ‹œå åº­çš„æƒ…å†µä¸‹ï¼Œä¸ä¼šè¿”å›é”™è¯¯çš„ç»“æœ&lt;/li>
&lt;li>available: åœ¨å¤§å¤šæ•°serverè¿è¡Œä¸”å¯ä»¥å’Œåˆ«çš„serverä»¥åŠclienté€šä¿¡çš„æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä¿è¯å¯ç”¨&lt;/li>
&lt;li>ä¸ä¾èµ–æ—¶é—´æ¥ä¿è¯ä¸€è‡´æ€§ï¼Œæ—¶é’Ÿé”™è¯¯ï¼Œä¿¡æ¯å»¶è¿Ÿä¼šå¯¼è‡´å¯ç”¨æ€§ä¸å¥½&lt;/li>
&lt;/ul>
&lt;h1 id="2pc-äºŒé˜¶æ®µæäº¤">2PC äºŒé˜¶æ®µæäº¤&lt;/h1>
&lt;p>ä¸¤é˜¶æ®µæäº¤åè®®ï¼ˆThe two-phase commit protocolï¼Œ2PCï¼‰æ˜¯ XA ç”¨äºåœ¨å…¨å±€äº‹åŠ¡ä¸­åè°ƒå¤šä¸ªèµ„æºçš„æœºåˆ¶&lt;/p>
&lt;p>&lt;img src="../imgs/distributed_consistency_211219_1.png" alt="distributed_consistency_211219_1.png">&lt;/p>
&lt;h2 id="1-é˜¶æ®µä¸€æäº¤äº‹åŠ¡è¯·æ±‚">1ã€é˜¶æ®µä¸€æäº¤äº‹åŠ¡è¯·æ±‚&lt;/h2>
&lt;p>1ã€åè°ƒè€…å‘æ‰€æœ‰çš„å‚ä¸è€…èŠ‚ç‚¹å‘é€äº‹åŠ¡å†…å®¹,è¯¢é—®æ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡æ“ä½œ,å¹¶ç­‰å¾…å…¶ä»–å‚ä¸è€…èŠ‚ç‚¹çš„åé¦ˆ&lt;/p>
&lt;p>2ã€å„å‚ä¸è€…èŠ‚ç‚¹æ‰§è¡Œäº‹åŠ¡æ“ä½œ&lt;/p>
&lt;p>3ã€å„å‚ä¸è€…èŠ‚ç‚¹åé¦ˆç»™åè°ƒè€…,äº‹åŠ¡æ˜¯å¦å¯ä»¥æ‰§è¡Œ&lt;/p>
&lt;h2 id="2-é˜¶æ®µäºŒäº‹åŠ¡æäº¤">2ã€é˜¶æ®µäºŒäº‹åŠ¡æäº¤&lt;/h2>
&lt;p>æ ¹æ®ä¸€é˜¶æ®µå„ä¸ªå‚ä¸è€…èŠ‚ç‚¹åé¦ˆçš„ackå¦‚æœæ‰€æœ‰å‚ä¸è€…èŠ‚ç‚¹åé¦ˆack,åˆ™æ‰§è¡Œäº‹åŠ¡æäº¤,å¦åˆ™ä¸­æ–­äº‹åŠ¡&lt;/p>
&lt;h3 id="äº‹åŠ¡æäº¤">äº‹åŠ¡æäº¤:&lt;/h3>
&lt;p>1ã€åè°ƒè€…å‘å„ä¸ªå‚ä¸è€…èŠ‚ç‚¹å‘é€commitè¯·æ±‚&lt;/p>
&lt;p>2ã€å‚ä¸è€…èŠ‚ç‚¹æ¥å—åˆ°commitè¯·æ±‚å,æ‰§è¡Œäº‹åŠ¡çš„æäº¤æ“ä½œ&lt;/p>
&lt;p>3ã€å„å‚ä¸è€…èŠ‚ç‚¹å®Œæˆäº‹åŠ¡æäº¤å,å‘åè°ƒè€…è¿”é€æäº¤commitæˆåŠŸç¡®è®¤æ¶ˆæ¯&lt;/p>
&lt;p>4ã€åè°ƒè€…æ¥å—å„ä¸ªå‚ä¸è€…èŠ‚ç‚¹çš„ackå,å®Œæˆäº‹åŠ¡commit&lt;/p>
&lt;h3 id="ä¸­æ–­äº‹åŠ¡">ä¸­æ–­äº‹åŠ¡:&lt;/h3>
&lt;p>1ã€å‘é€å›æ»šè¯·æ±‚&lt;/p>
&lt;p>2ã€å„ä¸ªå‚ä¸è€…èŠ‚ç‚¹å›æ»šäº‹åŠ¡&lt;/p>
&lt;p>3ã€åé¦ˆç»™åè°ƒè€…äº‹åŠ¡å›æ»šç»“æœ&lt;/p>
&lt;p>4ã€åè°ƒè€…æ¥å—å„å‚ä¸è€…èŠ‚ç‚¹ackåå›æ»šäº‹åŠ¡&lt;/p>
&lt;h2 id="äºŒé˜¶æ®µæäº¤å­˜åœ¨çš„é—®é¢˜">äºŒé˜¶æ®µæäº¤å­˜åœ¨çš„é—®é¢˜:&lt;/h2>
&lt;h3 id="1-åŒæ­¥é˜»å¡">1ã€åŒæ­¥é˜»å¡&lt;/h3>
&lt;p>äºŒé˜¶æ®µæäº¤è¿‡ç¨‹ä¸­,æ‰€æœ‰å‚ä¸äº‹åŠ¡æ“ä½œçš„èŠ‚ç‚¹å¤„äºåŒæ­¥é˜»å¡çŠ¶æ€,æ— æ³•è¿›è¡Œå…¶ä»–çš„æ“ä½œ&lt;/p>
&lt;h3 id="2-å•ç‚¹é—®é¢˜">2ã€å•ç‚¹é—®é¢˜&lt;/h3>
&lt;p>ä¸€æ—¦åè°ƒè€…å‡ºç°å•ç‚¹æ•…éšœ,æ— æ³•ä¿è¯äº‹åŠ¡çš„ä¸€è‡´æ€§æ“ä½œ&lt;/p>
&lt;h3 id="3-æ•°æ®ä¸ä¸€è‡´">3ã€æ•°æ®ä¸ä¸€è‡´&lt;/h3>
&lt;p>å¦‚æœåˆ†å¸ƒå¼èŠ‚ç‚¹å‡ºç°ç½‘ç»œåˆ†åŒº,æ ‡äº›å‚ä¸è€…æœªæ”¶åˆ°Commitæäº¤å‘½ä»¤ã€‚åˆ™å‡ºç°éƒ¨åˆ†å‚ä¸è€…å®Œæˆæ•°æ®æäº¤ã€‚æœªæ”¶åˆ°commitçš„å‘½ä»¤çš„å‚ä¸è€…åˆ™æ— æ³•è¿›è¡Œäº‹åŠ¡æäº¤,æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¾¿å‡ºç°äº†æ•°æ®ä¸ä¸€è‡´æ€§ç°è±¡ã€‚&lt;/p>
&lt;p>æ€»ç»“ä¸‰ç§åœºæ™¯ï¼šåè°ƒè€…æŒ‚äº†ï¼›å‚ä¸è€…æŒ‚äº†ï¼›ä¸¤è€…éƒ½æŒ‚äº†ã€‚é—®é¢˜ï¼šä¸çŸ¥é“æ‰§è¡Œåˆ°å“ªä¸€æ­¥æ‰æŒ‚çš„ï¼Œäº‹ç‰©æ˜¯å¦æäº¤ã€‚æ‰€ä»¥å¤šå¢åŠ ä¸€ä¸ªé˜¶æ®µæäº¤ï¼Œè¿™æ ·å¥½æ­¹çŸ¥é“æ˜¯åœ¨äº‹ç‰©æäº¤ä¹‹å‰æŒ‚çš„ã€‚&lt;/p>
&lt;p>2PCä¸è€ƒè™‘è¶…æ—¶å›æ»šçš„æƒ…å†µä¸‹å®ƒæ˜¯å®‰å…¨çš„, 2PCå¯ä»¥ä¿è¯safetyä½†æ˜¯ä¸ä¿è¯liveness.&lt;/p>
&lt;h1 id="3pc-ä¸‰é˜¶æ®µæäº¤">3PC ä¸‰é˜¶æ®µæäº¤&lt;/h1>
&lt;p>3PCæ˜¯2PCçš„æ”¹è¿›ç‰ˆ,å®è´¨æ˜¯å°†2PCä¸­æäº¤äº‹åŠ¡è¯·æ±‚æ‹†åˆ†ä¸ºä¸¤æ­¥,å½¢æˆäº†anCommitã€PreCommitã€doCommitä¸‰ä¸ªé˜¶æ®µçš„äº‹åŠ¡ä¸€è‡´æ€§åè®®&lt;/p>
&lt;p>&lt;img src="../imgs/distributed_consistency_211219_2.png" alt="distributed_consistency_211219_2.png">&lt;/p>
&lt;h2 id="é˜¶æ®µä¸€-cancommit">é˜¶æ®µä¸€: CanCommit&lt;/h2>
&lt;p>1ã€äº‹åŠ¡è¯¢é—®&lt;/p>
&lt;p>2ã€å„å‚ä¸è€…èŠ‚ç‚¹å‘åè°ƒè€…åé¦ˆäº‹åŠ¡è¯¢é—®çš„å“åº”&lt;/p>
&lt;h2 id="é˜¶æ®µäºŒ-preccommit">é˜¶æ®µäºŒ: PreCcommit&lt;/h2>
&lt;p>æ ¹æ®é˜¶æ®µä¸€çš„åé¦ˆç»“æœåˆ†ä¸ºä¸¤ç§æƒ…å†µ&lt;/p>
&lt;h3 id="1-æ‰§è¡Œäº‹åŠ¡é¢„æäº¤">1ã€æ‰§è¡Œäº‹åŠ¡é¢„æäº¤&lt;/h3>
&lt;p>1ï¼‰å‘é€é¢„æäº¤è¯·æ±‚&lt;/p>
&lt;p>åè°ƒè€…åˆ›æ²‚æœ‰å‚ä¸è€…èŠ‚ç‚¹å‘é€preCcommitè¯·æ±‚,è¿›å…¥preparedé˜¶æ®µ&lt;/p>
&lt;p>2ï¼‰äº‹åŠ¡é¢„æäº¤&lt;/p>
&lt;p>å„å‚ä¸è€…èŠ‚ç‚¹æ¥å—åˆ°preCommitè¯·æ±‚å,æ‰§è¡Œäº‹åŠ¡æ“ä½œ&lt;/p>
&lt;p>3)å„å‚ä¸è€…èŠ‚ç‚¹å‘åè°ƒè€…åé¦ˆäº‹åŠ¡æ‰§è¡Œ&lt;/p>
&lt;h3 id="2-ä¸­æ–­äº‹åŠ¡">2ã€ä¸­æ–­äº‹åŠ¡&lt;/h3>
&lt;p>ä»»æ„ä¸€ä¸ªå‚ä¸è€…èŠ‚ç‚¹åé¦ˆç»™åè°ƒè€…å“åº”Noæ—¶,æˆ–è€…åœ¨ç­‰å¾…è¶…æ—¶å,åè°ƒè€…è¿˜æœªæ”¶åˆ°å‚ä¸è€…çš„å&lt;/p>
&lt;p>é¦ˆ,å°±ä¸­æ–­äº‹åŠ¡,ä¸­æ–­äº‹åŠ¡åˆ†ä¸ºä¸¤æ­¥:&lt;/p>
&lt;p>1)åè°ƒè€…å‘å„ä¸ªå‚ä¸è€…èŠ‚ç‚¹å‘é€abortè¯·æ±‚&lt;/p>
&lt;p>2)å‚ä¸è€…æ”¶åˆ°abortè¯·æ±‚,æˆ–è€…ç­‰å¾…è¶…æ—¶æ—¶é—´å,ä¸­æ–­äº‹åŠ¡&lt;/p>
&lt;h2 id="é˜¶æ®µä¸‰-docommit">é˜¶æ®µä¸‰: doCommit&lt;/h2>
&lt;h3 id="1-æ‰§è¡Œæäº¤">1ã€æ‰§è¡Œæäº¤&lt;/h3>
&lt;ol>
&lt;li>å‘é€æäº¤è¯·æ±‚&lt;/li>
&lt;/ol>
&lt;p>åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…èŠ‚ç‚¹å‘é€doCommitè¯·æ±‚&lt;/p>
&lt;ol start="2">
&lt;li>äº‹åŠ¡æäº¤&lt;/li>
&lt;/ol>
&lt;p>å„å‚ä¸è€…èŠ‚ç‚¹æ¥å—åˆ°doCommitè¯·æ±‚å,æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œ&lt;/p>
&lt;ol start="3">
&lt;li>åé¦ˆäº‹åŠ¡æäº¤ç»“æœ&lt;/li>
&lt;/ol>
&lt;p>å„å‚ä¸è€…èŠ‚ç‚¹å®Œæˆäº‹åŠ¡æäº¤ä»¥å,å‘åè°ƒè€…å‘é€ack&lt;/p>
&lt;ol start="4">
&lt;li>äº‹åŠ¡å®Œæˆ&lt;/li>
&lt;/ol>
&lt;p>åè°ƒè€…æ¥å—å„ä¸ªå‚ä¸è€…åé¦ˆçš„ackå,å®Œæˆäº‹åŠ¡&lt;/p>
&lt;h3 id="2-ä¸­æ–­äº‹åŠ¡-1">2ã€ä¸­æ–­äº‹åŠ¡&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>å‚ä¸è€…æ¥å—åˆ°abortè¯·æ±‚å,æ‰§è¡Œäº‹åŠ¡å›æ»š&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å‚ä¸è€…å®Œæˆäº‹åŠ¡å›æ»šä»¥å,å‘åè°ƒè€…å‘é€ack&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åè°ƒè€…æ¥å—å›æ»šackå,å›æ»šäº‹åŠ¡&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="ä¸‰é˜¶æ®µè§£å†³çš„é—®é¢˜">ä¸‰é˜¶æ®µè§£å†³çš„é—®é¢˜&lt;/h2>
&lt;p>1ã€å¼•å…¥è¶…æ—¶æ—¶é—´ï¼Œè§£å†³äº†åŒæ­¥é˜»å¡&lt;/p>
&lt;p>2ã€å‚ä¸è€…é•¿æ—¶é—´æ¥æ”¶ä¸åˆ°åè°ƒè€…å“åº”ï¼Œå°±ä¼šå°†äº‹åŠ¡è¿›è¡Œæäº¤ï¼Œä½¿ç”¨è¿™ä¸ªæœºåˆ¶è§£å†³äº†å•ç‚¹é—®é¢˜&lt;/p>
&lt;p>3PCæ˜¯2PCçš„æ”¹è¿›ç‰ˆ, å®è´¨æ˜¯å°†2PCä¸­æäº¤äº‹åŠ¡è¯·æ±‚æ‹†åˆ†ä¸ºä¸¤æ­¥, å½¢æˆäº†CanCommitã€PreCommitã€doCommitä¸‰ä¸ªé˜¶æ®µçš„äº‹åŠ¡ä¸€è‡´æ€§åè®®ï¼ˆå‡å°‘åŒæ­¥é˜»å¡çš„å‘ç”ŸèŒƒå›´ï¼‰&lt;/p>
&lt;p>&lt;strong>ç®€å•æ¦‚æ‹¬ä¸€ä¸‹å°±æ˜¯ï¼Œå¦‚æœæŒ‚æ‰çš„é‚£å°æœºå™¨å·²ç»æ‰§è¡Œäº†commitï¼Œé‚£ä¹ˆåè°ƒè€…å¯ä»¥ä»æ‰€æœ‰æœªæŒ‚æ‰çš„å‚ä¸è€…çš„çŠ¶æ€ä¸­åˆ†æå‡ºæ¥ï¼Œå¹¶æ‰§è¡Œcommitã€‚å¦‚æœæŒ‚æ‰çš„é‚£ä¸ªå‚ä¸è€…æ‰§è¡Œäº†rollbackï¼Œé‚£ä¹ˆåè°ƒè€…å’Œå…¶ä»–çš„å‚ä¸è€…æ‰§è¡Œçš„è‚¯å®šä¹Ÿæ˜¯rollbackæ“ä½œã€‚&lt;/strong>&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œå†å¤šå¼•å…¥ä¸€ä¸ªé˜¶æ®µä¹‹åï¼Œ3PCè§£å†³äº†2PCä¸­å­˜åœ¨çš„é‚£ç§ç”±äºåè°ƒè€…å’Œå‚ä¸è€…åŒæ—¶æŒ‚æ‰æœ‰å¯èƒ½å¯¼è‡´çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚&lt;/p>
&lt;h3 id="3pcå­˜åœ¨çš„é—®é¢˜">3PCå­˜åœ¨çš„é—®é¢˜&lt;/h3>
&lt;p>åœ¨doCommité˜¶æ®µï¼Œå¦‚æœå‚ä¸è€…æ— æ³•åŠæ—¶æ¥æ”¶åˆ°æ¥è‡ªåè°ƒè€…çš„doCommitæˆ–è€…rebortè¯·æ±‚æ—¶ï¼Œä¼šåœ¨ç­‰å¾…è¶…æ—¶ä¹‹åï¼Œä¼šç»§ç»­è¿›è¡Œäº‹åŠ¡çš„æäº¤ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œç”±äºç½‘ç»œåŸå› ï¼Œåè°ƒè€…å‘é€çš„abortå“åº”æ²¡æœ‰åŠæ—¶è¢«å‚ä¸è€…æ¥æ”¶åˆ°ï¼Œé‚£ä¹ˆå‚ä¸è€…åœ¨ç­‰å¾…è¶…æ—¶ä¹‹åæ‰§è¡Œäº†commitæ“ä½œã€‚è¿™æ ·å°±å’Œå…¶ä»–æ¥åˆ°abortå‘½ä»¤å¹¶æ‰§è¡Œå›æ»šçš„å‚ä¸è€…ä¹‹é—´å­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ&lt;/p>
&lt;p>å‚è€ƒï¼š&lt;a href="https://blog.csdn.net/yyd19921214/article/details/68953629?utm_source=app&amp;amp;app_version=4.6.1">åˆ†å¸ƒå¼äº‹åŠ¡ä¸­2PCä¸3PCçš„åŒºåˆ«&lt;/a>&lt;/p>
&lt;h1 id="pcçš„åº”ç”¨">PCçš„åº”ç”¨&lt;/h1>
&lt;h2 id="æ³¨æ„">æ³¨æ„&lt;/h2>
&lt;p>ä¸€èˆ¬çš„ä¸»ä»åŒæ­¥å¹¶ä¸æ¶‰åŠç›¸å…³çš„åˆ†å¸ƒå¼åè®®ï¼ŒåŸºæœ¬éƒ½æ˜¯å¼‚æ­¥ä½¿ç”¨æ—¥å¿—æˆ–é•œåƒè¿›è¡Œä¸»ä»åŒæ­¥ï¼Œè¾¾æˆæœ€ç»ˆä¸€è‡´æ€§ã€‚æ¯”å¦‚ï¼šDHFSçš„namenodeï¼Œredisçš„ä¸»ä»åŒæ­¥ä»¥åŠMySQLçš„ä¸»ä»åŒæ­¥ã€‚ä¸è¦æŠŠ2pcï¼Œ3pcï¼Œpaxosç­‰åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•æƒ³è±¡ä¸ºå¤„ç†ä¸»ä»å¤åˆ¶è¿™ä¸ªè¿‡ç¨‹çš„ç®—æ³•ã€‚&lt;/p>
&lt;h2 id="mysqlçš„2pcåº”ç”¨">mysqlçš„2pcåº”ç”¨&lt;/h2>
&lt;p>å‚è€ƒï¼š&lt;a href="https://www.cnblogs.com/hustcat/p/3577584.html">https://www.cnblogs.com/hustcat/p/3577584.html&lt;/a>&lt;/p>
&lt;h2 id="flinkçš„2pcåº”ç”¨">flinkçš„2pcåº”ç”¨&lt;/h2>
&lt;p>å‚è€ƒï¼š&lt;a href="https://www.cnblogs.com/zhipeng-wang/p/14082806.html">https://www.cnblogs.com/zhipeng-wang/p/14082806.html&lt;/a>&lt;/p>
&lt;h1 id="è¡¥å¿äº‹åŠ¡-tcc">è¡¥å¿äº‹åŠ¡ï¼ˆTCCï¼‰&lt;/h1>
&lt;p>TCCï¼ˆ&lt;strong>Try-Confirm-Cancel&lt;/strong>ï¼‰åˆç§°è¡¥å¿äº‹åŠ¡ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š&amp;quot;é’ˆå¯¹æ¯ä¸ªæ“ä½œéƒ½è¦æ³¨å†Œä¸€ä¸ªä¸å…¶å¯¹åº”çš„ç¡®è®¤å’Œè¡¥å¿ï¼ˆæ’¤é”€æ“ä½œï¼‰&amp;quot;ã€‚å®ƒåˆ†ä¸ºä¸‰ä¸ªæ“ä½œï¼š&lt;/p>
&lt;ul>
&lt;li>Tryé˜¶æ®µï¼šä¸»è¦æ˜¯å¯¹ä¸šåŠ¡ç³»ç»Ÿåšæ£€æµ‹åŠèµ„æºé¢„ç•™ã€‚&lt;/li>
&lt;li>Confirmé˜¶æ®µï¼šç¡®è®¤æ‰§è¡Œä¸šåŠ¡æ“ä½œã€‚&lt;/li>
&lt;li>Cancelé˜¶æ®µï¼šå–æ¶ˆæ‰§è¡Œä¸šåŠ¡æ“ä½œã€‚&lt;/li>
&lt;/ul>
&lt;p>TCCæ˜¯åº”ç”¨å±‚çš„2PCå®ç°&lt;/p>
&lt;p>TCCäº‹åŠ¡çš„å¤„ç†æµç¨‹ä¸2PCä¸¤é˜¶æ®µæäº¤ç±»ä¼¼ï¼Œä¸è¿‡2PCé€šå¸¸éƒ½æ˜¯åœ¨è·¨åº“çš„DBå±‚é¢ï¼Œè€ŒTCCæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªåº”ç”¨å±‚é¢çš„2PCï¼Œ&lt;strong>éœ€è¦é€šè¿‡ä¸šåŠ¡é€»è¾‘æ¥å®ç°&lt;/strong>ã€‚è¿™ç§åˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°æ–¹å¼çš„ä¼˜åŠ¿åœ¨äºï¼Œå¯ä»¥è®©&lt;strong>åº”ç”¨è‡ªå·±å®šä¹‰æ•°æ®åº“æ“ä½œçš„ç²’åº¦ï¼Œä½¿å¾—é™ä½é”å†²çªã€æé«˜ååé‡æˆä¸ºå¯èƒ½&lt;/strong>ã€‚&lt;/p>
&lt;p>è€Œä¸è¶³ä¹‹å¤„åˆ™åœ¨äº&lt;strong>å¯¹åº”ç”¨çš„ä¾µå…¥æ€§éå¸¸å¼º&lt;/strong>ï¼Œä¸šåŠ¡é€»è¾‘çš„æ¯ä¸ªåˆ†æ”¯éƒ½éœ€è¦å®ç°tryã€confirmã€cancelä¸‰ä¸ªæ“ä½œã€‚æ­¤å¤–ï¼Œå…¶å®ç°éš¾åº¦ä¹Ÿæ¯”è¾ƒå¤§ï¼Œéœ€è¦æŒ‰ç…§ç½‘ç»œçŠ¶æ€ã€ç³»ç»Ÿæ•…éšœç­‰ä¸åŒçš„å¤±è´¥åŸå› å®ç°ä¸åŒçš„å›æ»šç­–ç•¥ã€‚ä¸ºäº†æ»¡è¶³ä¸€è‡´æ€§çš„è¦æ±‚ï¼Œ&lt;strong>confirmå’Œcancelæ¥å£è¿˜å¿…é¡»å®ç°å¹‚ç­‰&lt;/strong>ã€‚&lt;/p>
&lt;p>TCCçš„å…·ä½“åŸç†å›¾å¦‚ğŸ‘‡ï¼š&lt;/p>
&lt;p>&lt;img src="../imgs/distributed_consistency_211219_3.png" alt="distributed_consistency_211219_3.png">&lt;/p>
&lt;h2 id="2pcæ¯”è¾ƒ-æ•°æ®åº“vsåº”ç”¨">2PCæ¯”è¾ƒï¼šæ•°æ®åº“VSåº”ç”¨&lt;/h2>
&lt;p>æ¯”è¾ƒå®¹æ˜“å–å¾—å…±è¯†çš„ç»“è®ºï¼šä¸åŒä¸šåŠ¡ç³»ç»Ÿä¹‹é—´ä½¿ç”¨2PCã€‚&lt;/p>
&lt;p>é‚£å‰©ä¸‹çš„é—®é¢˜å°±ç®€å•äº†, ç›¸åŒä¸šåŠ¡ç³»ç»Ÿä¹‹é—´æ˜¯ä½¿ç”¨æ•°æ®è®¿é—®å±‚2PCè¿˜æ˜¯TCCï¼Ÿä¸€èˆ¬è€Œè¨€ï¼ŒåŸºäºç ”å‘æˆæœ¬è€ƒè™‘ï¼Œä¼šå»ºè®®ï¼šæ–°ç³»ç»Ÿç”±æ•°æ®åº“å±‚æ¥å®ç°ç»Ÿä¸€çš„åˆ†å¸ƒå¼äº‹åŠ¡ã€‚&lt;/p>
&lt;p>ä½†å¯¹çƒ­ç‚¹æ•°æ®ï¼Œä¾‹å¦‚å•†å“ï¼ˆç¥¨åˆ¸ç­‰ï¼‰åº“å­˜ï¼Œå»ºè®®ä½¿ç”¨TCCæ–¹æ¡ˆï¼Œå› ä¸ºTCCçš„ä¸»è¦ä¼˜åŠ¿æ­£æ˜¯å¯ä»¥é¿å…é•¿æ—¶é—´é”å®šæ•°æ®åº“èµ„æºè¿›è€Œæé«˜å¹¶å‘æ€§ã€‚&lt;/p>
&lt;p>2PCã€3PCã€TCCéƒ½æ˜¯åŸºäºXAåè®®æ€æƒ³ï¼ŒTCCæ˜¯åº”ç”¨å±‚/ä¸šåŠ¡å±‚ï¼ŒTCCå®é™…ä¸Šä¸º2PCçš„å˜ç§ã€‚&lt;/p>
&lt;h2 id="2pcä¸paxos">2PCä¸Paxos&lt;/h2>
&lt;p>æœ‰ä¸€ç§å¹¿ä¸ºæµä¼ çš„è§‚ç‚¹:&amp;quot;2PCåˆ°3PCåˆ°Paxosåˆ°Raft&amp;quot;ï¼Œå³è®¤ä¸º:&lt;/p>
&lt;p>â€¢ 2PCæ˜¯Paxosçš„æ®‹æ¬¡ç‰ˆæœ¬&lt;/p>
&lt;p>â€¢ 3PCæ˜¯2PCçš„æ”¹è¿›&lt;/p>
&lt;p>ä¸Šè¿°2ä¸ªè§‚ç‚¹éƒ½æ˜¯æˆ‘æ‰€ä¸è®¤åŒçš„ï¼Œæ›´å€¾å‘äºå¦‚ä¸‹è®¤çŸ¥ï¼š&lt;/p>
&lt;p>â€¢ 2PCä¸Paxosè§£å†³çš„é—®é¢˜ä¸åŒï¼š2PCæ˜¯ç”¨äºè§£å†³æ•°æ®åˆ†ç‰‡åï¼Œä¸åŒæ•°æ®ä¹‹é—´çš„åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼›è€ŒPaxosæ˜¯è§£å†³ç›¸åŒæ•°æ®å¤šå‰¯æœ¬ä¸‹çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚ä¾‹å¦‚ï¼ŒUP-2PCçš„æ•°æ®å­˜å‚¨èŠ‚ç‚¹å¯ä»¥ä½¿ç”¨MGRæ¥ç®¡ç†ç»Ÿä¸€æ•°æ®åˆ†ç‰‡çš„é«˜å¯ç”¨&lt;/p>
&lt;p>â€¢ 3PCåªæ˜¯2PCçš„ä¸€ä¸ªå®è·µæ–¹æ³•ï¼šä¸€æ–¹é¢å¹¶æ²¡æœ‰å®Œæ•´è§£å†³äº‹åŠ¡ç®¡ç†å™¨å®•æœºå’Œèµ„æºç®¡ç†å™¨å®•æœºç­‰å¼‚å¸¸ï¼Œåè€Œå› ä¸ºå¢åŠ äº†ä¸€ä¸ªå¤„ç†é˜¶æ®µè®©é—®é¢˜æ›´åŠ å¤æ‚&lt;/p>
&lt;h1 id="paxosç®—æ³•">Paxosç®—æ³•&lt;/h1>
&lt;p>è¯»éŸ³ï¼š/pakses/&lt;/p>
&lt;p>Paxosç®—æ³•æ˜¯LeslieLamport1990å¹´æå‡ºçš„ä¸€ç§ä¸€è‡´æ€§ç®—æ³•, è¯¥ç®—æ³•æ˜¯ä¸€ç§æé«˜åˆ†å¸ƒå¼ç³»ç»Ÿå®¹é”™æ€§çš„ä¸€è‡´æ€§ç®—æ³•, è§£å†³äº†3PCä¸­ç½‘ç»œåˆ†åŒºçš„é—®é¢˜, paxosç®—æ³•å¯ä»¥åœ¨èŠ‚ç‚¹å¤±æ•ˆã€ç½‘ç»œåˆ†åŒºã€ç½‘ç»œå»¶è¿Ÿç­‰å„ç§å¼‚å¸¸æƒ…å†µä¸‹ä¿è¯æ‰€æœ‰èŠ‚ç‚¹éƒ½å¤„äºåŒä¸€çŠ¶æ€, åŒæ—¶paxosç®—æ³•å¼•å…¥äº†â€œè¿‡åŠâ€œç†å¿µ, å³å°‘æ•°æœä»å¤šæ•°åŸåˆ™ã€‚&lt;/p>
&lt;p>&lt;strong>paxosæœ‰ä¸‰ä¸ªç‰ˆæœ¬:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>BasicPaxos&lt;/li>
&lt;li>MultiPaxos&lt;/li>
&lt;li>FastPaxos&lt;/li>
&lt;/ul>
&lt;h2 id="å››ç§è§’è‰²">å››ç§è§’è‰²&lt;/h2>
&lt;p>åœ¨paxosç®—æ³•ä¸­, æœ‰å››ç§ç§è§’è‰², åˆ†åˆ«å…·æœ‰ä¸‰ç§ä¸åŒçš„è¡Œä¸º, ä½†å¤šæ•°æƒ…å†µ, ä¸€ä¸ªè¿›ç¨‹å¯èƒ½åŒæ—¶å……å½“å¤šç§è§’è‰²ã€‚&lt;/p>
&lt;ul>
&lt;li>client: ç³»ç»Ÿå¤–éƒ¨è§’è‰², è¯·æ±‚å‘èµ·è€…, ä¸å‚ä¸å†³ç­–&lt;/li>
&lt;li>proposer: ææ¡ˆæè®®è€…&lt;/li>
&lt;li>acceptor: ææ¡ˆçš„è¡¨å†³è€…, å³æ˜¯å¦acceptè¯¥ææ¡ˆ, åªæœ‰è¶…è¿‡åŠæ•°ä»¥ä¸Šçš„acceptoræ¥å—äº†ææ¡ˆ, è¯¥ææ¡ˆæ‰è¢«è®¤ä¸ºè¢«â€œé€‰å®šâ€œ&lt;/li>
&lt;li>learners: ææ¡ˆçš„å­¦ä¹ è€…, å½“ææ¡ˆè¢«é€‰å®šå, å…¶åŒæ­¥æ‰§è¡Œææ¡ˆ, ä¸å‚ä¸å†³ç­–&lt;/li>
&lt;/ul>
&lt;h2 id="ä¸¤ä¸ªé˜¶æ®µ">ä¸¤ä¸ªé˜¶æ®µ&lt;/h2>
&lt;p>prepareé˜¶æ®µï¼ˆå‡†å¤‡è§£å†³ï¼‰ã€accepté˜¶æ®µï¼ˆåŒæ„é˜¶æ®µï¼‰&lt;/p>
&lt;p>1ã€prepareé˜¶æ®µ&lt;/p>
&lt;p>&amp;lt;1&amp;gt; proposeræå‡ºä¸€ä¸ªææ¡ˆ, ç¼–å·ä¸ºN, å‘é€ç»™æ‰€æœ‰çš„acceptorã€‚&lt;/p>
&lt;p>&amp;lt;2&amp;gt; æ¯ä¸ªè¡¨å†³è€…éƒ½ä¿å­˜è‡ªå·±çš„acceptçš„æœ€å¤§ææ¡ˆç¼–å·maxN, å½“è¡¨å†³è€…æ”¶åˆ°prepare(N) è¯·æ±‚æ—¶, ä¼šæ¯”è¾ƒNä¸maxNçš„å€¼, è‹¥Nå°äºmaxN, åˆ™ææ¡ˆå·²è¿‡æ—¶, æ‹’ç»prepare(N) è¯·æ±‚ã€‚è‹¥Nå¤§äºç­‰äºmaxN, åˆ™æ¥å—ææ¡ˆ, å¹¶å°†è¯¥è¡¨å†³è€…æ›¾ç»æ¥å—è¿‡çš„ç¼–å·æœ€å¤§çš„ææ¡ˆProposal(myid, maxN, wvalue) åé¦ˆç»™æè®®è€…: å…¶ä¸­myidè¡¨ç¤ºè¡¨å†³è€…acceptorçš„æ ‡è¯†id, maxNè¡¨ç¤ºæ¥å—è¿‡çš„æœ€å¤§ææ¡ˆç¼–å·maxN, valueè¡¨ç¤ºææ¡ˆå†…å®¹ã€‚è‹¥å½“å‰è¡¨å†³è€…æœªæ›¾acceptä»»ä½•æè®®, ä¼šå°†proposal(myid, nullnull) åé¦ˆç»™æè®®è€…ã€‚&lt;/p>
&lt;p>2ã€accepté˜¶æ®µ&lt;/p>
&lt;p>&amp;lt;1&amp;gt; æè®®è€…proposa|å‘å‡ºprepare(N) , è‹¥æ”¶åˆ°è¶…è¿‡åŠæ•°è¡¨å†³è€…acceptorçš„åé¦ˆ, proposalå°†çœŸæ­£çš„ææ¡ˆå†…å®¹proposal(N, wvalue) å‘é€ç»™æ‰€æœ‰è¡¨å†³è€…ã€‚&lt;/p>
&lt;p>&amp;lt;2&amp;gt; è¡¨å†³è€…aCCeptoræ¥å—æè®®è€…å‘é€çš„proposalææ¡ˆå, ä¼šå°†è‡ªå·±æ›¾ç»acceptè¿‡çš„æœ€å¤§&lt;/p>
&lt;p>ææ¡ˆç¼–å·maxNå’Œåé¦ˆè¿‡çš„prepareçš„æœ€å¤§ç¼–å·, è‹¥Nå¤§äºè¿™ä¸¤ä¸ªç¼–å·, åˆ™å½“å‰è¡¨å†³è€…acceptè¯¥æ&lt;/p>
&lt;p>æ¡ˆ, å¹¶åé¦ˆç»™æè®®è€…ã€‚å¦åˆ™æ‹’ç»è¯¥æè®®ã€‚&lt;/p>
&lt;p>&amp;lt;3&amp;gt; è‹¥æè®®è€…æ²¡æœ‰æ”¶åˆ°åŠæ•°ä»¥ä¸Šçš„è¡¨å†³è€…acceptåé¦ˆ, åˆ™é‡æ–°è¿›å…¥prepareé˜¶æ®µ, é€’å¢ææ¡ˆç¼–å·,Â &lt;/p>
&lt;p>é‡æ–°æå‡ºprepareè¯·æ±‚ã€‚è‹¥æ”¶åˆ°åŠæ•°ä»¥ä¸Šçš„accept, åˆ™å…¶ä»–æœªå‘æè®®è€…åé¦ˆçš„è¡¨å†³è€…ç§°ä¸º&lt;/p>
&lt;p>learner, ä¸»åŠ¨åŒæ­¥æè®®è€…çš„ææ¡ˆã€‚&lt;/p>
&lt;p>æ­£å¸¸æµç¨‹&lt;/p>
&lt;p>&lt;img src="../imgs/distributed_consistency_211219_4.png" alt="distributed_consistency_211219_4.png">&lt;/p>
&lt;p>å•ç‚¹æ•…éšœï¼Œéƒ¨åˆ†èŠ‚ç‚¹å¤±è´¥&lt;/p>
&lt;p>&lt;img src="../imgs/distributed_consistency_211219_5.png" alt="distributed_consistency_211219_5.png">&lt;/p>
&lt;p>proposerå¤±è´¥&lt;/p>
&lt;p>&lt;img src="../imgs/distributed_consistency_211219_6.png" alt="distributed_consistency_211219_6.png">&lt;/p>
&lt;p>&lt;img src="../imgs/distributed_consistency_211219_7.png" alt="distributed_consistency_211219_7.png">&lt;/p>
&lt;p>Basic Paxosç®—æ³•å­˜åœ¨æ´»é”é—®é¢˜ï¼ˆlivenessï¼‰æˆ–å…¨åºé—®é¢˜&lt;/p>
&lt;blockquote>
&lt;p>æ´»é”ï¼šå¹¶å‘å¯¼è‡´çš„ä½ è®©æˆ‘æˆ‘è®©ä½ ï¼Œå¦‚å¯¹é¢èµ°è·¯äº’ç›¸è®©è·¯è¿˜æ˜¯ä¼šå†²çªã€‚é¿å…æ´»é”ï¼šæ‰§è¡Œæ—¶é—´é”™å¼€ã€‚
æ³¨æ„Basic Paxosçš„æ´»é”åŸå› æ˜¯proposer1åœ¨å‘é€è¯·æ±‚ç»™accepterä¹‹åæŒ‚æ‰äº†ï¼Œç„¶åproposer2åˆå‘accepterå‘é€äº†æ–°çš„è¯·æ±‚ï¼Œç„¶åå¯¼è‡´çš„æ´»é”é—®é¢˜ã€‚æ›´æ·±å±‚proposerå¯ä»¥æœ‰å¤šä¸ªï¼Œæ‰€ä»¥mutil paxosé‡‡ç”¨äº†leaderï¼ˆå•ä¸ªï¼‰æ›¿ä»£proposerï¼ˆå¤šä¸ªï¼‰è§£å†³æ´»é”é—®é¢˜ï¼Œå¦‚æœleaderæŒ‚æ‰å°±é‡æ–°é€‰ä¸¾ï¼Œéƒ½æ˜¯leaderè¯´äº†ç®—å°±ä¸ä¼šäº§ç”Ÿæ´»é”é—®é¢˜äº†ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="æ¶ˆåŒ–ç†è§£">æ¶ˆåŒ–ç†è§£&lt;/h2>
&lt;h3 id="paxosç®—æ³•-1">paxosç®—æ³•&lt;/h3>
&lt;p>åŸºäºæ¶ˆæ¯ä¼ é€’ä¸€å…³æœ‰é«˜åº¦å®¹é”™æ€§çš„ä¸€ç§ç®—æ³•, æ˜¯ç›®å‰å…¬è®¤çš„è§£å†³åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜æœ€æœ‰æ•ˆçš„ç®—æ³•&lt;/p>
&lt;h3 id="é‡è¦æ¦‚å¿µ">é‡è¦æ¦‚å¿µ&lt;/h3>
&lt;p>åŠæ•°åŸåˆ™: å°‘æ•°æœä»å¤šæ•°&lt;/p>
&lt;h3 id="è§£å†³é—®é¢˜">è§£å†³é—®é¢˜&lt;/h3>
&lt;p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­, å¦‚æœäº§ç”Ÿå®¹æœºæˆ–è€…ç½‘ç»œå¼‚å¸¸æƒ…å†µ, å¿«é€Ÿçš„æ­£ç¡®çš„åœ¨é›†ç¾¤å†…éƒ¨å¯¹æŸ“ä¸ªæ•°æ®çš„ä¿¡è¾¾æˆä¸€è‡´, å¹¶çŸä¸ç®¡å‘ç”Ÿä»»ä½•å¼‚å¸¸, éƒ½ä¸ä¼šç ´åæ•´ä¸ªç³»ç»Ÿçš„ä¸€è‡´æ€§&lt;/p>
&lt;h4 id="å¤æ‚åº¦é—®é¢˜">å¤æ‚åº¦é—®é¢˜&lt;/h4>
&lt;p>ä¸ºäº†è§£å†³æ´»é”é—®é¢˜ï¼Œå‡ºç°äº†multi-paxosï¼›&lt;/p>
&lt;p>ä¸ºäº†è§£å†³é€šä¿¡æ¬¡æ•°è¾ƒå¤šçš„é—®é¢˜ï¼Œå‡ºç°äº†fast-paxosï¼›&lt;/p>
&lt;p>ä¸ºäº†å°½é‡å‡å°‘å†²çªï¼Œå‡ºç°äº†epaxosã€‚&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œå·¥ä¸šçº§å®ç°éœ€è¦è€ƒè™‘æ›´å¤šçš„æ–¹é¢ï¼Œè¯¸å¦‚æ€§èƒ½ï¼Œå¼‚å¸¸ç­‰ç­‰ã€‚è¿™ä¹Ÿæ˜¯è®¸å¤šåˆ†å¸ƒå¼çš„ä¸€è‡´æ€§æ¡†æ¶å¹¶éçœŸæ­£åŸºäºpaxosæ¥å®ç°çš„åŸå› ã€‚&lt;/p>
&lt;h4 id="å…¨åºé—®é¢˜">å…¨åºé—®é¢˜&lt;/h4>
&lt;p>å¯¹äºpaxosç®—æ³•æ¥è¯´ï¼Œä¸èƒ½ä¿è¯ä¸¤æ¬¡æäº¤æœ€ç»ˆçš„é¡ºåºï¼Œè€Œzookeeperéœ€è¦åšåˆ°è¿™ç‚¹ã€‚&lt;/p>
&lt;h3 id="ç†è§£basic-paxosç»†èŠ‚">ç†è§£basic paxosç»†èŠ‚&lt;/h3>
&lt;ul>
&lt;li>proposeræ˜¯å¯ä»¥æœ‰å¤šä¸ªï¼Œæ‰€ä»¥ä»–å«åšproposerï¼Œè€Œä¸å«leader&lt;/li>
&lt;li>proposerå¹¶ä¸å¼ºåˆ¶è¦å‘é€proposeåˆ°å…¨éƒ¨acceptorï¼Œä¹Ÿå¯ä»¥å‘é€70%çš„acceptorï¼Œåªè¦é€šè¿‡çš„æœ‰åŠæ•°ä»¥ä¸Šï¼Œå°±è®¤ä¸ºåè®®æ˜¯æˆåŠŸçš„&lt;/li>
&lt;li>å®¹æ˜“çœ‹å‡ºï¼Œç¬¬äºŒé˜¶æ®µçš„æ—¶å€™clientä»éœ€è¦ç­‰ç€ï¼Œåªæœ‰åœ¨ç¬¬äºŒé˜¶æ®µå¤§åŠacceptorè¿”å›acceptedåï¼Œclientæ‰èƒ½å¾—åˆ°æˆåŠŸçš„ä¿¡æ¯&lt;/li>
&lt;li>æœ‰ä¸€äº›é”™è¯¯åœºæ™¯ä¸­ï¼Œproposerä¼šäº’ç›¸é”ä½å¯¹æ–¹çš„é€’äº¤ï¼Œè¯¦ç»†å¯ä»¥çœ‹wikiï¼Œè¿™é‡Œä¸å¤šé˜è¿°ï¼š&lt;a href="https://en.wikipedia.org/wiki/Paxos_(computer_science)">Paxos (computer science)&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="multi-paxos">Multi Paxos&lt;/h2>
&lt;h3 id="æ”¹è¿›ç‚¹">æ”¹è¿›ç‚¹&lt;/h3>
&lt;ul>
&lt;li>Multi Paxosä¸­é‡‡ç”¨äº† Leader election ä¿è¯äº†åªæœ‰ä¸€ä¸ªProposerï¼Œé¿å…äº†æ´»é”çš„é—®é¢˜&lt;/li>
&lt;li>Basic Paxosä¸­åªæœ‰ProposerçŸ¥é“ é€‰æ‹©äº†å“ªä¸ªvalueï¼Œå¦‚æœå…¶ä»–serveræƒ³çŸ¥é“é€‰æ‹©äº†å“ªä¸ªï¼Œé‚£ä¹ˆå°±å¾—æŒ‰ç…§paxosåè®®å‘èµ·è¯·æ±‚ã€‚&lt;/li>
&lt;li>multi paxos ç›®æ ‡æ˜¯å®ç°å¤åˆ¶æ—¥å¿—åºåˆ—ï¼›å®ç°çš„æ—¶å€™æˆ‘ä»¬åœ¨Prepareå’Œacceptçš„æ—¶å€™ï¼ŒåŠ ä¸Šæ—¥å¿—è®°å½•çš„åºå·å³å¯ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="fast-paxos">&lt;strong>Fast Paxos&lt;/strong>&lt;/h2>
&lt;p>åœ¨Multi Paxosä¸­ï¼Œ&lt;strong>proposer -&amp;gt; leader -&amp;gt; acceptor -&amp;gt; learner&lt;/strong>ï¼Œä»æè®®åˆ°å®Œæˆå†³è®®å…±ç»è¿‡3æ¬¡é€šä¿¡ï¼Œèƒ½ä¸èƒ½å‡å°‘é€šä¿¡æ­¥éª¤ï¼Ÿ&lt;/p>
&lt;p>å¯¹Multi Paxos phase2aï¼Œå¦‚æœå¯ä»¥è‡ªç”±æè®®valueï¼Œåˆ™å¯ä»¥è®©proposerç›´æ¥å‘èµ·æè®®ã€leaderé€€å‡ºé€šä¿¡è¿‡ç¨‹ï¼Œå˜ä¸º&lt;strong>proposer -&amp;gt; acceptor -&amp;gt; learner&lt;/strong>ï¼Œè¿™å°±æ˜¯Fast Paxos[2]çš„ç”±æ¥ã€‚&lt;/p>
&lt;p>Multi Paxosé‡Œæè®®éƒ½ç”±leaderæå‡ºï¼Œå› è€Œä¸å­˜åœ¨ä¸€æ¬¡å†³è®®å‡ºç°å¤šä¸ªvalueï¼ŒFast Paxosé‡Œç”±proposerç›´æ¥æè®®ï¼Œä¸€æ¬¡å†³è®®é‡Œå¯èƒ½æœ‰å¤šä¸ªproposeræè®®ã€å‡ºç°å¤šä¸ªvalueï¼Œå³å‡ºç°æè®®å†²çª(collision)ã€‚&lt;strong>leaderèµ·åˆ°åˆå§‹åŒ–å†³è®®è¿›ç¨‹(progress)å’Œè§£å†³å†²çªçš„ä½œç”¨ï¼Œå½“å†²çªå‘ç”Ÿæ—¶leaderé‡æ–°å‚ä¸å†³è®®è¿‡ç¨‹ã€å›é€€åˆ°3æ¬¡é€šä¿¡æ­¥éª¤ã€‚&lt;/strong>&lt;/p>
&lt;p>Paxosè‡ªèº«éšå«çš„ä¸€ä¸ªç‰¹æ€§ä¹Ÿå¯ä»¥è¾¾åˆ°å‡å°‘é€šä¿¡æ­¥éª¤çš„ç›®æ ‡ï¼Œå¦‚æœacceptorä¸Šä¸€æ¬¡ç¡®å®š(chosen)çš„æè®®æ¥è‡ªproposerAï¼Œåˆ™å½“æ¬¡å†³è®®proposerAå¯ä»¥ç›´æ¥æè®®å‡å°‘ä¸€æ¬¡é€šä¿¡æ­¥éª¤ã€‚å¦‚æœæƒ³å®ç°è¿™æ ·çš„æ•ˆæœï¼Œéœ€è¦åœ¨proposerã€acceptorè®°å½•ä¸Šä¸€æ¬¡å†³è®®ç¡®å®š(chosen)çš„å†å²ï¼Œç”¨ä»¥åœ¨æè®®å‰çŸ¥é“å“ªä¸ªproposerçš„æè®®ä¸Šä¸€æ¬¡è¢«ç¡®å®šã€å½“æ¬¡å†³è®®èƒ½ä¸èƒ½èŠ‚çœä¸€æ¬¡é€šä¿¡æ­¥éª¤ã€‚&lt;/p>
&lt;h2 id="epaxos">&lt;strong>EPaxos&lt;/strong>&lt;/h2>
&lt;p>é™¤äº†ä»å‡å°‘é€šä¿¡æ­¥éª¤çš„è§’åº¦æé«˜Paxoså†³è®®æ•ˆç‡å¤–ï¼Œè¿˜æœ‰å…¶ä»–æ–¹é¢å¯ä»¥é™ä½Paxoså†³è®®æ—¶å»¶ï¼Œæ¯”å¦‚Generalized Paxos[3]æå‡ºä¸å†²çªçš„æè®®(ä¾‹å¦‚å¯¹ä¸åŒkeyçš„å†™è¯·æ±‚)å¯ä»¥åŒæ—¶å†³è®®ã€ä»¥é™ä½Paxosæ—¶å»¶ã€‚&lt;/p>
&lt;p>æ›´è¿›ä¸€æ­¥åœ°ï¼ŒEPaxos[4](Egalitarian Paxos)æå‡ºä¸€ç§æ—¢æ”¯æŒä¸å†²çªæè®®åŒæ—¶æäº¤é™ä½æ—¶å»¶ã€è¿˜å‡è¡¡å„èŠ‚ç‚¹è´Ÿè½½ã€åŒæ—¶å°†é€šä¿¡æ­¥éª¤å‡å°‘åˆ°æœ€å°‘çš„Paxosä¼˜åŒ–æ–¹æ³•ã€‚&lt;/p>
&lt;p>ä¸ºè¾¾åˆ°è¿™äº›ç›®æ ‡ï¼ŒEPaxosçš„å®ç°æœ‰å‡ ä¸ªè¦ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¸€æ˜¯EPaxosä¸­æ²¡æœ‰å…¨å±€çš„leaderï¼Œè€Œæ˜¯æ¯ä¸€æ¬¡æè®®å‘èµ·æè®®çš„proposerä½œä¸ºå½“æ¬¡æè®®çš„leader(command leader)ï¼›&lt;/li>
&lt;li>äºŒæ˜¯ä¸ç›¸äº’å½±å“(interfere)çš„æè®®å¯ä»¥åŒæ—¶æäº¤ï¼›&lt;/li>
&lt;li>ä¸‰æ˜¯è·³è¿‡prepareï¼Œç›´æ¥è¿›å…¥accepté˜¶æ®µã€‚&lt;/li>
&lt;/ul>
&lt;h1 id="zabåè®®">ZABåè®®&lt;/h1>
&lt;p>ç”±äºpaxosç®—æ³•çªç°èµ·æ¥è¾ƒéš¾, å­˜åœ¨æ´»é”å’Œå…¨åºé—®é¢˜(æ— æ³•ä¿è¯ä¸¤æ¬¡æœ€ç»ˆæäº¤çš„é¡ºåº) , æ‰€ä»¥zookeeperå¹¶æ²¡æœ‰ä½¿ç”¨paxosä½œä¸ºä¸€è‡´æ€§åè®®, è€Œæ˜¯ä½¿ç”¨äº†ZABåè®®ã€‚&lt;/p>
&lt;p>ZABï¼ˆzookeeper atomic broadcast) : æ˜¯ä¸€ç§æ”¯æŒå´–æºƒæ¢å¤çš„åŸå­å¹¿æ’­åè®®, åŸºäº&lt;strong>multi&lt;/strong> &lt;strong>paxos&lt;/strong>å®ç°&lt;/p>
&lt;p>ZooKeeperä½¿ç”¨&lt;strong>å•ä¸€ä¸»è¿›ç¨‹Leaderç”¨äºå¤„ç†å®¢æˆ·ç«¯æ‰€æœ‰äº‹åŠ¡è¯·æ±‚, , å³å†™è¯·æ±‚&lt;/strong>ã€‚å½“æœåŠ¡å™¨æ•°æ®å‘ç”Ÿå˜æ›´å¥½, é›†ç¾¤é‡‡ç”¨ZABåŸå­å¹¿æ’­åè®®, ä»¥äº‹åŠ¡æäº¤proposalçš„å½¢å¼å¹¿æ’­åˆ°æ‰€æœ‰çš„å‰¯æœ¬è¿›ç¨‹, æ¯ä¸€ä¸ªäº‹åŠ¡åˆ†é…ä¸€ä¸ªå…¨å±€çš„é€’å¢çš„äº‹åŠ¡ç¼–å·xidã€‚&lt;/p>
&lt;p>&lt;strong>è‹¥å®¢æˆ·ç«¯æäº¤çš„è¯·æ±‚ä¸ºè¯»è¯·æ±‚æ—¶, åˆ™æ¥å—è¯·æ±‚çš„èŠ‚ç‚¹ç›´æ¥æ ¹æ®è‡ªå·±ä¿å­˜çš„æ•°æ®å“åº”&lt;/strong>ã€‚**è‹¥æ˜¯å†™è¯·æ±‚, ä¸”å½“å‰èŠ‚ç‚¹ä¸æ˜¯leader, é‚£ä¹ˆè¯¥èŠ‚ç‚¹å°±ä¼šå°†è¯·æ±‚è½¬å‘ç»™leader, leaderä¼šä»¥ææ¡ˆçš„æ–¹å¼å¹¿æ’­æ­¤å†™è¯·æ±‚, å¦‚æœè¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹åŒæ„å†™è¯·æ±‚, åˆ™è¯¥å†™è¯·æ±‚å°±ä¼šæäº¤ã€‚**leaderä¼šé€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€…åŒæ­¥æ•°æ®ã€‚&lt;/p>
&lt;p>&lt;img src="../imgs/distributed_consistency_211219_8.png" alt="distributed_consistency_211219_8.png">&lt;/p>
&lt;h2 id="ä¸‰ç§è§’è‰²">ä¸‰ç§è§’è‰²&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>leader
è´Ÿè´£å¤„ç†é›†ç¾¤çš„å†™è¯·æ±‚ï¼Œå¹¶å‘èµ·æŠ•ç¥¨ï¼Œåªæœ‰è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹åŒæ„åæ‰ä¼šæäº¤è¯¥å†™è¯·æ±‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>follower
å¤„ç†è¯»è¯·æ±‚ï¼Œå“åº”ç»“æœã€‚è½¬å‘å†™è¯·æ±‚åˆ°leaderï¼Œåœ¨é€‰ä¸¾leaderè¿‡ç¨‹ä¸­å‚ä¸æŠ•ç¥¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>observer
å¯ä»¥ç†è§£ä¸ºæ²¡æœ‰æŠ•ç¥¨æƒçš„followerï¼Œä¸»è¦èŒè´£æ˜¯ååŠ©followerå¤„ç†è¯»è¯·æ±‚ã€‚é‚£ä¹ˆå½“æ•´ä¸ªzké›†ç¾¤è¯»è¯·æ±‚è´Ÿè½½å¾ˆé«˜æ—¶ï¼ˆæ­¤æ—¶ä¼šä½¿ç”¨observerç¼“è§£è¯»è¯·æ±‚å‹åŠ›ï¼‰ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥å¢åŠ followèŠ‚ç‚¹è€Œæ˜¯å¢åŠ observerèŠ‚ç‚¹å‘¢ï¼ŸåŸå› æ˜¯å¢åŠ followerèŠ‚ç‚¹ä¼šè®©leaderåœ¨æå‡ºå†™è¯·æ±‚ææ¡ˆæ—¶ï¼Œéœ€è¦åŠæ•°ä»¥ä¸Šçš„followeræŠ•ç¥¨èŠ‚ç‚¹åŒæ„ï¼Œè¿™æ ·ä¼šå¢åŠ leaderå’Œfoloowerçš„é€šä¿¡å‹åŠ›ï¼Œé™ä½å†™æ“ä½œæ•ˆç‡&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="ä¸¤ç§æ¨¡å¼">ä¸¤ç§æ¨¡å¼&lt;/h2>
&lt;h3 id="æ¢å¤æ¨¡å¼">æ¢å¤æ¨¡å¼&lt;/h3>
&lt;p>å½“æœåŠ¡å¯åŠ¨æˆ–é¢†å¯¼å´©æºƒå, zkè¿›å…¥æ¢å¤çŠ¶æ€, é€‰ä¸¾leader, leaderé€‰å‡ºå, å°†å®Œæˆleaderåˆ«å…¶ä»–æœºå™¨çš„æ•°æ®åŒæ­¥, å½“å¤§å¤šæ•°serverå®Œæˆå’Œleaderçš„åŒæ­¥å, æ¢å¤æ¨¡å¼ç»“æŸ&lt;/p>
&lt;h3 id="å¹¿æ’­æ¨¡å¼">å¹¿æ’­æ¨¡å¼&lt;/h3>
&lt;p>&lt;strong>ä¸€æ—¦Leaderå·²ç»å’Œå¤šæ•°çš„Followerè¿›è¡Œäº†çŠ¶æ€åŒæ­¥å, è¿›å…¥å¹¿æ’­æ¨¡å¼&lt;/strong>ã€‚è¿›å…¥å¹¿æ’­æ¨¡å¼å, å¦‚æœæœ‰&lt;/p>
&lt;p>æ–°åŠ å…¥çš„æœåŠ¡å™¨, ä¼šè‡ªåŠ¨ä»leaderä¸­åŒæ­¥æ•°æ®ã€‚leaderåœ¨æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚å, ä¼šç”Ÿæˆäº‹åŠ¡ææ¡ˆå¹¿æ’­&lt;/p>
&lt;p>ç»™å…¶ä»–æœºå™¨, æœ‰è¶…è¿‡åŠæ•°ä»¥ä¸Šçš„followeråŒæ„è¯¥æè®®å, å†æäº¤äº‹åŠ¡ã€‚&lt;/p>
&lt;p>&lt;strong>æ³¨æ„åœ¨ZABçš„äº‹åŠ¡çš„äºŒé˜¶æ®µæäº¤ä¸­, ç§»é™¤äº†äº‹åŠ¡ä¸­æ–­çš„é€»è¾‘, followerè¦ä¹ˆack, è¦ä¹ˆæ”¾å¼ƒ,Â leaderæ— éœ€ç­‰å¾…æ‰€æœ‰çš„followerçš„ackã€‚&lt;/strong>&lt;/p>
&lt;h2 id="zxid">zxid&lt;/h2>
&lt;p>zxidæ˜¯64ä½é•¿åº¦çš„Longç±»å‹, å…¶ä¸­é«˜32ä½è¡¨ç¤ºçºªå…ƒepoch, ä½32ä½è¡¨ç¤ºäº‹åŠ¡æ ‡è¯†xidã€‚å³zxidç”±ä¸¤éƒ¨åˆ†æ„æˆ: epochå’Œxid&lt;/p>
&lt;p>æ¯ä¸ªleaderéƒ½ä¼šå…·æœ‰ä¸åŒçš„epochå€¼, è¡¨ç¤ºä¸€ä¸ªçºªå…ƒ, æ¯ä¸€ä¸ªæ–°çš„é€‰ä¸¾å¼€å¯æ—¶éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„&lt;/p>
&lt;p>epoch, æ–°çš„leaderäº§ç”Ÿ, ä¼šæ›´æ–°æ‰€æœ‰çš„zKServerçš„zxidçš„epoch, xidæ˜¯ä¸€ä¸ªä¾æ¬¡é€’å¢çš„äº‹åŠ¡ç¼–å·ã€‚&lt;/p>
&lt;h2 id="leaderé€‰ä¸¾ç®—æ³•">leaderé€‰ä¸¾ç®—æ³•&lt;/h2>
&lt;h3 id="ä¸‰ä¸ªæ ¸å¿ƒé€‰ä¸¾åŸåˆ™">ä¸‰ä¸ªæ ¸å¿ƒé€‰ä¸¾åŸåˆ™&lt;/h3>
&lt;p>1ã€é›†ç¾¤ä¸­åªæœ‰è¶…è¿‡äº†åŠæ•°ä»¥ä¸Šçš„æœåŠ¡å™¨å¯åŠ¨ï¼Œé›†ç¾¤æ‰èƒ½æ­£å¸¸å·¥ä½œ&lt;/p>
&lt;p>2ã€åœ¨é›†ç¾¤æ­£å¸¸å·¥ä½œä¹‹å‰ï¼Œmyidå°çš„æœåŠ¡å™¨ä¼šç»™myidå¤§çš„æœåŠ¡å™¨è¿›è¡Œï¼ŒæŒç»­åˆ°é›†ç¾¤æ­£å¸¸å·¥ä½œï¼Œé€‰å‡ºleader&lt;/p>
&lt;p>3ã€é€‰æ‹©leaderä¹‹åï¼Œä¹‹å‰çš„æœåŠ¡å™¨çŠ¶æ€ç”±lookingæ”¹å˜ä¸ºfollowingï¼Œä»¥åçš„æœåŠ¡å™¨éƒ½æ˜¯follower&lt;/p>
&lt;p>&lt;img src="../imgs/distributed_consistency_211219_9.png" alt="distributed_consistency_211219_9.png">&lt;/p>
&lt;h3 id="å¯åŠ¨è¿‡ç¨‹">å¯åŠ¨è¿‡ç¨‹&lt;/h3>
&lt;ul>
&lt;li>æ¯ä¸€ä¸ªserverå‘å‡ºä¸€ä¸ªæŠ•ç¥¨ç»™é›†ç¾¤ä¸­å…¶ä»–èŠ‚ç‚¹&lt;/li>
&lt;li>æ”¶åˆ°å„ä¸ªæœåŠ¡å™¨çš„æŠ•ç¥¨å, åˆ¤æ–­è¯¥æŠ•ç¥¨æœ‰æ•ˆæ€§, æ¯”å¦‚æ˜¯å¦æ˜¯æœ¬è½®æŠ•ç¥¨ï¼ˆè§£å†³æ´»é”é—®é¢˜ï¼‰, æ˜¯å¦æ˜¯lookingçŠ¶æ€&lt;/li>
&lt;li>å¤„ç†æŠ•ç¥¨, pkåˆ«äººçš„æŠ•ç¥¨å’Œè‡ªå·±çš„æŠ•ç¥¨æ¯”è¾ƒè§„åˆ™xid &amp;gt; myidâ€œå–å¤§åŸåˆ™â€œ&lt;/li>
&lt;li>ç»Ÿè®¡æ˜¯å¦è¶…è¿‡åŠæ•°çš„æ¥å—ç›¸åŒçš„é€‰ç¥¨&lt;/li>
&lt;li>ç¡®è®¤leader, æ”¹å˜æœåŠ¡å™¨çŠ¶æ€&lt;/li>
&lt;li>æ·»åŠ æ–°server, leaderå·²ç»é€‰ä¸¾å‡ºæ¥, åªèƒ½ä»¥followerèº«ä»½åŠ å…¥é›†ç¾¤ä¸­&lt;/li>
&lt;/ul>
&lt;h3 id="å´©æºƒæ¢å¤è¿‡ç¨‹">å´©æºƒæ¢å¤è¿‡ç¨‹&lt;/h3>
&lt;ul>
&lt;li>leaderæŒ‚æ‰å, é›†ç¾¤ä¸­å…¶ä»–followerä¼šå°†çŠ¶æ€ä»FOLLOWINGå˜ä¸ºLOOKING, é‡æ–°è¿›å…¥leaderé€‰ä¸¾&lt;/li>
&lt;li>åŒä¸Šå¯åŠ¨è¿‡ç¨‹&lt;/li>
&lt;/ul>
&lt;h3 id="æ¶ˆæ¯å¹¿æ’­ç®—æ³•">æ¶ˆæ¯å¹¿æ’­ç®—æ³•&lt;/h3>
&lt;p>ä¸€æ—¦è¿›å…¥å¹¿æ’­æ¨¡å¼, é›†ç¾¤ä¸­éleaderèŠ‚ç‚¹æ¥å—åˆ°äº‹åŠ¡è¯·æ±‚, é¦–å…ˆä¼šå°†äº‹åŠ¡è¯·æ±‚è½¬å‘ç»™æœåŠ¡å™¨, leaderæœåŠ¡å™¨ä¸ºå…¶ç”Ÿæˆå¯¹åº”çš„äº‹åŠ¡ææ¡ˆproposalï¼Œå¹¶å‘é€ç»™é›†ç¾¤ä¸­å…¶ä»–èŠ‚ç‚¹ï¼Œå¦‚æœè¿‡åŠåˆ™äº‹åŠ¡æäº¤ï¼›&lt;/p>
&lt;p>&lt;img src="../imgs/distributed_consistency_211219_10.png" alt="distributed_consistency_211219_10.png">&lt;/p>
&lt;ul>
&lt;li>leaderæ¥æ”¶åˆ°æ¶ˆæ¯å, æ¶ˆæ¯é€šè¿‡å…¨å±€å”¯ä¸€çš„64ä½è‡ªå¢äº‹åŠ¡idï¼Œzxidæ ‡è¯†&lt;/li>
&lt;li>leaderå‘é€ç»™followerçš„ææ¡ˆæ˜¯æœ‰åºçš„, leaderä¼šåˆ›å»ºä¸€ä¸ªFIFFOé˜Ÿåˆ—, å°†ææ¡ˆé¡ºåºå†™å…¥é˜Ÿåˆ—ä¸­å‘é€ç»™follower&lt;/li>
&lt;li>followeræ¥å—åˆ°ææ¡ˆå, ä¼šæ¯”è¾ƒææ¡ˆzxidå’Œæœ¬åœ°äº‹åŠ¡æ—¥å¿—æœ€å¤§çš„zxid, è‹¥ææ¡ˆzxidæ¯”æœ¬åœ°äº‹åŠ¡idå¤§ï¼ˆä¿è¯å…¨åºï¼‰, å°†ææ¡ˆè®°å½•åˆ°æœ¬åœ°æ—¥å¿—ä¸­, åé¦ˆackç»™leader, å¦åˆ™æ‹’ç»&lt;/li>
&lt;li>leaderæ¥æ”¶åˆ°è¿‡åŠackå, leaderå‘æ‰€æœ‰çš„followerå‘é€commit, é€šçŸ¥æ¯ä¸ªfolloweræ‰§è¡Œæœ¬åœ°äº‹åŠ¡&lt;/li>
&lt;/ul>
&lt;h2 id="zabä¸paxosæ¯”è¾ƒ">ZABä¸Paxosæ¯”è¾ƒ&lt;/h2>
&lt;p>ZABå’ŒPaxosæœ€å¤§çš„ä¸åŒæ˜¯ï¼Œ&lt;strong>ZABä¸»è¦æ˜¯ä¸ºåˆ†å¸ƒå¼ä¸»å¤‡ç³»ç»Ÿè®¾è®¡çš„ï¼Œè€ŒPaxosçš„å®ç°æ˜¯ä¸€è‡´æ€§çŠ¶æ€æœº(state machine replication)&lt;/strong>&lt;/p>
&lt;p>å°½ç®¡ZABä¸æ˜¯Paxosçš„å®ç°ï¼Œä½†æ˜¯ZABä¹Ÿå‚è€ƒäº†ä¸€äº›Paxosçš„ä¸€äº›è®¾è®¡æ€æƒ³ï¼Œæ¯”å¦‚ï¼š&lt;/p>
&lt;ul>
&lt;li>leaderå‘followsæå‡ºææ¡ˆ(proposal)&lt;/li>
&lt;li>leader éœ€è¦åœ¨è¾¾åˆ°æ³•å®šæ•°é‡(åŠæ•°ä»¥ä¸Š)çš„followsç¡®è®¤ä¹‹åæ‰ä¼šè¿›è¡Œcommit&lt;/li>
&lt;li>æ¯ä¸€ä¸ªproposaléƒ½æœ‰ä¸€ä¸ªçºªå…ƒ(epoch)å·ï¼Œç±»ä¼¼äºPaxosä¸­çš„é€‰ç¥¨(ballot)&lt;/li>
&lt;/ul>
&lt;h1 id="reference">Reference&lt;/h1>
&lt;p>&lt;a href="https://www.cnblogs.com/raphael5200/p/5285583.html">zookeeperå·¥ä½œåŸç†&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://b23.tv/UpL9jf">PaxosåŸºæœ¬å…¥é—¨&lt;/a>&lt;/p></description></item><item><title>Docs: åˆ†å¸ƒå¼</title><link>/docs/41.%E5%88%86%E5%B8%83%E5%BC%8F/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/docs/41.%E5%88%86%E5%B8%83%E5%BC%8F/</guid><description>
&lt;h1 id="introduction">Introduction&lt;/h1>
&lt;p>åˆ†å¸ƒå¼&lt;/p></description></item><item><title>Docs: å¸¸è§åˆ†å¸ƒå¼æ‹“æ‰‘ç»“æ„</title><link>/docs/41.%E5%88%86%E5%B8%83%E5%BC%8F/%E5%B8%B8%E8%A7%81%E5%88%86%E5%B8%83%E5%BC%8F%E6%8B%93%E6%89%91%E7%BB%93%E6%9E%84/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/docs/41.%E5%88%86%E5%B8%83%E5%BC%8F/%E5%B8%B8%E8%A7%81%E5%88%86%E5%B8%83%E5%BC%8F%E6%8B%93%E6%89%91%E7%BB%93%E6%9E%84/</guid><description>
&lt;h1 id="èƒŒæ™¯">èƒŒæ™¯&lt;/h1>
&lt;p>åˆ†å¸ƒå¼æ¶æ„ä¸€èˆ¬æœ‰ä»¥ä¸‹å‡ ç§ç»“æ„ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¸»ä»æ¶æ„&lt;/li>
&lt;li>å»ä¸­å¿ƒåŒ–æ¶æ„&lt;/li>
&lt;li>æ··åˆå‹æ¶æ„&lt;/li>
&lt;/ul>
&lt;h1 id="redisåˆ†å¸ƒå¼æ¨¡å¼">Redisåˆ†å¸ƒå¼æ¨¡å¼&lt;/h1>
&lt;p>Redisä¸€èˆ¬æœ‰ä¸¤ç§æ¨¡å¼ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¸»ä»æ¨¡å¼&lt;/li>
&lt;li>é›†ç¾¤æ¨¡å¼ï¼ˆRedis Clusterï¼‰&lt;/li>
&lt;/ul>
&lt;h2 id="ä¸»ä»æ¨¡å¼">ä¸»ä»æ¨¡å¼&lt;/h2>
&lt;h3 id="æ ‡å‡†ä¸»ä»æ¨¡å¼">æ ‡å‡†ä¸»ä»æ¨¡å¼&lt;/h3>
&lt;p>æ ‡å‡†çš„Redisä¸»ä»æ¨¡å¼ï¼Œåªæœ‰ Master èŠ‚ç‚¹æ¥æ”¶å†™å…¥è¯·æ±‚ï¼Œå¹¶å°†å†™å…¥çš„æ•°æ®å¤åˆ¶ç»™ä¸€ä¸ªæˆ–å¤šä¸ªSlaveï¼Œå½¢æˆè‰¯å¥½çš„è¯»å†™åˆ†ç¦»æœºåˆ¶ï¼Œå¤šä¸ª Slave å¯ä»¥åˆ†æ‹…è¯»è¯·æ±‚ã€‚Redis ä¸»ä»æ˜¯æ ‡å‡†çš„åˆ†å¸ƒå¼ä¸­å¿ƒåŒ–æ€æƒ³ã€‚&lt;/p>
&lt;p>&lt;img src="../imgs/distributed_architecture_1.png" alt="distributed_architecture_1.png">&lt;/p>
&lt;h3 id="æ ‘å½¢ä¸»ä»æ¨¡å¼">æ ‘å½¢ä¸»ä»æ¨¡å¼&lt;/h3>
&lt;p>Redis åº”ç”¨åœºæ™¯å¤§å¤šæ˜¯æé«˜å¹¶å‘çš„å†…å­˜ I/Oï¼Œå¸¸è§åº”ç”¨åœºæ™¯æ˜¯ä½œä¸ºæ•°æ®åº“çš„é˜²æŠ¤ç½‘ï¼Œé˜²æ­¢æ•°æ®åº“è¢«å‡»ç©¿ï¼Œå› æ­¤æ ‡å‡†çš„ä¸»ä»æ¨¡å¼ä¸­çš„ Master å¯¹å¤–æ—¢è¦æ‰¿æ‹…å†™å…¥ï¼Œå¯¹å†…åˆè¦æ‰¿æ‹…å„ä¸ªèŠ‚ç‚¹çš„å¤åˆ¶æ“ä½œï¼Œèµ„æºæ¶ˆè€—å¾ˆå¤§ï¼Œä¸”éšç€ slave èŠ‚ç‚¹å¢å¤šé—®é¢˜è¶Šå‘æ˜æ˜¾ã€‚å› æ­¤åˆå½¢æˆä¸»ä»çš„ä¸€ä¸ªå˜å½¢å½¢å¼ã€‚&lt;/p>
&lt;p>&lt;img src="../imgs/distributed_architecture_2.png" alt="distributed_architecture_2.png">&lt;/p>
&lt;h2 id="é›†ç¾¤æ¨¡å¼">é›†ç¾¤æ¨¡å¼&lt;/h2>
&lt;p>å¯¹äºé«˜å¹¶å‘çš„ä¸šåŠ¡åœºæ™¯ï¼ŒMaster å§‹ç»ˆæ˜¯ä¸€ä¸ªéšæ‚£ã€‚å› ä¸º Master æ‰¿æ‹…ç€æ‰€æœ‰çš„å†™æ“ä½œï¼Œå¦‚æœæ²¡æœ‰HAè§£å†³æ–¹æ¡ˆä¸€æ—¦å®•æœºï¼Œé›†ç¾¤å°†ä¸å¯ç”¨ã€‚å› æ­¤ Redis ç¤¾åŒºæ¨å‡ºé›†ç¾¤æ–¹æ¡ˆï¼Œä¸»è¦æ˜¯ä¸ºäº†è§£å†³ Master å‹åŠ›ï¼Œå³é›†ç¾¤çš„åˆ†å¸ƒå¼æ— ä¸­å¿ƒæ¨¡å¼ã€‚&lt;/p>
&lt;p>&lt;img src="../imgs/distributed_architecture_3.png" alt="distributed_architecture_3.png">&lt;/p>
&lt;p>æ— ä¸­å¿ƒæ¨¡å¼é‡‡ç”¨è™šæ‹Ÿæ§½æ¦‚å¿µï¼Œç‹¬ç«‹äºç‰©ç†èŠ‚ç‚¹ã€‚è™šæ‹Ÿæ§½æœ‰ 0ï½16383 ä¸ªï¼Œæ•°æ®ä¼šè¿›è¡Œ key çš„hashè®¡ç®—ï¼Œç¡®å®šè¿›å…¥å“ªä¸ªæ§½ä½ã€‚è€Œç‰©ç†èŠ‚ç‚¹è´Ÿè´£å“ªäº›è™šæ‹Ÿæ§½ï¼Œå³å¯¹åº”å…³ç³»å¯ä»¥è‡ªè¡ŒæŒ‡å®šã€‚&lt;/p>
&lt;p>æ¯ä¸ªèŠ‚ç‚¹ï¼ˆæ•°æ®èŠ‚ç‚¹ï¼‰éƒ½æ˜¯&lt;strong>å¯¹ç­‰èŠ‚ç‚¹&lt;/strong>ã€‚æ­¤å¤–ï¼Œä¸ºäº†é«˜å¯é HAï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥å†æ¼”å˜æˆ Master å’Œ Slave çš„ä¸»ä»æ¨¡å¼éƒ¨ç½²ã€‚&lt;/p>
&lt;h2 id="å°ç»“">å°ç»“&lt;/h2>
&lt;p>Redis æœ€æˆç†Ÿçš„æ–¹æ¡ˆè¿˜æ˜¯ä¸»ä»æ¨¡å¼ï¼ŒRedis Cluster å¸¦æ¥çš„æ€§èƒ½ä¼˜åŠ¿æ— æ³•æŠµæ¶ˆå»ä¸­å¿ƒåŒ–å¸¦æ¥çš„ä¸æˆç†Ÿå’Œä¸å¯é é—®é¢˜ï¼Œå¯¼è‡´äººå·¥è¿ç»´çš„å¤æ‚åº¦å’Œéš¾åº¦ã€‚ç”Ÿäº§ä¸­æ…ç”¨ Redis Clusterã€‚&lt;/p>
&lt;h1 id="kafka">Kafka&lt;/h1>
&lt;h2 id="æ¶æ„">æ¶æ„&lt;/h2>
&lt;p>&lt;img src="../imgs/distributed_architecture_4.png" alt="distributed_architecture_4.png">&lt;/p>
&lt;p>Kafka é›†ç¾¤ä½¿ç”¨ Zookeeper é›†ç¾¤æ¥ç®¡ç†ï¼ŒBroker çš„æ³¨å†Œå‘ç°ç­‰éƒ½æ˜¯ä¾é  zookeeper æ¥ååŠ©å®Œæˆã€‚æ¯ä¸ª Broker ä¼šä»¥ä¸€ä¸»äºŒä»ï¼ˆLeader å’Œ Followerï¼‰çš„æ–¹å¼å‡åŒ€åˆ†å¸ƒã€‚&lt;/p>
&lt;p>ç”Ÿäº§è€…ï¼ˆProductï¼‰ä»ä»»æ„èŠ‚ç‚¹è·å– Meta ä¿¡æ¯ï¼Œæ‰¾åˆ° Broker ä¸­çš„ Leader åˆ†åŒºå‰¯æœ¬ï¼Œä¼šå‘é‡Œé¢å†™åˆ†é…å¥½çš„æ•°æ®ï¼ŒLeader ä¼šå‘é›†ç¾¤ä¸­å…¶ä»– Broker çš„ Follower åˆ†åŒºå‰¯æœ¬å¤åˆ¶ã€‚&lt;/p>
&lt;h2 id="å°ç»“-1">å°ç»“&lt;/h2>
&lt;p>Broker åˆ†åŒºä¿¡æ¯æ˜¯åˆ†å¸ƒåœ¨æ¯ä¸€å° Broker çš„ meta ç¼“å­˜é‡Œé¢ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¯ä»¥åœ¨ä»»æ„ä¸€å° Borker ä¸Šè·å–éœ€è¦æ“ä½œçš„ Leader åˆ†åŒºä¿¡æ¯ï¼ŒKafka è¿™ç§è®¾è®¡æœ‰ç‚¹å»ä¸­å¿ƒåŒ–çš„æ„æ€ã€‚ä½†æ˜¯è¿™äº› meta ç¼“å­˜ä¿¡æ¯å®è´¨æ˜¯æ¥è‡ª Zookeeperï¼ˆå¼ºä¾èµ–ï¼‰ï¼Œæ‰€ä»¥æœ¬è´¨ä¸Š Kafka ä¾ç„¶æ˜¯ä¸­å¿ƒåŒ–ç®¡ç†ã€‚&lt;/p>
&lt;h1 id="rocketmq">RocketMQ&lt;/h1>
&lt;h2 id="æ¶æ„-1">æ¶æ„&lt;/h2>
&lt;p>&lt;img src="../imgs/distributed_architecture_5.png" alt="distributed_architecture_5.png">&lt;/p>
&lt;p>RocketMQ æ€»ä½“ç»“æ„ä¸ Kafka ç±»ä¼¼ï¼Œæ›´é€‚åˆé«˜å¹¶å‘åœºæ™¯ï¼Œä½¿ç”¨ NameServer æ›¿ä»£äº† Zookeeperã€‚&lt;/p>
&lt;p>NameServer æ˜¯æ— ä¸­å¿ƒèŠ‚ç‚¹çš„ï¼Œéƒ½é€šè¿‡é”æ³¨å†Œè¡¨çš„æ–¹å¼å…±äº«ä¿¡æ¯ã€‚NameServer æ˜¯ Broker çš„æ³¨å†Œè¡¨ï¼ŒBroker æ–°æ³¨å†Œæˆ–è€…å¼‚å¸¸é€€å‡ºï¼Œå¯¹åº”çš„ NameSever éƒ½ä¼šæ„ŸçŸ¥åˆ°ã€‚NameServer å¢åŠ /åˆ é™¤æ‰€è¾– Broker ä¿¡æ¯åˆ°è¯¥æ³¨å†Œè¡¨ï¼Œå¹¶å®šæ—¶è¯»å–æœ€æ–°çš„é›†ç¾¤æ‰€æœ‰brokerä¿¡æ¯ã€‚&lt;/p>
&lt;p>ç”Ÿäº§è€…ï¼ˆProducetï¼‰è¿æ¥ä¸€ä¸ª NameServerï¼Œä¾¿èƒ½è·å–åˆ°æƒ³è¦å‘é€åˆ†åŒºæ•°æ®çš„ Brokersï¼ˆæ¶ˆè´¹è€…åŒç†ï¼‰ã€‚&lt;/p>
&lt;p>æ¯ä¸ª Borker å¯ä»¥å†åˆ†æˆä¸»ä»æ¨¡å¼ï¼ŒMaster è¿›è¡Œé˜Ÿåˆ—æ“ä½œï¼ŒSlave åªåšæ•°æ®åŒæ­¥ï¼ŒMaster å‡ºç°æ•…éšœæ—¶è¿›è¡Œæ›¿æ¢ã€‚&lt;/p>
&lt;h2 id="å°ç»“-2">å°ç»“&lt;/h2>
&lt;p>NameSever ç›¸å¯¹äº Zookeeper çš„ç»“æ„æ›´ç®€å•ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¯¹ Broker ä»¥åŠåˆ†åŒºçš„è·å–å¿…é¡»æ¥è‡ª NameSeverï¼Œå°½ç®¡ NameSever é›†ç¾¤æœ¬èº«æ˜¯æ— ä¸­å¿ƒçš„ï¼Œä½†æ•´ä¸ª RocketMQ çš„ Brokers æ˜¯è¢« NameSever ä¸­å¿ƒåŒ–ç®¡ç†çš„ï¼Œä½†æ•´ä½“ä¸Š Productã€Consumerã€Brokersé›†ç¾¤å¯¹è¿™ç§é›†ä¸­ç®¡ç†çš„ä¾èµ–ç¨‹åº¦å¹¶ä¸é«˜ï¼Œåªæ˜¯æä¾›äº†å¾ˆç®€å•çš„ Broker å…ƒä¿¡æ¯æœåŠ¡ï¼ŒçœŸæ­£çš„æ•°æ®æµè¿˜æ˜¯äº¤ç»™å„ä¸ªBroker è‡ªè¡Œè§£å†³ã€‚&lt;/p></description></item></channel></rss>