<!doctype html><html lang=zh-cn class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.101.0"><link rel=canonical type=text/html href=/docs/22.Golang/><link rel=alternate type=application/rss+xml href=/docs/22.Golang/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Golang | Herbdocs</title><meta name=description content="Introduction
Golang
"><meta property="og:title" content="Golang"><meta property="og:description" content="Herb's blog"><meta property="og:type" content="website"><meta property="og:url" content="/docs/22.Golang/"><meta property="og:site_name" content="Herbdocs"><meta itemprop=name content="Golang"><meta itemprop=description content="Herb's blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="Golang"><meta name=twitter:description content="Herb's blog"><link rel=preload href=/scss/main.min.dcab2c3dae6e6fefb7672f19e4b612cc4e75ca208740f642aa2f1fe378478a8f.css as=style><link href=/scss/main.min.dcab2c3dae6e6fefb7672f19e4b612cc4e75ca208740f642aa2f1fe378478a8f.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-00000000-0","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><img width=6% style=margin-bottom:1% src=/favicons/favicon.ico></span><span class=font-weight-bold>&nbsp;Herbdocs</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/about/><span>About</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/><span class=active>Documentation</span></a></li><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Chinese</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/en/>English</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; 站内搜索…" aria-label=站内搜索… autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.</p><p><a href=/docs/22.Golang/>返回本页常规视图</a>.</p></div><h1 class=title>Golang</h1><ul><li>1: <a href=#pg-ef6510fdd45ba457450941629332c5e2>go环境搭建及语法</a></li><li>2: <a href=#pg-9b4f6c8b3eaf641253b11b6438aa3ccc>Go语言基础知识01</a></li><li>3: <a href=#pg-5021b75fff9a9d3a51e6ac5b8977759a>Go语言基础知识02</a></li><li>4: <a href=#pg-f48a2c9f98ac0acb299aae1c8d50489c>util-cli</a></li><li>5: <a href=#pg-a68d3cb174e7811ff50973e90088c20b>mod包冲突解决实战01</a></li></ul><div class=content><h1 id=introduction>Introduction</h1><p>Golang</p></div></div><div class=td-content><h1 id=pg-ef6510fdd45ba457450941629332c5e2>1 - go环境搭建及语法</h1><blockquote><p>go语言基础的环境搭建和语法</p></blockquote><p>Go开发包网站</p><p><a href=https://pkg.go.dev/unicode/utf8>https://pkg.go.dev/unicode/utf8</a></p><h2 id=基本概念>基本概念</h2><h3 id=go-root>go root</h3><p>golang 的安装路径，一般为/usr/local/go</p><h3 id=go-path>go path</h3><p>个人工作路径，如/Users/admin/go_project/</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#177500># 查看go版本</span>
</span></span><span style=display:flex><span>go version
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500># 查看go环境</span>
</span></span><span style=display:flex><span>go env
</span></span><span style=display:flex><span>// 如上go root和go path路径等
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500># 设置go工作路径</span>
</span></span><span style=display:flex><span>go env -w <span style=color:#000>GOPATH</span><span style=color:#000>=</span>/Users/bo/go_project/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>go env -w <span style=color:#000>GOPROXY</span><span style=color:#000>=</span>https://goproxy.cn,direct
</span></span><span style=display:flex><span>// 私有仓库
</span></span><span style=display:flex><span>go env -w <span style=color:#000>GOPRIVATE</span><span style=color:#000>=</span>*.gitlab.com,*.gitee.com
</span></span></code></pre></td></tr></table></div></div></div><p>go代理</p><p>网站：goproxy.io</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#a90d91>export</span> <span style=color:#000>GOPROXY</span><span style=color:#000>=</span>https://goproxy.io,direct
</span></span><span style=display:flex><span><span style=color:#a90d91>export</span> <span style=color:#000>GOPRIVATE</span><span style=color:#000>=</span>git.mycompany.com,github.com/my/private
</span></span></code></pre></td></tr></table></div></div></div><h2 id=hello-world>hello world</h2><p>go_project // (go_project为GOPATH目录)</p><p>-- bin // golang编译可执行文件存放路径</p><p>-- pkg // golang编译包时，生成的.a文件存放路径</p><p>-- src // 源码路径。按照golang默认约定，go run，go install等命令的当前工作路径（即在此路径下执行上述命令）。</p><p>目录：/Users/bo/go_project/src/go_code/project01/main</p><p>创建hello.go</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>package</span> <span style=color:#000>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>import</span> <span style=color:#c41a16>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;hello&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><h3 id=创建mod>创建mod</h3><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>go mod init go-hello
</span></span><span style=display:flex><span><span style=color:#177500># go mod init github.com/rocksun/hellogo</span>
</span></span></code></pre></td></tr></table></div></div></div><h3 id=运行程序>运行程序</h3><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>go run main.go
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>go run ./ -v deploy
</span></span></code></pre></td></tr></table></div></div></div><h3 id=编译程序>编译程序</h3><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#177500># /Users/admin/go_project/src/go_code/hello_word/main</span>
</span></span><span style=display:flex><span><span style=color:#177500># 编译</span>
</span></span><span style=display:flex><span>go build go_code/hello_word/main
</span></span><span style=display:flex><span><span style=color:#177500># 或 </span>
</span></span><span style=display:flex><span>go build hello.go
</span></span><span style=display:flex><span><span style=color:#177500># 执行</span>
</span></span><span style=display:flex><span>./go_code/hello_word/main/hello
</span></span><span style=display:flex><span><span style=color:#177500># 指定名称编译</span>
</span></span><span style=display:flex><span>go build -o myhello hello.go
</span></span></code></pre></td></tr></table></div></div></div><p>格式化<style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-plain data-lang=plain><span style=display:flex><span>gofmt -w hello.go
</span></span></code></pre></td></tr></table></div></div></div></p><p>git下载包出现ssl问题：OpenSSL SSL_connect: SSL_ERROR_SYSCALL in connection to github.com:443
解决办法：取消http代理</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>git config --global --unset http.proxy
</span></span></code></pre></td></tr></table></div></div></div><h2 id=包导入>包导入</h2><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#177500>// import f &#34;fmt&#34; // 用别名f 代替 fmt
</span></span></span><span style=display:flex><span><span style=color:#177500>// import . &#34;fmt&#34;
</span></span></span><span style=display:flex><span><span style=color:#177500>// import _ &#34;xxx&#34; //包的匿名导入，只为了执行其init函数
</span></span></span><span style=display:flex><span><span style=color:#177500>// f.Println(&#34;go go go&#34;) // 用 f 代替了 fmt 调用 Println 函
</span></span></span><span style=display:flex><span><span style=color:#177500></span>
</span></span><span style=display:flex><span><span style=color:#177500>// 路径导入，gopath
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>import</span> <span style=color:#c41a16>&#34;go_code/hello_world/mathutil&#34;</span>
</span></span></code></pre></td></tr></table></div></div></div><p>绝对导入
相对导入</p><p>相对导入，有两点需要注意</p><ul><li>项目不要放在 <code>$GOPATH/src</code> 下，否则会报错（比如我修改当前项目目录为GOPATH后，运行就会报错）</li><li>Go Modules 不支持相对导入，在你开启 GO111MODULE 后，无法使用相对导入。
当我们导入一个包时，它会：</li></ul><ol><li>先从项目根目录的 xxx 目录中查找</li><li>最后从 <code>$GOROOT/src</code> 目录下查找</li><li>然后从 <code>$GOPATH/src</code> 目录下查找</li><li>都找不到的话，就报错。
你导入的包如果有域名，都会先在 <code>$GOPATH/pkg/mod</code> 下查找，找不到就连网去该网站上寻找，找不到或者找到的不是一个包，则报错。</li></ol><p>而如果你导入的包没有域名（比如 "fmt"这种），就只会到 <code>$GOROOT</code> 里查找。</p><h1 id=go模块>go模块</h1><ul><li><code>go mod init</code> 创建了一个新的模块，初始化 <code>go.mod</code> 文件并且生成相应的描述</li><li><code>go build, go test</code> 和其它构建代码包的命令，会在需要的时候在 <code>go.mod</code> 文件中添加新的依赖项</li><li><code>go list -m all</code> 列出了当前模块所有的依赖项</li><li><code>go get</code> 修改指定依赖项的版本（或者添加一个新的依赖项）</li><li><code>go mod tidy</code> 移除模块中没有用到的依赖项。</li></ul><p>当前目录/User/bo/hello，非$GOPATH</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#177500>// hello.go
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>package</span> <span style=color:#000>hello</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>Hello</span>() <span style=color:#a90d91>string</span> {
</span></span><span style=display:flex><span>  <span style=color:#a90d91>return</span> <span style=color:#c41a16>&#34;Hello, world.&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>// hello_test.go
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>package</span> <span style=color:#000>hello</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>import</span> <span style=color:#c41a16>&#34;testing&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>TestHello</span>(<span style=color:#000>t</span> <span style=color:#000>*</span><span style=color:#000>testing</span>.<span style=color:#000>T</span>) {
</span></span><span style=display:flex><span>    <span style=color:#000>want</span> <span style=color:#000>:=</span> <span style=color:#c41a16>&#34;Hello, world.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a90d91>if</span> <span style=color:#000>got</span> <span style=color:#000>:=</span> <span style=color:#000>Hello</span>(); <span style=color:#000>got</span> <span style=color:#000>!=</span> <span style=color:#000>want</span> {
</span></span><span style=display:flex><span>        <span style=color:#000>t</span>.<span style=color:#000>Errorf</span>(<span style=color:#c41a16>&#34;Hello() = %q, want %q&#34;</span>, <span style=color:#000>got</span>, <span style=color:#000>want</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><h2 id=go-mod-init>go mod init</h2><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>go mod init example.com/hello  // <span style=color:#1c01ce>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500># 切到go.mod目录下，即自动下载依赖包到pkg/mod/cache/download</span>
</span></span><span style=display:flex><span>go mod download
</span></span></code></pre></td></tr></table></div></div></div><h2 id=启动go-mod路径导入会报错>启动go mod路径导入会报错</h2><p>解决办法：</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>// 切换至项目目录，如hello_world目录下
</span></span><span style=display:flex><span>go mod init hello_world
</span></span><span style=display:flex><span>// 导入路径从 import <span style=color:#c41a16>&#34;go_code/hello_world/mathutil&#34;</span>改成
</span></span><span style=display:flex><span>import <span style=color:#c41a16>&#34;hello_world/mathutil&#34;</span>
</span></span></code></pre></td></tr></table></div></div></div><p>注意如果还报错，重启下IDE即可，或者修改下文件，这只是IDE刷新的问题</p><h2 id=go-test>go test</h2><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>go <span style=color:#a90d91>test</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// cat go.mod
</span></span><span style=display:flex><span>// cat go.sum
</span></span></code></pre></td></tr></table></div></div></div><blockquote><p><code>go.mod</code> 文件只存在于模块的根目录中。模块子目录的代码包的导入路径等于模块根目录的导入路径（就是前面说的 module path）加上子目录的相对路径。比如，我们如果创建了一个子目录叫 <code>world</code>，我们不需要（也不会想要）在子目录里面再运行一次 <code>go mod init</code> 了，这个代码包会被认为就是 <code>example.com/hello</code> 模块的一部分，而这个代码包的导入路径就是 <code>example.com/hello/world</code>。
除了 <code>go.mod</code> 之外，go 命令行工具还维护了一个 <code>go.sum</code> 文件，它包含了指定的模块的版本内容的哈希值作为校验参考：</p></blockquote><h2 id=go-list>go list</h2><p>把当前的模块和它所有的依赖项都列出来</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>go list -m all
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>go list -m -versions rsc.io/sampler
</span></span></code></pre></td></tr></table></div></div></div><blockquote><p>在上述 <code>go list</code> 命令的输出中，当前的模块，又称为主模块 (main module)，永远都在第一行，接着是主模块的依赖项，以依赖项的 module path 排序。</p></blockquote><h2 id=go-get>go get</h2><p>go get会做两件事：</p><ol><li><p>从远程下载需要用到的包</p></li><li><p>执行go install</p></li></ol><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>go get  // 拉所有包
</span></span><span style=display:flex><span>go get golang.org/x/text
</span></span><span style=display:flex><span>go get rsc.io/sampler@v1.3.1  // 默认情况下这个版本号是 @latest
</span></span></code></pre></td></tr></table></div></div></div><h2 id=go-install>go install</h2><p>go install 会生成可执行文件直接放到bin目录下，当然这是有前提的</p><p>你编译的是可执行文件，如果是一个普通的包，会被编译生成到pkg目录下该文件是.a结尾</p><h2 id=go-mod>go mod</h2><p>清除这些没用到的依赖项</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>go mod tidy
</span></span></code></pre></td></tr></table></div></div></div><p>下载依赖<style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>go mod download
</span></span></code></pre></td></tr></table></div></div></div></p><h1 id=基础语法>基础语法</h1><p>1、golang的命名推荐使用驼峰命名法，必须以一个字母（Unicode字母）或下划线开头，后面可以跟任意数量的字母、数字或下划线。</p><p>2、golang中根据首字母的大小写来确定可以访问的权限。无论是方法名、常量、变量名还是结构体的名称，如果首字母大写，则可以被其他的包访问；如果首字母小写，则只能在本包中使用</p><p>3、结构体中属性名的大写</p><p>如果属性名小写则在数据解析（如json解析,或将结构体作为请求或访问参数）时无法解析</p><h2 id=声明>声明</h2><h3 id=变量的定义>变量的定义</h3><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>var</span> <span style=color:#000>a</span> <span style=color:#a90d91>int</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>var</span> <span style=color:#000>b</span> <span style=color:#a90d91>float32</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>var</span> <span style=color:#000>c</span>, <span style=color:#000>d</span> <span style=color:#a90d91>float64</span>
</span></span><span style=display:flex><span><span style=color:#000>e</span>, <span style=color:#000>f</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>9</span>, <span style=color:#1c01ce>10</span>   <span style=color:#177500>// 使用:=这个符号。使用了这个符号之后，开发者不再需要写var关键字，只需要定义变量名，并在后面进行赋值即可
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>var</span> <span style=color:#000>g</span> = <span style=color:#c41a16>&#34;Ricardo&#34;</span>  <span style=color:#177500>// 在变量的定义过程中，如果定义的时候就赋予了变量的初始值，是不需要再声明变量的类型的
</span></span></span></code></pre></td></tr></table></div></div></div><h3 id=匿名变量>匿名变量</h3><p>不需要用的变量都可以用_表示，可以多个，如：</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>_</span>, <span style=color:#000>v</span>, <span style=color:#000>_</span> <span style=color:#000>:=</span> <span style=color:#000>getData</span>()
</span></span></code></pre></td></tr></table></div></div></div><h3 id=常量>常量</h3><p>在Golang的常量定义中，使用<code>const</code>关键字，并且<strong>不能</strong>使用<code>:=</code>标识符。</p><h2 id=判断>判断</h2><h2 id=循环>循环</h2><h2 id=函数>函数</h2><h3 id=defer>defer</h3><p>defer 语句会将函数推迟到外层函数返回之后执行。 推迟调用的函数其参数会立即求值，但直到外层函数返回前该函数都不会被调用。</p><blockquote><p>注意，defer后面必须是函数调用语句，不能是其他语句，否则编译器会报错。</p></blockquote><p>可以考虑到的场景是，文件的关闭，或数据库连接的释放等，这样打开和关闭的代码写在一起，既可以使得代码更加的整洁，也可以防止出现开发者在写了长长的业务代码后，忘记关闭的情况。</p><p>至于defer的底层实现，本文不进行详细的解释，简单来讲就是将defer语句后面的函数调用的地址压进一个栈中，在当前的函数执行完毕，CPU即将执行函数外的下一行代码之前，先把栈中的指令地址弹出给CPU执行，直到栈为空，才结束这个函数，继续执行后面的代码。</p><h2 id=指针>指针</h2><blockquote><p>但是，与 C 不同，Golang没有指针运算。</p></blockquote><h2 id=数组>数组</h2><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>var</span> <span style=color:#000>a</span> [<span style=color:#1c01ce>10</span>]<span style=color:#a90d91>int</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>str</span> <span style=color:#000>:=</span> [<span style=color:#1c01ce>4</span>]<span style=color:#a90d91>string</span>{
</span></span><span style=display:flex><span>	    <span style=color:#c41a16>&#34;aaa&#34;</span>,
</span></span><span style=display:flex><span>	    <span style=color:#c41a16>&#34;bbb&#34;</span>,
</span></span><span style=display:flex><span>	    <span style=color:#c41a16>&#34;ccc&#34;</span>,
</span></span><span style=display:flex><span>	    <span style=color:#c41a16>&#34;ddd&#34;</span>,
</span></span><span style=display:flex><span>	}
</span></span></code></pre></td></tr></table></div></div></div><blockquote><p>注意，在Golang中，数组的大小也同样和 C 语言一样不能改变。</p></blockquote><h3 id=切片>切片</h3><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>a</span>[<span style=color:#000>low</span> : <span style=color:#000>high</span>]  <span style=color:#177500>// 会选择一个半开区间，包括第一个元素，但排除最后一个元素。
</span></span></span></code></pre></td></tr></table></div></div></div><blockquote><p>Golang中的切片，不是拷贝，而是定义了新的指针，指向了原来数组所在的内存空间。所以，修改了切片数组的值，也就相应的修改了原数组的值了。
此外，切片可以用append增加元素。但是，如果此时底层数组容量不够，此时切片将会指向一个重新分配空间后进行拷贝的数组。</p></blockquote><p><strong>因此可以得出结论：</strong></p><ul><li>切片并不存储任何数据，它只是描述了底层数组中的一段。</li><li>更改切片的元素会修改其底层数组中对应的元素。</li><li>与它共享底层数组的切片都会观测到这些修改。</li></ul><h3 id=make>make</h3><p>切片可以用内建函数 make 来创建，这也是你创建动态数组的方式。</p><p>两个定义，len（长度）和cap（容量）：</p><p>len是数组的长度，指的是这个数组在定义的时候，所约定的长度。</p><p>cap是数组的容量，指的是底层数组的长度，也可以说是原数组在内存中的长度。</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>a</span> <span style=color:#000>:=</span> <span style=color:#a90d91>make</span>([]<span style=color:#a90d91>int</span>, <span style=color:#1c01ce>5</span>)  <span style=color:#177500>// len(a)=5
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>b</span> <span style=color:#000>:=</span> <span style=color:#a90d91>make</span>([]<span style=color:#a90d91>int</span>, <span style=color:#1c01ce>0</span>, <span style=color:#1c01ce>5</span>) <span style=color:#177500>// len(b)=0, cap(b)=5
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>b</span> = <span style=color:#000>b</span>[:<span style=color:#a90d91>cap</span>(<span style=color:#000>b</span>)] <span style=color:#177500>// len(b)=5, cap(b)=5
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>b</span> = <span style=color:#000>b</span>[<span style=color:#1c01ce>1</span>:]      <span style=color:#177500>// len(b)=4, cap(b)=4
</span></span></span></code></pre></td></tr></table></div></div></div><h1 id=进阶语法>进阶语法</h1><h2 id=结构体>结构体</h2><blockquote><p>在结构体中也遵循用大小写来设置公有或私有的规则。如果这个结构体名字的第一个字母是大写，则可以被其他包访问，否则，只能在包内进行访问。而结构体内的字段也一样，也是遵循一样的大小写确定可用性的规则。</p></blockquote><h3 id=定义>定义</h3><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>结构体名</span> <span style=color:#a90d91>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#000>字段1</span> <span style=color:#000>类型</span>
</span></span><span style=display:flex><span>    <span style=color:#000>字段2</span> <span style=color:#000>类型</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><h3 id=声明-1>声明</h3><h4 id=使用var关键字>使用var关键字</h4><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>var</span> <span style=color:#000>s</span> <span style=color:#000>T</span>
</span></span><span style=display:flex><span><span style=color:#000>s</span>.<span style=color:#000>a</span> = <span style=color:#1c01ce>1</span>
</span></span><span style=display:flex><span><span style=color:#000>s</span>.<span style=color:#000>b</span> = <span style=color:#1c01ce>2</span>
</span></span></code></pre></td></tr></table></div></div></div><blockquote><p>注意，在使用了var关键字之后不需要初始化，这和其他的语言有些不同。Golang会自动分配内存空间，并将该内存空间设置为默认的值，我们只需要按需进行赋值即可。</p></blockquote><h4 id=使用new函数>使用new函数</h4><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>people</span> <span style=color:#a90d91>struct</span> {
</span></span><span style=display:flex><span>  <span style=color:#000>name</span> <span style=color:#a90d91>string</span> <span style=color:#000>age</span> <span style=color:#a90d91>int</span> 
</span></span><span style=display:flex><span>} 
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>main</span>() { 
</span></span><span style=display:flex><span>  <span style=color:#000>ming</span> <span style=color:#000>:=</span> <span style=color:#a90d91>new</span>(<span style=color:#000>people</span>) 
</span></span><span style=display:flex><span>  <span style=color:#000>ming</span>.<span style=color:#000>name</span> = <span style=color:#c41a16>&#34;xiao ming&#34;</span> 
</span></span><span style=display:flex><span>  <span style=color:#000>ming</span>.<span style=color:#000>age</span> = <span style=color:#1c01ce>18</span> 
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><h4 id=使用字面量>使用字面量</h4><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>people</span> <span style=color:#a90d91>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#000>name</span> <span style=color:#a90d91>string</span>
</span></span><span style=display:flex><span>    <span style=color:#000>age</span> <span style=color:#a90d91>int</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#000>ming</span> <span style=color:#000>:=</span> <span style=color:#000>&amp;</span><span style=color:#000>people</span>{<span style=color:#c41a16>&#34;xiao ming&#34;</span>, <span style=color:#1c01ce>18</span>}
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><h4 id=区别>区别</h4><p>第一种使用<code>var</code>声明的方式，返回的是该实例的结构类型，而第二第三种，返回的是一个指向这个结构类型的一个<strong>指针</strong>，是地址。</p><p>所以，对于第二第三种返回指针的声明形式，在我们需要修改他的值的时候，其实应该使用的方式是:</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-plain data-lang=plain><span style=display:flex><span>(*ming).name = &#34;xiao wang&#34;
</span></span></code></pre></td></tr></table></div></div></div><p>但是，在Golang中，可以省略这一步骤，直接使用<code>ming.name = "xiao wang"</code>。尽管如此，我们应该知道这一行为的原因，分清楚自己所操作的对象究竟是什么类型，掌握这点对下面<strong>方法</strong>这一章节至关重要。</p><h2 id=方法>方法</h2><h2 id=label>label</h2><h3 id=break-label>break label</h3><p>break的跳转标签(label)必须放在循环语句<strong>for循环前面</strong>，并且在break label跳出循环<strong>不再执行for循环里的代码。</strong></p><h3 id=goto-label>goto label</h3><p>goto label的label(标签)既可以定义在<strong>for循环前面</strong>,也可以定义在<strong>for循环后面</strong>，当跳转到标签地方时，<strong>继续执行标签下面的代码</strong>。</p><h1 id=并发>并发</h1><h2 id=线程与协程>线程与协程</h2><p>进程和线程是由操作系统进行调度的，协程是对内核透明，由程序自己调度的。协程的切换一般由程序员在代码中<strong>显式控制</strong>，而不是交给操作系统去<strong>调度</strong>。它避免了上下文切换时的额外耗费，兼顾了多线程的优点，简化了高并发程序的复杂。</p><h2 id=goroutine>goroutine</h2><h2 id=channel>channel</h2><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>var</span> <span style=color:#000>pipline</span> <span style=color:#a90d91>chan</span> <span style=color:#a90d91>int</span>
</span></span><span style=display:flex><span><span style=color:#177500>// 无缓冲信道
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>pipline</span> = <span style=color:#a90d91>make</span>(<span style=color:#a90d91>chan</span> <span style=color:#a90d91>int</span>)
</span></span><span style=display:flex><span><span style=color:#177500>// pipline := make(chan int, 0)
</span></span></span><span style=display:flex><span><span style=color:#177500>// 缓冲信道
</span></span></span><span style=display:flex><span><span style=color:#177500>// pipline := make(chan int, 10)
</span></span></span><span style=display:flex><span><span style=color:#177500></span>
</span></span><span style=display:flex><span><span style=color:#177500>// 往信道中发送数据
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>pipline</span><span style=color:#000>&lt;-</span> <span style=color:#1c01ce>200</span>
</span></span><span style=display:flex><span><span style=color:#177500>// 从信道中取出数据，并赋值给mydata
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>mydata</span> <span style=color:#000>:=</span> <span style=color:#000>&lt;-</span><span style=color:#000>pipline</span>
</span></span><span style=display:flex><span><span style=color:#177500>// 关闭
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>close</span>(<span style=color:#000>pipline</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>// 当从信道中读取数据时，可以有多个返回值，其中第二个可以表示 信道是否被关闭，如果已经被关闭，ok 为 false，若还没被关闭，ok 为true。
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>x</span>, <span style=color:#000>ok</span> <span style=color:#000>:=</span> <span style=color:#000>&lt;-</span><span style=color:#000>pipline</span>
</span></span></code></pre></td></tr></table></div></div></div><h3 id=单向信道>单向信道</h3><p>默认情况下都是双向信道</p><p>可细分为只读信道和只写信道</p><h4 id=只读信道>只读信道</h4><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>var</span> <span style=color:#000>pipline</span> = <span style=color:#a90d91>make</span>(<span style=color:#a90d91>chan</span> <span style=color:#a90d91>int</span>)
</span></span><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>Receiver</span> = <span style=color:#000>&lt;-</span><span style=color:#a90d91>chan</span> <span style=color:#a90d91>int</span> <span style=color:#177500>// 关键代码：定义别名类型
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>var</span> <span style=color:#000>receiver</span> <span style=color:#000>Receiver</span> = <span style=color:#000>pipline</span>
</span></span></code></pre></td></tr></table></div></div></div><h4 id=只写信道>只写信道</h4><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>var</span> <span style=color:#000>pipline</span> = <span style=color:#a90d91>make</span>(<span style=color:#a90d91>chan</span> <span style=color:#a90d91>int</span>)
</span></span><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>Sender</span> = <span style=color:#a90d91>chan</span><span style=color:#000>&lt;-</span> <span style=color:#a90d91>int</span>  <span style=color:#177500>// 关键代码：定义别名类型
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>var</span> <span style=color:#000>sender</span> <span style=color:#000>Sender</span> = <span style=color:#000>pipline</span>
</span></span></code></pre></td></tr></table></div></div></div><p>仔细观察，区别在于 &lt;- 符号在关键字 chan 的左边还是右边。</p><ul><li>&lt;-chan 表示这个信道，只能从里发出数据，对于程序来说就是只读</li><li>chan&lt;- 表示这个信道，只能从外面接收数据，对于程序来说就是只写</li></ul><p>有同学可能会问：为什么还要先声明一个双向信道，再定义单向通道呢？比如这样写</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-plain data-lang=plain><span style=display:flex><span>type Sender = chan&lt;- int 
</span></span><span style=display:flex><span>sender := make(Sender)
</span></span></code></pre></td></tr></table></div></div></div><p>因为信道肯定读和写都要有</p><h2 id=range>range</h2><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>import</span> <span style=color:#c41a16>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>fibonacci</span>(<span style=color:#000>mychan</span> <span style=color:#a90d91>chan</span> <span style=color:#a90d91>int</span>) {
</span></span><span style=display:flex><span>    <span style=color:#000>n</span> <span style=color:#000>:=</span> <span style=color:#a90d91>cap</span>(<span style=color:#000>mychan</span>)
</span></span><span style=display:flex><span>    <span style=color:#000>x</span>, <span style=color:#000>y</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>1</span>, <span style=color:#1c01ce>1</span>
</span></span><span style=display:flex><span>    <span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>0</span>; <span style=color:#000>i</span> &lt; <span style=color:#000>n</span>; <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#000>mychan</span> <span style=color:#000>&lt;-</span> <span style=color:#000>x</span>
</span></span><span style=display:flex><span>        <span style=color:#000>x</span>, <span style=color:#000>y</span> = <span style=color:#000>y</span>, <span style=color:#000>x</span><span style=color:#000>+</span><span style=color:#000>y</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#177500>// 记得 close 信道
</span></span></span><span style=display:flex><span><span style=color:#177500></span>    <span style=color:#177500>// 不然主函数中遍历完并不会结束，而是会阻塞。
</span></span></span><span style=display:flex><span><span style=color:#177500></span>    <span style=color:#a90d91>close</span>(<span style=color:#000>mychan</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#000>pipline</span> <span style=color:#000>:=</span> <span style=color:#a90d91>make</span>(<span style=color:#a90d91>chan</span> <span style=color:#a90d91>int</span>, <span style=color:#1c01ce>10</span>)
</span></span><span style=display:flex><span>    <span style=color:#a90d91>go</span> <span style=color:#000>fibonacci</span>(<span style=color:#000>pipline</span>)
</span></span><span style=display:flex><span>    <span style=color:#a90d91>for</span> <span style=color:#000>k</span> <span style=color:#000>:=</span> <span style=color:#a90d91>range</span> <span style=color:#000>pipline</span> {
</span></span><span style=display:flex><span>        <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>k</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br><h2 id=select>select</h2><h2 id=waitgroup>WaitGroup</h2><h1 id=reference>Reference</h1><p><a href=https://juejin.cn/post/6844904119774216206>Golang入门：一天学完GO的进阶语法</a></p><p><a href=https://www.w3cschool.cn/go/go-error-handling.html>W3Cschool Go错误处理</a></p><p><a href=https://juejin.cn/post/6844904117450571790>Golang入门：一天学完GO的基本语法</a></p><p><a href=http://shouce.jb51.net/golang-doc/41.html>Go中文文档</a></p><p><a href=https://studygolang.com/articles/19334>Go Modules的使用方法</a></p><p><a href="https://mp.weixin.qq.com/s?__biz=MzU1NzU1MTM2NA==&mid=2247483746&idx=1&sn=5fb55f41cd5b11d7e13959dd94b454d3&chksm=fc355b09cb42d21f2efdf871dbe611db62bcd9cbfd10d0bb27fa657246dfcb561aa228a61007&scene=21#wechat_redirect">学习 Go 协程：WaitGroup</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-9b4f6c8b3eaf641253b11b6438aa3ccc>2 - Go语言基础知识01</h1><h1 id=背景-简介>背景&简介</h1><h2 id=历史背景>历史背景</h2><p>软件开发的新挑战：</p><p>1、多核硬件架构</p><p>2、超大规模分布式计算集群</p><p>3、Web 模式导致的前所未有的开发规模和更新速度</p><h2 id=发展现状>发展现状</h2><h2 id=语言特性>语言特性</h2><p>简单：</p><p>Go 语言足够简单，只有 25 个关键字。相比 C 语言 37 个关键字，C++ 语言 84 个关键字。</p><p>高效：</p><p>1）垃圾回收</p><p>2）指针</p><p>生产力：</p><p>只支持“复合”而非“继承”</p><p>云计算语言：</p><p>1）Docker</p><p>2）kubernetes</p><p>区块链语言：</p><p>1）ethereum（以太坊）</p><p>2）HYPERLEDGER</p><h1 id=安装使用>安装使用</h1><h2 id=下载安装>下载安装</h2><p>下载安装 Go 语言：</p><p><a href=https://go.dev/doc/install>https://go.dev/doc/install</a></p><p><a href=https://golang.google.cn/dl/>https://golang.google.cn/dl/</a></p><h2 id=开发环境构建>开发环境构建</h2><h3 id=gopath>GOPATH</h3><p>1、在 1.8 版本前必须设置这个环境变量</p><p>2、1.8 版本后（含 1.8）如果没有设置使用默认值</p><p>1）在 Unix 上默认 $HOME/go</p><p>2）在 Windows 上默认为 %USERPROFILE%/go</p><p>3）在 Mac 上 GOPATH 可以通过修改 ~/.bash_profile 来设置</p><p>示例代码参考：<a href=https://github.com/chnherb/go-demo>https://github.com/chnherb/go-demo</a></p><h3 id=运行程序>运行程序</h3><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>go run hello.go
</span></span></code></pre></td></tr></table></div></div></div><p>注意，hello.go 必须 <code>package main</code> （go 中 package 和 目录不必一致），否则会报错“go run: cannot run non-main package”</p><h3 id=编译程序>编译程序</h3><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>go build hello.go
</span></span><span style=display:flex><span>./hello
</span></span></code></pre></td></tr></table></div></div></div><h2 id=main-函数>main 函数</h2><h3 id=退出返回值>退出返回值</h3><p>与其他主要编程语言的差异：</p><p>1、Go 中 main 函数不支持任何返回值</p><p>2、通过 os.Exit 来返回状态</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>os</span>.<span style=color:#000>Exit</span>(<span style=color:#1c01ce>0</span>) <span style=color:#177500>// 表示成功退出
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>os</span>.<span style=color:#000>Exit</span>(<span style=color:#000>-</span><span style=color:#1c01ce>1</span>)  <span style=color:#177500>// exit status 255
</span></span></span></code></pre></td></tr></table></div></div></div><h3 id=获取命令行参数>获取命令行参数</h3><p>与其他主要编程语言的差异：</p><p>1、main 函数不支持传入参数</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>main</span>(<span style=color:#000>args</span> []<span style=color:#a90d91>string</span>) <span style=color:#177500>// error
</span></span></span></code></pre></td></tr></table></div></div></div><p>2、在程序中直接通过 os.Args 获取命令行参数<style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>main</span>() {
</span></span><span style=display:flex><span>  <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>os</span>.<span style=color:#000>Args</span>)
</span></span><span style=display:flex><span>  <span style=color:#a90d91>if</span> <span style=color:#a90d91>len</span>(<span style=color:#000>os</span>.<span style=color:#000>Args</span>) &gt; <span style=color:#1c01ce>1</span> {
</span></span><span style=display:flex><span>     <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;args:&#34;</span>, <span style=color:#000>os</span>.<span style=color:#000>Args</span>[<span style=color:#1c01ce>1</span>])
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#177500>// go run hello.go haha
</span></span></span></code></pre></td></tr></table></div></div></div></p><h1 id=基本程序架构>基本程序架构</h1><h2 id=变量-常量>变量&常量</h2><p>快速设置连续值</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>const</span> (
</span></span><span style=display:flex><span>  <span style=color:#000>Monday</span> = <span style=color:#a90d91>iota</span> <span style=color:#000>+</span> <span style=color:#1c01ce>1</span>
</span></span><span style=display:flex><span>  <span style=color:#000>TuesDay</span>
</span></span><span style=display:flex><span>  <span style=color:#000>WednesDay</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>const</span> (
</span></span><span style=display:flex><span>  <span style=color:#000>Open</span> = <span style=color:#1c01ce>1</span> <span style=color:#000>&lt;&lt;</span> <span style=color:#a90d91>iota</span> <span style=color:#177500>// bit 第1位为 1，其它位为 0
</span></span></span><span style=display:flex><span><span style=color:#177500></span>  <span style=color:#000>Close</span> <span style=color:#177500>// 第2位为 1，其它位为 0
</span></span></span><span style=display:flex><span><span style=color:#177500></span>  <span style=color:#000>Pending</span> <span style=color:#177500>// 第3位为 1，其它位为 0
</span></span></span><span style=display:flex><span><span style=color:#177500></span>)
</span></span></code></pre></td></tr></table></div></div></div><h2 id=数据类型>数据类型</h2><h3 id=基本数据类型>基本数据类型</h3><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>bool</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>string</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>int</span>   <span style=color:#a90d91>int8</span>   <span style=color:#a90d91>int16</span>   <span style=color:#a90d91>int32</span>   <span style=color:#a90d91>int64</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>uint</span>  <span style=color:#a90d91>uint8</span>  <span style=color:#a90d91>uint16</span>  <span style=color:#a90d91>uint32</span>  <span style=color:#a90d91>uint64</span> <span style=color:#a90d91>uintptr</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>byte</span> <span style=color:#177500>// alias for uint8
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>rune</span> <span style=color:#177500>// alias for int32, represents a Unicode code point
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>float32</span>  <span style=color:#a90d91>float64</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>complex64</span>  <span style=color:#a90d91>complex128</span>
</span></span></code></pre></td></tr></table></div></div></div><h3 id=类型转换>类型转换</h3><p>与其它主要编程语言的差异</p><p>1、Go 语言不允许隐式类型转换</p><p>2、别名和原有类型也不能进行隐式类型转换</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>MyInt</span> <span style=color:#a90d91>int64</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>Implicit</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a90d91>var</span> <span style=color:#000>a</span> <span style=color:#a90d91>int32</span> = <span style=color:#1c01ce>1</span>
</span></span><span style=display:flex><span>  <span style=color:#a90d91>var</span> <span style=color:#000>b</span> <span style=color:#a90d91>int64</span>
</span></span><span style=display:flex><span>  <span style=color:#000>b</span> = <span style=color:#a90d91>int64</span>(<span style=color:#000>a</span>)
</span></span><span style=display:flex><span>  <span style=color:#a90d91>var</span> <span style=color:#000>c</span> <span style=color:#000>MyInt</span>
</span></span><span style=display:flex><span>  <span style=color:#000>c</span> = <span style=color:#000>MyInt</span>(<span style=color:#000>b</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><h3 id=类型的预定义值>类型的预定义值</h3><p>1、math.MaxInt64</p><p>2、math.MaxFloat64</p><p>3、math.MaxUint32</p><h3 id=指针类型>指针类型</h3><p>1、不支持指针运算</p><p>2、string 是值类型，其默认的初始化值为空字符串，而不是 nil</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span>  <span style=color:#000>a</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>1</span>
</span></span><span style=display:flex><span>  <span style=color:#000>aPtr</span> <span style=color:#000>:=</span> <span style=color:#000>&amp;</span><span style=color:#000>a</span>
</span></span><span style=display:flex><span>  <span style=color:#177500>// aPtr = aPtr + 1 // error
</span></span></span><span style=display:flex><span><span style=color:#177500></span>  <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>a</span>, <span style=color:#000>aPtr</span>)
</span></span><span style=display:flex><span>  <span style=color:#000>fmt</span>.<span style=color:#000>Printf</span>(<span style=color:#c41a16>&#34;%T, %T
</span></span></span><span style=display:flex><span><span style=color:#c41a16>&#34;</span>, <span style=color:#000>a</span>, <span style=color:#000>aPtr</span>) <span style=color:#177500>// %T 打印类型
</span></span></span></code></pre></td></tr></table></div></div></div><h2 id=运算符>运算符</h2><h3 id=算数运算符>算数运算符</h3><table><thead><tr><th style=text-align:left>运算符</th><th style=text-align:left>描述</th><th style=text-align:left>示例</th></tr></thead><tbody><tr><td style=text-align:left>+</td><td style=text-align:left>相加</td><td style=text-align:left></td></tr><tr><td style=text-align:left>-</td><td style=text-align:left>相减</td><td style=text-align:left></td></tr><tr><td style=text-align:left>*</td><td style=text-align:left>相乘</td><td style=text-align:left></td></tr><tr><td style=text-align:left>/</td><td style=text-align:left>相除</td><td style=text-align:left></td></tr><tr><td style=text-align:left>%</td><td style=text-align:left>求余</td><td style=text-align:left></td></tr><tr><td style=text-align:left>++</td><td style=text-align:left>自增</td><td style=text-align:left></td></tr><tr><td style=text-align:left>--</td><td style=text-align:left>自减</td><td style=text-align:left></td></tr></tbody></table><p>Go 语言中没有前置 ++/--</p><h3 id=比较运算符>比较运算符</h3><p>如 ==、!= 、>、&lt;、>=、&lt;= 省略介绍</p><h4 id=用-比较数组>用 == 比较数组</h4><p>与其它语言比较数组时比较引用不同，Go 比较的是数组中的值。</p><p>1、相同维度且含有相同个数元素的数组才可以比较</p><p>2、每个元素都相同的才相等</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>a</span> <span style=color:#000>:=</span> [<span style=color:#000>...</span>]<span style=color:#a90d91>int</span>{<span style=color:#1c01ce>1</span>, <span style=color:#1c01ce>2</span>, <span style=color:#1c01ce>3</span>, <span style=color:#1c01ce>4</span>}
</span></span><span style=display:flex><span><span style=color:#000>b</span> <span style=color:#000>:=</span> [<span style=color:#000>...</span>]<span style=color:#a90d91>int</span>{<span style=color:#1c01ce>1</span>, <span style=color:#1c01ce>2</span>, <span style=color:#1c01ce>3</span>, <span style=color:#1c01ce>5</span>}
</span></span><span style=display:flex><span><span style=color:#177500>//c := [...]int{1, 2, 3, 4, 5}
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>d</span> <span style=color:#000>:=</span> [<span style=color:#000>...</span>]<span style=color:#a90d91>int</span>{<span style=color:#1c01ce>1</span>, <span style=color:#1c01ce>2</span>, <span style=color:#1c01ce>3</span>, <span style=color:#1c01ce>4</span>}
</span></span><span style=display:flex><span><span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>a</span> <span style=color:#000>==</span> <span style=color:#000>b</span>)
</span></span><span style=display:flex><span><span style=color:#177500>//fmt.Println(a == c) // error
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>a</span> <span style=color:#000>==</span> <span style=color:#000>d</span>)
</span></span></code></pre></td></tr></table></div></div></div><h3 id=逻辑运算符>逻辑运算符</h3><p>&&、||、!、</p><h3 id=位运算符>位运算符</h3><p>&、|、^、&lt;&lt;、>> 等</p><p>与其它语言主要差异：</p><p>&^ 按位清零</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>#</span> <span style=color:#000>右边操作数位上为</span> <span style=color:#1c01ce>1</span> <span style=color:#000>的</span><span style=color:#000>，</span><span style=color:#000>对应到左边操作数的位置为</span> <span style=color:#1c01ce>0</span> <span style=color:#000>；</span>
</span></span><span style=display:flex><span><span style=color:#000>#</span> <span style=color:#000>右边操作数位上为</span> <span style=color:#1c01ce>0</span> <span style=color:#000>的</span><span style=color:#000>，</span><span style=color:#000>对应到左边操作数的位上的值不变</span><span style=color:#000>；</span>
</span></span><span style=display:flex><span><span style=color:#1c01ce>1</span> <span style=color:#000>&amp;^</span> <span style=color:#1c01ce>0</span> <span style=color:#000>--</span> <span style=color:#1c01ce>1</span>
</span></span><span style=display:flex><span><span style=color:#1c01ce>1</span> <span style=color:#000>&amp;^</span> <span style=color:#1c01ce>1</span> <span style=color:#000>--</span> <span style=color:#1c01ce>0</span>
</span></span><span style=display:flex><span><span style=color:#1c01ce>0</span> <span style=color:#000>&amp;^</span> <span style=color:#1c01ce>0</span> <span style=color:#000>--</span> <span style=color:#1c01ce>0</span>
</span></span><span style=display:flex><span><span style=color:#1c01ce>0</span> <span style=color:#000>&amp;^</span> <span style=color:#1c01ce>0</span> <span style=color:#000>--</span> <span style=color:#1c01ce>0</span>
</span></span></code></pre></td></tr></table></div></div></div><h2 id=条件和循环>条件和循环</h2><h3 id=循环>循环</h3><p>Go 语言只支持循环关键 for，且不需要括号</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#177500>// 条件循环
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>n</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>0</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>for</span> <span style=color:#000>n</span> &lt; <span style=color:#1c01ce>5</span> {
</span></span><span style=display:flex><span>  <span style=color:#000>n</span><span style=color:#000>++</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#177500>// 无限循环
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>for</span> {
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><h3 id=if-条件>if 条件</h3><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>if</span> <span style=color:#000>condition</span> {
</span></span><span style=display:flex><span>  <span style=color:#177500>//
</span></span></span><span style=display:flex><span><span style=color:#177500></span>} <span style=color:#a90d91>else</span> <span style=color:#a90d91>if</span> <span style=color:#000>condition2</span> {
</span></span><span style=display:flex><span>  <span style=color:#177500>// 
</span></span></span><span style=display:flex><span><span style=color:#177500></span>} <span style=color:#a90d91>else</span> {
</span></span><span style=display:flex><span>  <span style=color:#177500>// 
</span></span></span><span style=display:flex><span><span style=color:#177500></span>}
</span></span></code></pre></td></tr></table></div></div></div><p>与其它语言的差异：
1、condition 必须为布尔值</p><p>2、支持变量赋值：</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>if</span> <span style=color:#a90d91>var</span> <span style=color:#000>declaration</span>; <span style=color:#000>condition</span> {
</span></span><span style=display:flex><span>  <span style=color:#177500>//
</span></span></span><span style=display:flex><span><span style=color:#177500></span>}
</span></span><span style=display:flex><span><span style=color:#177500>// eg
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>if</span> <span style=color:#000>v</span>, <span style=color:#000>err</span> <span style=color:#000>:=</span> <span style=color:#000>someFun</span>(); <span style=color:#000>err</span> <span style=color:#000>==</span> <span style=color:#a90d91>nil</span> {
</span></span><span style=display:flex><span>  <span style=color:#177500>//
</span></span></span><span style=display:flex><span><span style=color:#177500></span>} <span style=color:#a90d91>else</span> {
</span></span><span style=display:flex><span>  <span style=color:#177500>// 
</span></span></span><span style=display:flex><span><span style=color:#177500></span>}
</span></span></code></pre></td></tr></table></div></div></div><h3 id=switch-条件>switch 条件</h3><p>与其它语言的差异：</p><p>1、条件表达式不限制为常量或者整数；</p><p>2、单个 case 中，可以出现多个结果选项，使用逗号分隔；</p><p>3、与 C 语言等规则相反，Go 语言不需要用 break 来明确退出一个 case；</p><p>4、可以不设定 switch 之后的条件表达式，这种情况下，整个 switch 结构与多个 if...else... 的逻辑作用相同。</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>switch</span> <span style=color:#000>os</span> <span style=color:#000>:=</span> <span style=color:#000>runtime</span>.<span style=color:#000>GOOS</span>; <span style=color:#000>os</span> {
</span></span><span style=display:flex><span>  <span style=color:#a90d91>case</span> <span style=color:#c41a16>&#34;darwin&#34;</span>:
</span></span><span style=display:flex><span>    <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;OS X.&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#177500>// break // 默认不需要加 break
</span></span></span><span style=display:flex><span><span style=color:#177500></span>  <span style=color:#a90d91>case</span> <span style=color:#c41a16>&#34;linux&#34;</span>:
</span></span><span style=display:flex><span>    <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;linux&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a90d91>default</span>:
</span></span><span style=display:flex><span>    <span style=color:#000>fmt</span>.<span style=color:#000>Printf</span>(<span style=color:#c41a16>&#34;%s.&#34;</span>, <span style=color:#000>os</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>switch</span> {
</span></span><span style=display:flex><span>  <span style=color:#a90d91>case</span> <span style=color:#1c01ce>0</span> <span style=color:#000>&lt;=</span> <span style=color:#000>Num</span> <span style=color:#000>&amp;&amp;</span> <span style=color:#000>Num</span> <span style=color:#000>&lt;=</span> <span style=color:#1c01ce>3</span>:
</span></span><span style=display:flex><span>    <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;0-3&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a90d91>case</span> <span style=color:#1c01ce>4</span> <span style=color:#000>&lt;=</span> <span style=color:#000>Num</span> <span style=color:#000>&amp;&amp;</span> <span style=color:#000>Num</span> <span style=color:#000>&lt;=</span> <span style=color:#1c01ce>6</span>:
</span></span><span style=display:flex><span>    <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;4-6&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a90d91>case</span> <span style=color:#1c01ce>7</span> <span style=color:#000>&lt;=</span> <span style=color:#000>Num</span> <span style=color:#000>&amp;&amp;</span> <span style=color:#000>Num</span> <span style=color:#000>&lt;=</span> <span style=color:#1c01ce>9</span>:
</span></span><span style=display:flex><span>    <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;7-9&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><h1 id=常用集合>常用集合</h1><h2 id=数组和切片>数组和切片</h2><h3 id=数组基础操作>数组基础操作</h3><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>var</span> <span style=color:#000>a</span> [<span style=color:#1c01ce>3</span>]<span style=color:#a90d91>int</span> <span style=color:#177500>// 声明并初始化为默认零值
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>a</span>[<span style=color:#1c01ce>0</span>] = <span style=color:#1c01ce>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>b</span> <span style=color:#000>:=</span> [<span style=color:#1c01ce>3</span>]<span style=color:#a90d91>int</span>{<span style=color:#1c01ce>1</span>, <span style=color:#1c01ce>2</span>, <span style=color:#1c01ce>3</span>} <span style=color:#177500>// 声明同时初始化
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>c</span> <span style=color:#000>:=</span> [<span style=color:#1c01ce>2</span>][<span style=color:#1c01ce>2</span>]<span style=color:#a90d91>int</span>{{<span style=color:#1c01ce>1</span>, <span style=color:#1c01ce>2</span>}, {<span style=color:#1c01ce>3</span>, <span style=color:#1c01ce>4</span>}} <span style=color:#177500>// 多维数组初始化
</span></span></span></code></pre></td></tr></table></div></div></div><p>遍历<style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>arr3</span> <span style=color:#000>:=</span> [<span style=color:#000>...</span>]<span style=color:#a90d91>int</span>{<span style=color:#1c01ce>1</span>, <span style=color:#1c01ce>2</span>, <span style=color:#1c01ce>3</span>, <span style=color:#1c01ce>4</span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>0</span>; <span style=color:#000>i</span> &lt; <span style=color:#a90d91>len</span>(<span style=color:#000>arr3</span>); <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>  <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>arr3</span>[<span style=color:#000>i</span>])
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>for</span> <span style=color:#000>idx</span>, <span style=color:#000>e</span> <span style=color:#000>:=</span> <span style=color:#a90d91>range</span> <span style=color:#000>arr3</span> { <span style=color:#177500>// 不需要 idx 用 _ 替代
</span></span></span><span style=display:flex><span><span style=color:#177500></span>  <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>idx</span>, <span style=color:#000>e</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div></p><h3 id=数组截取>数组截取</h3><p>a[开始索引(包含), 结束索引(不包含), ]</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>a</span> <span style=color:#000>:=</span> [<span style=color:#000>...</span>]<span style=color:#a90d91>int</span>{<span style=color:#1c01ce>1</span>, <span style=color:#1c01ce>2</span>, <span style=color:#1c01ce>3</span>, <span style=color:#1c01ce>4</span>, <span style=color:#1c01ce>5</span>}
</span></span><span style=display:flex><span><span style=color:#000>a</span>[<span style=color:#1c01ce>1</span>: <span style=color:#1c01ce>2</span>] <span style=color:#177500>// 2
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>a</span>[<span style=color:#1c01ce>1</span>: <span style=color:#1c01ce>3</span>] <span style=color:#177500>// 2, 3
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>a</span>[<span style=color:#1c01ce>1</span>: <span style=color:#a90d91>len</span>(<span style=color:#000>a</span>)] <span style=color:#177500>// 2, 3, 4, 5
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>a</span>[<span style=color:#1c01ce>1</span>:] <span style=color:#177500>// 2, 3, 4, 5
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>a</span>[:<span style=color:#1c01ce>3</span>] <span style=color:#177500>// 1, 2, 3
</span></span></span></code></pre></td></tr></table></div></div></div><h3 id=切片>切片</h3><p>切片内部结构</p><p><img src=../imgs/go_basic01_1.png alt=go_basic01_1.png></p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>var</span> <span style=color:#000>s0</span> []<span style=color:#a90d91>int</span> <span style=color:#177500>// 没有长度
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>s0</span> = <span style=color:#a90d91>append</span>(<span style=color:#000>s0</span>, <span style=color:#1c01ce>1</span>)
</span></span><span style=display:flex><span><span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#a90d91>len</span>(<span style=color:#000>s0</span>), <span style=color:#a90d91>cap</span>(<span style=color:#000>s0</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>var</span> <span style=color:#000>s1</span> []<span style=color:#a90d91>int</span>{<span style=color:#1c01ce>1</span>, <span style=color:#1c01ce>2</span>, <span style=color:#1c01ce>3</span>, <span style=color:#1c01ce>4</span>} <span style=color:#177500>// 没有 ...
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#a90d91>len</span>(<span style=color:#000>s1</span>), <span style=color:#a90d91>cap</span>(<span style=color:#000>s1</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>// []type, len, cap
</span></span></span><span style=display:flex><span><span style=color:#177500>// 其中 len 个元素会被初始化为默认值0，未初始化元素不可以访问
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>s2</span> <span style=color:#000>:=</span> <span style=color:#a90d91>make</span>([]<span style=color:#a90d91>int</span>, <span style=color:#1c01ce>3</span>, <span style=color:#1c01ce>5</span>)
</span></span><span style=display:flex><span><span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#a90d91>len</span>(<span style=color:#000>s2</span>), <span style=color:#a90d91>cap</span>(<span style=color:#000>s2</span>))
</span></span></code></pre></td></tr></table></div></div></div><p>切片共享存储结构</p><p><img src=../imgs/go_basic02_2.png alt=go_basic02_2.png></p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#177500>// 切片增长  
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>s</span> <span style=color:#000>:=</span> []<span style=color:#a90d91>int</span>{}
</span></span><span style=display:flex><span><span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>0</span>; <span style=color:#000>i</span> &lt; <span style=color:#1c01ce>10</span>; <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>  <span style=color:#000>s</span> = <span style=color:#a90d91>append</span>(<span style=color:#000>s</span>, <span style=color:#000>i</span>)
</span></span><span style=display:flex><span>  <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#a90d91>len</span>(<span style=color:#000>s</span>), <span style=color:#a90d91>cap</span>(<span style=color:#000>s</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#177500>// 共享存储
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>year</span> <span style=color:#000>:=</span> []<span style=color:#a90d91>string</span>{<span style=color:#c41a16>&#34;Jan&#34;</span>, <span style=color:#c41a16>&#34;Feb&#34;</span>, <span style=color:#c41a16>&#34;Mar&#34;</span>, <span style=color:#c41a16>&#34;Apr&#34;</span>, <span style=color:#c41a16>&#34;May&#34;</span>, <span style=color:#c41a16>&#34;Jun&#34;</span>, <span style=color:#c41a16>&#34;Jul&#34;</span>, <span style=color:#c41a16>&#34;Aug&#34;</span>, <span style=color:#c41a16>&#34;Sep&#34;</span>, <span style=color:#c41a16>&#34;Oct&#34;</span>, <span style=color:#c41a16>&#34;Nov&#34;</span>, <span style=color:#c41a16>&#34;Dec&#34;</span>}
</span></span><span style=display:flex><span><span style=color:#000>Q2</span> <span style=color:#000>:=</span> <span style=color:#000>year</span>[<span style=color:#1c01ce>3</span>: <span style=color:#1c01ce>6</span>]
</span></span><span style=display:flex><span><span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#a90d91>len</span>(<span style=color:#000>Q2</span>), <span style=color:#a90d91>cap</span>(<span style=color:#000>Q2</span>)) <span style=color:#177500>// 3 9
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>summer</span> <span style=color:#000>:=</span> [<span style=color:#1c01ce>5</span>: <span style=color:#1c01ce>8</span>]
</span></span><span style=display:flex><span><span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#a90d91>len</span>(<span style=color:#000>summer</span>), <span style=color:#a90d91>cap</span>(<span style=color:#000>summer</span>)) <span style=color:#177500>// 3 7
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>summer</span>[<span style=color:#1c01ce>0</span>] = <span style=color:#c41a16>&#34;Unknow&#34;</span> <span style=color:#177500>// &#34;Jun&#34; -&gt; &#34;Unknow&#34; 
</span></span></span></code></pre></td></tr></table></div></div></div><h3 id=数组-vs-切片>数组 vs 切片</h3><p>1、 容量是否可伸缩</p><p>数组不可伸缩，切片可以</p><p>2、是否可以进行比较</p><p>数组可以直接比较是否相等，切片不可以比较</p><h2 id=map>Map</h2><h3 id=map-基础操作>Map 基础操作</h3><p>Map 声明</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>m</span> <span style=color:#000>:=</span> <span style=color:#a90d91>map</span>[<span style=color:#a90d91>string</span>]<span style=color:#a90d91>int</span>{<span style=color:#c41a16>&#34;one&#34;</span>: <span style=color:#1c01ce>1</span>, <span style=color:#c41a16>&#34;two&#34;</span>: <span style=color:#1c01ce>2</span>, <span style=color:#c41a16>&#34;three&#34;</span>: <span style=color:#1c01ce>3</span>}
</span></span><span style=display:flex><span><span style=color:#000>m1</span> <span style=color:#000>:=</span> <span style=color:#a90d91>map</span>[<span style=color:#a90d91>string</span>]<span style=color:#a90d91>int</span>{}
</span></span><span style=display:flex><span><span style=color:#000>m1</span>[<span style=color:#c41a16>&#34;one&#34;</span>] = <span style=color:#1c01ce>1</span>
</span></span><span style=display:flex><span><span style=color:#000>m2</span> <span style=color:#000>:=</span> <span style=color:#a90d91>make</span>(<span style=color:#a90d91>map</span>[<span style=color:#a90d91>string</span>]<span style=color:#a90d91>int</span>, <span style=color:#1c01ce>10</span> <span style=color:#177500>/*Initial Capacity*/</span>)
</span></span><span style=display:flex><span><span style=color:#177500>// 为什么不初始化len? len默认初始化默认值0，map没有办法赋值0
</span></span></span></code></pre></td></tr></table></div></div></div><p>与其它语言的区别：
在访问的 key 不存在时，会返回默认值，不能通过返回 nil 来判断元素是否存在。</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#177500>// 访问不存在key的值会返回默认值
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>m1</span> <span style=color:#000>:=</span> <span style=color:#a90d91>map</span>[<span style=color:#a90d91>string</span>]<span style=color:#a90d91>int</span>{}
</span></span><span style=display:flex><span><span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>m1</span>[<span style=color:#c41a16>&#34;haha&#34;</span>]) <span style=color:#177500>// default 0
</span></span></span><span style=display:flex><span><span style=color:#177500>// m1[&#34;haha&#34;] = 2
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>if</span> <span style=color:#000>v</span>, <span style=color:#000>ok</span> <span style=color:#000>:=</span> <span style=color:#000>m1</span>[<span style=color:#c41a16>&#34;haha&#34;</span>]; <span style=color:#000>ok</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;exist haha:&#34;</span>, <span style=color:#000>v</span>)
</span></span><span style=display:flex><span>} <span style=color:#a90d91>else</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;don&#39;t exist&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><p>map遍历<style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>m1</span> <span style=color:#000>:=</span> <span style=color:#a90d91>map</span>[<span style=color:#a90d91>int</span>]<span style=color:#a90d91>int</span>{<span style=color:#1c01ce>1</span>: <span style=color:#1c01ce>1</span>, <span style=color:#1c01ce>2</span>: <span style=color:#1c01ce>4</span>, <span style=color:#1c01ce>3</span>: <span style=color:#1c01ce>9</span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>for</span> <span style=color:#000>k</span>, <span style=color:#000>v</span> <span style=color:#000>:=</span> <span style=color:#a90d91>range</span> <span style=color:#000>m1</span> {
</span></span><span style=display:flex><span>  <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>k</span>, <span style=color:#000>v</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div></p><h3 id=map-与工厂模式>Map 与工厂模式</h3><p>1、Map 的 value 可以是一个方法</p><p>2、与 Go 的 Dock type 接口方式一起，可以方便地实现单一方法对象的工厂模式</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>m</span> <span style=color:#000>:=</span> <span style=color:#a90d91>map</span>[<span style=color:#a90d91>int</span>]<span style=color:#a90d91>func</span>(<span style=color:#000>op</span> <span style=color:#a90d91>int</span>) <span style=color:#a90d91>int</span>{}
</span></span><span style=display:flex><span><span style=color:#000>m</span>[<span style=color:#1c01ce>1</span>] = <span style=color:#a90d91>func</span>(<span style=color:#000>op</span> <span style=color:#a90d91>int</span>) <span style=color:#a90d91>int</span> { <span style=color:#a90d91>return</span> <span style=color:#000>op</span> }
</span></span><span style=display:flex><span><span style=color:#000>m</span>[<span style=color:#1c01ce>2</span>] = <span style=color:#a90d91>func</span>(<span style=color:#000>op</span> <span style=color:#a90d91>int</span>) <span style=color:#a90d91>int</span> { <span style=color:#a90d91>return</span> <span style=color:#000>op</span> <span style=color:#000>*</span> <span style=color:#000>op</span> }
</span></span><span style=display:flex><span><span style=color:#000>m</span>[<span style=color:#1c01ce>3</span>] = <span style=color:#a90d91>func</span>(<span style=color:#000>op</span> <span style=color:#a90d91>int</span>) <span style=color:#a90d91>int</span> { <span style=color:#a90d91>return</span> <span style=color:#000>op</span> <span style=color:#000>*</span> <span style=color:#000>op</span> <span style=color:#000>*</span> <span style=color:#000>op</span> }
</span></span><span style=display:flex><span><span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>m</span>[<span style=color:#1c01ce>1</span>](<span style=color:#1c01ce>2</span>), <span style=color:#000>m</span>[<span style=color:#1c01ce>2</span>](<span style=color:#1c01ce>2</span>), <span style=color:#000>m</span>[<span style=color:#1c01ce>3</span>](<span style=color:#1c01ce>2</span>)) <span style=color:#177500>// 2 4 8
</span></span></span></code></pre></td></tr></table></div></div></div><h3 id=实现-set>实现 Set</h3><p>Go 的内置集合中没有 Set 试下，可以 map[type]bool</p><p>1、元素的唯一性</p><p>2、基本操作</p><p>1）添加元素</p><p>2）判断元素是否存在</p><p>3）删除元素</p><p>4）元素个数</p><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>mySet</span> <span style=color:#000>:=</span> <span style=color:#a90d91>map</span>[<span style=color:#a90d91>int</span>]<span style=color:#a90d91>bool</span>{}
</span></span><span style=display:flex><span><span style=color:#000>mySet</span>[<span style=color:#1c01ce>1</span>] = <span style=color:#a90d91>true</span>
</span></span><span style=display:flex><span><span style=color:#000>n</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>3</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>if</span> <span style=color:#000>mySet</span>[<span style=color:#000>n</span>] {
</span></span><span style=display:flex><span>   <span style=color:#000>fmt</span>.<span style=color:#000>Printf</span>(<span style=color:#c41a16>&#34;%d exist
</span></span></span><span style=display:flex><span><span style=color:#c41a16>&#34;</span>, <span style=color:#000>n</span>)
</span></span><span style=display:flex><span>} <span style=color:#a90d91>else</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>fmt</span>.<span style=color:#000>Printf</span>(<span style=color:#c41a16>&#34;%d not exist
</span></span></span><span style=display:flex><span><span style=color:#c41a16>&#34;</span>, <span style=color:#000>n</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#000>mySet</span>[<span style=color:#1c01ce>3</span>] = <span style=color:#a90d91>true</span>
</span></span><span style=display:flex><span><span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#a90d91>len</span>(<span style=color:#000>mySet</span>))
</span></span><span style=display:flex><span><span style=color:#a90d91>delete</span>(<span style=color:#000>mySet</span>, <span style=color:#1c01ce>1</span>)
</span></span><span style=display:flex><span><span style=color:#000>n</span> = <span style=color:#1c01ce>1</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>if</span> <span style=color:#000>mySet</span>[<span style=color:#000>n</span>] {
</span></span><span style=display:flex><span>   <span style=color:#000>fmt</span>.<span style=color:#000>Printf</span>(<span style=color:#c41a16>&#34;%d exist
</span></span></span><span style=display:flex><span><span style=color:#c41a16>&#34;</span>, <span style=color:#000>n</span>)
</span></span><span style=display:flex><span>} <span style=color:#a90d91>else</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>fmt</span>.<span style=color:#000>Printf</span>(<span style=color:#c41a16>&#34;%d not exist
</span></span></span><span style=display:flex><span><span style=color:#c41a16>&#34;</span>, <span style=color:#000>n</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br><h1 id=字符串>字符串</h1><h3 id=string-基本操作>string 基本操作</h3><p>与其它语言的主要差异：</p><p>1、string 是数据类型，不是引用或指针类型</p><p>2、string 是只读的 byte slice，len 函数可以它所包含的 byte 数</p><p>3、string 的 byte 数组可以存放任何数据</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>var</span> <span style=color:#000>s</span> <span style=color:#a90d91>string</span>
</span></span><span style=display:flex><span><span style=color:#000>fmt</span>.<span style=color:#000>Printf</span>(<span style=color:#c41a16>&#34;s:%s*
</span></span></span><span style=display:flex><span><span style=color:#c41a16>&#34;</span>, <span style=color:#000>s</span>)
</span></span><span style=display:flex><span><span style=color:#000>s</span> = <span style=color:#c41a16>&#34;hello&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#a90d91>len</span>(<span style=color:#000>s</span>)) <span style=color:#177500>// 5
</span></span></span><span style=display:flex><span><span style=color:#177500>// s[1] = &#39;3&#39; // error, string 是不可变的 byte slice
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>s</span> = <span style=color:#c41a16>&#34;严&#34;</span> <span style=color:#177500>// 可以存储任意二进制数据
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>fmt</span>.<span style=color:#000>Printf</span>(<span style=color:#c41a16>&#34;s:%s*
</span></span></span><span style=display:flex><span><span style=color:#c41a16>&#34;</span>, <span style=color:#000>s</span>) <span style=color:#177500>// s:严*
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#a90d91>len</span>(<span style=color:#000>s</span>)) <span style=color:#177500>// 3
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>s</span> = <span style=color:#c41a16>&#34;中&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>fmt</span>.<span style=color:#000>Printf</span>(<span style=color:#c41a16>&#34;s:%s*
</span></span></span><span style=display:flex><span><span style=color:#c41a16>&#34;</span>, <span style=color:#000>s</span>) <span style=color:#177500>// s:中*
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#a90d91>len</span>(<span style=color:#000>s</span>)) <span style=color:#177500>// 3  byte数
</span></span></span></code></pre></td></tr></table></div></div></div><h3 id=unicode-utf8>Unicode UTF8</h3><p>1、Unicode 是一种字符集（code point）</p><p>2、UTF8 是 unicode 的存储实现（转换为字节序列的规则）</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>s</span> <span style=color:#000>:=</span> <span style=color:#c41a16>&#34;中&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>fmt</span>.<span style=color:#000>Printf</span>(<span style=color:#c41a16>&#34;s:%s*
</span></span></span><span style=display:flex><span><span style=color:#c41a16>&#34;</span>, <span style=color:#000>s</span>) <span style=color:#177500>// s:中*
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#a90d91>len</span>(<span style=color:#000>s</span>)) <span style=color:#177500>// 3  byte数
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>c</span> <span style=color:#000>:=</span> []<span style=color:#a90d91>rune</span>(<span style=color:#000>s</span>) <span style=color:#177500>// 取出字符串的 Unicode
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#a90d91>len</span>(<span style=color:#000>c</span>)) <span style=color:#177500>// 1
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>fmt</span>.<span style=color:#000>Printf</span>(<span style=color:#c41a16>&#34;中 Unicode %x
</span></span></span><span style=display:flex><span><span style=color:#c41a16>&#34;</span>, <span style=color:#000>c</span>[<span style=color:#1c01ce>0</span>]) <span style=color:#177500>// 中 Unicode 4e2d
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>fmt</span>.<span style=color:#000>Printf</span>(<span style=color:#c41a16>&#34;中 UTF8 %x
</span></span></span><span style=display:flex><span><span style=color:#c41a16>&#34;</span>, <span style=color:#000>s</span>) <span style=color:#177500>// 中 UTF8 e4b8ad
</span></span></span></code></pre></td></tr></table></div></div></div><p>编码与存储</p><table><thead><tr><th style=text-align:left>字符</th><th style=text-align:left>“中”</th></tr></thead><tbody><tr><td style=text-align:left>Unicode</td><td style=text-align:left>0x4E2D</td></tr><tr><td style=text-align:left>UTF-8</td><td style=text-align:left>0XE4B8AD</td></tr><tr><td style=text-align:left>string/[]byte</td><td style=text-align:left>[0xE4, 0xB8, 0xAD]</td></tr></tbody></table><p>常用字符串函数</p><p>1、string 包（<a href=https://pkg.go.dev/strings>https://pkg.go.dev/strings</a>）</p><p>2、strconv 包（<a href=https://pkg.go.dev/strconv>https://pkg.go.dev/strconv</a>）</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>strToRune</span>() {
</span></span><span style=display:flex><span>   <span style=color:#000>s</span> <span style=color:#000>:=</span> <span style=color:#c41a16>&#34;中华人民共和国&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#a90d91>for</span> <span style=color:#000>_</span>, <span style=color:#000>c</span> <span style=color:#000>:=</span> <span style=color:#a90d91>range</span> <span style=color:#000>s</span> { <span style=color:#177500>// string rang 时默认转成 rune
</span></span></span><span style=display:flex><span><span style=color:#177500></span>      <span style=color:#000>fmt</span>.<span style=color:#000>Printf</span>(<span style=color:#c41a16>&#34;%[1]c, %[1]x
</span></span></span><span style=display:flex><span><span style=color:#c41a16>&#34;</span>, <span style=color:#000>c</span>) <span style=color:#177500>// [1]表示取第一个参数
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><h1 id=函数>函数</h1><h2 id=函数是一等公民>函数是一等公民</h2><p>与其它语言的差异：</p><p>1、可以有多个返回值</p><p>2、<strong>所有参数都是值传递</strong>：slice，map，channel 会有传引用的错觉（可参考slice数据结构）</p><p>3、函数可以作为变量的值</p><p>4、函数可以作为参数和返回值</p><h3 id=函数编程>函数编程</h3><p>计时函数</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>main</span>() {
</span></span><span style=display:flex><span>   <span style=color:#000>tsSF</span> <span style=color:#000>:=</span> <span style=color:#000>timeSpent</span>(<span style=color:#000>slowFunc</span>)
</span></span><span style=display:flex><span>   <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>tsSF</span>(<span style=color:#1c01ce>10</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>timeSpent</span>(<span style=color:#000>inner</span> <span style=color:#a90d91>func</span>(<span style=color:#000>op</span> <span style=color:#a90d91>int</span>) <span style=color:#a90d91>int</span>) <span style=color:#a90d91>func</span>(<span style=color:#000>op</span> <span style=color:#a90d91>int</span>) <span style=color:#a90d91>int</span> {
</span></span><span style=display:flex><span>   <span style=color:#a90d91>return</span> <span style=color:#a90d91>func</span>(<span style=color:#000>n</span> <span style=color:#a90d91>int</span>) <span style=color:#a90d91>int</span> {
</span></span><span style=display:flex><span>      <span style=color:#000>start</span> <span style=color:#000>:=</span> <span style=color:#000>time</span>.<span style=color:#000>Now</span>()
</span></span><span style=display:flex><span>      <span style=color:#000>ret</span> <span style=color:#000>:=</span> <span style=color:#000>inner</span>(<span style=color:#000>n</span>)
</span></span><span style=display:flex><span>      <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;time spent: &#34;</span>, <span style=color:#000>time</span>.<span style=color:#000>Since</span>(<span style=color:#000>start</span>).<span style=color:#000>Seconds</span>())
</span></span><span style=display:flex><span>      <span style=color:#a90d91>return</span> <span style=color:#000>ret</span>
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>slowFunc</span>(<span style=color:#000>op</span> <span style=color:#a90d91>int</span>) <span style=color:#a90d91>int</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>time</span>.<span style=color:#000>Sleep</span>(<span style=color:#000>time</span>.<span style=color:#000>Second</span> <span style=color:#000>*</span> <span style=color:#1c01ce>1</span>)
</span></span><span style=display:flex><span>   <span style=color:#a90d91>return</span> <span style=color:#000>op</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><p>学习函数式编程
推荐书籍：《计算机程序的构造和解释》</p><h3 id=可变参数>可变参数</h3><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>sum</span>(<span style=color:#000>ops</span> <span style=color:#000>...</span><span style=color:#a90d91>int</span>) <span style=color:#a90d91>int</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>s</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>0</span>
</span></span><span style=display:flex><span>   <span style=color:#a90d91>for</span> <span style=color:#000>_</span>, <span style=color:#000>op</span> <span style=color:#000>:=</span> <span style=color:#a90d91>range</span> <span style=color:#000>ops</span> {
</span></span><span style=display:flex><span>      <span style=color:#000>s</span> <span style=color:#000>+=</span> <span style=color:#000>op</span>
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#a90d91>return</span> <span style=color:#000>s</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#177500>// sum(1, 2, 3)
</span></span></span></code></pre></td></tr></table></div></div></div><h3 id=defer-函数>defer 函数</h3><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>deferDemo</span>() {
</span></span><span style=display:flex><span>   <span style=color:#a90d91>defer</span> <span style=color:#a90d91>func</span>() {
</span></span><span style=display:flex><span>      <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;deferDemo defer&#34;</span>)
</span></span><span style=display:flex><span>   }()
</span></span><span style=display:flex><span>   <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;deferDemo&#34;</span>)
</span></span><span style=display:flex><span>   <span style=color:#a90d91>panic</span>(<span style=color:#c41a16>&#34;Fatal error&#34;</span>) <span style=color:#177500>// defer函数仍会执行
</span></span></span><span style=display:flex><span><span style=color:#177500></span>}
</span></span></code></pre></td></tr></table></div></div></div><h1 id=面向对象编程>面向对象编程</h1><h2 id=行为定义和实现>行为定义和实现</h2><p>go是面向对象编程语言吗？<a href=https://go.dev/doc/faq#Is_Go_an_object-oriented_language>https://go.dev/doc/faq#Is_Go_an_object-oriented_language</a></p><p>是也不是。</p><h3 id=结构体定义>结构体定义</h3><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>Employee</span> <span style=color:#a90d91>struct</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>Id</span>   <span style=color:#a90d91>string</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Name</span> <span style=color:#a90d91>string</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Age</span>  <span style=color:#a90d91>int</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><h3 id=实例创建及初始化>实例创建及初始化</h3><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>initEmployee</span>() {
</span></span><span style=display:flex><span>   <span style=color:#000>e</span> <span style=color:#000>:=</span> <span style=color:#000>Employee</span>{<span style=color:#c41a16>&#34;0&#34;</span>, <span style=color:#c41a16>&#34;Bob&#34;</span>, <span style=color:#1c01ce>20</span>}
</span></span><span style=display:flex><span>   <span style=color:#000>e1</span> <span style=color:#000>:=</span> <span style=color:#000>Employee</span>{<span style=color:#000>Id</span>: <span style=color:#c41a16>&#34;1&#34;</span>, <span style=color:#000>Name</span>: <span style=color:#c41a16>&#34;Mike&#34;</span>, <span style=color:#000>Age</span>: <span style=color:#1c01ce>21</span>}
</span></span><span style=display:flex><span>   <span style=color:#000>e2</span> <span style=color:#000>:=</span> <span style=color:#a90d91>new</span>(<span style=color:#000>Employee</span>) <span style=color:#177500>// 注意这里返回的引用/指针，相当于 e := &amp;Employee{}
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>e2</span>.<span style=color:#000>Id</span> = <span style=color:#c41a16>&#34;2&#34;</span> <span style=color:#177500>// 与其它语言的差异，通过实例的指针访问不需要使用 -&gt;
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>e2</span>.<span style=color:#000>Name</span> = <span style=color:#c41a16>&#34;Rose&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#000>e2</span>.<span style=color:#000>Age</span> = <span style=color:#1c01ce>18</span>
</span></span><span style=display:flex><span>   <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>e</span>)
</span></span><span style=display:flex><span>   <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>e1</span>)
</span></span><span style=display:flex><span>   <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>e2</span>)
</span></span><span style=display:flex><span>   <span style=color:#000>fmt</span>.<span style=color:#000>Printf</span>(<span style=color:#c41a16>&#34;%T, %T, %T
</span></span></span><span style=display:flex><span><span style=color:#c41a16>&#34;</span>, <span style=color:#000>e</span>, <span style=color:#000>e1</span>, <span style=color:#000>e2</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><h3 id=行为-方法-定义>行为（方法）定义</h3><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#177500>// 第一种定义方式在实例对应方法被调用时，实例的成员会进行值复制
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>func</span> (<span style=color:#000>e</span> <span style=color:#000>Employee</span>) <span style=color:#000>String1</span>() <span style=color:#a90d91>string</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>fmt</span>.<span style=color:#000>Printf</span>(<span style=color:#c41a16>&#34;Address is %x
</span></span></span><span style=display:flex><span><span style=color:#c41a16>&#34;</span>, <span style=color:#000>unsafe</span>.<span style=color:#000>Pointer</span>(<span style=color:#000>&amp;</span><span style=color:#000>e</span>.<span style=color:#000>Name</span>))
</span></span><span style=display:flex><span>   <span style=color:#a90d91>return</span> <span style=color:#000>fmt</span>.<span style=color:#000>Sprintf</span>(<span style=color:#c41a16>&#34;ID: %s - Name: %s - Age: %s&#34;</span>, <span style=color:#000>e</span>.<span style=color:#000>Id</span>, <span style=color:#000>e</span>.<span style=color:#000>Name</span>, <span style=color:#000>e</span>.<span style=color:#000>Age</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#177500>// 通常情况下为了避免内存拷贝使用第二种定义方式
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>func</span> (<span style=color:#000>e</span> <span style=color:#000>*</span><span style=color:#000>Employee</span>) <span style=color:#000>String2</span>() <span style=color:#a90d91>string</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>fmt</span>.<span style=color:#000>Printf</span>(<span style=color:#c41a16>&#34;Address is %x
</span></span></span><span style=display:flex><span><span style=color:#c41a16>&#34;</span>, <span style=color:#000>unsafe</span>.<span style=color:#000>Pointer</span>(<span style=color:#000>&amp;</span><span style=color:#000>e</span>.<span style=color:#000>Name</span>))
</span></span><span style=display:flex><span>   <span style=color:#a90d91>return</span> <span style=color:#000>fmt</span>.<span style=color:#000>Sprintf</span>(<span style=color:#c41a16>&#34;ID: %s - Name: %s - Age: %s&#34;</span>, <span style=color:#000>e</span>.<span style=color:#000>Id</span>, <span style=color:#000>e</span>.<span style=color:#000>Name</span>, <span style=color:#000>e</span>.<span style=color:#000>Age</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><h2 id=go-接口>Go 接口</h2><p>与其它主要编程语言的差异：</p><p>1、接口为非入侵性，实现不依赖于接口定义（duck type）</p><p>2、接口的定义可以包含在接口使用者包内</p><h2 id=扩展与复用>扩展与复用</h2><p>1、没有继承、重载、LSP（参数为父类、传入子类）等功能</p><p>2、只能通过匿名嵌套的方式</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>Dog</span> <span style=color:#a90d91>struct</span> {
</span></span><span style=display:flex><span>  <span style=color:#177500>// p *Pet
</span></span></span><span style=display:flex><span><span style=color:#177500></span>  <span style=color:#000>Pet</span> <span style=color:#177500>// 匿名嵌套类型，直接复用Pet定义的方法
</span></span></span><span style=display:flex><span><span style=color:#177500></span>}
</span></span></code></pre></td></tr></table></div></div></div><h2 id=多态>多态</h2><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>package</span> <span style=color:#000>main</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>import</span> <span style=color:#c41a16>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>Code</span> <span style=color:#a90d91>string</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>Programmer</span> <span style=color:#a90d91>interface</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>WriteHelloWord</span>() <span style=color:#000>Code</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>GoProgrammer</span> <span style=color:#a90d91>struct</span> {
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> (<span style=color:#000>p</span> <span style=color:#000>*</span><span style=color:#000>GoProgrammer</span>) <span style=color:#000>WriteHelloWord</span>() <span style=color:#000>Code</span> {
</span></span><span style=display:flex><span>   <span style=color:#a90d91>return</span> <span style=color:#c41a16>&#34;fmt.Println(\&#34;Hello world\&#34;)&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>JavaProgrammer</span> <span style=color:#a90d91>struct</span> {
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> (<span style=color:#000>p</span> <span style=color:#000>*</span><span style=color:#000>JavaProgrammer</span>) <span style=color:#000>WriteHelloWord</span>() <span style=color:#000>Code</span> {
</span></span><span style=display:flex><span>   <span style=color:#a90d91>return</span> <span style=color:#c41a16>&#34;System.out.Println(\&#34;Hello world\&#34;)&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>writeHelloWorld</span>(<span style=color:#000>p</span> <span style=color:#000>Programmer</span>) {
</span></span><span style=display:flex><span>   <span style=color:#000>fmt</span>.<span style=color:#000>Printf</span>(<span style=color:#c41a16>&#34;%T %v
</span></span></span><span style=display:flex><span><span style=color:#c41a16>&#34;</span>, <span style=color:#000>p</span>, <span style=color:#000>p</span>.<span style=color:#000>WriteHelloWord</span>())
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>main</span>() {
</span></span><span style=display:flex><span>   <span style=color:#000>goProg</span> <span style=color:#000>:=</span> <span style=color:#a90d91>new</span>(<span style=color:#000>GoProgrammer</span>) <span style=color:#177500>// 指针类型，或为&amp;GoProgrammer{}，但不能为 GoProgrammer{}
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>javaProg</span> <span style=color:#000>:=</span> <span style=color:#000>new</span> (<span style=color:#000>JavaProgrammer</span>)
</span></span><span style=display:flex><span>   <span style=color:#000>writeHelloWorld</span>(<span style=color:#000>goProg</span>)
</span></span><span style=display:flex><span>   <span style=color:#000>writeHelloWorld</span>(<span style=color:#000>javaProg</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br><h2 id=空接口与断言>空接口与断言</h2><p>1、空接口可以表示任何类型</p><p>2、通过断言来将空接口转换为指定类型</p><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>v</span>, <span style=color:#000>ok</span> <span style=color:#000>:=</span> <span style=color:#000>p</span>.(<span style=color:#a90d91>int</span>) <span style=color:#177500>// ok=true 表示转换成功
</span></span></span><span style=display:flex><span><span style=color:#177500></span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>main</span>() {
</span></span><span style=display:flex><span>   <span style=color:#000>DoSomething</span>(<span style=color:#1c01ce>10</span>)
</span></span><span style=display:flex><span>   <span style=color:#000>DoSomething</span>(<span style=color:#c41a16>&#34;10&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>DoSomething</span>(<span style=color:#000>p</span> <span style=color:#a90d91>interface</span>{}) {
</span></span><span style=display:flex><span>   <span style=color:#177500>//if i, ok := p.(int); ok {
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#177500>// fmt.Println(&#34;int&#34;, i)
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#177500>// return
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#177500>//}
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#177500>//if s, ok := p.(string); ok {
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#177500>// fmt.Println(&#34;string&#34;, s)
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#177500>// return
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#177500>//}
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#177500>//fmt.Println(&#34;Unkown Type&#34;)
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#a90d91>switch</span> <span style=color:#000>v</span> <span style=color:#000>:=</span> <span style=color:#000>p</span>.(<span style=color:#a90d91>type</span>) {
</span></span><span style=display:flex><span>   <span style=color:#a90d91>case</span> <span style=color:#a90d91>int</span>:
</span></span><span style=display:flex><span>      <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;int&#34;</span>, <span style=color:#000>v</span>)
</span></span><span style=display:flex><span>   <span style=color:#a90d91>case</span> <span style=color:#a90d91>string</span>:
</span></span><span style=display:flex><span>      <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;string&#34;</span>, <span style=color:#000>v</span>)
</span></span><span style=display:flex><span>   <span style=color:#a90d91>default</span>:
</span></span><span style=display:flex><span>      <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;Unkown Type&#34;</span>)
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br><h2 id=go-接口最佳实践>Go 接口最佳实践</h2><p>1、倾向于使用晓得接口定义，很多接口只包含一个方法</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>Reader</span> <span style=color:#a90d91>interface</span> {
</span></span><span style=display:flex><span>  <span style=color:#000>Read</span>(<span style=color:#000>p</span> []<span style=color:#a90d91>byte</span>) (<span style=color:#000>n</span> <span style=color:#a90d91>int</span>, <span style=color:#000>err</span> <span style=color:#a90d91>error</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>Writer</span> <span style=color:#a90d91>interface</span> {
</span></span><span style=display:flex><span>  <span style=color:#000>write</span>(<span style=color:#000>p</span> []<span style=color:#a90d91>byte</span>) (<span style=color:#000>n</span> <span style=color:#a90d91>int</span>, <span style=color:#000>err</span> <span style=color:#a90d91>error</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><p>2、较大的接口定义，可以由多个小接口定义组合而成<style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>ReadWriter</span> <span style=color:#a90d91>interface</span> {
</span></span><span style=display:flex><span>  <span style=color:#000>Reader</span>
</span></span><span style=display:flex><span>  <span style=color:#000>Writer</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div></p><p>3、只依赖于必要功能的最小接口<style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>StoreData</span>(<span style=color:#000>reader</span> <span style=color:#000>Reader</span>) <span style=color:#a90d91>error</span> {
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div></p><h1 id=错误处理>错误处理</h1><h2 id=go-的错误机制>Go 的错误机制</h2><p>1、没有异常机制</p><p>2、error 类型实现了 error 接口</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#a90d91>error</span> <span style=color:#a90d91>interface</span> {
</span></span><span style=display:flex><span>  <span style=color:#000>Error</span>() <span style=color:#a90d91>string</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><p>3、可以通过 errors.New 来快速创建错误实例<style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>errors</span>.<span style=color:#000>New</span>(<span style=color:#c41a16>&#34;n must be in the range [0,10]&#34;</span>)
</span></span></code></pre></td></tr></table></div></div></div></p><p>最佳实践</p><p>及早失败，避免嵌套</p><h2 id=panic>panic</h2><h3 id=panic-vs-os-exit>panic vs os.Exit</h3><p>1、os.Exit 退出时不会调用 defer 指定的函数</p><p>2、os.Exit 退出时不输出当前调用栈信息</p><h2 id=recover>recover</h2><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>defer</span> <span style=color:#a90d91>func</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a90d91>if</span> <span style=color:#000>err</span> <span style=color:#000>:=</span> <span style=color:#a90d91>recover</span>(); <span style=color:#000>err</span> <span style=color:#000>!=</span> <span style=color:#a90d91>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#177500>// 恢复错误
</span></span></span><span style=display:flex><span><span style=color:#177500></span>  }
</span></span><span style=display:flex><span>}()
</span></span></code></pre></td></tr></table></div></div></div><p>当心 recover 成为恶魔</p><p>1、形成僵尸服务进程，导致 health check 失效</p><p>2、“Let it Crash!” 往往是恢复不确定性错误的最好方法</p><h1 id=包和依赖管理>包和依赖管理</h1><h2 id=package>package</h2><p>1、基本复用模块单元</p><p>以首字母大写来表明可被包外代码访问</p><p>2、代码的 package 可以和所在目录不一致</p><p>3、同一目录的 Go 代码的 package 要保持一致</p><p>其它注意项：</p><p>1、通过 go get 来获取远程依赖</p><p>go get -u 强制从网络更新远程依赖</p><p>2、注意代码在 GitHub 上的组织形式，以适应 go get</p><p>直接以代码路径开始，不要有 src</p><p>示例：<a href=https://github.com/easierway/concurrent_map>https://github.com/easierway/concurrent_map</a></p><h3 id=init-方法>init 方法</h3><p>1、在 main 被执行前，所有依赖的 package 的 init 方法都会被执行</p><p>2、不同包的 init 函数依照包导入的依赖关系决定执行顺序</p><p>3、每个包可以有多个 init 函数</p><p>4、包的每个源文件也可以有多个 init 函数，这点比较特殊</p><h2 id=依赖管理>依赖管理</h2><p>Go 未解决的依赖问题</p><p>1、同一环境下，不同项目使用同一包的不同版本</p><p>2、无法管理对包的特定版本的依赖</p><h3 id=vendor-路径>vendor 路径</h3><p>随着 Go 1.5 release 版本的发布，vendor 目录被添加到除了 GOPATH 和 GOROOT 之外的依赖目录查找的解决方案。在 Go 1.6 之前，需要手动设置环境变量。</p><p>查找依赖包路径的解决方案如下：</p><p>1、当前包下的 vendor 目录</p><p>2、向上级目录查找，直到找到 src 下的 vendor 目录</p><p>3、在 GOPATH 下面查找依赖包</p><p>4、在 GOROOT 目录下查找</p><h3 id=常用的依赖管理工具>常用的依赖管理工具</h3><p>godep：<a href=https://github.com/tools/godep>https://github.com/tools/godep</a></p><p>glide：<a href=https://github.com/Masterminds/glide>https://github.com/Masterminds/glide</a></p><p>dep：<a href=https://github.com/golang/dep>https://github.com/golang/dep</a></p><h1 id=测试>测试</h1><h2 id=编写测试程序>编写测试程序</h2><p>1、源码文件以 _test 结尾：xxx_test.go</p><p>2、测试方法名以 Test 开头：func TestXXX(t *testing.T) {...} （或 Test_XXX）</p><h2 id=单元测试>单元测试</h2><p>functions.go</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>package</span> <span style=color:#000>ch02</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>square</span>(<span style=color:#000>op</span> <span style=color:#a90d91>int</span>) <span style=color:#a90d91>int</span> {
</span></span><span style=display:flex><span>   <span style=color:#a90d91>return</span> <span style=color:#000>op</span> <span style=color:#000>*</span> <span style=color:#000>op</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><p>functions_test.go<style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>package</span> <span style=color:#000>ch02</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>import</span> <span style=color:#c41a16>&#34;testing&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>TestSquare</span>(<span style=color:#000>t</span> <span style=color:#000>*</span><span style=color:#000>testing</span>.<span style=color:#000>T</span>) {
</span></span><span style=display:flex><span>   <span style=color:#000>inputs</span> <span style=color:#000>:=</span> [<span style=color:#000>...</span>]<span style=color:#a90d91>int</span>{<span style=color:#1c01ce>1</span>, <span style=color:#1c01ce>2</span>, <span style=color:#1c01ce>3</span>}
</span></span><span style=display:flex><span>   <span style=color:#000>expected</span> <span style=color:#000>:=</span> [<span style=color:#000>...</span>]<span style=color:#a90d91>int</span>{<span style=color:#1c01ce>1</span>, <span style=color:#1c01ce>4</span>, <span style=color:#1c01ce>9</span>}
</span></span><span style=display:flex><span>   <span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>0</span>; <span style=color:#000>i</span> &lt; <span style=color:#a90d91>len</span>(<span style=color:#000>inputs</span>); <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>      <span style=color:#000>ret</span> <span style=color:#000>:=</span> <span style=color:#000>square</span>(<span style=color:#000>inputs</span>[<span style=color:#000>i</span>])
</span></span><span style=display:flex><span>      <span style=color:#a90d91>if</span> <span style=color:#000>ret</span> <span style=color:#000>!=</span> <span style=color:#000>expected</span>[<span style=color:#000>i</span>] {
</span></span><span style=display:flex><span>         <span style=color:#000>t</span>.<span style=color:#000>Errorf</span>(<span style=color:#c41a16>&#34;input is %d, the expected is %d, the actual %d&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#000>inputs</span>[<span style=color:#000>i</span>], <span style=color:#000>expected</span>[<span style=color:#000>i</span>], <span style=color:#000>ret</span>)
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div></p><h2 id=内置单元测试框架>内置单元测试框架</h2><p>1、Fail, Error：该测试失败，该测试继续，其他测试继续执行</p><p>2、FailNow, Fatal：该测试失败，该测试中止，其他测试继续执行</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>TestErrorInCode</span>(<span style=color:#000>t</span> <span style=color:#000>*</span><span style=color:#000>testing</span>.<span style=color:#000>T</span>) {
</span></span><span style=display:flex><span>   <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;Start&#34;</span>)
</span></span><span style=display:flex><span>   <span style=color:#000>t</span>.<span style=color:#000>Error</span>(<span style=color:#c41a16>&#34;Error&#34;</span>) <span style=color:#177500>// 测试继续
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;End&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>TestFailErrorInCode</span>(<span style=color:#000>t</span> <span style=color:#000>*</span><span style=color:#000>testing</span>.<span style=color:#000>T</span>) {
</span></span><span style=display:flex><span>   <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;Start&#34;</span>)
</span></span><span style=display:flex><span>   <span style=color:#000>t</span>.<span style=color:#000>Fatal</span>(<span style=color:#c41a16>&#34;Error&#34;</span>) <span style=color:#177500>// 测试中止
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;End&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><p>代码覆盖率</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>go <span style=color:#a90d91>test</span> -v - cover
</span></span></code></pre></td></tr></table></div></div></div><p>断言
<a href=https://github.com/stretchr/testify>https://github.com/stretchr/testify</a></p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>go get -u github.com/stretchr/testify/assert
</span></span></code></pre></td></tr></table></div></div></div><p>代码示例：<style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>import</span> (
</span></span><span style=display:flex><span>   <span style=color:#c41a16>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#c41a16>&#34;testing&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#c41a16>&#34;github.com/stretchr/testify/assert&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>TestSquareWithAssert</span>(<span style=color:#000>t</span> <span style=color:#000>*</span><span style=color:#000>testing</span>.<span style=color:#000>T</span>) {
</span></span><span style=display:flex><span>   <span style=color:#000>inputs</span> <span style=color:#000>:=</span> [<span style=color:#000>...</span>]<span style=color:#a90d91>int</span>{<span style=color:#1c01ce>1</span>, <span style=color:#1c01ce>2</span>, <span style=color:#1c01ce>3</span>}
</span></span><span style=display:flex><span>   <span style=color:#000>expected</span> <span style=color:#000>:=</span> [<span style=color:#000>...</span>]<span style=color:#a90d91>int</span>{<span style=color:#1c01ce>1</span>, <span style=color:#1c01ce>4</span>, <span style=color:#1c01ce>9</span>}
</span></span><span style=display:flex><span>   <span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>0</span>; <span style=color:#000>i</span> &lt; <span style=color:#a90d91>len</span>(<span style=color:#000>inputs</span>); <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>      <span style=color:#000>ret</span> <span style=color:#000>:=</span> <span style=color:#000>square</span>(<span style=color:#000>inputs</span>[<span style=color:#000>i</span>])
</span></span><span style=display:flex><span>      <span style=color:#000>assert</span>.<span style=color:#000>Equal</span>(<span style=color:#000>t</span>, <span style=color:#000>expected</span>[<span style=color:#000>i</span>], <span style=color:#000>ret</span>)
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div></p><p>tips：导入包报错，重启 Goland 即可。</p><h2 id=benchmark>Benchmark</h2><p>benchmark_test.go</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-plain data-lang=plain><span style=display:flex><span>func BenchmarkDemo(b *testing.B) {
</span></span><span style=display:flex><span>   // 与性能测试无关的代码
</span></span><span style=display:flex><span>   elems := []string{&#34;1&#34;,&#34;2&#34;,&#34;3&#34;, &#34;4&#34;, &#34;5&#34;}
</span></span><span style=display:flex><span>   b.ResetTimer()
</span></span><span style=display:flex><span>   for j := 0; j &lt; b.N; j++ {
</span></span><span style=display:flex><span>      var buf bytes.Buffer
</span></span><span style=display:flex><span>      for _, elem := range elems{
</span></span><span style=display:flex><span>         buf.WriteString(elem)
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   b.StopTimer()
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><p>运行测试</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>go <span style=color:#a90d91>test</span> -bench<span style=color:#000>=</span>.  <span style=color:#177500># Windows 下为 -bench=&#34;.&#34;</span>
</span></span><span style=display:flex><span>go <span style=color:#a90d91>test</span> -bench<span style=color:#000>=</span>. benchmen  <span style=color:#177500># 分析原因，增加内存使用信息</span>
</span></span></code></pre></td></tr></table></div></div></div><h2 id=bdd>BDD</h2><p>Behavior Driven Development</p><p>Story Card</p><h3 id=bdd-in-go>BDD in Go</h3><p>项目网站：<a href=https://github.com/smartystreets/goconvey>https://github.com/smartystreets/goconvey</a></p><p>安装：</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>go get -u github.com/smartystreets/goconvey/convey
</span></span></code></pre></td></tr></table></div></div></div><p>启动 Web UI<style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#000>$GOPATH</span>/bin/goconvey
</span></span></code></pre></td></tr></table></div></div></div></p><p>使用示例：</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>import</span> (
</span></span><span style=display:flex><span>   . <span style=color:#c41a16>&#34;github.com/smartystreets/goconvey/convey&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#c41a16>&#34;testing&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>TestSpec</span>(<span style=color:#000>t</span> <span style=color:#000>*</span><span style=color:#000>testing</span>.<span style=color:#000>T</span>) {
</span></span><span style=display:flex><span>   <span style=color:#177500>// Only pass t into top-level Convey Calls
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>Convey</span>(<span style=color:#c41a16>&#34;Given 2 even numbers&#34;</span>, <span style=color:#000>t</span>, <span style=color:#a90d91>func</span>() {
</span></span><span style=display:flex><span>      <span style=color:#000>a</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>2</span>
</span></span><span style=display:flex><span>      <span style=color:#000>b</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>4</span>
</span></span><span style=display:flex><span>      <span style=color:#000>Convey</span>(<span style=color:#c41a16>&#34;When add the two numbers&#34;</span>, <span style=color:#a90d91>func</span>() {
</span></span><span style=display:flex><span>         <span style=color:#000>c</span> <span style=color:#000>:=</span> <span style=color:#000>a</span> <span style=color:#000>+</span> <span style=color:#000>b</span>
</span></span><span style=display:flex><span>         <span style=color:#000>Convey</span>(<span style=color:#c41a16>&#34;Then the result is still even&#34;</span>, <span style=color:#a90d91>func</span>() {
</span></span><span style=display:flex><span>            <span style=color:#000>So</span>(<span style=color:#000>c</span><span style=color:#000>%</span><span style=color:#1c01ce>2</span>, <span style=color:#000>ShouldEqual</span>, <span style=color:#1c01ce>0</span>)
</span></span><span style=display:flex><span>         })
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>   })
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><h1 id=reference>Reference</h1><p><a href=https://golang.google.cn/ref/spec>Go 语言规范文档</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-5021b75fff9a9d3a51e6ac5b8977759a>3 - Go语言基础知识02</h1><h1 id=并发编程>并发编程</h1><h2 id=协程机制>协程机制</h2><p>Thread vs Groutine</p><p>1、创建时默认的 stack 的大小</p><p>1）JDK5 以后 Java Thread stack 默认为 1M</p><p>2）Groutine 的 Stack 初始化大小为 2K</p><p>2、和 KSE（Kernel Space Entity）的对应关系</p><p>1）Java Thread 是 1:1</p><p>2）Goroutine 是 M:N</p><h2 id=共享内存并发机制>共享内存并发机制</h2><h3 id=mutex>Mutex</h3><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>var</span> <span style=color:#000>mut</span> <span style=color:#000>sync</span>.<span style=color:#000>Mutex</span>
</span></span><span style=display:flex><span><span style=color:#000>counter</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>0</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>0</span>; <span style=color:#000>i</span> &lt;<span style=color:#1c01ce>5000</span>; <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>   <span style=color:#a90d91>go</span> <span style=color:#a90d91>func</span>() {
</span></span><span style=display:flex><span>      <span style=color:#a90d91>defer</span> <span style=color:#a90d91>func</span>() {
</span></span><span style=display:flex><span>         <span style=color:#000>mut</span>.<span style=color:#000>Unlock</span>()
</span></span><span style=display:flex><span>      }()
</span></span><span style=display:flex><span>      <span style=color:#000>mut</span>.<span style=color:#000>Lock</span>()
</span></span><span style=display:flex><span>      <span style=color:#000>counter</span><span style=color:#000>++</span>
</span></span><span style=display:flex><span>   }()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#000>time</span>.<span style=color:#000>Sleep</span>(<span style=color:#1c01ce>1</span> <span style=color:#000>*</span> <span style=color:#000>time</span>.<span style=color:#000>Second</span>)
</span></span><span style=display:flex><span><span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>counter</span>)
</span></span></code></pre></td></tr></table></div></div></div><h3 id=waitgroup>WaitGroup</h3><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>var</span> <span style=color:#000>wg</span> <span style=color:#000>sync</span>.<span style=color:#000>WaitGroup</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>0</span>; <span style=color:#000>i</span> &lt;<span style=color:#1c01ce>5000</span>; <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>wg</span>.<span style=color:#000>Add</span>(<span style=color:#1c01ce>1</span>)
</span></span><span style=display:flex><span>   <span style=color:#a90d91>go</span> <span style=color:#a90d91>func</span>() {
</span></span><span style=display:flex><span>      <span style=color:#a90d91>defer</span> <span style=color:#a90d91>func</span>() {
</span></span><span style=display:flex><span>         <span style=color:#000>wg</span>.<span style=color:#000>Done</span>()
</span></span><span style=display:flex><span>      }()
</span></span><span style=display:flex><span>   }()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#000>wg</span>.<span style=color:#000>Wait</span>()
</span></span></code></pre></td></tr></table></div></div></div><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>var</span> <span style=color:#000>mut</span> <span style=color:#000>sync</span>.<span style=color:#000>Mutex</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>var</span> <span style=color:#000>wg</span> <span style=color:#000>sync</span>.<span style=color:#000>WaitGroup</span>
</span></span><span style=display:flex><span><span style=color:#000>counter</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>0</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>0</span>; <span style=color:#000>i</span> &lt; <span style=color:#1c01ce>5000</span>; <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>wg</span>.<span style=color:#000>Add</span>(<span style=color:#1c01ce>1</span>)
</span></span><span style=display:flex><span>   <span style=color:#a90d91>go</span> <span style=color:#a90d91>func</span>() {
</span></span><span style=display:flex><span>      <span style=color:#a90d91>defer</span> <span style=color:#a90d91>func</span>() {
</span></span><span style=display:flex><span>         <span style=color:#000>mut</span>.<span style=color:#000>Unlock</span>()
</span></span><span style=display:flex><span>      }()
</span></span><span style=display:flex><span>      <span style=color:#000>mut</span>.<span style=color:#000>Lock</span>()
</span></span><span style=display:flex><span>      <span style=color:#000>counter</span><span style=color:#000>++</span>
</span></span><span style=display:flex><span>      <span style=color:#000>wg</span>.<span style=color:#000>Done</span>()
</span></span><span style=display:flex><span>   }()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#000>wg</span>.<span style=color:#000>Wait</span>()
</span></span><span style=display:flex><span><span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>counter</span>)
</span></span></code></pre></td></tr></table></div></div></div><h2 id=csp-并发机制>CSP 并发机制</h2><p>Communicating sequential processes</p><h3 id=csp-vs-actor>CSP vs Actor</h3><p>1、和 Actor 直接通讯不同，CSP 模式则是通过 Channel 进行通讯的，更松耦合一些</p><p>2、Go 中 channel 是有容量限制并且独立于处理 Groutine，而如 Erlang、Actor 模式中的 mailbox 容量是无限的，接收进程也总是被动地处理消息</p><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>package</span> <span style=color:#000>main</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>import</span> (
</span></span><span style=display:flex><span>   <span style=color:#c41a16>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#c41a16>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>service</span>() <span style=color:#a90d91>string</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>time</span>.<span style=color:#000>Sleep</span>(<span style=color:#000>time</span>.<span style=color:#000>Microsecond</span> <span style=color:#000>*</span> <span style=color:#1c01ce>50</span>)
</span></span><span style=display:flex><span>   <span style=color:#a90d91>return</span> <span style=color:#c41a16>&#34;Done&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>otherTask</span>() {
</span></span><span style=display:flex><span>   <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;working on something else&#34;</span>)
</span></span><span style=display:flex><span>   <span style=color:#000>time</span>.<span style=color:#000>Sleep</span>(<span style=color:#000>time</span>.<span style=color:#000>Microsecond</span> <span style=color:#000>*</span> <span style=color:#1c01ce>100</span>)
</span></span><span style=display:flex><span>   <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;Task is done.&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>AsyncService</span>() <span style=color:#a90d91>chan</span> <span style=color:#a90d91>string</span> {
</span></span><span style=display:flex><span>   <span style=color:#177500>//retCh := make(chan string)
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>retCh</span> <span style=color:#000>:=</span> <span style=color:#a90d91>make</span>(<span style=color:#a90d91>chan</span> <span style=color:#a90d91>string</span>, <span style=color:#1c01ce>1</span>) <span style=color:#177500>// 更高效，不阻塞
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#a90d91>go</span> <span style=color:#a90d91>func</span>() {
</span></span><span style=display:flex><span>      <span style=color:#000>ret</span> <span style=color:#000>:=</span> <span style=color:#000>service</span>()
</span></span><span style=display:flex><span>      <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;returned result.&#34;</span>)
</span></span><span style=display:flex><span>      <span style=color:#000>retCh</span> <span style=color:#000>&lt;-</span> <span style=color:#000>ret</span>  <span style=color:#177500>// retCh buf 为 1 不阻塞
</span></span></span><span style=display:flex><span><span style=color:#177500></span>      <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;service existed&#34;</span>)
</span></span><span style=display:flex><span>   }()
</span></span><span style=display:flex><span>   <span style=color:#a90d91>return</span> <span style=color:#000>retCh</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>main</span>() {
</span></span><span style=display:flex><span>   <span style=color:#177500>//fmt.Println(service())
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#177500>//otherTask()
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>retCh</span> <span style=color:#000>:=</span> <span style=color:#000>AsyncService</span>()
</span></span><span style=display:flex><span>   <span style=color:#000>otherTask</span>()
</span></span><span style=display:flex><span>   <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>&lt;-</span><span style=color:#000>retCh</span>)
</span></span><span style=display:flex><span>   <span style=color:#000>time</span>.<span style=color:#000>Sleep</span>(<span style=color:#000>time</span>.<span style=color:#000>Second</span> <span style=color:#000>+</span> <span style=color:#1c01ce>1</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br><h2 id=多路选择和超时>多路选择和超时</h2><p>多渠道的选择</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-plain data-lang=plain><span style=display:flex><span>select {
</span></span><span style=display:flex><span>case ret := &lt;-retCh1:
</span></span><span style=display:flex><span>   fmt.Println(&#34;xxx&#34;)
</span></span><span style=display:flex><span>case ret := &lt;-retCh2:
</span></span><span style=display:flex><span>   fmt.Println(&#34;xxx&#34;)
</span></span><span style=display:flex><span>default:
</span></span><span style=display:flex><span>   fmt.Println(&#34;xxx&#34;)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><p>超时控制</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-plain data-lang=plain><span style=display:flex><span>select {
</span></span><span style=display:flex><span>case ret := &lt;-retCh:
</span></span><span style=display:flex><span>   fmt.Println(&#34;xxx&#34;)
</span></span><span style=display:flex><span>case &lt;-time.After(time.Second * 1)
</span></span><span style=display:flex><span>   fmt.Println(&#34;time out&#34;)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><h2 id=channel-关闭和广播>channel 关闭和广播</h2><p>1、想关闭的 channel 发送数据，会导致 panic</p><p>2、v, ok &lt;- ch; ok 为 bool 值，true 表示正常接收，false 表示通道关闭。（通道关闭后如果取值会返回默认值）</p><p>3、所有的 channel 接收者都会在 channel 关闭时，立刻从阻塞等待中返回且上述 ok 值为 false。这个广播机制常被利用，进行多个订阅者同时发送信号。如：退出信号。</p><h2 id=任务的取消>任务的取消</h2><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>package</span> <span style=color:#000>main</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>import</span> (
</span></span><span style=display:flex><span>   <span style=color:#c41a16>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#c41a16>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>isCancelled</span>(<span style=color:#000>cancelCh</span> <span style=color:#a90d91>chan</span> <span style=color:#a90d91>struct</span>{}) <span style=color:#a90d91>bool</span> {
</span></span><span style=display:flex><span>   <span style=color:#a90d91>select</span> {
</span></span><span style=display:flex><span>   <span style=color:#a90d91>case</span> <span style=color:#000>&lt;-</span><span style=color:#000>cancelCh</span>:
</span></span><span style=display:flex><span>      <span style=color:#a90d91>return</span> <span style=color:#a90d91>true</span>
</span></span><span style=display:flex><span>   <span style=color:#a90d91>default</span>:
</span></span><span style=display:flex><span>      <span style=color:#a90d91>return</span> <span style=color:#a90d91>false</span>
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>cancel_1</span>(<span style=color:#000>cancelCh</span> <span style=color:#a90d91>chan</span> <span style=color:#a90d91>struct</span>{}) {
</span></span><span style=display:flex><span>   <span style=color:#000>cancelCh</span> <span style=color:#000>&lt;-</span> <span style=color:#a90d91>struct</span>{}{}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>cancel_2</span>(<span style=color:#000>cancelCh</span> <span style=color:#a90d91>chan</span> <span style=color:#a90d91>struct</span>{}) {
</span></span><span style=display:flex><span>   <span style=color:#a90d91>close</span>(<span style=color:#000>cancelCh</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>taskCancel</span>() {
</span></span><span style=display:flex><span>   <span style=color:#000>cancelCh</span> <span style=color:#000>:=</span> <span style=color:#a90d91>make</span>(<span style=color:#a90d91>chan</span> <span style=color:#a90d91>struct</span>{}, <span style=color:#1c01ce>0</span>)
</span></span><span style=display:flex><span>   <span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>0</span>; <span style=color:#000>i</span> &lt; <span style=color:#1c01ce>5</span>; <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>      <span style=color:#a90d91>go</span> <span style=color:#a90d91>func</span>(<span style=color:#000>i</span> <span style=color:#a90d91>int</span>, <span style=color:#000>cancelCh</span> <span style=color:#a90d91>chan</span> <span style=color:#a90d91>struct</span>{}) {
</span></span><span style=display:flex><span>         <span style=color:#a90d91>for</span> {
</span></span><span style=display:flex><span>            <span style=color:#a90d91>if</span> <span style=color:#000>isCancelled</span>(<span style=color:#000>cancelCh</span>) {
</span></span><span style=display:flex><span>               <span style=color:#a90d91>break</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#000>time</span>.<span style=color:#000>Sleep</span>(<span style=color:#000>time</span>.<span style=color:#000>Microsecond</span> <span style=color:#000>*</span> <span style=color:#1c01ce>5</span>)
</span></span><span style=display:flex><span>         }
</span></span><span style=display:flex><span>         <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>i</span>, <span style=color:#c41a16>&#34;Cancelled&#34;</span>)
</span></span><span style=display:flex><span>      }(<span style=color:#000>i</span>, <span style=color:#000>cancelCh</span>)
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#177500>//cancel_1(cancelCh)
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>cancel_2</span>(<span style=color:#000>cancelCh</span>)
</span></span><span style=display:flex><span>   <span style=color:#000>time</span>.<span style=color:#000>Sleep</span>(<span style=color:#000>time</span>.<span style=color:#000>Second</span> <span style=color:#000>*</span> <span style=color:#1c01ce>1</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>main</span>() {
</span></span><span style=display:flex><span>   <span style=color:#000>taskCancel</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br><h2 id=context-与任务取消>Context 与任务取消</h2><h3 id=context>Context</h3><p>1、根 Context：通过 context.Background() 创建</p><p>2、子 Context：context.WithCancel(parentContext) 创建</p><p>ctx, cancel := context.WithCancel(context.Background())</p><p>3、当前 Context 被取消时，基于他的子 Context 都被会取消</p><p>4、接收取消通知 &lt;- ctx.Done()</p><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>package</span> <span style=color:#000>main</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>import</span> (
</span></span><span style=display:flex><span>   <span style=color:#c41a16>&#34;context&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#c41a16>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#c41a16>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>isCancelled</span>(<span style=color:#000>ctx</span> <span style=color:#000>context</span>.<span style=color:#000>Context</span>) <span style=color:#a90d91>bool</span> {
</span></span><span style=display:flex><span>   <span style=color:#a90d91>select</span> {
</span></span><span style=display:flex><span>   <span style=color:#a90d91>case</span> <span style=color:#000>&lt;-</span><span style=color:#000>ctx</span>.<span style=color:#000>Done</span>():
</span></span><span style=display:flex><span>      <span style=color:#a90d91>return</span> <span style=color:#a90d91>true</span>
</span></span><span style=display:flex><span>   <span style=color:#a90d91>default</span>:
</span></span><span style=display:flex><span>      <span style=color:#a90d91>return</span> <span style=color:#a90d91>false</span>
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>taskCancel1</span>() {
</span></span><span style=display:flex><span>   <span style=color:#000>ctx</span>, <span style=color:#000>cancel</span> <span style=color:#000>:=</span> <span style=color:#000>context</span>.<span style=color:#000>WithCancel</span>(<span style=color:#000>context</span>.<span style=color:#000>Background</span>())
</span></span><span style=display:flex><span>   <span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>0</span>; <span style=color:#000>i</span> &lt; <span style=color:#1c01ce>5</span>; <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>      <span style=color:#a90d91>go</span> <span style=color:#a90d91>func</span>(<span style=color:#000>i</span> <span style=color:#a90d91>int</span>, <span style=color:#000>ctx</span> <span style=color:#000>context</span>.<span style=color:#000>Context</span>) {
</span></span><span style=display:flex><span>         <span style=color:#a90d91>for</span> {
</span></span><span style=display:flex><span>            <span style=color:#a90d91>if</span> <span style=color:#000>isCancelled</span>(<span style=color:#000>ctx</span>) {
</span></span><span style=display:flex><span>               <span style=color:#a90d91>break</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#000>time</span>.<span style=color:#000>Sleep</span>(<span style=color:#000>time</span>.<span style=color:#000>Microsecond</span> <span style=color:#000>*</span> <span style=color:#1c01ce>5</span>)
</span></span><span style=display:flex><span>         }
</span></span><span style=display:flex><span>         <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>i</span>, <span style=color:#c41a16>&#34;Cancelled&#34;</span>)
</span></span><span style=display:flex><span>      }(<span style=color:#000>i</span>, <span style=color:#000>ctx</span>)
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#000>cancel</span>()
</span></span><span style=display:flex><span>   <span style=color:#000>time</span>.<span style=color:#000>Sleep</span>(<span style=color:#000>time</span>.<span style=color:#000>Second</span> <span style=color:#000>*</span> <span style=color:#1c01ce>1</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>main</span>() {
</span></span><span style=display:flex><span>   <span style=color:#000>taskCancel1</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br><h1 id=典型并发任务>典型并发任务</h1><h2 id=只运行一次>只运行一次</h2><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>package</span> <span style=color:#000>main</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>import</span> (
</span></span><span style=display:flex><span>   <span style=color:#c41a16>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#c41a16>&#34;sync&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#c41a16>&#34;unsafe&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>Singleton</span> <span style=color:#a90d91>struct</span> {
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>var</span> <span style=color:#000>singleInstance</span> <span style=color:#000>*</span><span style=color:#000>Singleton</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>var</span> <span style=color:#000>once</span> <span style=color:#000>sync</span>.<span style=color:#000>Once</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>GetSingletonObj</span>() <span style=color:#000>*</span><span style=color:#000>Singleton</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>once</span>.<span style=color:#000>Do</span>(<span style=color:#a90d91>func</span>() {
</span></span><span style=display:flex><span>      <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;Create Obj&#34;</span>)
</span></span><span style=display:flex><span>      <span style=color:#000>singleInstance</span> = <span style=color:#a90d91>new</span>(<span style=color:#000>Singleton</span>)
</span></span><span style=display:flex><span>   })
</span></span><span style=display:flex><span>   <span style=color:#a90d91>return</span> <span style=color:#000>singleInstance</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>main</span>() {
</span></span><span style=display:flex><span>   <span style=color:#a90d91>var</span> <span style=color:#000>wg</span> <span style=color:#000>sync</span>.<span style=color:#000>WaitGroup</span>
</span></span><span style=display:flex><span>   <span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>0</span>; <span style=color:#000>i</span> &lt; <span style=color:#1c01ce>10</span>; <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>      <span style=color:#000>wg</span>.<span style=color:#000>Add</span>(<span style=color:#1c01ce>1</span>)
</span></span><span style=display:flex><span>      <span style=color:#a90d91>go</span> <span style=color:#a90d91>func</span>() {
</span></span><span style=display:flex><span>         <span style=color:#000>obj</span> <span style=color:#000>:=</span> <span style=color:#000>GetSingletonObj</span>()
</span></span><span style=display:flex><span>         <span style=color:#000>fmt</span>.<span style=color:#000>Printf</span>(<span style=color:#c41a16>&#34;%x
</span></span></span><span style=display:flex><span><span style=color:#c41a16>&#34;</span>,<span style=color:#000>unsafe</span>.<span style=color:#000>Pointer</span>(<span style=color:#000>obj</span>))
</span></span><span style=display:flex><span>         <span style=color:#000>wg</span>.<span style=color:#000>Done</span>()
</span></span><span style=display:flex><span>      }()
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#000>wg</span>.<span style=color:#000>Wait</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br><h2 id=仅需任意任务完成>仅需任意任务完成</h2><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>package</span> <span style=color:#000>main</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>import</span> (
</span></span><span style=display:flex><span>   <span style=color:#c41a16>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#c41a16>&#34;runtime&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#c41a16>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>runTask</span>(<span style=color:#000>id</span> <span style=color:#a90d91>int</span>) <span style=color:#a90d91>string</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>time</span>.<span style=color:#000>Sleep</span>(<span style=color:#1c01ce>10</span> <span style=color:#000>*</span> <span style=color:#000>time</span>.<span style=color:#000>Microsecond</span>)
</span></span><span style=display:flex><span>   <span style=color:#a90d91>return</span> <span style=color:#000>fmt</span>.<span style=color:#000>Sprintf</span>(<span style=color:#c41a16>&#34;The result is from %d&#34;</span>, <span style=color:#000>id</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>FirstResponse</span>() <span style=color:#a90d91>string</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>numOfRunner</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>10</span>
</span></span><span style=display:flex><span>   <span style=color:#000>ch</span> <span style=color:#000>:=</span> <span style=color:#a90d91>make</span>(<span style=color:#a90d91>chan</span> <span style=color:#a90d91>string</span>, <span style=color:#000>numOfRunner</span>) <span style=color:#177500>// 改成 buffer channel，不用阻塞等待
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>0</span>; <span style=color:#000>i</span> &lt; <span style=color:#000>numOfRunner</span>; <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>      <span style=color:#a90d91>go</span> <span style=color:#a90d91>func</span>(<span style=color:#000>i</span> <span style=color:#a90d91>int</span>) {
</span></span><span style=display:flex><span>         <span style=color:#000>ret</span> <span style=color:#000>:=</span> <span style=color:#000>runTask</span>(<span style=color:#000>i</span>)
</span></span><span style=display:flex><span>         <span style=color:#000>ch</span> <span style=color:#000>&lt;-</span> <span style=color:#000>ret</span>
</span></span><span style=display:flex><span>      }(<span style=color:#000>i</span>)
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#a90d91>return</span> <span style=color:#000>&lt;-</span><span style=color:#000>ch</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>main</span>() {
</span></span><span style=display:flex><span>   <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;Before:&#34;</span>, <span style=color:#000>runtime</span>.<span style=color:#000>NumGoroutine</span>())
</span></span><span style=display:flex><span>   <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>FirstResponse</span>())
</span></span><span style=display:flex><span>   <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;After:&#34;</span>, <span style=color:#000>runtime</span>.<span style=color:#000>NumGoroutine</span>())
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br><h2 id=所有任务完成>所有任务完成</h2><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>AllResponse</span>() <span style=color:#a90d91>string</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>numOfRunner</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>10</span>
</span></span><span style=display:flex><span>   <span style=color:#000>ch</span> <span style=color:#000>:=</span> <span style=color:#a90d91>make</span>(<span style=color:#a90d91>chan</span> <span style=color:#a90d91>string</span>, <span style=color:#000>numOfRunner</span>) <span style=color:#177500>// 改成 buffer channel，不用阻塞等待
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>0</span>; <span style=color:#000>i</span> &lt; <span style=color:#000>numOfRunner</span>; <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>      <span style=color:#a90d91>go</span> <span style=color:#a90d91>func</span>(<span style=color:#000>i</span> <span style=color:#a90d91>int</span>) {
</span></span><span style=display:flex><span>         <span style=color:#000>ret</span> <span style=color:#000>:=</span> <span style=color:#000>runTask</span>(<span style=color:#000>i</span>)
</span></span><span style=display:flex><span>         <span style=color:#000>ch</span> <span style=color:#000>&lt;-</span> <span style=color:#000>ret</span>
</span></span><span style=display:flex><span>      }(<span style=color:#000>i</span>)
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#000>finalRet</span> <span style=color:#000>:=</span> <span style=color:#c41a16>&#34;&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#a90d91>for</span> <span style=color:#000>i</span><span style=color:#000>:=</span><span style=color:#1c01ce>0</span> ; <span style=color:#000>i</span>&lt;<span style=color:#000>numOfRunner</span>; <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>      <span style=color:#000>finalRet</span> <span style=color:#000>+=</span> <span style=color:#000>&lt;-</span><span style=color:#000>ch</span> <span style=color:#000>+</span> <span style=color:#c41a16>&#34;
</span></span></span><span style=display:flex><span><span style=color:#c41a16>&#34;</span>
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#a90d91>return</span> <span style=color:#000>finalRet</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><h2 id=对象池>对象池</h2><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>package</span> <span style=color:#000>main</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>import</span> (
</span></span><span style=display:flex><span>   <span style=color:#c41a16>&#34;errors&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#c41a16>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#c41a16>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>ReusableObj</span> <span style=color:#a90d91>struct</span> {
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>ObjPool</span> <span style=color:#a90d91>struct</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>bufChan</span> <span style=color:#a90d91>chan</span> <span style=color:#000>*</span><span style=color:#000>ReusableObj</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>NewObjPool</span>(<span style=color:#000>numOfObj</span> <span style=color:#a90d91>int</span>) <span style=color:#000>*</span><span style=color:#000>ObjPool</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>objPool</span> <span style=color:#000>:=</span> <span style=color:#000>ObjPool</span>{}
</span></span><span style=display:flex><span>   <span style=color:#000>objPool</span>.<span style=color:#000>bufChan</span> = <span style=color:#a90d91>make</span>(<span style=color:#a90d91>chan</span> <span style=color:#000>*</span><span style=color:#000>ReusableObj</span>, <span style=color:#000>numOfObj</span>)
</span></span><span style=display:flex><span>   <span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>0</span>; <span style=color:#000>i</span> &lt; <span style=color:#000>numOfObj</span>; <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>      <span style=color:#000>objPool</span>.<span style=color:#000>bufChan</span> <span style=color:#000>&lt;-</span> <span style=color:#000>&amp;</span><span style=color:#000>ReusableObj</span>{}
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#a90d91>return</span> <span style=color:#000>&amp;</span><span style=color:#000>objPool</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> (<span style=color:#000>p</span> <span style=color:#000>*</span><span style=color:#000>ObjPool</span>) <span style=color:#000>GetObj</span>(<span style=color:#000>timeout</span> <span style=color:#000>time</span>.<span style=color:#000>Duration</span>) (<span style=color:#000>*</span><span style=color:#000>ReusableObj</span>, <span style=color:#a90d91>error</span>) {
</span></span><span style=display:flex><span>   <span style=color:#a90d91>select</span> {
</span></span><span style=display:flex><span>   <span style=color:#a90d91>case</span> <span style=color:#000>ret</span> <span style=color:#000>:=</span> <span style=color:#000>&lt;-</span><span style=color:#000>p</span>.<span style=color:#000>bufChan</span>:
</span></span><span style=display:flex><span>      <span style=color:#a90d91>return</span> <span style=color:#000>ret</span>, <span style=color:#a90d91>nil</span>
</span></span><span style=display:flex><span>   <span style=color:#a90d91>case</span> <span style=color:#000>&lt;-</span><span style=color:#000>time</span>.<span style=color:#000>After</span>(<span style=color:#000>timeout</span>):
</span></span><span style=display:flex><span>      <span style=color:#a90d91>return</span> <span style=color:#a90d91>nil</span>, <span style=color:#000>errors</span>.<span style=color:#000>New</span>(<span style=color:#c41a16>&#34;time out&#34;</span>)
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> (<span style=color:#000>p</span> <span style=color:#000>*</span><span style=color:#000>ObjPool</span>) <span style=color:#000>ReleaseObj</span>(<span style=color:#000>obj</span> <span style=color:#000>*</span><span style=color:#000>ReusableObj</span>) <span style=color:#a90d91>error</span> {
</span></span><span style=display:flex><span>   <span style=color:#a90d91>select</span> {
</span></span><span style=display:flex><span>   <span style=color:#a90d91>case</span> <span style=color:#000>p</span>.<span style=color:#000>bufChan</span> <span style=color:#000>&lt;-</span> <span style=color:#000>obj</span>:
</span></span><span style=display:flex><span>      <span style=color:#a90d91>return</span> <span style=color:#a90d91>nil</span>
</span></span><span style=display:flex><span>   <span style=color:#a90d91>default</span>:
</span></span><span style=display:flex><span>      <span style=color:#a90d91>return</span> <span style=color:#000>errors</span>.<span style=color:#000>New</span>(<span style=color:#c41a16>&#34;overflow&#34;</span>)
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>main</span>() {
</span></span><span style=display:flex><span>   <span style=color:#000>pool</span> <span style=color:#000>:=</span> <span style=color:#000>NewObjPool</span>(<span style=color:#1c01ce>10</span>)
</span></span><span style=display:flex><span>   <span style=color:#177500>//if err := pool.ReleaseObj(&amp;ReusableObj{}); err != nil {
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#177500>// fmt.Println(err.Error()) // overflow
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#177500>//}
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>0</span>; <span style=color:#000>i</span> &lt; <span style=color:#1c01ce>11</span>; <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>      <span style=color:#a90d91>if</span> <span style=color:#000>v</span>, <span style=color:#000>err</span> <span style=color:#000>:=</span> <span style=color:#000>pool</span>.<span style=color:#000>GetObj</span>(<span style=color:#000>time</span>.<span style=color:#000>Second</span> <span style=color:#000>*</span> <span style=color:#1c01ce>1</span>); <span style=color:#000>err</span> <span style=color:#000>!=</span> <span style=color:#a90d91>nil</span> {
</span></span><span style=display:flex><span>         <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>err</span>.<span style=color:#000>Error</span>())
</span></span><span style=display:flex><span>      } <span style=color:#a90d91>else</span> {
</span></span><span style=display:flex><span>         <span style=color:#000>fmt</span>.<span style=color:#000>Printf</span>(<span style=color:#c41a16>&#34;%T
</span></span></span><span style=display:flex><span><span style=color:#c41a16>&#34;</span>, <span style=color:#000>v</span>)
</span></span><span style=display:flex><span>         <span style=color:#177500>// 不及时释放，上面 get 就会 timeout
</span></span></span><span style=display:flex><span><span style=color:#177500></span>         <span style=color:#177500>//if err := pool.ReleaseObj(v); err != nil {
</span></span></span><span style=display:flex><span><span style=color:#177500></span>         <span style=color:#177500>// fmt.Println(err.Error())
</span></span></span><span style=display:flex><span><span style=color:#177500></span>         <span style=color:#177500>//}
</span></span></span><span style=display:flex><span><span style=color:#177500></span>      }
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;Done&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br><h2 id=sync-pool-对象缓存>sync.pool 对象缓存</h2><p>sync.pool 对象获取：</p><p>1、尝试从私有对象（协程安全）获取</p><p>2、私有对象不存在，尝试从当前 Processor 的共享池（协程不安全）获取</p><p>3、如果当前 Processor 共享池也是空的，那么久尝试去其他 Processor 的共享池获取</p><p>sync.pool 对象放回：</p><p>1、如果私有对象不存在则保存为私有对象</p><p>2、如果私有对象存在，放入当前 Processor 子池的共享池中</p><p>使用方式：</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>pool</span> <span style=color:#000>:=</span> <span style=color:#000>&amp;</span><span style=color:#000>sync</span>.<span style=color:#000>Pool</span> {
</span></span><span style=display:flex><span>  <span style=color:#000>New</span>: <span style=color:#a90d91>func</span>() <span style=color:#a90d91>interface</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>return</span> <span style=color:#1c01ce>0</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#000>arry</span> <span style=color:#000>:=</span> <span style=color:#000>pool</span>.<span style=color:#000>Get</span>().(<span style=color:#a90d91>int</span>)
</span></span><span style=display:flex><span><span style=color:#000>pool</span>.<span style=color:#000>put</span>(<span style=color:#1c01ce>10</span>)
</span></span></code></pre></td></tr></table></div></div></div><p>sync.Pool 对象的生命周期</p><p>1、GC 会清除 sync.pool 缓存的对象</p><p>2、对象的缓存有效期为下一次 GC 之前</p><p>使用示例：</p><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>pool</span> <span style=color:#000>:=</span> <span style=color:#000>&amp;</span><span style=color:#000>sync</span>.<span style=color:#000>Pool</span>{
</span></span><span style=display:flex><span>   <span style=color:#000>New</span>: <span style=color:#a90d91>func</span>() <span style=color:#a90d91>interface</span>{} {
</span></span><span style=display:flex><span>      <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;Create a new object.&#34;</span>)
</span></span><span style=display:flex><span>      <span style=color:#a90d91>return</span> <span style=color:#1c01ce>100</span>
</span></span><span style=display:flex><span>   },
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#000>v</span> <span style=color:#000>:=</span> <span style=color:#000>pool</span>.<span style=color:#000>Get</span>().(<span style=color:#a90d91>int</span>)
</span></span><span style=display:flex><span><span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>v</span>)
</span></span><span style=display:flex><span><span style=color:#000>pool</span>.<span style=color:#000>Put</span>(<span style=color:#1c01ce>3</span>)
</span></span><span style=display:flex><span><span style=color:#177500>//runtime.GC() // 清除 sync.Pool 中缓存的对象
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>v1</span>, <span style=color:#000>_</span> <span style=color:#000>:=</span> <span style=color:#000>pool</span>.<span style=color:#000>Get</span>().(<span style=color:#a90d91>int</span>)
</span></span><span style=display:flex><span><span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>v1</span>)
</span></span><span style=display:flex><span><span style=color:#000>v2</span>, <span style=color:#000>_</span> <span style=color:#000>:=</span> <span style=color:#000>pool</span>.<span style=color:#000>Get</span>().(<span style=color:#a90d91>int</span>)
</span></span><span style=display:flex><span><span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>v2</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>// multi value
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>pool</span> <span style=color:#000>:=</span> <span style=color:#000>&amp;</span><span style=color:#000>sync</span>.<span style=color:#000>Pool</span>{
</span></span><span style=display:flex><span>   <span style=color:#000>New</span>: <span style=color:#a90d91>func</span>() <span style=color:#a90d91>interface</span>{} {
</span></span><span style=display:flex><span>      <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;Create a new object.&#34;</span>)
</span></span><span style=display:flex><span>      <span style=color:#a90d91>return</span> <span style=color:#1c01ce>100</span>
</span></span><span style=display:flex><span>   },
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#000>pool</span>.<span style=color:#000>Put</span>(<span style=color:#1c01ce>10</span>)
</span></span><span style=display:flex><span><span style=color:#000>pool</span>.<span style=color:#000>Put</span>(<span style=color:#1c01ce>10</span>)
</span></span><span style=display:flex><span><span style=color:#000>pool</span>.<span style=color:#000>Put</span>(<span style=color:#1c01ce>10</span>)
</span></span><span style=display:flex><span><span style=color:#a90d91>var</span> <span style=color:#000>wg</span> <span style=color:#000>sync</span>.<span style=color:#000>WaitGroup</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>0</span>; <span style=color:#000>i</span> &lt; <span style=color:#1c01ce>10</span>; <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>wg</span>.<span style=color:#000>Add</span>(<span style=color:#1c01ce>1</span>)
</span></span><span style=display:flex><span>   <span style=color:#a90d91>go</span> <span style=color:#a90d91>func</span>(<span style=color:#000>id</span> <span style=color:#a90d91>int</span>) {
</span></span><span style=display:flex><span>      <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>pool</span>.<span style=color:#000>Get</span>())
</span></span><span style=display:flex><span>      <span style=color:#000>wg</span>.<span style=color:#000>Done</span>()
</span></span><span style=display:flex><span>   }(<span style=color:#000>i</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#000>wg</span>.<span style=color:#000>Wait</span>()
</span></span></code></pre></td></tr></table></div></div></details><br><p>sync.Pool 总结：</p><p>1、适合于通过复用，降低复杂对象的创建和 GC 代价</p><p>2、协程安全，会有锁的开销</p><p>3、生命周期受 GC 影响，不适合于做连接池等，需自己管理生命周期的资源的池化</p><h1 id=反射>反射</h1><p><strong>reflect.TypeOf vs reflect.ValueOf</strong></p><p>1、reflect.TypeOf 返回类型（reflect.Type）</p><p>2、reflect.ValueOf 返回值（reflect.Value）</p><p>3、可以从 reflect.Value 获得类型</p><p>4、通过 Kind() 的来判断类型</p><p>利用反射编写灵活的代码</p><p>1、按名字访问结构的成员</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>reflect</span>.<span style=color:#000>ValueOf</span>(<span style=color:#000>*</span><span style=color:#000>e</span>).<span style=color:#000>FieldByName</span>(<span style=color:#c41a16>&#34;Name&#34;</span>)
</span></span></code></pre></td></tr></table></div></div></div><p>2、按名字访问结构的方法<style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>reflect</span>.<span style=color:#000>ValueOf</span>(<span style=color:#000>e</span>).<span style=color:#000>MethodByName</span>(<span style=color:#c41a16>&#34;UpdateAge&#34;</span>).<span style=color:#000>Call</span>([]<span style=color:#000>reflect</span>.<span style=color:#000>Value</span>{<span style=color:#000>reflect</span>.<span style=color:#000>ValueOf</span>(<span style=color:#1c01ce>1</span>)})
</span></span></code></pre></td></tr></table></div></div></div></p><p>反射示例：</p><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>Employee</span> <span style=color:#a90d91>struct</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>EmployeeID</span> <span style=color:#a90d91>string</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Name</span>       <span style=color:#a90d91>string</span> <span style=color:#c41a16>`format:&#34;normal&#34;`</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Age</span>        <span style=color:#a90d91>int</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> (<span style=color:#000>e</span> <span style=color:#000>*</span><span style=color:#000>Employee</span>) <span style=color:#000>UpdateAge</span>(<span style=color:#000>newVal</span> <span style=color:#a90d91>int</span>) {
</span></span><span style=display:flex><span>   <span style=color:#000>e</span>.<span style=color:#000>Age</span> = <span style=color:#000>newVal</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>TestInvokeByName</span>(<span style=color:#000>t</span> <span style=color:#000>*</span><span style=color:#000>testing</span>.<span style=color:#000>T</span>) {
</span></span><span style=display:flex><span>   <span style=color:#000>e</span> <span style=color:#000>:=</span> <span style=color:#000>&amp;</span><span style=color:#000>Employee</span>{<span style=color:#c41a16>&#34;1&#34;</span>, <span style=color:#c41a16>&#34;Mike&#34;</span>, <span style=color:#1c01ce>20</span>}
</span></span><span style=display:flex><span>   <span style=color:#177500>// 按照名字获取成员
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>t</span>.<span style=color:#000>Logf</span>(<span style=color:#c41a16>&#34;Name: value(%[1]v), Type(%[1]T) &#34;</span>, <span style=color:#000>reflect</span>.<span style=color:#000>ValueOf</span>(<span style=color:#000>*</span><span style=color:#000>e</span>).<span style=color:#000>FieldByName</span>(<span style=color:#c41a16>&#34;Name&#34;</span>))
</span></span><span style=display:flex><span>   <span style=color:#a90d91>if</span> <span style=color:#000>nameField</span>, <span style=color:#000>ok</span> <span style=color:#000>:=</span> <span style=color:#000>reflect</span>.<span style=color:#000>TypeOf</span>(<span style=color:#000>*</span><span style=color:#000>e</span>).<span style=color:#000>FieldByName</span>(<span style=color:#c41a16>&#34;Name&#34;</span>); !<span style=color:#000>ok</span> {
</span></span><span style=display:flex><span>      <span style=color:#000>t</span>.<span style=color:#000>Error</span>(<span style=color:#c41a16>&#34;Failed to get &#39;Name&#39; field&#34;</span>)
</span></span><span style=display:flex><span>   } <span style=color:#a90d91>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#000>t</span>.<span style=color:#000>Log</span>(<span style=color:#c41a16>&#34;Tag:format&#34;</span>, <span style=color:#000>nameField</span>.<span style=color:#000>Tag</span>.<span style=color:#000>Get</span>(<span style=color:#c41a16>&#34;format&#34;</span>))
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#000>reflect</span>.<span style=color:#000>ValueOf</span>(<span style=color:#000>e</span>).<span style=color:#000>MethodByName</span>(<span style=color:#c41a16>&#34;UpdateAge&#34;</span>).<span style=color:#000>Call</span>(
</span></span><span style=display:flex><span>      []<span style=color:#000>reflect</span>.<span style=color:#000>Value</span>{<span style=color:#000>reflect</span>.<span style=color:#000>ValueOf</span>(<span style=color:#1c01ce>1</span>)})
</span></span><span style=display:flex><span>   <span style=color:#000>t</span>.<span style=color:#000>Log</span>(<span style=color:#c41a16>&#34;Updated Age:&#34;</span>, <span style=color:#000>e</span>)
</span></span><span style=display:flex><span>   <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>e</span>.<span style=color:#000>Age</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br><h2 id=deepequal>DeepEqual</h2><p>比较切片和map</p><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>Customer</span> <span style=color:#a90d91>struct</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>CookieID</span> <span style=color:#a90d91>string</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Name</span>     <span style=color:#a90d91>string</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Age</span>      <span style=color:#a90d91>int</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>TestDeepEqual</span>(<span style=color:#000>t</span> <span style=color:#000>*</span><span style=color:#000>testing</span>.<span style=color:#000>T</span>) {
</span></span><span style=display:flex><span>   <span style=color:#000>a</span> <span style=color:#000>:=</span> <span style=color:#a90d91>map</span>[<span style=color:#a90d91>int</span>]<span style=color:#a90d91>string</span>{<span style=color:#1c01ce>1</span>: <span style=color:#c41a16>&#34;one&#34;</span>, <span style=color:#1c01ce>2</span>: <span style=color:#c41a16>&#34;two&#34;</span>, <span style=color:#1c01ce>3</span>: <span style=color:#c41a16>&#34;three&#34;</span>}
</span></span><span style=display:flex><span>   <span style=color:#000>b</span> <span style=color:#000>:=</span> <span style=color:#a90d91>map</span>[<span style=color:#a90d91>int</span>]<span style=color:#a90d91>string</span>{<span style=color:#1c01ce>1</span>: <span style=color:#c41a16>&#34;one&#34;</span>, <span style=color:#1c01ce>2</span>: <span style=color:#c41a16>&#34;two&#34;</span>, <span style=color:#1c01ce>3</span>: <span style=color:#c41a16>&#34;three&#34;</span>}
</span></span><span style=display:flex><span>   <span style=color:#177500>// t.Log(a == b)  // error
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>t</span>.<span style=color:#000>Log</span>(<span style=color:#000>reflect</span>.<span style=color:#000>DeepEqual</span>(<span style=color:#000>a</span>, <span style=color:#000>b</span>)) <span style=color:#177500>// true
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>s1</span> <span style=color:#000>:=</span> []<span style=color:#a90d91>int</span>{<span style=color:#1c01ce>1</span>, <span style=color:#1c01ce>2</span>, <span style=color:#1c01ce>3</span>}
</span></span><span style=display:flex><span>   <span style=color:#000>s2</span> <span style=color:#000>:=</span> []<span style=color:#a90d91>int</span>{<span style=color:#1c01ce>1</span>, <span style=color:#1c01ce>2</span>, <span style=color:#1c01ce>3</span>}
</span></span><span style=display:flex><span>   <span style=color:#000>s3</span> <span style=color:#000>:=</span> []<span style=color:#a90d91>int</span>{<span style=color:#1c01ce>2</span>, <span style=color:#1c01ce>3</span>, <span style=color:#1c01ce>1</span>}
</span></span><span style=display:flex><span>   <span style=color:#177500>// t.Log(s1 == s2) // error
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>t</span>.<span style=color:#000>Log</span>(<span style=color:#c41a16>&#34;s1 == s2?&#34;</span>, <span style=color:#000>reflect</span>.<span style=color:#000>DeepEqual</span>(<span style=color:#000>s1</span>, <span style=color:#000>s2</span>)) <span style=color:#177500>// true
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>t</span>.<span style=color:#000>Log</span>(<span style=color:#c41a16>&#34;s1 == s3?&#34;</span>, <span style=color:#000>reflect</span>.<span style=color:#000>DeepEqual</span>(<span style=color:#000>s1</span>, <span style=color:#000>s3</span>)) <span style=color:#177500>// false
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>c1</span> <span style=color:#000>:=</span> <span style=color:#000>Customer</span>{<span style=color:#c41a16>&#34;1&#34;</span>, <span style=color:#c41a16>&#34;Mike&#34;</span>, <span style=color:#1c01ce>20</span>}
</span></span><span style=display:flex><span>   <span style=color:#000>c2</span> <span style=color:#000>:=</span> <span style=color:#000>Customer</span>{<span style=color:#c41a16>&#34;1&#34;</span>, <span style=color:#c41a16>&#34;Mike&#34;</span>, <span style=color:#1c01ce>20</span>}
</span></span><span style=display:flex><span>   <span style=color:#000>t</span>.<span style=color:#000>Log</span>(<span style=color:#000>c1</span> <span style=color:#000>==</span> <span style=color:#000>c2</span>)                  <span style=color:#177500>// true
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>t</span>.<span style=color:#000>Log</span>(<span style=color:#000>reflect</span>.<span style=color:#000>DeepEqual</span>(<span style=color:#000>c1</span>, <span style=color:#000>c2</span>)) <span style=color:#177500>// true
</span></span></span><span style=display:flex><span><span style=color:#177500></span>}
</span></span></code></pre></td></tr></table></div></div></details><br><h2 id=万能程序>万能程序</h2><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>Employee</span> <span style=color:#a90d91>struct</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>EmployeeID</span> <span style=color:#a90d91>string</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Name</span>       <span style=color:#a90d91>string</span> <span style=color:#c41a16>`format:&#34;normal&#34;`</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Age</span>        <span style=color:#a90d91>int</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>Customer</span> <span style=color:#a90d91>struct</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>CookieID</span> <span style=color:#a90d91>string</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Name</span>     <span style=color:#a90d91>string</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Age</span>      <span style=color:#a90d91>int</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>fillBySettings</span>(<span style=color:#000>st</span> <span style=color:#a90d91>interface</span>{}, <span style=color:#000>settings</span> <span style=color:#a90d91>map</span>[<span style=color:#a90d91>string</span>]<span style=color:#a90d91>interface</span>{}) <span style=color:#a90d91>error</span> {
</span></span><span style=display:flex><span>   <span style=color:#177500>// func (v Value) Elem() Value
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#177500>// Elem returns the value that the interface v contains or that the pointer v points to.
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#177500>// It panics if v&#39;s Kind is not Interface or Ptr.
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#177500>// It returns the zero Value if v is nil.
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#a90d91>if</span> <span style=color:#000>reflect</span>.<span style=color:#000>TypeOf</span>(<span style=color:#000>st</span>).<span style=color:#000>Kind</span>() <span style=color:#000>!=</span> <span style=color:#000>reflect</span>.<span style=color:#000>Ptr</span> {
</span></span><span style=display:flex><span>      <span style=color:#a90d91>return</span> <span style=color:#000>errors</span>.<span style=color:#000>New</span>(<span style=color:#c41a16>&#34;the first param should be a pointer to the struct type.&#34;</span>)
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#177500>// Elem() 获取指针指向的值
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#a90d91>if</span> <span style=color:#000>reflect</span>.<span style=color:#000>TypeOf</span>(<span style=color:#000>st</span>).<span style=color:#000>Elem</span>().<span style=color:#000>Kind</span>() <span style=color:#000>!=</span> <span style=color:#000>reflect</span>.<span style=color:#000>Struct</span> {
</span></span><span style=display:flex><span>      <span style=color:#a90d91>return</span> <span style=color:#000>errors</span>.<span style=color:#000>New</span>(<span style=color:#c41a16>&#34;the first param should be a pointer to the struct type.&#34;</span>)
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#a90d91>if</span> <span style=color:#000>settings</span> <span style=color:#000>==</span> <span style=color:#a90d91>nil</span> {
</span></span><span style=display:flex><span>      <span style=color:#a90d91>return</span> <span style=color:#000>errors</span>.<span style=color:#000>New</span>(<span style=color:#c41a16>&#34;settings is nil.&#34;</span>)
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#a90d91>var</span> (
</span></span><span style=display:flex><span>      <span style=color:#000>field</span> <span style=color:#000>reflect</span>.<span style=color:#000>StructField</span>
</span></span><span style=display:flex><span>      <span style=color:#000>ok</span>    <span style=color:#a90d91>bool</span>
</span></span><span style=display:flex><span>   )
</span></span><span style=display:flex><span>   <span style=color:#a90d91>for</span> <span style=color:#000>k</span>, <span style=color:#000>v</span> <span style=color:#000>:=</span> <span style=color:#a90d91>range</span> <span style=color:#000>settings</span> {
</span></span><span style=display:flex><span>      <span style=color:#a90d91>if</span> <span style=color:#000>field</span>, <span style=color:#000>ok</span> = (<span style=color:#000>reflect</span>.<span style=color:#000>ValueOf</span>(<span style=color:#000>st</span>)).<span style=color:#000>Elem</span>().<span style=color:#000>Type</span>().<span style=color:#000>FieldByName</span>(<span style=color:#000>k</span>); !<span style=color:#000>ok</span> {
</span></span><span style=display:flex><span>         <span style=color:#a90d91>continue</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#a90d91>if</span> <span style=color:#000>field</span>.<span style=color:#000>Type</span> <span style=color:#000>==</span> <span style=color:#000>reflect</span>.<span style=color:#000>TypeOf</span>(<span style=color:#000>v</span>) {
</span></span><span style=display:flex><span>         <span style=color:#000>vstr</span> <span style=color:#000>:=</span> <span style=color:#000>reflect</span>.<span style=color:#000>ValueOf</span>(<span style=color:#000>st</span>)
</span></span><span style=display:flex><span>         <span style=color:#000>vstr</span> = <span style=color:#000>vstr</span>.<span style=color:#000>Elem</span>()
</span></span><span style=display:flex><span>         <span style=color:#000>vstr</span>.<span style=color:#000>FieldByName</span>(<span style=color:#000>k</span>).<span style=color:#000>Set</span>(<span style=color:#000>reflect</span>.<span style=color:#000>ValueOf</span>(<span style=color:#000>v</span>))
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#a90d91>return</span> <span style=color:#a90d91>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>TestFillNameAndAge</span>(<span style=color:#000>t</span> <span style=color:#000>*</span><span style=color:#000>testing</span>.<span style=color:#000>T</span>) {
</span></span><span style=display:flex><span>   <span style=color:#000>settings</span> <span style=color:#000>:=</span> <span style=color:#a90d91>map</span>[<span style=color:#a90d91>string</span>]<span style=color:#a90d91>interface</span>{}{<span style=color:#c41a16>&#34;Name&#34;</span>: <span style=color:#c41a16>&#34;Mike&#34;</span>, <span style=color:#c41a16>&#34;Age&#34;</span>: <span style=color:#1c01ce>30</span>}
</span></span><span style=display:flex><span>   <span style=color:#000>e</span> <span style=color:#000>:=</span> <span style=color:#000>Employee</span>{}
</span></span><span style=display:flex><span>   <span style=color:#a90d91>if</span> <span style=color:#000>err</span> <span style=color:#000>:=</span> <span style=color:#000>fillBySettings</span>(<span style=color:#000>&amp;</span><span style=color:#000>e</span>, <span style=color:#000>settings</span>); <span style=color:#000>err</span> <span style=color:#000>!=</span> <span style=color:#a90d91>nil</span> {
</span></span><span style=display:flex><span>      <span style=color:#000>t</span>.<span style=color:#000>Fatal</span>(<span style=color:#000>err</span>)
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#000>t</span>.<span style=color:#000>Log</span>(<span style=color:#000>e</span>)
</span></span><span style=display:flex><span>   <span style=color:#000>c</span> <span style=color:#000>:=</span> <span style=color:#a90d91>new</span>(<span style=color:#000>Customer</span>)
</span></span><span style=display:flex><span>   <span style=color:#a90d91>if</span> <span style=color:#000>err</span> <span style=color:#000>:=</span> <span style=color:#000>fillBySettings</span>(<span style=color:#000>c</span>, <span style=color:#000>settings</span>); <span style=color:#000>err</span> <span style=color:#000>!=</span> <span style=color:#a90d91>nil</span> {
</span></span><span style=display:flex><span>      <span style=color:#000>t</span>.<span style=color:#000>Fatal</span>(<span style=color:#000>err</span>)
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#000>t</span>.<span style=color:#000>Log</span>(<span style=color:#000>*</span><span style=color:#000>c</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br><h2 id=unsafe>unsafe</h2><h3 id=不安全行为>不安全行为</h3><p>“不安全”行为的危险性</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>10</span>
</span></span><span style=display:flex><span><span style=color:#000>f</span> <span style=color:#000>:=</span> <span style=color:#000>*</span>(<span style=color:#000>*</span><span style=color:#a90d91>float64</span>)(<span style=color:#000>unsafe</span>.<span style=color:#000>Pointer</span>(<span style=color:#000>&amp;</span><span style=color:#000>i</span>)) <span style=color:#177500>// 0xc0000aa1b0
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>t</span>.<span style=color:#000>Log</span>(<span style=color:#000>unsafe</span>.<span style=color:#000>Pointer</span>(<span style=color:#000>&amp;</span><span style=color:#000>i</span>)) <span style=color:#177500>// 5e-323
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>t</span>.<span style=color:#000>Log</span>(<span style=color:#000>f</span>)
</span></span></code></pre></td></tr></table></div></div></div><h3 id=合理转换>合理转换</h3><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#177500>// The cases is suitable for unsafe
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>type</span> <span style=color:#000>MyInt</span> <span style=color:#a90d91>int</span>
</span></span><span style=display:flex><span><span style=color:#177500>//合理的类型转换
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>func</span> <span style=color:#000>TestConvert</span>(<span style=color:#000>t</span> <span style=color:#000>*</span><span style=color:#000>testing</span>.<span style=color:#000>T</span>) {
</span></span><span style=display:flex><span>   <span style=color:#000>a</span> <span style=color:#000>:=</span> []<span style=color:#a90d91>int</span>{<span style=color:#1c01ce>1</span>, <span style=color:#1c01ce>2</span>, <span style=color:#1c01ce>3</span>, <span style=color:#1c01ce>4</span>}
</span></span><span style=display:flex><span>   <span style=color:#000>b</span> <span style=color:#000>:=</span> <span style=color:#000>*</span>(<span style=color:#000>*</span>[]<span style=color:#000>MyInt</span>)(<span style=color:#000>unsafe</span>.<span style=color:#000>Pointer</span>(<span style=color:#000>&amp;</span><span style=color:#000>a</span>))
</span></span><span style=display:flex><span>   <span style=color:#000>t</span>.<span style=color:#000>Log</span>(<span style=color:#000>b</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><h3 id=原子类型操作>原子类型操作</h3><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#177500>//原子类型操作
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>func</span> <span style=color:#000>TestAtomic</span>(<span style=color:#000>t</span> <span style=color:#000>*</span><span style=color:#000>testing</span>.<span style=color:#000>T</span>) {
</span></span><span style=display:flex><span>   <span style=color:#a90d91>var</span> <span style=color:#000>shareBufPtr</span> <span style=color:#000>unsafe</span>.<span style=color:#000>Pointer</span>
</span></span><span style=display:flex><span>   <span style=color:#177500>//var shareBufPtr []int
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>writeDataFn</span> <span style=color:#000>:=</span> <span style=color:#a90d91>func</span>() {
</span></span><span style=display:flex><span>      <span style=color:#000>data</span> <span style=color:#000>:=</span> []<span style=color:#a90d91>int</span>{}
</span></span><span style=display:flex><span>      <span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>0</span>; <span style=color:#000>i</span> &lt; <span style=color:#1c01ce>100</span>; <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>         <span style=color:#000>data</span> = <span style=color:#a90d91>append</span>(<span style=color:#000>data</span>, <span style=color:#000>i</span>)
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#000>atomic</span>.<span style=color:#000>StorePointer</span>(<span style=color:#000>&amp;</span><span style=color:#000>shareBufPtr</span>, <span style=color:#000>unsafe</span>.<span style=color:#000>Pointer</span>(<span style=color:#000>&amp;</span><span style=color:#000>data</span>))
</span></span><span style=display:flex><span>      <span style=color:#177500>//shareBufPtr = data
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   }
</span></span><span style=display:flex><span>   <span style=color:#000>readDataFn</span> <span style=color:#000>:=</span> <span style=color:#a90d91>func</span>() {
</span></span><span style=display:flex><span>      <span style=color:#000>data</span> <span style=color:#000>:=</span> <span style=color:#000>atomic</span>.<span style=color:#000>LoadPointer</span>(<span style=color:#000>&amp;</span><span style=color:#000>shareBufPtr</span>)
</span></span><span style=display:flex><span>      <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>data</span>, <span style=color:#000>*</span>(<span style=color:#000>*</span>[]<span style=color:#a90d91>int</span>)(<span style=color:#000>data</span>))
</span></span><span style=display:flex><span>      <span style=color:#177500>//data := shareBufPtr
</span></span></span><span style=display:flex><span><span style=color:#177500></span>      <span style=color:#177500>//fmt.Println(unsafe.Pointer(&amp;data), data)
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   }
</span></span><span style=display:flex><span>   <span style=color:#a90d91>var</span> <span style=color:#000>wg</span> <span style=color:#000>sync</span>.<span style=color:#000>WaitGroup</span>
</span></span><span style=display:flex><span>   <span style=color:#000>writeDataFn</span>()
</span></span><span style=display:flex><span>   <span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>0</span>; <span style=color:#000>i</span> &lt; <span style=color:#1c01ce>10</span>; <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>      <span style=color:#000>wg</span>.<span style=color:#000>Add</span>(<span style=color:#1c01ce>1</span>)
</span></span><span style=display:flex><span>      <span style=color:#a90d91>go</span> <span style=color:#a90d91>func</span>() {
</span></span><span style=display:flex><span>         <span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>0</span>; <span style=color:#000>i</span> &lt; <span style=color:#1c01ce>10</span>; <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>            <span style=color:#000>writeDataFn</span>()
</span></span><span style=display:flex><span>            <span style=color:#000>time</span>.<span style=color:#000>Sleep</span>(<span style=color:#000>time</span>.<span style=color:#000>Microsecond</span> <span style=color:#000>*</span> <span style=color:#1c01ce>100</span>)
</span></span><span style=display:flex><span>         }
</span></span><span style=display:flex><span>         <span style=color:#000>wg</span>.<span style=color:#000>Done</span>()
</span></span><span style=display:flex><span>      }()
</span></span><span style=display:flex><span>      <span style=color:#000>wg</span>.<span style=color:#000>Add</span>(<span style=color:#1c01ce>1</span>)
</span></span><span style=display:flex><span>      <span style=color:#a90d91>go</span> <span style=color:#a90d91>func</span>() {
</span></span><span style=display:flex><span>         <span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>0</span>; <span style=color:#000>i</span> &lt; <span style=color:#1c01ce>10</span>; <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>            <span style=color:#000>readDataFn</span>()
</span></span><span style=display:flex><span>            <span style=color:#000>time</span>.<span style=color:#000>Sleep</span>(<span style=color:#000>time</span>.<span style=color:#000>Microsecond</span> <span style=color:#000>*</span> <span style=color:#1c01ce>100</span>)
</span></span><span style=display:flex><span>         }
</span></span><span style=display:flex><span>         <span style=color:#000>wg</span>.<span style=color:#000>Done</span>()
</span></span><span style=display:flex><span>      }()
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#000>wg</span>.<span style=color:#000>Wait</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br><h1 id=常见架构模式实现>常见架构模式实现</h1><h2 id=pipe-filter-framework>pipe-filter framework</h2><p>1、非常适合与数据处理及数据分析系统</p><p>2、Filter 封装数据处理的功能</p><p>3、松耦合：Filter 只跟数据（格式）耦合</p><p>4、Pipe 用于连接 Filter 传递数据或者在异步处理过程中缓冲数据流</p><p>进程内同步调用时，pipe 演变为数据在方法调用间传递</p><h2 id=micro-kernel-framework>micro-kernel framework</h2><p>特点</p><p>1）易于扩展</p><p>2）错误隔离</p><p>3）保持架构一致性</p><p>要点</p><p>1）内核包含公共流程或通用逻辑</p><p>2）将可变或可扩展部分规划为扩展点</p><p>3）抽象扩展点行为，定义接口</p><p><img src=../imgs/go_basic02_1.png alt=go_basic02_1.png></p><h1 id=常见任务>常见任务</h1><h2 id=内置json解析>内置JSON解析</h2><p>利用反射实现，通过 FeildTag 来标识对应的 json 值（性能很低，不适用于高 QPS 场景）</p><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>BasicInfo</span> <span style=color:#a90d91>struct</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>Name</span> <span style=color:#a90d91>string</span> <span style=color:#c41a16>`json:&#34;name&#34;`</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Age</span>  <span style=color:#a90d91>int</span>    <span style=color:#c41a16>`json:&#34;age&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>JobInfo</span> <span style=color:#a90d91>struct</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>Skills</span> []<span style=color:#a90d91>string</span> <span style=color:#c41a16>`json:&#34;skills&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>Employee</span> <span style=color:#a90d91>struct</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>BasicInfo</span> <span style=color:#000>BasicInfo</span> <span style=color:#c41a16>`json:&#34;basic_info&#34;`</span>
</span></span><span style=display:flex><span>   <span style=color:#000>JobInfo</span>   <span style=color:#000>JobInfo</span>   <span style=color:#c41a16>`json:&#34;job_info&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>var</span> <span style=color:#000>jsonStr</span> = <span style=color:#c41a16>`{
</span></span></span><span style=display:flex><span><span style=color:#c41a16>   &#34;basic_info&#34;:{
</span></span></span><span style=display:flex><span><span style=color:#c41a16>      &#34;name&#34;:&#34;Mike&#34;,
</span></span></span><span style=display:flex><span><span style=color:#c41a16>      &#34;age&#34;:30
</span></span></span><span style=display:flex><span><span style=color:#c41a16>   },
</span></span></span><span style=display:flex><span><span style=color:#c41a16>   &#34;job_info&#34;:{
</span></span></span><span style=display:flex><span><span style=color:#c41a16>      &#34;skills&#34;:[&#34;Java&#34;,&#34;Go&#34;,&#34;C&#34;]
</span></span></span><span style=display:flex><span><span style=color:#c41a16>   }
</span></span></span><span style=display:flex><span><span style=color:#c41a16>}  `</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>TestEmbeddedJson</span>(<span style=color:#000>t</span> <span style=color:#000>*</span><span style=color:#000>testing</span>.<span style=color:#000>T</span>) {
</span></span><span style=display:flex><span>   <span style=color:#000>e</span> <span style=color:#000>:=</span> <span style=color:#a90d91>new</span>(<span style=color:#000>Employee</span>)
</span></span><span style=display:flex><span>   <span style=color:#000>err</span> <span style=color:#000>:=</span> <span style=color:#000>json</span>.<span style=color:#000>Unmarshal</span>([]<span style=color:#a90d91>byte</span>(<span style=color:#000>jsonStr</span>), <span style=color:#000>e</span>)
</span></span><span style=display:flex><span>   <span style=color:#a90d91>if</span> <span style=color:#000>err</span> <span style=color:#000>!=</span> <span style=color:#a90d91>nil</span> {
</span></span><span style=display:flex><span>      <span style=color:#000>t</span>.<span style=color:#000>Error</span>(<span style=color:#000>err</span>)
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>*</span><span style=color:#000>e</span>)
</span></span><span style=display:flex><span>   <span style=color:#a90d91>if</span> <span style=color:#000>v</span>, <span style=color:#000>err</span> <span style=color:#000>:=</span> <span style=color:#000>json</span>.<span style=color:#000>Marshal</span>(<span style=color:#000>e</span>); <span style=color:#000>err</span> <span style=color:#000>==</span> <span style=color:#a90d91>nil</span> {
</span></span><span style=display:flex><span>      <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#a90d91>string</span>(<span style=color:#000>v</span>))
</span></span><span style=display:flex><span>   } <span style=color:#a90d91>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#000>t</span>.<span style=color:#000>Error</span>(<span style=color:#000>err</span>)
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br><h2 id=easyjson>easyjson</h2><p>EasyJSON 采用代码生成而非反射</p><p>安装：</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#177500># 注意，这里的 ... 不用替换</span>
</span></span><span style=display:flex><span>go get -u github.com/mailru/easyjson/...
</span></span></code></pre></td></tr></table></div></div></div><p>使用：<style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#177500># 生成代码</span>
</span></span><span style=display:flex><span>easyjson -all &lt;结构定义&gt;.go
</span></span></code></pre></td></tr></table></div></div></div></p><h2 id=http服务>HTTP服务</h2><p>路由规则：</p><p>1、URL 分为两种，末尾是 / 表示一个子树，后面可以跟其他子路径；末尾不是 /，表示一个叶子，固定的路径以 / 结尾的 URL 可以匹配它的任何子路径，比如 /images/ 会匹配 /images/cute-cat.jpg</p><p>2、它采用最长匹配原则，如果有多个匹配，一定采用匹配路径最长的那个进行处理。</p><p>3、如果没有找到任何匹配项，会返回 404 错误。</p><p>代码示例：</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>package</span> <span style=color:#000>main</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>import</span> (
</span></span><span style=display:flex><span>   <span style=color:#c41a16>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#c41a16>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#c41a16>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>main</span>() {
</span></span><span style=display:flex><span>   <span style=color:#000>http</span>.<span style=color:#000>HandleFunc</span>(<span style=color:#c41a16>&#34;/&#34;</span>, <span style=color:#a90d91>func</span>(<span style=color:#000>w</span> <span style=color:#000>http</span>.<span style=color:#000>ResponseWriter</span>, <span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>http</span>.<span style=color:#000>Request</span>) {
</span></span><span style=display:flex><span>      <span style=color:#000>fmt</span>.<span style=color:#000>Fprintf</span>(<span style=color:#000>w</span>, <span style=color:#c41a16>&#34;Hello World!&#34;</span>)
</span></span><span style=display:flex><span>   })
</span></span><span style=display:flex><span>   <span style=color:#000>http</span>.<span style=color:#000>HandleFunc</span>(<span style=color:#c41a16>&#34;/time/&#34;</span>, <span style=color:#a90d91>func</span>(<span style=color:#000>w</span> <span style=color:#000>http</span>.<span style=color:#000>ResponseWriter</span>, <span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>http</span>.<span style=color:#000>Request</span>) {
</span></span><span style=display:flex><span>      <span style=color:#000>t</span> <span style=color:#000>:=</span> <span style=color:#000>time</span>.<span style=color:#000>Now</span>()
</span></span><span style=display:flex><span>      <span style=color:#000>timeStr</span> <span style=color:#000>:=</span> <span style=color:#000>fmt</span>.<span style=color:#000>Sprintf</span>(<span style=color:#c41a16>&#34;{\&#34;time\&#34;: \&#34;%s\&#34;}&#34;</span>, <span style=color:#000>t</span>)
</span></span><span style=display:flex><span>      <span style=color:#000>w</span>.<span style=color:#000>Write</span>([]<span style=color:#a90d91>byte</span>(<span style=color:#000>timeStr</span>))
</span></span><span style=display:flex><span>   })
</span></span><span style=display:flex><span>   <span style=color:#000>http</span>.<span style=color:#000>ListenAndServe</span>(<span style=color:#c41a16>&#34;:8080&#34;</span>, <span style=color:#a90d91>nil</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><h2 id=restful服务>Restful服务</h2><p>更好的 Router</p><p><a href=https://github.com/julienschmidt/httprouter>https://github.com/julienschmidt/httprouter</a></p><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>package</span> <span style=color:#000>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#c41a16>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#c41a16>&#34;log&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#c41a16>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#c41a16>&#34;github.com/julienschmidt/httprouter&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>Index</span>(<span style=color:#000>w</span> <span style=color:#000>http</span>.<span style=color:#000>ResponseWriter</span>, <span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>http</span>.<span style=color:#000>Request</span>, <span style=color:#000>_</span> <span style=color:#000>httprouter</span>.<span style=color:#000>Params</span>) {
</span></span><span style=display:flex><span>	<span style=color:#000>fmt</span>.<span style=color:#000>Fprint</span>(<span style=color:#000>w</span>, <span style=color:#c41a16>&#34;Welcome!
</span></span></span><span style=display:flex><span><span style=color:#c41a16>&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>Hello</span>(<span style=color:#000>w</span> <span style=color:#000>http</span>.<span style=color:#000>ResponseWriter</span>, <span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>http</span>.<span style=color:#000>Request</span>, <span style=color:#000>ps</span> <span style=color:#000>httprouter</span>.<span style=color:#000>Params</span>) {
</span></span><span style=display:flex><span>	<span style=color:#000>fmt</span>.<span style=color:#000>Fprintf</span>(<span style=color:#000>w</span>, <span style=color:#c41a16>&#34;hello, %s!
</span></span></span><span style=display:flex><span><span style=color:#c41a16>&#34;</span>, <span style=color:#000>ps</span>.<span style=color:#000>ByName</span>(<span style=color:#c41a16>&#34;name&#34;</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#000>router</span> <span style=color:#000>:=</span> <span style=color:#000>httprouter</span>.<span style=color:#000>New</span>()
</span></span><span style=display:flex><span>	<span style=color:#000>router</span>.<span style=color:#000>GET</span>(<span style=color:#c41a16>&#34;/&#34;</span>, <span style=color:#000>Index</span>)
</span></span><span style=display:flex><span>	<span style=color:#000>router</span>.<span style=color:#000>GET</span>(<span style=color:#c41a16>&#34;/hello/:name&#34;</span>, <span style=color:#000>Hello</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#000>log</span>.<span style=color:#000>Fatal</span>(<span style=color:#000>http</span>.<span style=color:#000>ListenAndServe</span>(<span style=color:#c41a16>&#34;:8080&#34;</span>, <span style=color:#000>router</span>))
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br><h1 id=性能调优>性能调优</h1><h2 id=性能分析工具>性能分析工具</h2><p>准备工作：</p><p>1、安装 graphviz</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>brew install graphviz
</span></span></code></pre></td></tr></table></div></div></div><p>2、将 $GOPATH 加入到 $PATH
Mac OS：在 .bash_profile 中修改路径</p><p>3、安装 go-torch（go1.1之后已经内置）</p><p>1）go get</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>go get github.com/uber/go-torch
</span></span></code></pre></td></tr></table></div></div></div><p>2）下载并复制 flamegraph.pl （<a href=https://github.com/brendangregg/FlameGraph>https://github.com/brendangregg/FlameGraph</a>）至 $GOPATH/bin 路径下
3）将 $GOPATH/bin 加入 $PATH</p><p>通过文件方式输出 Profile</p><p>1、灵活性高，适用于特定代码段的分析</p><p>2、通过手动调用 runtime/pprof 的 API</p><p>3、API 相关文档 <a href=https://pkg.go.dev/runtime/pprof>https://pkg.go.dev/runtime/pprof</a></p><p>4、</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>go tool pprof <span style=color:#000>[</span>binary<span style=color:#000>]</span> <span style=color:#000>[</span>binary.prof<span style=color:#000>]</span>
</span></span></code></pre></td></tr></table></div></div></div><p>go 支持多种 profile</p><p>1、go help testflag</p><p>2、<a href=https://pkg.go.dev/github.com/pkg/profile>https://pkg.go.dev/github.com/pkg/profile</a></p><p>代码示例：<a href=https://github.com/chnherb/go-demo/tree/master/ch17_tools/file>https://github.com/chnherb/go-demo/tree/master/ch17_tools/file</a></p><p>查看 profile</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>go tool pprof prof cpu.prof
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>go-torch cpu.prof
</span></span></code></pre></td></tr></table></div></div></div><h3 id=通过-http-方式输出-profile>通过 HTTP 方式输出 Profile</h3><p>1、简单，适合于持续运行的应用</p><p>2、在应用程序中导入 import _ "net/http/pprof" ，并启动 http server 即可</p><p>3、http://<host>:<port>/debug/pprof</p><p>4、</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>go tool pprof http://&lt;host&gt;:&lt;port&gt;/debug/pprof/profile?seconds<span style=color:#000>=</span><span style=color:#1c01ce>10</span>  <span style=color:#177500># 默认值为30秒</span>
</span></span></code></pre></td></tr></table></div></div></div><p>5、<style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>go-torch -seconds <span style=color:#1c01ce>10</span> http://&lt;host&gt;:&lt;port&gt;/debug/pprof/profile
</span></span></code></pre></td></tr></table></div></div></div></p><h2 id=锁的性能>锁的性能</h2><p>sync.Map</p><p>1、适合读多写少，且 key 相对稳定的环境。</p><p>2、采用了空间换时间的方案，并且采用指针的方式简介实现值的映射，所以存储空间会较 built-in map 大。</p><p>Concurrent Map</p><p>1、适用于读写都很频繁的情况</p><p><a href=https://github.com/easierway/concurrent_map>https://github.com/easierway/concurrent_map</a></p><p>代码示例：<a href=https://github.com/chnherb/go-demo/tree/master/ch18_lock>https://github.com/chnherb/go-demo/tree/master/ch18_lock</a></p><h2 id=gc友好的代码>GC友好的代码</h2><p>避免内存分配和复制</p><p>1、复杂对象尽量传递引用</p><p>1）数组的传递</p><p>2）结构体传递</p><p>2、初始化至合适的大小</p><p>1）自动扩容是有代价的</p><p>3、复用内存</p><p>打开 GC 日志</p><p>只要在程序执行之前加上环境变量 GODEBUG=gctrace=1，如：</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#000>GODEBUG</span><span style=color:#000>=</span><span style=color:#000>gctrace</span><span style=color:#000>=</span><span style=color:#1c01ce>1</span> go <span style=color:#a90d91>test</span> -bench<span style=color:#000>=</span>.
</span></span><span style=display:flex><span><span style=color:#000>GODEBUG</span><span style=color:#000>=</span><span style=color:#000>gctrace</span><span style=color:#000>=</span><span style=color:#1c01ce>1</span> go run main.go
</span></span></code></pre></td></tr></table></div></div></div><p>日志详细信息参考：<a href=https://pkg.go.dev/runtime>https://pkg.go.dev/runtime</a></p><h3 id=go-tool-trace>go tool trace</h3><p>普通程序输出 trace 信息</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>package</span> <span style=color:#000>main</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>import</span> (
</span></span><span style=display:flex><span>  <span style=color:#c41a16>&#34;os&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#c41a16>&#34;runtime/trace&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>main</span>() {
</span></span><span style=display:flex><span>  <span style=color:#000>f</span>, <span style=color:#000>err</span> <span style=color:#000>:=</span> <span style=color:#000>os</span>.<span style=color:#000>Create</span>(<span style=color:#c41a16>&#34;trace.out&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a90d91>if</span> <span style=color:#000>err</span> <span style=color:#000>!=</span> <span style=color:#a90d91>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>panic</span>(<span style=color:#000>err</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a90d91>defer</span> <span style=color:#000>f</span>.<span style=color:#000>Close</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><p>测试程序输出 trace 信息</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>go <span style=color:#a90d91>test</span> -trace trace.out
</span></span></code></pre></td></tr></table></div></div></div><p>可视化 trace 信息</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>go tool trace trace.out
</span></span></code></pre></td></tr></table></div></div></div><h1 id=heading></h1></div><div class=td-content style=page-break-before:always><h1 id=pg-f48a2c9f98ac0acb299aae1c8d50489c>4 - util-cli</h1><blockquote><p>本文主要介绍一个基于Golang语言的cli工具，以及部署、使用方法整个链路的流程</p></blockquote><h2 id=背景>背景</h2><p>原来使用石墨文档记录笔记，因为种种原因后来想换成github的pages记录，但是石墨文档导出的MD文件是将图片的原始数据base64加密直接存储在MD文件中，对于原始MD文件的查看是极不友好的，因此想写一个脚本工具将图片原始进行转换，还原MD源文件的简洁。</p><h2 id=功能>功能</h2><ul><li>解析 MD 文件中的 base64 图片数据</li><li>将 base64 图片数据存储到本地相对文件夹的对应文件中</li><li>文件名自动编号</li><li>自动递归编译指定文件夹中的所有MD文件</li></ul><h2 id=实现>实现</h2><ul><li>使用正则匹配md文件中的base64图片数据</li><li>基于go语言的cobra包实现命令行交互</li><li>基于slog包控制界面信息的展示</li></ul><h3 id=源码>源码</h3><p>上传到GitHub：<a href=https://github.com/chnherb/util-cli>https://github.com/chnherb/util-cli</a></p><h3 id=部署>部署</h3><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#177500># 切到仓库目录</span>
</span></span><span style=display:flex><span><span style=color:#177500># 编译生成可执行文件</span>
</span></span><span style=display:flex><span>go build ./
</span></span><span style=display:flex><span>git init
</span></span><span style=display:flex><span>git add .
</span></span><span style=display:flex><span>git commit -m <span style=color:#c41a16>&#34;feat: util-cli init&#34;</span>
</span></span><span style=display:flex><span>git remote add origin https://github.com/chnherb/util-cli.git
</span></span></code></pre></td></tr></table></div></div></div><h2 id=下载方法>下载方法</h2><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#177500># 下载文件到本地，注意修改成自己的路径</span>
</span></span><span style=display:flex><span>https://github.com/chnherb/util-cli/releases/download/v1.0.3/util-cli_v1.0.3_darwin_amd64.tar.gz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500># 注意：软连接必须是全路径，不可用~、./等</span>
</span></span></code></pre></td></tr></table></div></div></div><h2 id=使用说明>使用说明</h2><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>util-cli -h --help
</span></span><span style=display:flex><span>util-cli picbase64 replace base64图像替换
</span></span><span style=display:flex><span>--src: 工作路径，md文件所在路径
</span></span><span style=display:flex><span>--chapter: 当前章节主题，用于生成图片前缀名
</span></span><span style=display:flex><span>--rewrite: 是否替换源文件，默认true，即直接修改原md文件
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500># 命令示例</span>
</span></span><span style=display:flex><span>util-cli picbase64 replace <span style=color:#c41a16>\
</span></span></span><span style=display:flex><span><span style=color:#c41a16></span>--src<span style=color:#000>=</span>/Users/bo/hb_blog --chapter<span style=color:#000>=</span><span style=color:#a90d91>test</span> --rewrite<span style=color:#000>=</span><span style=color:#a90d91>false</span>
</span></span></code></pre></td></tr></table></div></div></div></div><div class=td-content style=page-break-before:always><h1 id=pg-a68d3cb174e7811ff50973e90088c20b>5 - mod包冲突解决实战01</h1><h1 id=背景>背景</h1><p>Go升级包之后编译报错</p><h1 id=常用命令>常用命令</h1><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>
</span></span><span style=display:flex><span>go mod tidy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>go mod why xxx包
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>go list -m -versions xx包
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ go mod <span style=color:#a90d91>help</span>
</span></span><span style=display:flex><span>Usage:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        go mod &lt;command&gt; <span style=color:#000>[</span>arguments<span style=color:#000>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The commands are:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        download    download modules to <span style=color:#a90d91>local</span> cache
</span></span><span style=display:flex><span>        edit        edit go.mod from tools or scripts
</span></span><span style=display:flex><span>        graph       print module requirement graph
</span></span><span style=display:flex><span>        init        initialize new module in current directory
</span></span><span style=display:flex><span>        tidy        add missing and remove unused modules
</span></span><span style=display:flex><span>        vendor      make vendored copy of dependencies
</span></span><span style=display:flex><span>        verify      verify dependencies have expected content
</span></span><span style=display:flex><span>        why         explain why packages or modules are needed
</span></span></code></pre></td></tr></table></div></div></details><br><h1 id=分析过程>分析过程</h1><h2 id=错误1>错误1</h2><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>$</span> <span style=color:#a90d91>go</span> <span style=color:#000>mod</span> <span style=color:#000>tidy</span>
</span></span><span style=display:flex><span><span style=color:#000>code</span>.<span style=color:#000>byted</span>.<span style=color:#000>org</span><span style=color:#000>/</span><span style=color:#000>life</span><span style=color:#000>/</span><span style=color:#000>poi_api</span><span style=color:#000>/</span><span style=color:#000>pack</span> <span style=color:#000>imports</span>
</span></span><span style=display:flex><span>        <span style=color:#000>code</span>.<span style=color:#000>byted</span>.<span style=color:#000>org</span><span style=color:#000>/</span><span style=color:#000>life</span><span style=color:#000>/</span><span style=color:#000>schema_builder</span><span style=color:#000>/</span><span style=color:#000>builder</span> <span style=color:#000>tested</span> <span style=color:#000>by</span>
</span></span><span style=display:flex><span>        <span style=color:#000>code</span>.<span style=color:#000>byted</span>.<span style=color:#000>org</span><span style=color:#000>/</span><span style=color:#000>life</span><span style=color:#000>/</span><span style=color:#000>schema_builder</span><span style=color:#000>/</span><span style=color:#000>builder</span>.<span style=color:#000>test</span> <span style=color:#000>imports</span>
</span></span><span style=display:flex><span>        <span style=color:#000>code</span>.<span style=color:#000>byted</span>.<span style=color:#000>org</span><span style=color:#000>/</span><span style=color:#000>aweme</span><span style=color:#000>/</span><span style=color:#000>goprofile_api</span><span style=color:#000>/</span><span style=color:#000>clients</span> <span style=color:#000>imports</span>
</span></span><span style=display:flex><span>        <span style=color:#000>code</span>.<span style=color:#000>byted</span>.<span style=color:#000>org</span><span style=color:#000>/</span><span style=color:#000>ucenter</span><span style=color:#000>/</span><span style=color:#000>act_passport_lib</span> <span style=color:#000>imports</span>
</span></span><span style=display:flex><span>        <span style=color:#000>code</span>.<span style=color:#000>byted</span>.<span style=color:#000>org</span><span style=color:#000>/</span><span style=color:#000>luckycat</span><span style=color:#000>/</span><span style=color:#000>activity_common_util</span><span style=color:#000>/</span><span style=color:#000>settings</span> <span style=color:#000>imports</span>
</span></span><span style=display:flex><span>        <span style=color:#000>code</span>.<span style=color:#000>byted</span>.<span style=color:#000>org</span><span style=color:#000>/</span><span style=color:#000>luckycat</span><span style=color:#000>/</span><span style=color:#000>activity_common_util</span><span style=color:#000>/</span><span style=color:#000>byteconf</span> <span style=color:#000>imports</span>
</span></span><span style=display:flex><span>        <span style=color:#000>code</span>.<span style=color:#000>byted</span>.<span style=color:#000>org</span><span style=color:#000>/</span><span style=color:#000>ttarch</span><span style=color:#000>/</span><span style=color:#000>byteconf_sdk</span> <span style=color:#000>imports</span>
</span></span><span style=display:flex><span>        <span style=color:#000>code</span>.<span style=color:#000>byted</span>.<span style=color:#000>org</span><span style=color:#000>/</span><span style=color:#000>toutiao</span><span style=color:#000>/</span><span style=color:#000>conf_middleground_json_engine_lib</span><span style=color:#000>/</span><span style=color:#000>model</span><span style=color:#000>/</span><span style=color:#000>celconf</span> <span style=color:#000>imports</span>
</span></span><span style=display:flex><span>        <span style=color:#000>github</span>.<span style=color:#000>com</span><span style=color:#000>/</span><span style=color:#000>google</span><span style=color:#000>/</span><span style=color:#000>cel</span><span style=color:#000>-</span><span style=color:#a90d91>go</span><span style=color:#000>/</span><span style=color:#000>cel</span> <span style=color:#000>imports</span>
</span></span><span style=display:flex><span>        <span style=color:#000>github</span>.<span style=color:#000>com</span><span style=color:#000>/</span><span style=color:#000>google</span><span style=color:#000>/</span><span style=color:#000>cel</span><span style=color:#000>-</span><span style=color:#a90d91>go</span><span style=color:#000>/</span><span style=color:#000>parser</span> <span style=color:#000>imports</span>
</span></span><span style=display:flex><span>        <span style=color:#000>github</span>.<span style=color:#000>com</span><span style=color:#000>/</span><span style=color:#000>antlr</span><span style=color:#000>/</span><span style=color:#000>antlr4</span><span style=color:#000>/</span><span style=color:#000>runtime</span><span style=color:#000>/</span><span style=color:#000>Go</span><span style=color:#000>/</span><span style=color:#000>antlr</span>: <span style=color:#000>ambiguous</span> <span style=color:#a90d91>import</span>: <span style=color:#000>found</span> <span style=color:#a90d91>package</span> <span style=color:#000>github</span>.<span style=color:#000>com</span><span style=color:#000>/</span><span style=color:#000>antlr</span><span style=color:#000>/</span><span style=color:#000>antlr4</span><span style=color:#000>/</span><span style=color:#000>runtime</span><span style=color:#000>/</span><span style=color:#000>Go</span><span style=color:#000>/</span><span style=color:#000>antlr</span> <span style=color:#000>in</span> <span style=color:#000>multiple</span> <span style=color:#000>modules</span>:
</span></span><span style=display:flex><span>        <span style=color:#000>github</span>.<span style=color:#000>com</span><span style=color:#000>/</span><span style=color:#000>antlr</span><span style=color:#000>/</span><span style=color:#000>antlr4</span> <span style=color:#000>v0</span><span style=color:#1c01ce>.0.0</span><span style=color:#000>-</span><span style=color:#1c01ce>20200503195918</span><span style=color:#000>-</span><span style=color:#1c01ce>621</span><span style=color:#000>b933c7a7f</span> (<span style=color:#000>/</span><span style=color:#000>Users</span><span style=color:#000>/</span><span style=color:#000>admin</span><span style=color:#000>/</span><span style=color:#a90d91>go</span><span style=color:#000>/</span><span style=color:#000>pkg</span><span style=color:#000>/</span><span style=color:#000>mod</span><span style=color:#000>/</span><span style=color:#000>github</span>.<span style=color:#000>com</span><span style=color:#000>/</span><span style=color:#000>antlr</span><span style=color:#000>/</span><span style=color:#000>antlr4</span><span style=color:#000>@</span><span style=color:#000>v0</span><span style=color:#1c01ce>.0.0</span><span style=color:#000>-</span><span style=color:#1c01ce>20200503195918</span><span style=color:#000>-</span><span style=color:#1c01ce>621</span><span style=color:#000>b933c7a7f</span><span style=color:#000>/</span><span style=color:#000>runtime</span><span style=color:#000>/</span><span style=color:#000>Go</span><span style=color:#000>/</span><span style=color:#000>antlr</span>)
</span></span><span style=display:flex><span>        <span style=color:#000>github</span>.<span style=color:#000>com</span><span style=color:#000>/</span><span style=color:#000>antlr</span><span style=color:#000>/</span><span style=color:#000>antlr4</span><span style=color:#000>/</span><span style=color:#000>runtime</span><span style=color:#000>/</span><span style=color:#000>Go</span><span style=color:#000>/</span><span style=color:#000>antlr</span> <span style=color:#000>v0</span><span style=color:#1c01ce>.0.0</span><span style=color:#000>-</span><span style=color:#1c01ce>20210521184019</span><span style=color:#000>-</span><span style=color:#000>c5ad59b459ec</span> (<span style=color:#000>/</span><span style=color:#000>Users</span><span style=color:#000>/</span><span style=color:#000>admin</span><span style=color:#000>/</span><span style=color:#a90d91>go</span><span style=color:#000>/</span><span style=color:#000>pkg</span><span style=color:#000>/</span><span style=color:#000>mod</span><span style=color:#000>/</span><span style=color:#000>github</span>.<span style=color:#000>com</span><span style=color:#000>/</span><span style=color:#000>antlr</span><span style=color:#000>/</span><span style=color:#000>antlr4</span><span style=color:#000>/</span><span style=color:#000>runtime</span><span style=color:#000>/</span>!<span style=color:#a90d91>go</span><span style=color:#000>/</span><span style=color:#000>antlr</span><span style=color:#000>@</span><span style=color:#000>v0</span><span style=color:#1c01ce>.0.0</span><span style=color:#000>-</span><span style=color:#1c01ce>20210521184019</span><span style=color:#000>-</span><span style=color:#000>c5ad59b459ec</span>)
</span></span></code></pre></td></tr></table></div></div></div><h2 id=解决1>解决1</h2><p>分析：尝试升级 cel-go 依赖库</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ go get github.com/google/cel-go
</span></span></code></pre></td></tr></table></div></div></div><p>然后 go mod tidy，提示<style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>To upgrade to the versions selected by go 1.16:
</span></span><span style=display:flex><span>        go mod tidy -go<span style=color:#000>=</span>1.16 <span style=color:#000>&amp;&amp;</span> go mod tidy -go<span style=color:#000>=</span>1.17
</span></span><span style=display:flex><span>If reproducibility with go 1.16 is not needed:
</span></span><span style=display:flex><span>        go mod tidy -compat<span style=color:#000>=</span>1.17
</span></span><span style=display:flex><span>For other options, see:
</span></span></code></pre></td></tr></table></div></div></div></p><p>便执行<style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>go mod tidy -go<span style=color:#000>=</span>1.16 <span style=color:#000>&amp;&amp;</span> go mod tidy -go<span style=color:#000>=</span>1.17
</span></span></code></pre></td></tr></table></div></div></div></p><h2 id=错误2>错误2</h2><p>编译报错：</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>2023/09/03 16:20:41 ../compile_path/pkg/mod/code.byted.org/iesarch/samsarahq_thunder@v0.0.0-20230227104850-d8b99a2a24a4/graphql/directive.go:141:55: cannot use NewMultiMapParameters<span style=color:#000>(</span>expressArguments, r.E.AssignData, r.E.RawData, sourceMap<span style=color:#000>)</span> <span style=color:#000>(</span><span style=color:#a90d91>type</span> MultiMapParameters<span style=color:#000>)</span> as <span style=color:#a90d91>type</span> govaluate.MapParameters in argument to expression.Eval
</span></span><span style=display:flex><span><span style=color:#1c01ce>499</span>
</span></span><span style=display:flex><span>2023/09/03 16:20:41 ../compile_path/pkg/mod/code.byted.org/iesarch/samsarahq_thunder@v0.0.0-20230227104850-d8b99a2a24a4/graphql/eval_calculator.go:32:48: cannot use NewMultiMapParameters<span style=color:#000>(</span>m...<span style=color:#000>)</span> <span style=color:#000>(</span><span style=color:#a90d91>type</span> MultiMapParameters<span style=color:#000>)</span> as <span style=color:#a90d91>type</span> govaluate.MapParameters in argument to e.expression.Eval
</span></span><span style=display:flex><span><span style=color:#1c01ce>500</span>
</span></span><span style=display:flex><span>2023/09/03 16:20:41 ../compile_path/pkg/mod/code.byted.org/iesarch/samsarahq_thunder@v0.0.0-20230227104850-d8b99a2a24a4/graphql/resolver.go:408:55: cannot use NewMultiMapParameters<span style=color:#000>(</span>expressArguments, r.E.AssignData, r.E.RawData, sourceMap<span style=color:#000>)</span> <span style=color:#000>(</span><span style=color:#a90d91>type</span> MultiMapParameters<span style=color:#000>)</span> as <span style=color:#a90d91>type</span> govaluate.MapParameters in argument to expression.Eval
</span></span><span style=display:flex><span><span style=color:#1c01ce>501</span>
</span></span><span style=display:flex><span>2023/09/03 16:20:49 <span style=color:#177500># code.byted.org/eventbus/client-go/discovery</span>
</span></span></code></pre></td></tr></table></div></div></div><h2 id=解决2>解决2</h2><p>通过报错信息可以发现 code.byted.org/iesarch/samsarahq_thunder 依赖 code.byted.org/whale/govaluate 包，但出现参数不匹配的问题。</p><p>对比之前master代码，发现 code.byted.org/iesarch/samsarahq_thunder 版本无变化，code.byted.org/whale/govaluate 版本由 v1.0.1 升级到了 v1.0.5（也可以查看该包所有版本）。顾降级该版本。</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>replace code.byted.org/whale/govaluate <span style=color:#000>=</span>&gt; code.byted.org/whale/govaluate v1.0.1
</span></span></code></pre></td></tr></table></div></div></div><p>重新执行：</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>go mod tidy
</span></span></code></pre></td></tr></table></div></div></div><p>然后重新编译</p><h2 id=错误3>错误3</h2><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>2023/09/03 16:50:14 + go build -mod<span style=color:#000>=</span>mod -o data.life.poi_api -opt<span style=color:#000>=</span>beast
</span></span><span style=display:flex><span><span style=color:#1c01ce>497</span>
</span></span><span style=display:flex><span>2023/09/03 16:50:50 <span style=color:#177500># code.byted.org/eventbus/client-go/discovery</span>
</span></span><span style=display:flex><span><span style=color:#1c01ce>498</span>
</span></span><span style=display:flex><span>2023/09/03 16:50:50 ../compile_path/pkg/mod/code.byted.org/eventbus/client-go@v1.10.1/discovery/consul_resolver.go:48:8: invalid argument cluster <span style=color:#000>(</span><span style=color:#a90d91>type</span> func<span style=color:#000>()</span> string<span style=color:#000>)</span> <span style=color:#a90d91>for</span> len
</span></span><span style=display:flex><span><span style=color:#1c01ce>499</span>
</span></span><span style=display:flex><span>2023/09/03 16:50:50 ../compile_path/pkg/mod/code.byted.org/eventbus/client-go@v1.10.1/discovery/consul_resolver.go:49:11: cannot use defaultCluster <span style=color:#000>(</span><span style=color:#a90d91>type</span> string<span style=color:#000>)</span> as <span style=color:#a90d91>type</span> func<span style=color:#000>()</span> string in assignment
</span></span><span style=display:flex><span><span style=color:#1c01ce>500</span>
</span></span><span style=display:flex><span>2023/09/03 16:50:50 ../compile_path/pkg/mod/code.byted.org/eventbus/client-go@v1.10.1/discovery/consul_resolver.go:54:26: cannot use cluster <span style=color:#000>(</span><span style=color:#a90d91>type</span> func<span style=color:#000>()</span> string<span style=color:#000>)</span> as <span style=color:#a90d91>type</span> string in argument to newConsulResolver
</span></span></code></pre></td></tr></table></div></div></div><h2 id=解决3>解决3</h2><p>分析 code.byted.org/eventbus/client-go 原来master代码是 v1.10.1，现在的版本还是一样，查找该包所有版本：</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>go list -m -versions code.byted.org/eventbus/client-go
</span></span></code></pre></td></tr></table></div></div></div><p>也可直接升级到最新版本：<style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>go get code.byted.org/eventbus/client-go
</span></span></code></pre></td></tr></table></div></div></div></p><p>查看mod文件升级到 v1.13.5，然后tidy之后重新编译。</p><h2 id=问题4>问题4</h2><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#177500># code.byted.org/eventbus/client-go/discovery</span>
</span></span><span style=display:flex><span>/home/byteide/go/pkg/mod/code.byted.org/eventbus/client-go@v1.10.1/discovery/consul_resolver.go:48:8: invalid argument cluster <span style=color:#000>(</span><span style=color:#a90d91>type</span> func<span style=color:#000>()</span> string<span style=color:#000>)</span> <span style=color:#a90d91>for</span> len
</span></span><span style=display:flex><span>/home/byteide/go/pkg/mod/code.byted.org/eventbus/client-go@v1.10.1/discovery/consul_resolver.go:49:11: cannot use defaultCluster <span style=color:#000>(</span><span style=color:#a90d91>type</span> string<span style=color:#000>)</span> as <span style=color:#a90d91>type</span> func<span style=color:#000>()</span> string in assignment
</span></span><span style=display:flex><span>/home/byteide/go/pkg/mod/code.byted.org/eventbus/client-go@v1.10.1/discovery/consul_resolver.go:54:26: cannot use cluster <span style=color:#000>(</span><span style=color:#a90d91>type</span> func<span style=color:#000>()</span> string<span style=color:#000>)</span> as <span style=color:#a90d91>type</span> string in argument to newConsulResolver
</span></span><span style=display:flex><span><span style=color:#177500># github.com/mattn/go-sqlite3</span>
</span></span><span style=display:flex><span>sqlite3-binding.c: In <span style=color:#a90d91>function</span> ‘sqlite3SelectNew’:
</span></span><span style=display:flex><span>sqlite3-binding.c:128049:10: warning: <span style=color:#a90d91>function</span> may <span style=color:#a90d91>return</span> address of <span style=color:#a90d91>local</span> variable <span style=color:#000>[</span>-Wreturn-local-addr<span style=color:#000>]</span>
</span></span><span style=display:flex><span><span style=color:#1c01ce>128049</span> |   <span style=color:#a90d91>return</span> pNew;
</span></span><span style=display:flex><span>       |          ^~~~
</span></span><span style=display:flex><span>sqlite3-binding.c:128009:10: note: declared here
</span></span><span style=display:flex><span><span style=color:#1c01ce>128009</span> |   Select standin;
</span></span></code></pre></td></tr></table></div></div></div><h2 id=解决4>解决4</h2><p>参考：</p><blockquote><p><a href=https://github.com/mattn/go-sqlite3/issues/822>https://github.com/mattn/go-sqlite3/issues/822</a>
<a href=https://github.com/mattn/go-sqlite3/issues/803>https://github.com/mattn/go-sqlite3/issues/803</a></p></blockquote><p>查看</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ go env | grep -i CGO_CFLAGS
</span></span><span style=display:flex><span><span style=color:#000>CGO_CFLAGS</span><span style=color:#000>=</span><span style=color:#c41a16>&#34;-g -O2&#34;</span>
</span></span></code></pre></td></tr></table></div></div></div><p>解决：<style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#000>CGO_CFLAGS</span><span style=color:#000>=</span><span style=color:#c41a16>&#34;-g -O2 -Wno-return-local-addr&#34;</span> bash build.sh
</span></span></code></pre></td></tr></table></div></div></div></p></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2023 The Herb 保留所有权利</small>
<small class=ml-1><a href=# target=_blank rel=noopener>隐私政策</a></small><p class=mt-2><a href=/about/>Herbdocs</a></p></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.91798a335c881f1b6b805085ba4aa22d1dbd2b0b18d105d05189fa104ddae350.js integrity="sha256-kXmKM1yIHxtrgFCFukqiLR29KwsY0QXQUYn6EE3a41A=" crossorigin=anonymous></script></body></html>