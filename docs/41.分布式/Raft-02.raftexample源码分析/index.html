<!doctype html><html lang=zh-cn class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.101.0"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Raft-02.raftexample源码分析 | Herbdocs</title><meta name=description content="前言
本文源码分析代码参考 etcd v3.5.0 中 raft 代码：
https://github.com/etcd-io/etcd/tree/v3.5.0/contrib/raftexample
Etcd 将 raft 协议实现为一个 library，然后本身作为一个应用使用它。此外，etcd …"><meta property="og:title" content="Raft-02.raftexample源码分析"><meta property="og:description" content="前言 本文源码分析代码参考 etcd v3.5.0 中 raft 代码：
https://github.com/etcd-io/etcd/tree/v3.5.0/contrib/raftexample
Etcd 将 raft 协议实现为一个 library，然后本身作为一个应用使用它。此外，etcd 还提供了一个叫 raftexample 的示例程序。
在 etcd 中，raft 作为底层的共识模块，运行在一个 goroutine 里，通过 channel 接受上层（etcdserver）的消息，并将处理结果通过另一个 channel 返回给上层应用，交互过程大致如下：
这种全异步地交互方式好处是提高了性能，坏处是难以测试，增加代码阅读难度。
基本概念 源码中定义的一些变量概念
Node: 对 etcd-raft 模块具体实现的一层封装，方便上层模块使用 etcd-raft 模块；
上层模块: etcd-raft 的调用者，上层模块通过Node提供的API与底层的 etcd-raft 模块进行交互；
Cluster: 表示一个集群,其中记录了该集群的基础信息；
Member: 组层Cluster的元素之一，其中封装了一个节点的基本信息；
Peer: 集群中某个节点对集群中另一个节点的称呼；
Entry记录: 节点之间的传递是通过 message 进行的，每条消息中可以携带多条 Entry 记录,每条Entry对应一条一个独立的操作 1 2 3 4 5 6 7 8 9 10 11 12 13 type Entry struct { // Term：表示该Entry所在的任期。 Term uint64 `protobuf:&#34;varint,2,opt,name=Term&#34; json:&#34;Term&#34;` // Index:当前这个entry在整个raft日志中的位置索引,有了Term和Index之后，一个`log entry`就能被唯一标识。 Index uint64 `protobuf:&#34;varint,3,opt,name=Index&#34; json:&#34;Index&#34;` // 当前entry的类型 // 目前etcd支持两种类型：EntryNormal和EntryConfChange // EntryNormaln表示普通的数据操作 // EntryConfChange表示集群的变更操作 Type EntryType `protobuf:&#34;varint,1,opt,name=Type,enum=raftpb."><meta property="og:type" content="article"><meta property="og:url" content="/docs/41.%E5%88%86%E5%B8%83%E5%BC%8F/Raft-02.raftexample%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"><meta property="article:section" content="docs"><meta property="og:site_name" content="Herbdocs"><meta itemprop=name content="Raft-02.raftexample源码分析"><meta itemprop=description content="前言 本文源码分析代码参考 etcd v3.5.0 中 raft 代码：
https://github.com/etcd-io/etcd/tree/v3.5.0/contrib/raftexample
Etcd 将 raft 协议实现为一个 library，然后本身作为一个应用使用它。此外，etcd 还提供了一个叫 raftexample 的示例程序。
在 etcd 中，raft 作为底层的共识模块，运行在一个 goroutine 里，通过 channel 接受上层（etcdserver）的消息，并将处理结果通过另一个 channel 返回给上层应用，交互过程大致如下：
这种全异步地交互方式好处是提高了性能，坏处是难以测试，增加代码阅读难度。
基本概念 源码中定义的一些变量概念
Node: 对 etcd-raft 模块具体实现的一层封装，方便上层模块使用 etcd-raft 模块；
上层模块: etcd-raft 的调用者，上层模块通过Node提供的API与底层的 etcd-raft 模块进行交互；
Cluster: 表示一个集群,其中记录了该集群的基础信息；
Member: 组层Cluster的元素之一，其中封装了一个节点的基本信息；
Peer: 集群中某个节点对集群中另一个节点的称呼；
Entry记录: 节点之间的传递是通过 message 进行的，每条消息中可以携带多条 Entry 记录,每条Entry对应一条一个独立的操作 1 2 3 4 5 6 7 8 9 10 11 12 13 type Entry struct { // Term：表示该Entry所在的任期。 Term uint64 `protobuf:&#34;varint,2,opt,name=Term&#34; json:&#34;Term&#34;` // Index:当前这个entry在整个raft日志中的位置索引,有了Term和Index之后，一个`log entry`就能被唯一标识。 Index uint64 `protobuf:&#34;varint,3,opt,name=Index&#34; json:&#34;Index&#34;` // 当前entry的类型 // 目前etcd支持两种类型：EntryNormal和EntryConfChange // EntryNormaln表示普通的数据操作 // EntryConfChange表示集群的变更操作 Type EntryType `protobuf:&#34;varint,1,opt,name=Type,enum=raftpb."><meta itemprop=wordCount content="4398"><meta itemprop=keywords content="raft,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Raft-02.raftexample源码分析"><meta name=twitter:description content="前言 本文源码分析代码参考 etcd v3.5.0 中 raft 代码：
https://github.com/etcd-io/etcd/tree/v3.5.0/contrib/raftexample
Etcd 将 raft 协议实现为一个 library，然后本身作为一个应用使用它。此外，etcd 还提供了一个叫 raftexample 的示例程序。
在 etcd 中，raft 作为底层的共识模块，运行在一个 goroutine 里，通过 channel 接受上层（etcdserver）的消息，并将处理结果通过另一个 channel 返回给上层应用，交互过程大致如下：
这种全异步地交互方式好处是提高了性能，坏处是难以测试，增加代码阅读难度。
基本概念 源码中定义的一些变量概念
Node: 对 etcd-raft 模块具体实现的一层封装，方便上层模块使用 etcd-raft 模块；
上层模块: etcd-raft 的调用者，上层模块通过Node提供的API与底层的 etcd-raft 模块进行交互；
Cluster: 表示一个集群,其中记录了该集群的基础信息；
Member: 组层Cluster的元素之一，其中封装了一个节点的基本信息；
Peer: 集群中某个节点对集群中另一个节点的称呼；
Entry记录: 节点之间的传递是通过 message 进行的，每条消息中可以携带多条 Entry 记录,每条Entry对应一条一个独立的操作 1 2 3 4 5 6 7 8 9 10 11 12 13 type Entry struct { // Term：表示该Entry所在的任期。 Term uint64 `protobuf:&#34;varint,2,opt,name=Term&#34; json:&#34;Term&#34;` // Index:当前这个entry在整个raft日志中的位置索引,有了Term和Index之后，一个`log entry`就能被唯一标识。 Index uint64 `protobuf:&#34;varint,3,opt,name=Index&#34; json:&#34;Index&#34;` // 当前entry的类型 // 目前etcd支持两种类型：EntryNormal和EntryConfChange // EntryNormaln表示普通的数据操作 // EntryConfChange表示集群的变更操作 Type EntryType `protobuf:&#34;varint,1,opt,name=Type,enum=raftpb."><link rel=preload href=/scss/main.min.dcab2c3dae6e6fefb7672f19e4b612cc4e75ca208740f642aa2f1fe378478a8f.css as=style><link href=/scss/main.min.dcab2c3dae6e6fefb7672f19e4b612cc4e75ca208740f642aa2f1fe378478a8f.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-00000000-0","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><img width=6% style=margin-bottom:1% src=/favicons/favicon.ico></span><span class=font-weight-bold>&nbsp;Herbdocs</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/about/><span>About</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/><span class=active>Documentation</span></a></li><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Chinese</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/en/>English</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; 站内搜索…" aria-label=站内搜索… autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002; 站内搜索…" aria-label=站内搜索… autocomplete=off>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav foldable-nav" id=td-section-nav><div class="nav-item dropdown d-block d-lg-none"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Chinese</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/en/>English</a></div></div><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docs-li><a href=/docs/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docs><span>Documentation</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-00-util-li><input type=checkbox id=m-docs-00-util-check>
<label for=m-docs-00-util-check><a href=/docs/00.util/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-00-util><span>util</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-00-util-git-li><input type=checkbox id=m-docs-00-util-git-check>
<label for=m-docs-00-util-git-check><a href=/docs/00.util/git/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-00-util-git><span>git</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-00-util-git-github-actions-e5-8f-91-e5-b8-83pages-li><input type=checkbox id=m-docs-00-util-git-github-actions-e5-8f-91-e5-b8-83pages-check>
<label for=m-docs-00-util-git-github-actions-e5-8f-91-e5-b8-83pages-check><a href=/docs/00.util/git/github-actions%E5%8F%91%E5%B8%83pages/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-00-util-git-github-actions-e5-8f-91-e5-b8-83pages><span>github-actions发布pages</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-00-util-git-git-e5-b8-b8-e7-94-a8-e6-93-8d-e4-bd-9c-li><input type=checkbox id=m-docs-00-util-git-git-e5-b8-b8-e7-94-a8-e6-93-8d-e4-bd-9c-check>
<label for=m-docs-00-util-git-git-e5-b8-b8-e7-94-a8-e6-93-8d-e4-bd-9c-check><a href=/docs/00.util/git/git%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-00-util-git-git-e5-b8-b8-e7-94-a8-e6-93-8d-e4-bd-9c><span>git常用操作</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-00-util-git-git-e5-9f-ba-e7-a1-80-e7-9f-a5-e8-af-86-li><input type=checkbox id=m-docs-00-util-git-git-e5-9f-ba-e7-a1-80-e7-9f-a5-e8-af-86-check>
<label for=m-docs-00-util-git-git-e5-9f-ba-e7-a1-80-e7-9f-a5-e8-af-86-check><a href=/docs/00.util/git/git%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-00-util-git-git-e5-9f-ba-e7-a1-80-e7-9f-a5-e8-af-86><span>git基础知识</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-00-util-gitbook-e4-bd-bf-e7-94-a8-e6-8c-87-e5-8d-97-li><input type=checkbox id=m-docs-00-util-gitbook-e4-bd-bf-e7-94-a8-e6-8c-87-e5-8d-97-check>
<label for=m-docs-00-util-gitbook-e4-bd-bf-e7-94-a8-e6-8c-87-e5-8d-97-check><a href=/docs/00.util/gitbook%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-00-util-gitbook-e4-bd-bf-e7-94-a8-e6-8c-87-e5-8d-97><span>gitbook使用指南</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-00-util-github-e6-90-9c-e7-b4-a2-e6-8a-80-e5-b7-a7-li><input type=checkbox id=m-docs-00-util-github-e6-90-9c-e7-b4-a2-e6-8a-80-e5-b7-a7-check>
<label for=m-docs-00-util-github-e6-90-9c-e7-b4-a2-e6-8a-80-e5-b7-a7-check><a href=/docs/00.util/github%E6%90%9C%E7%B4%A2%E6%8A%80%E5%B7%A7/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-00-util-github-e6-90-9c-e7-b4-a2-e6-8a-80-e5-b7-a7><span>github搜索技巧</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-00-util-e5-bf-ab-e6-8d-b7-e9-94-ae-li><input type=checkbox id=m-docs-00-util-e5-bf-ab-e6-8d-b7-e9-94-ae-check>
<label for=m-docs-00-util-e5-bf-ab-e6-8d-b7-e9-94-ae-check><a href=/docs/00.util/%E5%BF%AB%E6%8D%B7%E9%94%AE/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-00-util-e5-bf-ab-e6-8d-b7-e9-94-ae><span>快捷键</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-00-util-hugo-e6-90-ad-e5-bb-ba-e4-b8-aa-e4-ba-ba-e7-bd-91-e7-ab-99-li><input type=checkbox id=m-docs-00-util-hugo-e6-90-ad-e5-bb-ba-e4-b8-aa-e4-ba-ba-e7-bd-91-e7-ab-99-check>
<label for=m-docs-00-util-hugo-e6-90-ad-e5-bb-ba-e4-b8-aa-e4-ba-ba-e7-bd-91-e7-ab-99-check><a href=/docs/00.util/hugo%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-00-util-hugo-e6-90-ad-e5-bb-ba-e4-b8-aa-e4-ba-ba-e7-bd-91-e7-ab-99><span>hugo搭建个人网站</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-00-util-e6-ad-a3-e5-88-99-e8-a1-a8-e8-be-be-e5-bc-8f-li><input type=checkbox id=m-docs-00-util-e6-ad-a3-e5-88-99-e8-a1-a8-e8-be-be-e5-bc-8f-check>
<label for=m-docs-00-util-e6-ad-a3-e5-88-99-e8-a1-a8-e8-be-be-e5-bc-8f-check><a href=/docs/00.util/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-00-util-e6-ad-a3-e5-88-99-e8-a1-a8-e8-be-be-e5-bc-8f><span>正则表达式</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-10-os-li><input type=checkbox id=m-docs-10-os-check>
<label for=m-docs-10-os-check><a href=/docs/10.OS/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-10-os><span>OS</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-10-os-00-os-e7-9b-b8-e5-85-b3-e6-a6-82-e5-bf-b5-li><input type=checkbox id=m-docs-10-os-00-os-e7-9b-b8-e5-85-b3-e6-a6-82-e5-bf-b5-check>
<label for=m-docs-10-os-00-os-e7-9b-b8-e5-85-b3-e6-a6-82-e5-bf-b5-check><a href=/docs/10.OS/00.OS%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-10-os-00-os-e7-9b-b8-e5-85-b3-e6-a6-82-e5-bf-b5><span>00.OS相关概念</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-10-os-linux-e8-b4-9f-e8-bd-bd-e5-9d-87-e8-a1-a1lvs-e4-b9-8bipvs-li><input type=checkbox id=m-docs-10-os-linux-e8-b4-9f-e8-bd-bd-e5-9d-87-e8-a1-a1lvs-e4-b9-8bipvs-check>
<label for=m-docs-10-os-linux-e8-b4-9f-e8-bd-bd-e5-9d-87-e8-a1-a1lvs-e4-b9-8bipvs-check><a href=/docs/10.OS/Linux%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1LVS%E4%B9%8BIPVS/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-10-os-linux-e8-b4-9f-e8-bd-bd-e5-9d-87-e8-a1-a1lvs-e4-b9-8bipvs><span>Linux负载均衡LVS之IPVS</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-10-os-shell-li><input type=checkbox id=m-docs-10-os-shell-check>
<label for=m-docs-10-os-shell-check><a href=/docs/10.OS/shell/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-10-os-shell><span>shell</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-10-os-shell-shebang-li><input type=checkbox id=m-docs-10-os-shell-shebang-check>
<label for=m-docs-10-os-shell-shebang-check><a href=/docs/10.OS/shell/Shebang/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-10-os-shell-shebang><span>Shebang</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-10-os-shell-curlwget-li><input type=checkbox id=m-docs-10-os-shell-curlwget-check>
<label for=m-docs-10-os-shell-curlwget-check><a href=/docs/10.OS/shell/curlwget/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-10-os-shell-curlwget><span>curl&wget</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-10-os-shell-shell-find-li><input type=checkbox id=m-docs-10-os-shell-shell-find-check>
<label for=m-docs-10-os-shell-shell-find-check><a href=/docs/10.OS/shell/shell-find/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-10-os-shell-shell-find><span>shell-find</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-10-os-shell-shell-e6-96-87-e6-9c-ac-e5-a4-84-e7-90-86-e4-b8-89-e5-89-91-e5-ae-a2-li><input type=checkbox id=m-docs-10-os-shell-shell-e6-96-87-e6-9c-ac-e5-a4-84-e7-90-86-e4-b8-89-e5-89-91-e5-ae-a2-check>
<label for=m-docs-10-os-shell-shell-e6-96-87-e6-9c-ac-e5-a4-84-e7-90-86-e4-b8-89-e5-89-91-e5-ae-a2-check><a href=/docs/10.OS/shell/shell%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-10-os-shell-shell-e6-96-87-e6-9c-ac-e5-a4-84-e7-90-86-e4-b8-89-e5-89-91-e5-ae-a2><span>shell文本处理三剑客</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-10-os-shell-shell-e8-a7-a3-e6-9e-90json-li><input type=checkbox id=m-docs-10-os-shell-shell-e8-a7-a3-e6-9e-90json-check>
<label for=m-docs-10-os-shell-shell-e8-a7-a3-e6-9e-90json-check><a href=/docs/10.OS/shell/shell%E8%A7%A3%E6%9E%90json/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-10-os-shell-shell-e8-a7-a3-e6-9e-90json><span>shell解析json</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-10-os-shell-e8-8e-b7-e5-8f-96-e7-a8-8b-e5-ba-8f-e5-bd-93-e5-89-8d-e8-b7-af-e5-be-84-e6-9c-89-e5-a4-9a-e9-ba-bb-e7-83-a6-li><input type=checkbox id=m-docs-10-os-shell-e8-8e-b7-e5-8f-96-e7-a8-8b-e5-ba-8f-e5-bd-93-e5-89-8d-e8-b7-af-e5-be-84-e6-9c-89-e5-a4-9a-e9-ba-bb-e7-83-a6-check>
<label for=m-docs-10-os-shell-e8-8e-b7-e5-8f-96-e7-a8-8b-e5-ba-8f-e5-bd-93-e5-89-8d-e8-b7-af-e5-be-84-e6-9c-89-e5-a4-9a-e9-ba-bb-e7-83-a6-check><a href=/docs/10.OS/shell/%E8%8E%B7%E5%8F%96%E7%A8%8B%E5%BA%8F%E5%BD%93%E5%89%8D%E8%B7%AF%E5%BE%84%E6%9C%89%E5%A4%9A%E9%BA%BB%E7%83%A6/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-10-os-shell-e8-8e-b7-e5-8f-96-e7-a8-8b-e5-ba-8f-e5-bd-93-e5-89-8d-e8-b7-af-e5-be-84-e6-9c-89-e5-a4-9a-e9-ba-bb-e7-83-a6><span>获取程序当前路径有多麻烦</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-10-os-e8-bf-9b-e7-a8-8b-li><input type=checkbox id=m-docs-10-os-e8-bf-9b-e7-a8-8b-check>
<label for=m-docs-10-os-e8-bf-9b-e7-a8-8b-check><a href=/docs/10.OS/%E8%BF%9B%E7%A8%8B/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-10-os-e8-bf-9b-e7-a8-8b><span>进程</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-10-os-e8-bf-9b-e7-a8-8b-linux-e5-90-8e-e5-8f-b0-e8-bf-9b-e7-a8-8b-li><input type=checkbox id=m-docs-10-os-e8-bf-9b-e7-a8-8b-linux-e5-90-8e-e5-8f-b0-e8-bf-9b-e7-a8-8b-check>
<label for=m-docs-10-os-e8-bf-9b-e7-a8-8b-linux-e5-90-8e-e5-8f-b0-e8-bf-9b-e7-a8-8b-check><a href=/docs/10.OS/%E8%BF%9B%E7%A8%8B/Linux%E5%90%8E%E5%8F%B0%E8%BF%9B%E7%A8%8B/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-10-os-e8-bf-9b-e7-a8-8b-linux-e5-90-8e-e5-8f-b0-e8-bf-9b-e7-a8-8b><span>Linux后台进程</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-10-os-e8-bf-9b-e7-a8-8b-linux-e7-9a-84-e5-90-af-e5-8a-a8-e8-bf-87-e7-a8-8b-li><input type=checkbox id=m-docs-10-os-e8-bf-9b-e7-a8-8b-linux-e7-9a-84-e5-90-af-e5-8a-a8-e8-bf-87-e7-a8-8b-check>
<label for=m-docs-10-os-e8-bf-9b-e7-a8-8b-linux-e7-9a-84-e5-90-af-e5-8a-a8-e8-bf-87-e7-a8-8b-check><a href=/docs/10.OS/%E8%BF%9B%E7%A8%8B/Linux%E7%9A%84%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-10-os-e8-bf-9b-e7-a8-8b-linux-e7-9a-84-e5-90-af-e5-8a-a8-e8-bf-87-e7-a8-8b><span>Linux的启动过程</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-10-os-e8-bf-9b-e7-a8-8b-supervisor-li><input type=checkbox id=m-docs-10-os-e8-bf-9b-e7-a8-8b-supervisor-check>
<label for=m-docs-10-os-e8-bf-9b-e7-a8-8b-supervisor-check><a href=/docs/10.OS/%E8%BF%9B%E7%A8%8B/supervisor/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-10-os-e8-bf-9b-e7-a8-8b-supervisor><span>supervisor</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-10-os-e8-bf-9b-e7-a8-8b-systemd-li><input type=checkbox id=m-docs-10-os-e8-bf-9b-e7-a8-8b-systemd-check>
<label for=m-docs-10-os-e8-bf-9b-e7-a8-8b-systemd-check><a href=/docs/10.OS/%E8%BF%9B%E7%A8%8B/systemd/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-10-os-e8-bf-9b-e7-a8-8b-systemd><span>systemd</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-10-os-e8-bf-9b-e7-a8-8b-goreman-li><input type=checkbox id=m-docs-10-os-e8-bf-9b-e7-a8-8b-goreman-check>
<label for=m-docs-10-os-e8-bf-9b-e7-a8-8b-goreman-check><a href=/docs/10.OS/%E8%BF%9B%E7%A8%8B/goreman/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-10-os-e8-bf-9b-e7-a8-8b-goreman><span>goreman</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-10-os-e8-bf-9b-e7-a8-8b-e5-ae-88-e6-8a-a4-e8-bf-9b-e7-a8-8b-li><input type=checkbox id=m-docs-10-os-e8-bf-9b-e7-a8-8b-e5-ae-88-e6-8a-a4-e8-bf-9b-e7-a8-8b-check>
<label for=m-docs-10-os-e8-bf-9b-e7-a8-8b-e5-ae-88-e6-8a-a4-e8-bf-9b-e7-a8-8b-check><a href=/docs/10.OS/%E8%BF%9B%E7%A8%8B/%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-10-os-e8-bf-9b-e7-a8-8b-e5-ae-88-e6-8a-a4-e8-bf-9b-e7-a8-8b><span>守护进程</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-10-os-e8-bf-9b-e7-a8-8b-e8-bf-9b-e7-a8-8b-e9-97-b4-e9-80-9a-e4-bf-a1-li><input type=checkbox id=m-docs-10-os-e8-bf-9b-e7-a8-8b-e8-bf-9b-e7-a8-8b-e9-97-b4-e9-80-9a-e4-bf-a1-check>
<label for=m-docs-10-os-e8-bf-9b-e7-a8-8b-e8-bf-9b-e7-a8-8b-e9-97-b4-e9-80-9a-e4-bf-a1-check><a href=/docs/10.OS/%E8%BF%9B%E7%A8%8B/%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-10-os-e8-bf-9b-e7-a8-8b-e8-bf-9b-e7-a8-8b-e9-97-b4-e9-80-9a-e4-bf-a1><span>进程间通信</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-10-os-e6-96-87-e4-bb-b6-e7-b3-bb-e7-bb-9f-li><input type=checkbox id=m-docs-10-os-e6-96-87-e4-bb-b6-e7-b3-bb-e7-bb-9f-check>
<label for=m-docs-10-os-e6-96-87-e4-bb-b6-e7-b3-bb-e7-bb-9f-check><a href=/docs/10.OS/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-10-os-e6-96-87-e4-bb-b6-e7-b3-bb-e7-bb-9f><span>文件系统</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-10-os-e6-96-87-e4-bb-b6-e7-b3-bb-e7-bb-9f-linux-e6-96-87-e4-bb-b6-e7-b3-bb-e7-bb-9f-01-e8-ae-be-e5-a4-87-li><input type=checkbox id=m-docs-10-os-e6-96-87-e4-bb-b6-e7-b3-bb-e7-bb-9f-linux-e6-96-87-e4-bb-b6-e7-b3-bb-e7-bb-9f-01-e8-ae-be-e5-a4-87-check>
<label for=m-docs-10-os-e6-96-87-e4-bb-b6-e7-b3-bb-e7-bb-9f-linux-e6-96-87-e4-bb-b6-e7-b3-bb-e7-bb-9f-01-e8-ae-be-e5-a4-87-check><a href=/docs/10.OS/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/Linux%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F-01%E8%AE%BE%E5%A4%87/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-10-os-e6-96-87-e4-bb-b6-e7-b3-bb-e7-bb-9f-linux-e6-96-87-e4-bb-b6-e7-b3-bb-e7-bb-9f-01-e8-ae-be-e5-a4-87><span>Linux文件系统-01设备</span></a></label></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-11-network-li><input type=checkbox id=m-docs-11-network-check>
<label for=m-docs-11-network-check><a href=/docs/11.Network/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-11-network><span>NetWork</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-11-network-e7-ab-af-e5-8f-a3-e8-bd-ac-e5-8f-91socat-li><input type=checkbox id=m-docs-11-network-e7-ab-af-e5-8f-a3-e8-bd-ac-e5-8f-91socat-check>
<label for=m-docs-11-network-e7-ab-af-e5-8f-a3-e8-bd-ac-e5-8f-91socat-check><a href=/docs/11.Network/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91socat/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-11-network-e7-ab-af-e5-8f-a3-e8-bd-ac-e5-8f-91socat><span>端口转发socat</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-11-network-e8-ae-a4-e8-af-81-e9-89-b4-e6-9d-83-li><input type=checkbox id=m-docs-11-network-e8-ae-a4-e8-af-81-e9-89-b4-e6-9d-83-check>
<label for=m-docs-11-network-e8-ae-a4-e8-af-81-e9-89-b4-e6-9d-83-check><a href=/docs/11.Network/%E8%AE%A4%E8%AF%81%E9%89%B4%E6%9D%83/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-11-network-e8-ae-a4-e8-af-81-e9-89-b4-e6-9d-83><span>认证鉴权</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-11-network-e8-ae-a4-e8-af-81-e9-89-b4-e6-9d-83-oauth2-e4-bb-8b-e7-bb-8d-li><input type=checkbox id=m-docs-11-network-e8-ae-a4-e8-af-81-e9-89-b4-e6-9d-83-oauth2-e4-bb-8b-e7-bb-8d-check>
<label for=m-docs-11-network-e8-ae-a4-e8-af-81-e9-89-b4-e6-9d-83-oauth2-e4-bb-8b-e7-bb-8d-check><a href=/docs/11.Network/%E8%AE%A4%E8%AF%81%E9%89%B4%E6%9D%83/OAuth2%E4%BB%8B%E7%BB%8D/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-11-network-e8-ae-a4-e8-af-81-e9-89-b4-e6-9d-83-oauth2-e4-bb-8b-e7-bb-8d><span>OAuth2介绍</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-11-network-protocol-li><input type=checkbox id=m-docs-11-network-protocol-check>
<label for=m-docs-11-network-protocol-check><a href=/docs/11.Network/protocol/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-11-network-protocol><span>protocol</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-11-network-protocol-http-e5-8d-8f-e8-ae-ae-e4-bb-8b-e7-bb-8d-li><input type=checkbox id=m-docs-11-network-protocol-http-e5-8d-8f-e8-ae-ae-e4-bb-8b-e7-bb-8d-check>
<label for=m-docs-11-network-protocol-http-e5-8d-8f-e8-ae-ae-e4-bb-8b-e7-bb-8d-check><a href=/docs/11.Network/protocol/HTTP%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-11-network-protocol-http-e5-8d-8f-e8-ae-ae-e4-bb-8b-e7-bb-8d><span>HTTP协议介绍</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-11-network-protocol-https-e5-8a-a0-e5-af-86-e5-8e-9f-e7-90-86-li><input type=checkbox id=m-docs-11-network-protocol-https-e5-8a-a0-e5-af-86-e5-8e-9f-e7-90-86-check>
<label for=m-docs-11-network-protocol-https-e5-8a-a0-e5-af-86-e5-8e-9f-e7-90-86-check><a href=/docs/11.Network/protocol/HTTPS%E5%8A%A0%E5%AF%86%E5%8E%9F%E7%90%86/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-11-network-protocol-https-e5-8a-a0-e5-af-86-e5-8e-9f-e7-90-86><span>HTTPS加密原理</span></a></label></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-12-io-li><input type=checkbox id=m-docs-12-io-check>
<label for=m-docs-12-io-check><a href=/docs/12.IO/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-12-io><span>IO</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-12-io-java-nio-e6-a0-b8-e5-bf-83-e7-9f-a5-e8-af-86-li><input type=checkbox id=m-docs-12-io-java-nio-e6-a0-b8-e5-bf-83-e7-9f-a5-e8-af-86-check>
<label for=m-docs-12-io-java-nio-e6-a0-b8-e5-bf-83-e7-9f-a5-e8-af-86-check><a href=/docs/12.IO/Java-NIO%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-12-io-java-nio-e6-a0-b8-e5-bf-83-e7-9f-a5-e8-af-86><span>Java NIO核心知识</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-12-io-netty-e6-9c-8d-e5-8a-a1-e5-99-a8-e5-90-af-e5-8a-a8-e6-ba-90-e7-a0-81-e5-88-86-e6-9e-90-li><input type=checkbox id=m-docs-12-io-netty-e6-9c-8d-e5-8a-a1-e5-99-a8-e5-90-af-e5-8a-a8-e6-ba-90-e7-a0-81-e5-88-86-e6-9e-90-check>
<label for=m-docs-12-io-netty-e6-9c-8d-e5-8a-a1-e5-99-a8-e5-90-af-e5-8a-a8-e6-ba-90-e7-a0-81-e5-88-86-e6-9e-90-check><a href=/docs/12.IO/Netty%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%AF%E5%8A%A8%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-12-io-netty-e6-9c-8d-e5-8a-a1-e5-99-a8-e5-90-af-e5-8a-a8-e6-ba-90-e7-a0-81-e5-88-86-e6-9e-90><span>Netty服务器启动源码分析</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-12-io-io-e6-a8-a1-e5-9e-8b-li><input type=checkbox id=m-docs-12-io-io-e6-a8-a1-e5-9e-8b-check>
<label for=m-docs-12-io-io-e6-a8-a1-e5-9e-8b-check><a href=/docs/12.IO/IO%E6%A8%A1%E5%9E%8B/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-12-io-io-e6-a8-a1-e5-9e-8b><span>IO模型</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-21-java-li><input type=checkbox id=m-docs-21-java-check>
<label for=m-docs-21-java-check><a href=/docs/21.Java/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-21-java><span>Java</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-21-java-01-e5-9f-ba-e7-a1-80-li><input type=checkbox id=m-docs-21-java-01-e5-9f-ba-e7-a1-80-check>
<label for=m-docs-21-java-01-e5-9f-ba-e7-a1-80-check><a href=/docs/21.Java/01.%E5%9F%BA%E7%A1%80/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-21-java-01-e5-9f-ba-e7-a1-80><span>基础</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-21-java-01-e5-9f-ba-e7-a1-80-e5-8f-8c-e4-ba-b2-e5-a7-94-e6-b4-be-e6-9c-ba-e5-88-b6-li><input type=checkbox id=m-docs-21-java-01-e5-9f-ba-e7-a1-80-e5-8f-8c-e4-ba-b2-e5-a7-94-e6-b4-be-e6-9c-ba-e5-88-b6-check>
<label for=m-docs-21-java-01-e5-9f-ba-e7-a1-80-e5-8f-8c-e4-ba-b2-e5-a7-94-e6-b4-be-e6-9c-ba-e5-88-b6-check><a href=/docs/21.Java/01.%E5%9F%BA%E7%A1%80/%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%9C%BA%E5%88%B6/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-21-java-01-e5-9f-ba-e7-a1-80-e5-8f-8c-e4-ba-b2-e5-a7-94-e6-b4-be-e6-9c-ba-e5-88-b6><span>双亲委派机制</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-21-java-03-jvm-li><input type=checkbox id=m-docs-21-java-03-jvm-check>
<label for=m-docs-21-java-03-jvm-check><a href=/docs/21.Java/03.JVM/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-21-java-03-jvm><span>JVM</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-21-java-03-jvm-e5-9e-83-e5-9c-be-e5-9b-9e-e6-94-b6-e7-ae-97-e6-b3-95-li><input type=checkbox id=m-docs-21-java-03-jvm-e5-9e-83-e5-9c-be-e5-9b-9e-e6-94-b6-e7-ae-97-e6-b3-95-check>
<label for=m-docs-21-java-03-jvm-e5-9e-83-e5-9c-be-e5-9b-9e-e6-94-b6-e7-ae-97-e6-b3-95-check><a href=/docs/21.Java/03.JVM/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%AE%97%E6%B3%95/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-21-java-03-jvm-e5-9e-83-e5-9c-be-e5-9b-9e-e6-94-b6-e7-ae-97-e6-b3-95><span>垃圾回收算法</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-21-java-03-jvm-jvm-e8-b0-83-e4-bc-98-li><input type=checkbox id=m-docs-21-java-03-jvm-jvm-e8-b0-83-e4-bc-98-check>
<label for=m-docs-21-java-03-jvm-jvm-e8-b0-83-e4-bc-98-check><a href=/docs/21.Java/03.JVM/JVM%E8%B0%83%E4%BC%98/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-21-java-03-jvm-jvm-e8-b0-83-e4-bc-98><span>JVM调优</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-21-java-05-e5-b9-b6-e5-8f-91-li><input type=checkbox id=m-docs-21-java-05-e5-b9-b6-e5-8f-91-check>
<label for=m-docs-21-java-05-e5-b9-b6-e5-8f-91-check><a href=/docs/21.Java/05.%E5%B9%B6%E5%8F%91/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-21-java-05-e5-b9-b6-e5-8f-91><span>并发</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-21-java-05-e5-b9-b6-e5-8f-91-java-e5-b9-b6-e5-8f-91-e7-bc-96-e7-a8-8b-e7-9a-84-e8-89-ba-e6-9c-af-li><input type=checkbox id=m-docs-21-java-05-e5-b9-b6-e5-8f-91-java-e5-b9-b6-e5-8f-91-e7-bc-96-e7-a8-8b-e7-9a-84-e8-89-ba-e6-9c-af-check>
<label for=m-docs-21-java-05-e5-b9-b6-e5-8f-91-java-e5-b9-b6-e5-8f-91-e7-bc-96-e7-a8-8b-e7-9a-84-e8-89-ba-e6-9c-af-check><a href=/docs/21.Java/05.%E5%B9%B6%E5%8F%91/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%9A%84%E8%89%BA%E6%9C%AF/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-21-java-05-e5-b9-b6-e5-8f-91-java-e5-b9-b6-e5-8f-91-e7-bc-96-e7-a8-8b-e7-9a-84-e8-89-ba-e6-9c-af><span>Java并发编程的艺术</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-21-java-07-web-li><input type=checkbox id=m-docs-21-java-07-web-check>
<label for=m-docs-21-java-07-web-check><a href=/docs/21.Java/07.Web/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-21-java-07-web><span>Web</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-li><input type=checkbox id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-check>
<label for=m-docs-21-java-08-e6-a1-86-e6-9e-b6-check><a href=/docs/21.Java/08.%E6%A1%86%E6%9E%B6/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6><span>框架</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-mybatis-li><input type=checkbox id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-mybatis-check>
<label for=m-docs-21-java-08-e6-a1-86-e6-9e-b6-mybatis-check><a href=/docs/21.Java/08.%E6%A1%86%E6%9E%B6/Mybatis/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-mybatis><span>Mybatis</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-li><input type=checkbox id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-check>
<label for=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-check><a href=/docs/21.Java/08.%E6%A1%86%E6%9E%B6/Spring/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring><span>Spring</span></a></label><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-01-spring-e5-9f-ba-e7-a1-80-e7-9f-a5-e8-af-86-li><input type=checkbox id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-01-spring-e5-9f-ba-e7-a1-80-e7-9f-a5-e8-af-86-check>
<label for=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-01-spring-e5-9f-ba-e7-a1-80-e7-9f-a5-e8-af-86-check><a href=/docs/21.Java/08.%E6%A1%86%E6%9E%B6/Spring/01.Spring%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-01-spring-e5-9f-ba-e7-a1-80-e7-9f-a5-e8-af-86><span>01.Spring基础知识</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-04-spring-e5-ae-9a-e6-97-b6-e4-bb-bb-e5-8a-a1-li><input type=checkbox id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-04-spring-e5-ae-9a-e6-97-b6-e4-bb-bb-e5-8a-a1-check>
<label for=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-04-spring-e5-ae-9a-e6-97-b6-e4-bb-bb-e5-8a-a1-check><a href=/docs/21.Java/08.%E6%A1%86%E6%9E%B6/Spring/04.Spring%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-04-spring-e5-ae-9a-e6-97-b6-e4-bb-bb-e5-8a-a1><span>04.Spring定时任务</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-12-spring-e6-89-a9-e5-b1-95-li><input type=checkbox id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-12-spring-e6-89-a9-e5-b1-95-check>
<label for=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-12-spring-e6-89-a9-e5-b1-95-check><a href=/docs/21.Java/08.%E6%A1%86%E6%9E%B6/Spring/12.Spring%E6%89%A9%E5%B1%95/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-12-spring-e6-89-a9-e5-b1-95><span>12.Spring扩展</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-50-spring-e5-be-aa-e7-8e-af-e4-be-9d-e8-b5-96-li><input type=checkbox id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-50-spring-e5-be-aa-e7-8e-af-e4-be-9d-e8-b5-96-check>
<label for=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-50-spring-e5-be-aa-e7-8e-af-e4-be-9d-e8-b5-96-check><a href=/docs/21.Java/08.%E6%A1%86%E6%9E%B6/Spring/50.Spring%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-50-spring-e5-be-aa-e7-8e-af-e4-be-9d-e8-b5-96><span>50.Spring循环依赖</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-51-springbean-e7-9a-84-e5-8a-a0-e8-bd-bd-e6-ba-90-e7-a0-81-li><input type=checkbox id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-51-springbean-e7-9a-84-e5-8a-a0-e8-bd-bd-e6-ba-90-e7-a0-81-check>
<label for=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-51-springbean-e7-9a-84-e5-8a-a0-e8-bd-bd-e6-ba-90-e7-a0-81-check><a href=/docs/21.Java/08.%E6%A1%86%E6%9E%B6/Spring/51.SpringBean%E7%9A%84%E5%8A%A0%E8%BD%BD%E6%BA%90%E7%A0%81/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-51-springbean-e7-9a-84-e5-8a-a0-e8-bd-bd-e6-ba-90-e7-a0-81><span>51.SpringBean的加载源码</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-spring-e6-b3-a8-e8-a7-a3-e9-a9-b1-e5-8a-a8-e6-ba-90-e7-a0-81-li><input type=checkbox id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-spring-e6-b3-a8-e8-a7-a3-e9-a9-b1-e5-8a-a8-e6-ba-90-e7-a0-81-check>
<label for=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-spring-e6-b3-a8-e8-a7-a3-e9-a9-b1-e5-8a-a8-e6-ba-90-e7-a0-81-check><a href=/docs/21.Java/08.%E6%A1%86%E6%9E%B6/Spring/spring%E6%B3%A8%E8%A7%A3%E9%A9%B1%E5%8A%A8+%E6%BA%90%E7%A0%81/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-spring-e6-b3-a8-e8-a7-a3-e9-a9-b1-e5-8a-a8-e6-ba-90-e7-a0-81><span>spring注解驱动+源码</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-01-e5-9f-ba-e7-a1-80-e4-bd-bf-e7-94-a8-e5-8f-8a-e5-8e-9f-e7-90-86-li><input type=checkbox id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-01-e5-9f-ba-e7-a1-80-e4-bd-bf-e7-94-a8-e5-8f-8a-e5-8e-9f-e7-90-86-check>
<label for=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-01-e5-9f-ba-e7-a1-80-e4-bd-bf-e7-94-a8-e5-8f-8a-e5-8e-9f-e7-90-86-check><a href=/docs/21.Java/08.%E6%A1%86%E6%9E%B6/Spring/SpringBoot-01%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E5%8F%8A%E5%8E%9F%E7%90%86/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-01-e5-9f-ba-e7-a1-80-e4-bd-bf-e7-94-a8-e5-8f-8a-e5-8e-9f-e7-90-86><span>SpringBoot-01基础使用及原理</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-02web-e5-bc-80-e5-8f-91-e5-8f-8a-e8-af-b7-e6-b1-82-e5-93-8d-e5-ba-94-e5-a4-84-e7-90-86-li><input type=checkbox id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-02web-e5-bc-80-e5-8f-91-e5-8f-8a-e8-af-b7-e6-b1-82-e5-93-8d-e5-ba-94-e5-a4-84-e7-90-86-check>
<label for=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-02web-e5-bc-80-e5-8f-91-e5-8f-8a-e8-af-b7-e6-b1-82-e5-93-8d-e5-ba-94-e5-a4-84-e7-90-86-check><a href=/docs/21.Java/08.%E6%A1%86%E6%9E%B6/Spring/SpringBoot-02Web%E5%BC%80%E5%8F%91%E5%8F%8A%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94%E5%A4%84%E7%90%86/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-02web-e5-bc-80-e5-8f-91-e5-8f-8a-e8-af-b7-e6-b1-82-e5-93-8d-e5-ba-94-e5-a4-84-e7-90-86><span>SpringBoot-02Web开发及请求响应处理</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-03web-e7-bb-84-e4-bb-b6-li><input type=checkbox id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-03web-e7-bb-84-e4-bb-b6-check>
<label for=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-03web-e7-bb-84-e4-bb-b6-check><a href=/docs/21.Java/08.%E6%A1%86%E6%9E%B6/Spring/SpringBoot-03Web%E7%BB%84%E4%BB%B6/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-03web-e7-bb-84-e4-bb-b6><span>SpringBoot-03Web组件</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-04-e6-95-b0-e6-8d-ae-e8-ae-bf-e9-97-ae-li><input type=checkbox id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-04-e6-95-b0-e6-8d-ae-e8-ae-bf-e9-97-ae-check>
<label for=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-04-e6-95-b0-e6-8d-ae-e8-ae-bf-e9-97-ae-check><a href=/docs/21.Java/08.%E6%A1%86%E6%9E%B6/Spring/SpringBoot-04%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-04-e6-95-b0-e6-8d-ae-e8-ae-bf-e9-97-ae><span>SpringBoot-04数据访问</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-05-e5-8d-95-e5-85-83-e6-b5-8b-e8-af-95-li><input type=checkbox id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-05-e5-8d-95-e5-85-83-e6-b5-8b-e8-af-95-check>
<label for=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-05-e5-8d-95-e5-85-83-e6-b5-8b-e8-af-95-check><a href=/docs/21.Java/08.%E6%A1%86%E6%9E%B6/Spring/SpringBoot-05%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-05-e5-8d-95-e5-85-83-e6-b5-8b-e8-af-95><span>SpringBoot-05单元测试</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-06-e6-8c-87-e6-a0-87-e7-9b-91-e6-8e-a7-li><input type=checkbox id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-06-e6-8c-87-e6-a0-87-e7-9b-91-e6-8e-a7-check>
<label for=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-06-e6-8c-87-e6-a0-87-e7-9b-91-e6-8e-a7-check><a href=/docs/21.Java/08.%E6%A1%86%E6%9E%B6/Spring/SpringBoot-06%E6%8C%87%E6%A0%87%E7%9B%91%E6%8E%A7/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-06-e6-8c-87-e6-a0-87-e7-9b-91-e6-8e-a7><span>SpringBoot-06指标监控</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-07-e9-85-8d-e7-bd-ae-e4-b8-8e-e5-8a-a0-e8-bd-bd-e8-bf-87-e7-a8-8b-li><input type=checkbox id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-07-e9-85-8d-e7-bd-ae-e4-b8-8e-e5-8a-a0-e8-bd-bd-e8-bf-87-e7-a8-8b-check>
<label for=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-07-e9-85-8d-e7-bd-ae-e4-b8-8e-e5-8a-a0-e8-bd-bd-e8-bf-87-e7-a8-8b-check><a href=/docs/21.Java/08.%E6%A1%86%E6%9E%B6/Spring/SpringBoot-07%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-spring-springboot-07-e9-85-8d-e7-bd-ae-e4-b8-8e-e5-8a-a0-e8-bd-bd-e8-bf-87-e7-a8-8b><span>SpringBoot-07配置与加载过程</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-springmvc-li><input type=checkbox id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-springmvc-check>
<label for=m-docs-21-java-08-e6-a1-86-e6-9e-b6-springmvc-check><a href=/docs/21.Java/08.%E6%A1%86%E6%9E%B6/SpringMVC/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-21-java-08-e6-a1-86-e6-9e-b6-springmvc><span>SpringMVC</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-21-java-09-e7-ac-ac-e4-b8-89-e6-96-b9-e5-8c-85-li><input type=checkbox id=m-docs-21-java-09-e7-ac-ac-e4-b8-89-e6-96-b9-e5-8c-85-check>
<label for=m-docs-21-java-09-e7-ac-ac-e4-b8-89-e6-96-b9-e5-8c-85-check><a href=/docs/21.Java/09.%E7%AC%AC%E4%B8%89%E6%96%B9%E5%8C%85/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-21-java-09-e7-ac-ac-e4-b8-89-e6-96-b9-e5-8c-85><span>第三方包</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-21-java-09-e7-ac-ac-e4-b8-89-e6-96-b9-e5-8c-85-log-li><input type=checkbox id=m-docs-21-java-09-e7-ac-ac-e4-b8-89-e6-96-b9-e5-8c-85-log-check>
<label for=m-docs-21-java-09-e7-ac-ac-e4-b8-89-e6-96-b9-e5-8c-85-log-check><a href=/docs/21.Java/09.%E7%AC%AC%E4%B8%89%E6%96%B9%E5%8C%85/log/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-21-java-09-e7-ac-ac-e4-b8-89-e6-96-b9-e5-8c-85-log><span>log</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-21-java-09-e7-ac-ac-e4-b8-89-e6-96-b9-e5-8c-85-lombok-e5-8a-9f-e8-83-bd-e5-8f-8a-e5-8e-9f-e7-90-86-li><input type=checkbox id=m-docs-21-java-09-e7-ac-ac-e4-b8-89-e6-96-b9-e5-8c-85-lombok-e5-8a-9f-e8-83-bd-e5-8f-8a-e5-8e-9f-e7-90-86-check>
<label for=m-docs-21-java-09-e7-ac-ac-e4-b8-89-e6-96-b9-e5-8c-85-lombok-e5-8a-9f-e8-83-bd-e5-8f-8a-e5-8e-9f-e7-90-86-check><a href=/docs/21.Java/09.%E7%AC%AC%E4%B8%89%E6%96%B9%E5%8C%85/lombok%E5%8A%9F%E8%83%BD%E5%8F%8A%E5%8E%9F%E7%90%86/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-21-java-09-e7-ac-ac-e4-b8-89-e6-96-b9-e5-8c-85-lombok-e5-8a-9f-e8-83-bd-e5-8f-8a-e5-8e-9f-e7-90-86><span>lombok功能及原理</span></a></label></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-22-golang-li><input type=checkbox id=m-docs-22-golang-check>
<label for=m-docs-22-golang-check><a href=/docs/22.Golang/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-22-golang><span>Golang</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-22-golang-go-e7-8e-af-e5-a2-83-e6-90-ad-e5-bb-ba-e5-8f-8a-e8-af-ad-e6-b3-95-li><input type=checkbox id=m-docs-22-golang-go-e7-8e-af-e5-a2-83-e6-90-ad-e5-bb-ba-e5-8f-8a-e8-af-ad-e6-b3-95-check>
<label for=m-docs-22-golang-go-e7-8e-af-e5-a2-83-e6-90-ad-e5-bb-ba-e5-8f-8a-e8-af-ad-e6-b3-95-check><a href=/docs/22.Golang/go%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E5%8F%8A%E8%AF%AD%E6%B3%95/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-22-golang-go-e7-8e-af-e5-a2-83-e6-90-ad-e5-bb-ba-e5-8f-8a-e8-af-ad-e6-b3-95><span>go环境搭建及语法</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-22-golang-go-e8-af-ad-e8-a8-80-e5-9f-ba-e7-a1-80-e7-9f-a5-e8-af-8601-li><input type=checkbox id=m-docs-22-golang-go-e8-af-ad-e8-a8-80-e5-9f-ba-e7-a1-80-e7-9f-a5-e8-af-8601-check>
<label for=m-docs-22-golang-go-e8-af-ad-e8-a8-80-e5-9f-ba-e7-a1-80-e7-9f-a5-e8-af-8601-check><a href=/docs/22.Golang/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%8601/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-22-golang-go-e8-af-ad-e8-a8-80-e5-9f-ba-e7-a1-80-e7-9f-a5-e8-af-8601><span>Go语言基础知识01</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-22-golang-go-e8-af-ad-e8-a8-80-e5-9f-ba-e7-a1-80-e7-9f-a5-e8-af-8602-li><input type=checkbox id=m-docs-22-golang-go-e8-af-ad-e8-a8-80-e5-9f-ba-e7-a1-80-e7-9f-a5-e8-af-8602-check>
<label for=m-docs-22-golang-go-e8-af-ad-e8-a8-80-e5-9f-ba-e7-a1-80-e7-9f-a5-e8-af-8602-check><a href=/docs/22.Golang/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%8602/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-22-golang-go-e8-af-ad-e8-a8-80-e5-9f-ba-e7-a1-80-e7-9f-a5-e8-af-8602><span>Go语言基础知识02</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-22-golang-util-cli-li><input type=checkbox id=m-docs-22-golang-util-cli-check>
<label for=m-docs-22-golang-util-cli-check><a href=/docs/22.Golang/util-cli/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-22-golang-util-cli><span>util-cli</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-22-golang-mod-e5-8c-85-e5-86-b2-e7-aa-81-e8-a7-a3-e5-86-b3-e5-ae-9e-e6-88-9801-li><input type=checkbox id=m-docs-22-golang-mod-e5-8c-85-e5-86-b2-e7-aa-81-e8-a7-a3-e5-86-b3-e5-ae-9e-e6-88-9801-check>
<label for=m-docs-22-golang-mod-e5-8c-85-e5-86-b2-e7-aa-81-e8-a7-a3-e5-86-b3-e5-ae-9e-e6-88-9801-check><a href=/docs/22.Golang/mod%E5%8C%85%E5%86%B2%E7%AA%81%E8%A7%A3%E5%86%B3%E5%AE%9E%E6%88%9801/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-22-golang-mod-e5-8c-85-e5-86-b2-e7-aa-81-e8-a7-a3-e5-86-b3-e5-ae-9e-e6-88-9801><span>mod包冲突解决实战01</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-23-python-li><input type=checkbox id=m-docs-23-python-check>
<label for=m-docs-23-python-check><a href=/docs/23.Python/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-23-python><span>Python</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-23-python-pydemo-li><input type=checkbox id=m-docs-23-python-pydemo-check>
<label for=m-docs-23-python-pydemo-check><a href=/docs/23.Python/pydemo/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-23-python-pydemo><span>pydemo</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-23-python-selenium-e4-bd-bf-e7-94-a8-li><input type=checkbox id=m-docs-23-python-selenium-e4-bd-bf-e7-94-a8-check>
<label for=m-docs-23-python-selenium-e4-bd-bf-e7-94-a8-check><a href=/docs/23.Python/selenium%E4%BD%BF%E7%94%A8/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-23-python-selenium-e4-bd-bf-e7-94-a8><span>selenium使用</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-24-cpp-li><input type=checkbox id=m-docs-24-cpp-check>
<label for=m-docs-24-cpp-check><a href=/docs/24.Cpp/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-24-cpp><span>Cpp</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-24-cpp-cpp-e5-85-a5-e9-97-a8-01-e5-9f-ba-e7-a1-80-e8-af-ad-e6-b3-95-li><input type=checkbox id=m-docs-24-cpp-cpp-e5-85-a5-e9-97-a8-01-e5-9f-ba-e7-a1-80-e8-af-ad-e6-b3-95-check>
<label for=m-docs-24-cpp-cpp-e5-85-a5-e9-97-a8-01-e5-9f-ba-e7-a1-80-e8-af-ad-e6-b3-95-check><a href=/docs/24.Cpp/cpp%E5%85%A5%E9%97%A8-01%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-24-cpp-cpp-e5-85-a5-e9-97-a8-01-e5-9f-ba-e7-a1-80-e8-af-ad-e6-b3-95><span>cpp入门-01基础语法</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93><span>数据库</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-e5-88-86-e5-b8-83-e5-bc-8f-e6-95-b0-e6-8d-ae-e5-ba-93-e7-90-86-e8-ae-ba-e6-a6-82-e8-bf-b0-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-e5-88-86-e5-b8-83-e5-bc-8f-e6-95-b0-e6-8d-ae-e5-ba-93-e7-90-86-e8-ae-ba-e6-a6-82-e8-bf-b0-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-e5-88-86-e5-b8-83-e5-bc-8f-e6-95-b0-e6-8d-ae-e5-ba-93-e7-90-86-e8-ae-ba-e6-a6-82-e8-bf-b0-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%88%86%E5%B8%83%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%90%86%E8%AE%BA%E6%A6%82%E8%BF%B0/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-e5-88-86-e5-b8-83-e5-bc-8f-e6-95-b0-e6-8d-ae-e5-ba-93-e7-90-86-e8-ae-ba-e6-a6-82-e8-bf-b0><span>分布式数据库理论概述</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/01.MySQL/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql><span>MySQL</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-01-sql-e6-9f-a5-e8-af-a2-e6-b5-81-e7-a8-8b-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-01-sql-e6-9f-a5-e8-af-a2-e6-b5-81-e7-a8-8b-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-01-sql-e6-9f-a5-e8-af-a2-e6-b5-81-e7-a8-8b-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/01.MySQL/01.SQL%E6%9F%A5%E8%AF%A2%E6%B5%81%E7%A8%8B/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-01-sql-e6-9f-a5-e8-af-a2-e6-b5-81-e7-a8-8b><span>01.SQL查询流程</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-02-e6-97-a5-e5-bf-97-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-02-e6-97-a5-e5-bf-97-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-02-e6-97-a5-e5-bf-97-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/01.MySQL/02.%E6%97%A5%E5%BF%97/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-02-e6-97-a5-e5-bf-97><span>02.日志</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-02-e6-97-a5-e5-bf-97-e6-89-a9-e5-b1-95-e4-b8-bb-e4-bb-8e-e6-9e-b6-e6-9e-84-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-02-e6-97-a5-e5-bf-97-e6-89-a9-e5-b1-95-e4-b8-bb-e4-bb-8e-e6-9e-b6-e6-9e-84-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-02-e6-97-a5-e5-bf-97-e6-89-a9-e5-b1-95-e4-b8-bb-e4-bb-8e-e6-9e-b6-e6-9e-84-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/01.MySQL/02.%E6%97%A5%E5%BF%97%E6%89%A9%E5%B1%95-%E4%B8%BB%E4%BB%8E%E6%9E%B6%E6%9E%84/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-02-e6-97-a5-e5-bf-97-e6-89-a9-e5-b1-95-e4-b8-bb-e4-bb-8e-e6-9e-b6-e6-9e-84><span>02.日志扩展-主从架构</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-03-e8-a1-a8-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-03-e8-a1-a8-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-03-e8-a1-a8-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/01.MySQL/03.%E8%A1%A8/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-03-e8-a1-a8><span>03.表</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-04-e7-b4-a2-e5-bc-95-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-04-e7-b4-a2-e5-bc-95-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-04-e7-b4-a2-e5-bc-95-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/01.MySQL/04.%E7%B4%A2%E5%BC%95/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-04-e7-b4-a2-e5-bc-95><span>04.索引</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-05-e9-94-81-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-05-e9-94-81-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-05-e9-94-81-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/01.MySQL/05.%E9%94%81/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-05-e9-94-81><span>05.锁</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-06-e4-ba-8b-e5-8a-a1-e9-9a-94-e7-a6-bb-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-06-e4-ba-8b-e5-8a-a1-e9-9a-94-e7-a6-bb-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-06-e4-ba-8b-e5-8a-a1-e9-9a-94-e7-a6-bb-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/01.MySQL/06.%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-06-e4-ba-8b-e5-8a-a1-e9-9a-94-e7-a6-bb><span>06.事务隔离</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-mysql-e6-8a-80-e6-9c-af-e5-86-85-e5-b9-95-innodb-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-mysql-e6-8a-80-e6-9c-af-e5-86-85-e5-b9-95-innodb-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-mysql-e6-8a-80-e6-9c-af-e5-86-85-e5-b9-95-innodb-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/01.MySQL/MySQL%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95-InnoDB/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-01-mysql-mysql-e6-8a-80-e6-9c-af-e5-86-85-e5-b9-95-innodb><span>MySQL技术内幕-InnoDB</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-redis-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-redis-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-redis-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-redis><span>Redis</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-redis-redis-e5-bc-80-e5-8f-91-e4-b8-8e-e8-bf-90-e7-bb-b4-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-redis-redis-e5-bc-80-e5-8f-91-e4-b8-8e-e8-bf-90-e7-bb-b4-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-redis-redis-e5-bc-80-e5-8f-91-e4-b8-8e-e8-bf-90-e7-bb-b4-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/Redis%E5%BC%80%E5%8F%91%E4%B8%8E%E8%BF%90%E7%BB%B4/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-redis-redis-e5-bc-80-e5-8f-91-e4-b8-8e-e8-bf-90-e7-bb-b4><span>Redis开发与运维</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-tidb-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-tidb-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-tidb-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/TiDB/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-tidb><span>TiDB</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-tidb-tidb-e5-88-9d-e6-8e-a2-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-tidb-tidb-e5-88-9d-e6-8e-a2-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-tidb-tidb-e5-88-9d-e6-8e-a2-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/TiDB/TiDB%E5%88%9D%E6%8E%A2/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-tidb-tidb-e5-88-9d-e6-8e-a2><span>TiDB初探</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-sql-e5-bc-95-e6-93-8e-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-sql-e5-bc-95-e6-93-8e-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-sql-e5-bc-95-e6-93-8e-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/SQL%E5%BC%95%E6%93%8E/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-sql-e5-bc-95-e6-93-8e><span>SQL引擎</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-sql-e5-bc-95-e6-93-8e-01-sql-e8-a7-a3-e6-9e-90-e5-99-a8-e4-bb-8b-e7-bb-8d-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-sql-e5-bc-95-e6-93-8e-01-sql-e8-a7-a3-e6-9e-90-e5-99-a8-e4-bb-8b-e7-bb-8d-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-sql-e5-bc-95-e6-93-8e-01-sql-e8-a7-a3-e6-9e-90-e5-99-a8-e4-bb-8b-e7-bb-8d-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/SQL%E5%BC%95%E6%93%8E/01.SQL%E8%A7%A3%E6%9E%90%E5%99%A8%E4%BB%8B%E7%BB%8D/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-sql-e5-bc-95-e6-93-8e-01-sql-e8-a7-a3-e6-9e-90-e5-99-a8-e4-bb-8b-e7-bb-8d><span>01.SQL解析器介绍</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-sql-e5-bc-95-e6-93-8e-02-join-e6-93-8d-e4-bd-9c-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-sql-e5-bc-95-e6-93-8e-02-join-e6-93-8d-e4-bd-9c-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-sql-e5-bc-95-e6-93-8e-02-join-e6-93-8d-e4-bd-9c-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/SQL%E5%BC%95%E6%93%8E/02.Join%E6%93%8D%E4%BD%9C/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-sql-e5-bc-95-e6-93-8e-02-join-e6-93-8d-e4-bd-9c><span>02.Join操作</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-sql-e5-bc-95-e6-93-8e-03-e7-bb-9f-e8-ae-a1-e8-ae-a1-e6-95-b0-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-sql-e5-bc-95-e6-93-8e-03-e7-bb-9f-e8-ae-a1-e8-ae-a1-e6-95-b0-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-sql-e5-bc-95-e6-93-8e-03-e7-bb-9f-e8-ae-a1-e8-ae-a1-e6-95-b0-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/SQL%E5%BC%95%E6%93%8E/03.%E7%BB%9F%E8%AE%A1%E8%AE%A1%E6%95%B0/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-sql-e5-bc-95-e6-93-8e-03-e7-bb-9f-e8-ae-a1-e8-ae-a1-e6-95-b0><span>03.统计计数</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-sql-e5-bc-95-e6-93-8e-presto-e7-ae-80-e4-bb-8b-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-sql-e5-bc-95-e6-93-8e-presto-e7-ae-80-e4-bb-8b-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-sql-e5-bc-95-e6-93-8e-presto-e7-ae-80-e4-bb-8b-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/SQL%E5%BC%95%E6%93%8E/Presto%E7%AE%80%E4%BB%8B/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-sql-e5-bc-95-e6-93-8e-presto-e7-ae-80-e4-bb-8b><span>Presto简介</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-postgresql-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-postgresql-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-postgresql-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/PostgreSQL/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-postgresql><span>PostgreSQL</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-postgresql-postgresql-e5-9f-ba-e7-a1-80-e4-bd-bf-e7-94-a8-e5-85-a5-e9-97-a8-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-postgresql-postgresql-e5-9f-ba-e7-a1-80-e4-bd-bf-e7-94-a8-e5-85-a5-e9-97-a8-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-postgresql-postgresql-e5-9f-ba-e7-a1-80-e4-bd-bf-e7-94-a8-e5-85-a5-e9-97-a8-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/PostgreSQL/PostgreSQL%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E5%85%A5%E9%97%A8/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-postgresql-postgresql-e5-9f-ba-e7-a1-80-e4-bd-bf-e7-94-a8-e5-85-a5-e9-97-a8><span>PostgreSQL基础使用入门</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-graph-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-graph-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-graph-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/graph/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-graph><span>图</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-graph-e5-9b-be-e5-9f-ba-e6-9c-ac-e4-bb-8b-e7-bb-8d-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-graph-e5-9b-be-e5-9f-ba-e6-9c-ac-e4-bb-8b-e7-bb-8d-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-graph-e5-9b-be-e5-9f-ba-e6-9c-ac-e4-bb-8b-e7-bb-8d-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/graph/%E5%9B%BE%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-graph-e5-9b-be-e5-9f-ba-e6-9c-ac-e4-bb-8b-e7-bb-8d><span>图数据库基本介绍</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/LevelDB/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb><span>LevelDB</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-leveldb-01-e5-9f-ba-e6-9c-ac-e4-bb-8b-e7-bb-8d-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-leveldb-01-e5-9f-ba-e6-9c-ac-e4-bb-8b-e7-bb-8d-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-leveldb-01-e5-9f-ba-e6-9c-ac-e4-bb-8b-e7-bb-8d-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/LevelDB/LevelDB-01%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-leveldb-01-e5-9f-ba-e6-9c-ac-e4-bb-8b-e7-bb-8d><span>LevelDB-01基本介绍</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-leveldb-02-e5-9f-ba-e7-a1-80-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-leveldb-02-e5-9f-ba-e7-a1-80-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-leveldb-02-e5-9f-ba-e7-a1-80-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/LevelDB/LevelDB-02%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-leveldb-02-e5-9f-ba-e7-a1-80-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84><span>LevelDB-02基础数据结构</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-leveldb-03log-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-leveldb-03log-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-leveldb-03log-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/LevelDB/LevelDB-03Log/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-leveldb-03log><span>LevelDB-03Log</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-leveldb-04-e6-95-b0-e6-8d-ae-e8-af-bb-e5-86-99-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-leveldb-04-e6-95-b0-e6-8d-ae-e8-af-bb-e5-86-99-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-leveldb-04-e6-95-b0-e6-8d-ae-e8-af-bb-e5-86-99-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/LevelDB/LevelDB-04%E6%95%B0%E6%8D%AE%E8%AF%BB%E5%86%99/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-leveldb-04-e6-95-b0-e6-8d-ae-e8-af-bb-e5-86-99><span>LevelDB-04数据读写</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-leveldb-05cache-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-leveldb-05cache-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-leveldb-05cache-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/LevelDB/LevelDB-05Cache/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-leveldb-05cache><span>LevelDB-05Cache</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-leveldb-06compaction-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-leveldb-06compaction-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-leveldb-06compaction-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/LevelDB/LevelDB-06Compaction/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-leveldb-leveldb-06compaction><span>LevelDB-06Compaction</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-clickhouse-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-clickhouse-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-clickhouse-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/ClickHouse/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-clickhouse><span>ClickHouse</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-clickhouse-01-clickhouse-e5-9f-ba-e6-9c-ac-e4-bb-8b-e7-bb-8d-li><input type=checkbox id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-clickhouse-01-clickhouse-e5-9f-ba-e6-9c-ac-e4-bb-8b-e7-bb-8d-check>
<label for=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-clickhouse-01-clickhouse-e5-9f-ba-e6-9c-ac-e4-bb-8b-e7-bb-8d-check><a href=/docs/30.%E6%95%B0%E6%8D%AE%E5%BA%93/ClickHouse/01.ClickHouse%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-30-e6-95-b0-e6-8d-ae-e5-ba-93-clickhouse-01-clickhouse-e5-9f-ba-e6-9c-ac-e4-bb-8b-e7-bb-8d><span>01.ClickHouse基本介绍</span></a></label></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-31-e5-ad-98-e5-82-a8-li><input type=checkbox id=m-docs-31-e5-ad-98-e5-82-a8-check>
<label for=m-docs-31-e5-ad-98-e5-82-a8-check><a href=/docs/31.%E5%AD%98%E5%82%A8/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-31-e5-ad-98-e5-82-a8><span>存储</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-31-e5-ad-98-e5-82-a8-ceph-li><input type=checkbox id=m-docs-31-e5-ad-98-e5-82-a8-ceph-check>
<label for=m-docs-31-e5-ad-98-e5-82-a8-ceph-check><a href=/docs/31.%E5%AD%98%E5%82%A8/Ceph/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-31-e5-ad-98-e5-82-a8-ceph><span>Ceph</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-31-e5-ad-98-e5-82-a8-ceph-01-ceph-e4-bb-8b-e7-bb-8d-li><input type=checkbox id=m-docs-31-e5-ad-98-e5-82-a8-ceph-01-ceph-e4-bb-8b-e7-bb-8d-check>
<label for=m-docs-31-e5-ad-98-e5-82-a8-ceph-01-ceph-e4-bb-8b-e7-bb-8d-check><a href=/docs/31.%E5%AD%98%E5%82%A8/Ceph/01.Ceph%E4%BB%8B%E7%BB%8D/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-31-e5-ad-98-e5-82-a8-ceph-01-ceph-e4-bb-8b-e7-bb-8d><span>01.Ceph介绍</span></a></label></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-li><input type=checkbox id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-check checked>
<label for=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-check><a href=/docs/41.%E5%88%86%E5%B8%83%E5%BC%8F/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f><span>分布式</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-zookeeper-e5-9f-ba-e6-9c-ac-e4-bd-bf-e7-94-a8-li><input type=checkbox id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-zookeeper-e5-9f-ba-e6-9c-ac-e4-bd-bf-e7-94-a8-check>
<label for=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-zookeeper-e5-9f-ba-e6-9c-ac-e4-bd-bf-e7-94-a8-check><a href=/docs/41.%E5%88%86%E5%B8%83%E5%BC%8F/Zookeeper%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-zookeeper-e5-9f-ba-e6-9c-ac-e4-bd-bf-e7-94-a8><span>Zookeeper基本使用</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-zookeeper-e5-90-af-e5-8a-a8-e6-ba-90-e7-a0-81-e5-88-86-e6-9e-90-li><input type=checkbox id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-zookeeper-e5-90-af-e5-8a-a8-e6-ba-90-e7-a0-81-e5-88-86-e6-9e-90-check>
<label for=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-zookeeper-e5-90-af-e5-8a-a8-e6-ba-90-e7-a0-81-e5-88-86-e6-9e-90-check><a href=/docs/41.%E5%88%86%E5%B8%83%E5%BC%8F/zookeeper%E5%90%AF%E5%8A%A8%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-zookeeper-e5-90-af-e5-8a-a8-e6-ba-90-e7-a0-81-e5-88-86-e6-9e-90><span>zookeeper启动源码分析</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-e5-88-86-e5-b8-83-e5-bc-8f-e4-b8-80-e8-87-b4-e6-80-a7-e7-ae-97-e6-b3-95-li><input type=checkbox id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-e5-88-86-e5-b8-83-e5-bc-8f-e4-b8-80-e8-87-b4-e6-80-a7-e7-ae-97-e6-b3-95-check>
<label for=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-e5-88-86-e5-b8-83-e5-bc-8f-e4-b8-80-e8-87-b4-e6-80-a7-e7-ae-97-e6-b3-95-check><a href=/docs/41.%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%80%E8%87%B4%E6%80%A7%E7%AE%97%E6%B3%95/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-e5-88-86-e5-b8-83-e5-bc-8f-e4-b8-80-e8-87-b4-e6-80-a7-e7-ae-97-e6-b3-95><span>分布式一致性算法</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-quorum-e6-9c-ba-e5-88-b6-li><input type=checkbox id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-quorum-e6-9c-ba-e5-88-b6-check>
<label for=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-quorum-e6-9c-ba-e5-88-b6-check><a href=/docs/41.%E5%88%86%E5%B8%83%E5%BC%8F/Quorum%E6%9C%BA%E5%88%B6/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-quorum-e6-9c-ba-e5-88-b6><span>Quorum机制</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-raft-01-e5-9f-ba-e7-a1-80-e7-90-86-e8-ae-ba-li><input type=checkbox id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-raft-01-e5-9f-ba-e7-a1-80-e7-90-86-e8-ae-ba-check>
<label for=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-raft-01-e5-9f-ba-e7-a1-80-e7-90-86-e8-ae-ba-check><a href=/docs/41.%E5%88%86%E5%B8%83%E5%BC%8F/Raft-01.%E5%9F%BA%E7%A1%80%E7%90%86%E8%AE%BA/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-raft-01-e5-9f-ba-e7-a1-80-e7-90-86-e8-ae-ba><span>Raft-01.基础理论</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-raft-02-raftexample-e6-ba-90-e7-a0-81-e5-88-86-e6-9e-90-li><input type=checkbox id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-raft-02-raftexample-e6-ba-90-e7-a0-81-e5-88-86-e6-9e-90-check>
<label for=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-raft-02-raftexample-e6-ba-90-e7-a0-81-e5-88-86-e6-9e-90-check><a href=/docs/41.%E5%88%86%E5%B8%83%E5%BC%8F/Raft-02.raftexample%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-raft-02-raftexample-e6-ba-90-e7-a0-81-e5-88-86-e6-9e-90><span class=td-sidebar-nav-active-item>Raft-02.raftexample源码分析</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-e5-88-86-e5-b8-83-e5-bc-8f-e9-94-81-e5-ae-9e-e7-8e-b0-e5-8f-8a-e6-96-b9-e6-a1-88-e6-af-94-e8-be-83-li><input type=checkbox id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-e5-88-86-e5-b8-83-e5-bc-8f-e9-94-81-e5-ae-9e-e7-8e-b0-e5-8f-8a-e6-96-b9-e6-a1-88-e6-af-94-e8-be-83-check>
<label for=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-e5-88-86-e5-b8-83-e5-bc-8f-e9-94-81-e5-ae-9e-e7-8e-b0-e5-8f-8a-e6-96-b9-e6-a1-88-e6-af-94-e8-be-83-check><a href=/docs/41.%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%AE%9E%E7%8E%B0%E5%8F%8A%E6%96%B9%E6%A1%88%E6%AF%94%E8%BE%83/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-e5-88-86-e5-b8-83-e5-bc-8f-e9-94-81-e5-ae-9e-e7-8e-b0-e5-8f-8a-e6-96-b9-e6-a1-88-e6-af-94-e8-be-83><span>分布式锁实现及方案比较</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-e5-b8-b8-e8-a7-81-e5-88-86-e5-b8-83-e5-bc-8f-e6-8b-93-e6-89-91-e7-bb-93-e6-9e-84-li><input type=checkbox id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-e5-b8-b8-e8-a7-81-e5-88-86-e5-b8-83-e5-bc-8f-e6-8b-93-e6-89-91-e7-bb-93-e6-9e-84-check>
<label for=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-e5-b8-b8-e8-a7-81-e5-88-86-e5-b8-83-e5-bc-8f-e6-8b-93-e6-89-91-e7-bb-93-e6-9e-84-check><a href=/docs/41.%E5%88%86%E5%B8%83%E5%BC%8F/%E5%B8%B8%E8%A7%81%E5%88%86%E5%B8%83%E5%BC%8F%E6%8B%93%E6%89%91%E7%BB%93%E6%9E%84/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-41-e5-88-86-e5-b8-83-e5-bc-8f-e5-b8-b8-e8-a7-81-e5-88-86-e5-b8-83-e5-bc-8f-e6-8b-93-e6-89-91-e7-bb-93-e6-9e-84><span>常见分布式拓扑结构</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-42-rpc-li><input type=checkbox id=m-docs-42-rpc-check>
<label for=m-docs-42-rpc-check><a href=/docs/42.RPC/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-42-rpc><span>RPC</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-42-rpc-rpc-e4-b8-8d-e5-90-8c-e5-ae-9e-e7-8e-b0-e6-96-b9-e5-bc-8f-li><input type=checkbox id=m-docs-42-rpc-rpc-e4-b8-8d-e5-90-8c-e5-ae-9e-e7-8e-b0-e6-96-b9-e5-bc-8f-check>
<label for=m-docs-42-rpc-rpc-e4-b8-8d-e5-90-8c-e5-ae-9e-e7-8e-b0-e6-96-b9-e5-bc-8f-check><a href=/docs/42.RPC/RPC%E4%B8%8D%E5%90%8C%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-42-rpc-rpc-e4-b8-8d-e5-90-8c-e5-ae-9e-e7-8e-b0-e6-96-b9-e5-bc-8f><span>RPC不同实现方式</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-43-mq-li><input type=checkbox id=m-docs-43-mq-check>
<label for=m-docs-43-mq-check><a href=/docs/43.MQ/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-43-mq><span>MQ</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-43-mq-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3kafka-e6-a0-b8-e5-bf-83-e8-ae-be-e8-ae-a1-e4-b8-8e-e5-ae-9e-e8-b7-b5-e5-8e-9f-e7-90-86-li><input type=checkbox id=m-docs-43-mq-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3kafka-e6-a0-b8-e5-bf-83-e8-ae-be-e8-ae-a1-e4-b8-8e-e5-ae-9e-e8-b7-b5-e5-8e-9f-e7-90-86-check>
<label for=m-docs-43-mq-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3kafka-e6-a0-b8-e5-bf-83-e8-ae-be-e8-ae-a1-e4-b8-8e-e5-ae-9e-e8-b7-b5-e5-8e-9f-e7-90-86-check><a href=/docs/43.MQ/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Kafka%E6%A0%B8%E5%BF%83%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E8%B7%B5%E5%8E%9F%E7%90%86/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-43-mq-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3kafka-e6-a0-b8-e5-bf-83-e8-ae-be-e8-ae-a1-e4-b8-8e-e5-ae-9e-e8-b7-b5-e5-8e-9f-e7-90-86><span>深入理解Kafka：核心设计与实践原理</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-43-mq-pulsar-li><input type=checkbox id=m-docs-43-mq-pulsar-check>
<label for=m-docs-43-mq-pulsar-check><a href=/docs/43.MQ/Pulsar/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-43-mq-pulsar><span>Pulsar</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-43-mq-rocketmq-e6-ba-90-e7-a0-81-e5-88-86-e6-9e-90-li><input type=checkbox id=m-docs-43-mq-rocketmq-e6-ba-90-e7-a0-81-e5-88-86-e6-9e-90-check>
<label for=m-docs-43-mq-rocketmq-e6-ba-90-e7-a0-81-e5-88-86-e6-9e-90-check><a href=/docs/43.MQ/RocketMQ%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-43-mq-rocketmq-e6-ba-90-e7-a0-81-e5-88-86-e6-9e-90><span>RocketMQ源码分析</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-44-e6-90-9c-e7-b4-a2-li><input type=checkbox id=m-docs-44-e6-90-9c-e7-b4-a2-check>
<label for=m-docs-44-e6-90-9c-e7-b4-a2-check><a href=/docs/44.%E6%90%9C%E7%B4%A2/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-44-e6-90-9c-e7-b4-a2><span>搜索</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-44-e6-90-9c-e7-b4-a2-es-e5-92-8csolr-e6-af-94-e8-be-83-li><input type=checkbox id=m-docs-44-e6-90-9c-e7-b4-a2-es-e5-92-8csolr-e6-af-94-e8-be-83-check>
<label for=m-docs-44-e6-90-9c-e7-b4-a2-es-e5-92-8csolr-e6-af-94-e8-be-83-check><a href=/docs/44.%E6%90%9C%E7%B4%A2/ES%E5%92%8CSolr%E6%AF%94%E8%BE%83/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-44-e6-90-9c-e7-b4-a2-es-e5-92-8csolr-e6-af-94-e8-be-83><span>ES和Solr比较</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-44-e6-90-9c-e7-b4-a2-es-e5-ae-89-e8-a3-85-e4-b8-8e-e4-bd-bf-e7-94-a8-li><input type=checkbox id=m-docs-44-e6-90-9c-e7-b4-a2-es-e5-ae-89-e8-a3-85-e4-b8-8e-e4-bd-bf-e7-94-a8-check>
<label for=m-docs-44-e6-90-9c-e7-b4-a2-es-e5-ae-89-e8-a3-85-e4-b8-8e-e4-bd-bf-e7-94-a8-check><a href=/docs/44.%E6%90%9C%E7%B4%A2/ES%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-44-e6-90-9c-e7-b4-a2-es-e5-ae-89-e8-a3-85-e4-b8-8e-e4-bd-bf-e7-94-a8><span>ES安装与使用</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-44-e6-90-9c-e7-b4-a2-es-e5-9f-ba-e6-9c-ac-e6-93-8d-e4-bd-9c-li><input type=checkbox id=m-docs-44-e6-90-9c-e7-b4-a2-es-e5-9f-ba-e6-9c-ac-e6-93-8d-e4-bd-9c-check>
<label for=m-docs-44-e6-90-9c-e7-b4-a2-es-e5-9f-ba-e6-9c-ac-e6-93-8d-e4-bd-9c-check><a href=/docs/44.%E6%90%9C%E7%B4%A2/ES%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-44-e6-90-9c-e7-b4-a2-es-e5-9f-ba-e6-9c-ac-e6-93-8d-e4-bd-9c><span>ES基本操作</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-44-e6-90-9c-e7-b4-a2-es-e5-9f-ba-e6-9c-ac-e6-93-8d-e4-bd-9c-e5-88-86-e8-af-8d-e5-99-a8-li><input type=checkbox id=m-docs-44-e6-90-9c-e7-b4-a2-es-e5-9f-ba-e6-9c-ac-e6-93-8d-e4-bd-9c-e5-88-86-e8-af-8d-e5-99-a8-check>
<label for=m-docs-44-e6-90-9c-e7-b4-a2-es-e5-9f-ba-e6-9c-ac-e6-93-8d-e4-bd-9c-e5-88-86-e8-af-8d-e5-99-a8-check><a href=/docs/44.%E6%90%9C%E7%B4%A2/ES%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C-%E5%88%86%E8%AF%8D%E5%99%A8/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-44-e6-90-9c-e7-b4-a2-es-e5-9f-ba-e6-9c-ac-e6-93-8d-e4-bd-9c-e5-88-86-e8-af-8d-e5-99-a8><span>ES基本操作-分词器</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-44-e6-90-9c-e7-b4-a2-es-e5-9f-ba-e6-9c-ac-e6-93-8d-e4-bd-9c-e6-95-b4-e5-90-88springboot-li><input type=checkbox id=m-docs-44-e6-90-9c-e7-b4-a2-es-e5-9f-ba-e6-9c-ac-e6-93-8d-e4-bd-9c-e6-95-b4-e5-90-88springboot-check>
<label for=m-docs-44-e6-90-9c-e7-b4-a2-es-e5-9f-ba-e6-9c-ac-e6-93-8d-e4-bd-9c-e6-95-b4-e5-90-88springboot-check><a href=/docs/44.%E6%90%9C%E7%B4%A2/ES%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E6%95%B4%E5%90%88SpringBoot/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-44-e6-90-9c-e7-b4-a2-es-e5-9f-ba-e6-9c-ac-e6-93-8d-e4-bd-9c-e6-95-b4-e5-90-88springboot><span>ES基本操作整合SpringBoot</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-li><input type=checkbox id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-check>
<label for=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-check><a href=/docs/44.%E6%90%9C%E7%B4%A2/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3ElasticSearch/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch><span>深入理解ElasticSearch</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-01-e7-ae-80-e4-bb-8b-li><input type=checkbox id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-01-e7-ae-80-e4-bb-8b-check>
<label for=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-01-e7-ae-80-e4-bb-8b-check><a href=/docs/44.%E6%90%9C%E7%B4%A2/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3ElasticSearch/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3ES-01%E7%AE%80%E4%BB%8B/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-01-e7-ae-80-e4-bb-8b><span>深入理解ES-01简介</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-02-e6-9f-a5-e8-af-a2dsl-e8-bf-9b-e9-98-b6-li><input type=checkbox id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-02-e6-9f-a5-e8-af-a2dsl-e8-bf-9b-e9-98-b6-check>
<label for=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-02-e6-9f-a5-e8-af-a2dsl-e8-bf-9b-e9-98-b6-check><a href=/docs/44.%E6%90%9C%E7%B4%A2/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3ElasticSearch/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3ES-02%E6%9F%A5%E8%AF%A2DSL%E8%BF%9B%E9%98%B6/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-02-e6-9f-a5-e8-af-a2dsl-e8-bf-9b-e9-98-b6><span>深入理解ES-02查询DSL进阶</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-03-e5-ba-95-e5-b1-82-e7-b4-a2-e5-bc-95-e6-8e-a7-e5-88-b6-li><input type=checkbox id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-03-e5-ba-95-e5-b1-82-e7-b4-a2-e5-bc-95-e6-8e-a7-e5-88-b6-check>
<label for=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-03-e5-ba-95-e5-b1-82-e7-b4-a2-e5-bc-95-e6-8e-a7-e5-88-b6-check><a href=/docs/44.%E6%90%9C%E7%B4%A2/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3ElasticSearch/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3ES-03%E5%BA%95%E5%B1%82%E7%B4%A2%E5%BC%95%E6%8E%A7%E5%88%B6/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-03-e5-ba-95-e5-b1-82-e7-b4-a2-e5-bc-95-e6-8e-a7-e5-88-b6><span>深入理解ES-03底层索引控制</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-04-e5-88-86-e5-b8-83-e5-bc-8f-e7-b4-a2-e5-bc-95-e6-9e-b6-e6-9e-84-li><input type=checkbox id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-04-e5-88-86-e5-b8-83-e5-bc-8f-e7-b4-a2-e5-bc-95-e6-9e-b6-e6-9e-84-check>
<label for=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-04-e5-88-86-e5-b8-83-e5-bc-8f-e7-b4-a2-e5-bc-95-e6-9e-b6-e6-9e-84-check><a href=/docs/44.%E6%90%9C%E7%B4%A2/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3ElasticSearch/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3ES-04%E5%88%86%E5%B8%83%E5%BC%8F%E7%B4%A2%E5%BC%95%E6%9E%B6%E6%9E%84/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-04-e5-88-86-e5-b8-83-e5-bc-8f-e7-b4-a2-e5-bc-95-e6-9e-b6-e6-9e-84><span>深入理解ES-04分布式索引架构</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-05-e7-ae-a1-e7-90-86es-li><input type=checkbox id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-05-e7-ae-a1-e7-90-86es-check>
<label for=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-05-e7-ae-a1-e7-90-86es-check><a href=/docs/44.%E6%90%9C%E7%B4%A2/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3ElasticSearch/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3ES-05%E7%AE%A1%E7%90%86ES/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-05-e7-ae-a1-e7-90-86es><span>深入理解ES-05管理ES</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-06-e6-95-85-e9-9a-9c-e5-a4-84-e7-90-86-li><input type=checkbox id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-06-e6-95-85-e9-9a-9c-e5-a4-84-e7-90-86-check>
<label for=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-06-e6-95-85-e9-9a-9c-e5-a4-84-e7-90-86-check><a href=/docs/44.%E6%90%9C%E7%B4%A2/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3ElasticSearch/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3ES-06%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-06-e6-95-85-e9-9a-9c-e5-a4-84-e7-90-86><span>深入理解ES-06故障处理</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-07-e6-94-b9-e5-96-84-e7-94-a8-e6-88-b7-e6-90-9c-e7-b4-a2-e4-bd-93-e9-aa-8c-li><input type=checkbox id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-07-e6-94-b9-e5-96-84-e7-94-a8-e6-88-b7-e6-90-9c-e7-b4-a2-e4-bd-93-e9-aa-8c-check>
<label for=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-07-e6-94-b9-e5-96-84-e7-94-a8-e6-88-b7-e6-90-9c-e7-b4-a2-e4-bd-93-e9-aa-8c-check><a href=/docs/44.%E6%90%9C%E7%B4%A2/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3ElasticSearch/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3ES-07%E6%94%B9%E5%96%84%E7%94%A8%E6%88%B7%E6%90%9C%E7%B4%A2%E4%BD%93%E9%AA%8C/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-07-e6-94-b9-e5-96-84-e7-94-a8-e6-88-b7-e6-90-9c-e7-b4-a2-e4-bd-93-e9-aa-8c><span>深入理解ES-07改善用户搜索体验</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-08-es-java-api-li><input type=checkbox id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-08-es-java-api-check>
<label for=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-08-es-java-api-check><a href=/docs/44.%E6%90%9C%E7%B4%A2/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3ElasticSearch/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3ES-08-ES-Java-API/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-08-es-java-api><span>深入理解ES-08 ES Java API</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-09-e5-bc-80-e5-8f-91es-e6-8f-92-e4-bb-b6-li><input type=checkbox id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-09-e5-bc-80-e5-8f-91es-e6-8f-92-e4-bb-b6-check>
<label for=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-09-e5-bc-80-e5-8f-91es-e6-8f-92-e4-bb-b6-check><a href=/docs/44.%E6%90%9C%E7%B4%A2/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3ElasticSearch/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3ES-09%E5%BC%80%E5%8F%91ES%E6%8F%92%E4%BB%B6/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-44-e6-90-9c-e7-b4-a2-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3elasticsearch-e6-b7-b1-e5-85-a5-e7-90-86-e8-a7-a3es-09-e5-bc-80-e5-8f-91es-e6-8f-92-e4-bb-b6><span>深入理解ES-09开发ES插件</span></a></label></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-45-apm-li><input type=checkbox id=m-docs-45-apm-check>
<label for=m-docs-45-apm-check><a href=/docs/45.APM/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-45-apm><span>APM</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-45-apm-skywalking-e5-9f-ba-e7-a1-80-e4-bd-bf-e7-94-a8-li><input type=checkbox id=m-docs-45-apm-skywalking-e5-9f-ba-e7-a1-80-e4-bd-bf-e7-94-a8-check>
<label for=m-docs-45-apm-skywalking-e5-9f-ba-e7-a1-80-e4-bd-bf-e7-94-a8-check><a href=/docs/45.APM/Skywalking%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-45-apm-skywalking-e5-9f-ba-e7-a1-80-e4-bd-bf-e7-94-a8><span>Skywalking基础使用</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-45-apm-skywalking-e6-ba-90-e7-a0-81-e5-88-86-e6-9e-902-e5-90-af-e5-8a-a8-e6-b5-81-e7-a8-8b-li><input type=checkbox id=m-docs-45-apm-skywalking-e6-ba-90-e7-a0-81-e5-88-86-e6-9e-902-e5-90-af-e5-8a-a8-e6-b5-81-e7-a8-8b-check>
<label for=m-docs-45-apm-skywalking-e6-ba-90-e7-a0-81-e5-88-86-e6-9e-902-e5-90-af-e5-8a-a8-e6-b5-81-e7-a8-8b-check><a href=/docs/45.APM/Skywalking%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%902-%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-45-apm-skywalking-e6-ba-90-e7-a0-81-e5-88-86-e6-9e-902-e5-90-af-e5-8a-a8-e6-b5-81-e7-a8-8b><span>Skywalking源码分析2-启动流程</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-45-apm-e5-ad-97-e8-8a-82-e7-a0-81-e5-a2-9e-e5-bc-ba-e6-8a-80-e6-9c-af-e6-a6-82-e5-bf-b5-li><input type=checkbox id=m-docs-45-apm-e5-ad-97-e8-8a-82-e7-a0-81-e5-a2-9e-e5-bc-ba-e6-8a-80-e6-9c-af-e6-a6-82-e5-bf-b5-check>
<label for=m-docs-45-apm-e5-ad-97-e8-8a-82-e7-a0-81-e5-a2-9e-e5-bc-ba-e6-8a-80-e6-9c-af-e6-a6-82-e5-bf-b5-check><a href=/docs/45.APM/%E5%AD%97%E8%8A%82%E7%A0%81%E5%A2%9E%E5%BC%BA%E6%8A%80%E6%9C%AF-%E6%A6%82%E5%BF%B5/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-45-apm-e5-ad-97-e8-8a-82-e7-a0-81-e5-a2-9e-e5-bc-ba-e6-8a-80-e6-9c-af-e6-a6-82-e5-bf-b5><span>字节码增强技术-概念</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-49-container-li><input type=checkbox id=m-docs-49-container-check>
<label for=m-docs-49-container-check><a href=/docs/49.Container/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-49-container><span>Container</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-49-container-01-docker-e5-9f-ba-e7-a1-80-e7-89-88-li><input type=checkbox id=m-docs-49-container-01-docker-e5-9f-ba-e7-a1-80-e7-89-88-check>
<label for=m-docs-49-container-01-docker-e5-9f-ba-e7-a1-80-e7-89-88-check><a href=/docs/49.Container/01.docker%E5%9F%BA%E7%A1%80%E7%89%88/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-49-container-01-docker-e5-9f-ba-e7-a1-80-e7-89-88><span>01.docker基础版</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-49-container-20-docker-e7-9b-ae-e5-bd-95-li><input type=checkbox id=m-docs-49-container-20-docker-e7-9b-ae-e5-bd-95-check>
<label for=m-docs-49-container-20-docker-e7-9b-ae-e5-bd-95-check><a href=/docs/49.Container/20.docker%E7%9B%AE%E5%BD%95/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-49-container-20-docker-e7-9b-ae-e5-bd-95><span>20.docker目录</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-49-container-21-docker-e8-b7-af-e5-be-84-e4-bf-ae-e6-94-b9-li><input type=checkbox id=m-docs-49-container-21-docker-e8-b7-af-e5-be-84-e4-bf-ae-e6-94-b9-check>
<label for=m-docs-49-container-21-docker-e8-b7-af-e5-be-84-e4-bf-ae-e6-94-b9-check><a href=/docs/49.Container/21.docker%E8%B7%AF%E5%BE%84%E4%BF%AE%E6%94%B9/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-49-container-21-docker-e8-b7-af-e5-be-84-e4-bf-ae-e6-94-b9><span>21.docker路径修改</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-49-container-22-dockerd-li><input type=checkbox id=m-docs-49-container-22-dockerd-check>
<label for=m-docs-49-container-22-dockerd-check><a href=/docs/49.Container/22.dockerd/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-49-container-22-dockerd><span>22.dockerd</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-49-container-51-kubernetes01-li><input type=checkbox id=m-docs-49-container-51-kubernetes01-check>
<label for=m-docs-49-container-51-kubernetes01-check><a href=/docs/49.Container/51.kubernetes01/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-49-container-51-kubernetes01><span>51.kubernetes01</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-49-container-52-kubernetes02-li><input type=checkbox id=m-docs-49-container-52-kubernetes02-check>
<label for=m-docs-49-container-52-kubernetes02-check><a href=/docs/49.Container/52.kubernetes02/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-49-container-52-kubernetes02><span>52.kubernetes02</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-50-cloud-li><input type=checkbox id=m-docs-50-cloud-check>
<label for=m-docs-50-cloud-check><a href=/docs/50.Cloud/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-50-cloud><span>Cloud</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-51-e5-ae-89-e5-85-a8-li><input type=checkbox id=m-docs-51-e5-ae-89-e5-85-a8-check>
<label for=m-docs-51-e5-ae-89-e5-85-a8-check><a href=/docs/51.%E5%AE%89%E5%85%A8/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-51-e5-ae-89-e5-85-a8><span>安全</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-51-e5-ae-89-e5-85-a8-fastjson-e8-bf-9c-e7-a8-8b-e6-89-a7-e8-a1-8c-e6-bc-8f-e6-b4-9e-e5-88-86-e6-9e-90-li><input type=checkbox id=m-docs-51-e5-ae-89-e5-85-a8-fastjson-e8-bf-9c-e7-a8-8b-e6-89-a7-e8-a1-8c-e6-bc-8f-e6-b4-9e-e5-88-86-e6-9e-90-check>
<label for=m-docs-51-e5-ae-89-e5-85-a8-fastjson-e8-bf-9c-e7-a8-8b-e6-89-a7-e8-a1-8c-e6-bc-8f-e6-b4-9e-e5-88-86-e6-9e-90-check><a href=/docs/51.%E5%AE%89%E5%85%A8/fastjson%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-51-e5-ae-89-e5-85-a8-fastjson-e8-bf-9c-e7-a8-8b-e6-89-a7-e8-a1-8c-e6-bc-8f-e6-b4-9e-e5-88-86-e6-9e-90><span>fastjson远程执行漏洞分析</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-51-e5-ae-89-e5-85-a8-log4j2-e8-bf-9c-e7-a8-8b-e6-89-a7-e8-a1-8c-e6-bc-8f-e6-b4-9e-li><input type=checkbox id=m-docs-51-e5-ae-89-e5-85-a8-log4j2-e8-bf-9c-e7-a8-8b-e6-89-a7-e8-a1-8c-e6-bc-8f-e6-b4-9e-check>
<label for=m-docs-51-e5-ae-89-e5-85-a8-log4j2-e8-bf-9c-e7-a8-8b-e6-89-a7-e8-a1-8c-e6-bc-8f-e6-b4-9e-check><a href=/docs/51.%E5%AE%89%E5%85%A8/Log4j2%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-51-e5-ae-89-e5-85-a8-log4j2-e8-bf-9c-e7-a8-8b-e6-89-a7-e8-a1-8c-e6-bc-8f-e6-b4-9e><span>Log4j2远程执行漏洞</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-li><input type=checkbox id=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-check>
<label for=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-check><a href=/docs/52.%E5%A4%A7%E6%95%B0%E6%8D%AE/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae><span>大数据</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-e5-88-9d-e6-8e-a2hbase-li><input type=checkbox id=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-e5-88-9d-e6-8e-a2hbase-check>
<label for=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-e5-88-9d-e6-8e-a2hbase-check><a href=/docs/52.%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%88%9D%E6%8E%A2Hbase/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-e5-88-9d-e6-8e-a2hbase><span>初探Hbase</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-e5-a4-a7-e6-95-b0-e6-8d-ae-e6-a1-86-e6-9e-b6-li><input type=checkbox id=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-e5-a4-a7-e6-95-b0-e6-8d-ae-e6-a1-86-e6-9e-b6-check>
<label for=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-e5-a4-a7-e6-95-b0-e6-8d-ae-e6-a1-86-e6-9e-b6-check><a href=/docs/52.%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%A1%86%E6%9E%B6/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-e5-a4-a7-e6-95-b0-e6-8d-ae-e6-a1-86-e6-9e-b6><span>大数据框架</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-hdfs-01-e5-9f-ba-e6-9c-ac-e4-bb-8b-e7-bb-8d-li><input type=checkbox id=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-hdfs-01-e5-9f-ba-e6-9c-ac-e4-bb-8b-e7-bb-8d-check>
<label for=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-hdfs-01-e5-9f-ba-e6-9c-ac-e4-bb-8b-e7-bb-8d-check><a href=/docs/52.%E5%A4%A7%E6%95%B0%E6%8D%AE/HDFS-01%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-hdfs-01-e5-9f-ba-e6-9c-ac-e4-bb-8b-e7-bb-8d><span>HDFS-01基本介绍</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-hdfs-02-e5-9f-ba-e6-9c-ac-e5-91-bd-e4-bb-a4-li><input type=checkbox id=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-hdfs-02-e5-9f-ba-e6-9c-ac-e5-91-bd-e4-bb-a4-check>
<label for=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-hdfs-02-e5-9f-ba-e6-9c-ac-e5-91-bd-e4-bb-a4-check><a href=/docs/52.%E5%A4%A7%E6%95%B0%E6%8D%AE/HDFS-02%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-hdfs-02-e5-9f-ba-e6-9c-ac-e5-91-bd-e4-bb-a4><span>HDFS-02基本命令</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-spark-li><input type=checkbox id=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-spark-check>
<label for=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-spark-check><a href=/docs/52.%E5%A4%A7%E6%95%B0%E6%8D%AE/Spark/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-spark><span>Spark</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-spark-01-spark-e5-9f-ba-e6-9c-ac-e4-bb-8b-e7-bb-8d-li><input type=checkbox id=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-spark-01-spark-e5-9f-ba-e6-9c-ac-e4-bb-8b-e7-bb-8d-check>
<label for=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-spark-01-spark-e5-9f-ba-e6-9c-ac-e4-bb-8b-e7-bb-8d-check><a href=/docs/52.%E5%A4%A7%E6%95%B0%E6%8D%AE/Spark/01.Spark%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-52-e5-a4-a7-e6-95-b0-e6-8d-ae-spark-01-spark-e5-9f-ba-e6-9c-ac-e4-bb-8b-e7-bb-8d><span>01.Spark基本介绍</span></a></label></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-li><input type=checkbox id=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-check>
<label for=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-check><a href=/docs/60.%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84><span>算法与数据结构</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-li><input type=checkbox id=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-check>
<label for=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-check><a href=/docs/60.%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84><span>数据结构</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-lsm-e6-a0-91-li><input type=checkbox id=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-lsm-e6-a0-91-check>
<label for=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-lsm-e6-a0-91-check><a href=/docs/60.%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/LSM%E6%A0%91/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-lsm-e6-a0-91><span>LSM树</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e7-ba-a2-e9-bb-91-e6-a0-91-li><input type=checkbox id=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e7-ba-a2-e9-bb-91-e6-a0-91-check>
<label for=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e7-ba-a2-e9-bb-91-e6-a0-91-check><a href=/docs/60.%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E7%BA%A2%E9%BB%91%E6%A0%91/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e7-ba-a2-e9-bb-91-e6-a0-91><span>红黑树</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e8-b7-b3-e8-a1-a8-li><input type=checkbox id=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e8-b7-b3-e8-a1-a8-check>
<label for=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e8-b7-b3-e8-a1-a8-check><a href=/docs/60.%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%B7%B3%E8%A1%A8/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e8-b7-b3-e8-a1-a8><span>跳表</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e7-ae-97-e6-b3-95-li><input type=checkbox id=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e7-ae-97-e6-b3-95-check>
<label for=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e7-ae-97-e6-b3-95-check><a href=/docs/60.%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E7%AE%97%E6%B3%95/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e7-ae-97-e6-b3-95><span>算法</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e7-ae-97-e6-b3-95-e9-9b-aa-e8-8a-b1-e7-ae-97-e6-b3-95-li><input type=checkbox id=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e7-ae-97-e6-b3-95-e9-9b-aa-e8-8a-b1-e7-ae-97-e6-b3-95-check>
<label for=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e7-ae-97-e6-b3-95-e9-9b-aa-e8-8a-b1-e7-ae-97-e6-b3-95-check><a href=/docs/60.%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E7%AE%97%E6%B3%95/%E9%9B%AA%E8%8A%B1%E7%AE%97%E6%B3%95/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-60-e7-ae-97-e6-b3-95-e4-b8-8e-e6-95-b0-e6-8d-ae-e7-bb-93-e6-9e-84-e7-ae-97-e6-b3-95-e9-9b-aa-e8-8a-b1-e7-ae-97-e6-b3-95><span>雪花算法</span></a></label></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-70-e5-89-8d-e7-ab-af-li><input type=checkbox id=m-docs-70-e5-89-8d-e7-ab-af-check>
<label for=m-docs-70-e5-89-8d-e7-ab-af-check><a href=/docs/70.%E5%89%8D%E7%AB%AF/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-70-e5-89-8d-e7-ab-af><span>前端</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-70-e5-89-8d-e7-ab-af-vue-li><input type=checkbox id=m-docs-70-e5-89-8d-e7-ab-af-vue-check>
<label for=m-docs-70-e5-89-8d-e7-ab-af-vue-check><a href=/docs/70.%E5%89%8D%E7%AB%AF/Vue/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-70-e5-89-8d-e7-ab-af-vue><span>Vue</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-70-e5-89-8d-e7-ab-af-vue-js-e5-b0-81-e8-a3-85-e5-87-bd-e6-95-b0-e5-8f-8aaxios-e5-b0-81-e8-a3-85-li><input type=checkbox id=m-docs-70-e5-89-8d-e7-ab-af-vue-js-e5-b0-81-e8-a3-85-e5-87-bd-e6-95-b0-e5-8f-8aaxios-e5-b0-81-e8-a3-85-check>
<label for=m-docs-70-e5-89-8d-e7-ab-af-vue-js-e5-b0-81-e8-a3-85-e5-87-bd-e6-95-b0-e5-8f-8aaxios-e5-b0-81-e8-a3-85-check><a href=/docs/70.%E5%89%8D%E7%AB%AF/Vue/js%E5%B0%81%E8%A3%85%E5%87%BD%E6%95%B0%E5%8F%8Aaxios%E5%B0%81%E8%A3%85/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-70-e5-89-8d-e7-ab-af-vue-js-e5-b0-81-e8-a3-85-e5-87-bd-e6-95-b0-e5-8f-8aaxios-e5-b0-81-e8-a3-85><span>js封装函数及axios封装</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-70-e5-89-8d-e7-ab-af-vue-vue-e4-bf-9d-e5-ad-98-e6-97-b6-e4-b8-8a-e4-bc-a0-e5-9b-be-e7-89-87-li><input type=checkbox id=m-docs-70-e5-89-8d-e7-ab-af-vue-vue-e4-bf-9d-e5-ad-98-e6-97-b6-e4-b8-8a-e4-bc-a0-e5-9b-be-e7-89-87-check>
<label for=m-docs-70-e5-89-8d-e7-ab-af-vue-vue-e4-bf-9d-e5-ad-98-e6-97-b6-e4-b8-8a-e4-bc-a0-e5-9b-be-e7-89-87-check><a href=/docs/70.%E5%89%8D%E7%AB%AF/Vue/vue%E4%BF%9D%E5%AD%98%E6%97%B6%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-70-e5-89-8d-e7-ab-af-vue-vue-e4-bf-9d-e5-ad-98-e6-97-b6-e4-b8-8a-e4-bc-a0-e5-9b-be-e7-89-87><span>vue保存时上传图片</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-70-e5-89-8d-e7-ab-af-vue-vue-e9-94-99-e8-af-af-e9-9b-86-e9-94-a6-li><input type=checkbox id=m-docs-70-e5-89-8d-e7-ab-af-vue-vue-e9-94-99-e8-af-af-e9-9b-86-e9-94-a6-check>
<label for=m-docs-70-e5-89-8d-e7-ab-af-vue-vue-e9-94-99-e8-af-af-e9-9b-86-e9-94-a6-check><a href=/docs/70.%E5%89%8D%E7%AB%AF/Vue/vue%E9%94%99%E8%AF%AF%E9%9B%86%E9%94%A6/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-70-e5-89-8d-e7-ab-af-vue-vue-e9-94-99-e8-af-af-e9-9b-86-e9-94-a6><span>vue错误集锦</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-70-e5-89-8d-e7-ab-af-vue-vue-e7-bb-93-e5-90-88-e5-90-8e-e5-8f-b0-e6-8e-a5-e5-8f-a3-e9-85-8d-e7-bd-ae-e8-b0-83-e8-af-95-e7-8e-af-e5-a2-83-li><input type=checkbox id=m-docs-70-e5-89-8d-e7-ab-af-vue-vue-e7-bb-93-e5-90-88-e5-90-8e-e5-8f-b0-e6-8e-a5-e5-8f-a3-e9-85-8d-e7-bd-ae-e8-b0-83-e8-af-95-e7-8e-af-e5-a2-83-check>
<label for=m-docs-70-e5-89-8d-e7-ab-af-vue-vue-e7-bb-93-e5-90-88-e5-90-8e-e5-8f-b0-e6-8e-a5-e5-8f-a3-e9-85-8d-e7-bd-ae-e8-b0-83-e8-af-95-e7-8e-af-e5-a2-83-check><a href=/docs/70.%E5%89%8D%E7%AB%AF/Vue/vue%E7%BB%93%E5%90%88%E5%90%8E%E5%8F%B0%E6%8E%A5%E5%8F%A3%E9%85%8D%E7%BD%AE%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-70-e5-89-8d-e7-ab-af-vue-vue-e7-bb-93-e5-90-88-e5-90-8e-e5-8f-b0-e6-8e-a5-e5-8f-a3-e9-85-8d-e7-bd-ae-e8-b0-83-e8-af-95-e7-8e-af-e5-a2-83><span>vue结合后台接口配置调试环境</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-70-e5-89-8d-e7-ab-af-vue-vue-e5-bf-ab-e9-80-9f-e5-85-a5-e9-97-a8-li><input type=checkbox id=m-docs-70-e5-89-8d-e7-ab-af-vue-vue-e5-bf-ab-e9-80-9f-e5-85-a5-e9-97-a8-check>
<label for=m-docs-70-e5-89-8d-e7-ab-af-vue-vue-e5-bf-ab-e9-80-9f-e5-85-a5-e9-97-a8-check><a href=/docs/70.%E5%89%8D%E7%AB%AF/Vue/vue%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-70-e5-89-8d-e7-ab-af-vue-vue-e5-bf-ab-e9-80-9f-e5-85-a5-e9-97-a8><span>vue快速入门</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-70-e5-89-8d-e7-ab-af-vue-vue-e6-98-be-e7-a4-ba-e6-95-b0-e5-80-bc-e5-b0-8f-e6-95-b0-e7-82-b9-li><input type=checkbox id=m-docs-70-e5-89-8d-e7-ab-af-vue-vue-e6-98-be-e7-a4-ba-e6-95-b0-e5-80-bc-e5-b0-8f-e6-95-b0-e7-82-b9-check>
<label for=m-docs-70-e5-89-8d-e7-ab-af-vue-vue-e6-98-be-e7-a4-ba-e6-95-b0-e5-80-bc-e5-b0-8f-e6-95-b0-e7-82-b9-check><a href=/docs/70.%E5%89%8D%E7%AB%AF/Vue/vue%E6%98%BE%E7%A4%BA%E6%95%B0%E5%80%BC%E5%B0%8F%E6%95%B0%E7%82%B9/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-70-e5-89-8d-e7-ab-af-vue-vue-e6-98-be-e7-a4-ba-e6-95-b0-e5-80-bc-e5-b0-8f-e6-95-b0-e7-82-b9><span>vue显示数值小数点</span></a></label></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-71-e9-80-9a-e7-94-a8-li><input type=checkbox id=m-docs-71-e9-80-9a-e7-94-a8-check>
<label for=m-docs-71-e9-80-9a-e7-94-a8-check><a href=/docs/71.%E9%80%9A%E7%94%A8/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-71-e9-80-9a-e7-94-a8><span>通用</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-71-e9-80-9a-e7-94-a8-cron-e8-a1-a8-e8-be-be-e5-bc-8f-li><input type=checkbox id=m-docs-71-e9-80-9a-e7-94-a8-cron-e8-a1-a8-e8-be-be-e5-bc-8f-check>
<label for=m-docs-71-e9-80-9a-e7-94-a8-cron-e8-a1-a8-e8-be-be-e5-bc-8f-check><a href=/docs/71.%E9%80%9A%E7%94%A8/cron%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-71-e9-80-9a-e7-94-a8-cron-e8-a1-a8-e8-be-be-e5-bc-8f><span>cron表达式</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-71-e9-80-9a-e7-94-a8-e6-9e-b6-e6-9e-84-e8-ae-be-e8-ae-a101-e5-9f-ba-e7-a1-80-e6-9e-b6-e6-9e-84-li><input type=checkbox id=m-docs-71-e9-80-9a-e7-94-a8-e6-9e-b6-e6-9e-84-e8-ae-be-e8-ae-a101-e5-9f-ba-e7-a1-80-e6-9e-b6-e6-9e-84-check>
<label for=m-docs-71-e9-80-9a-e7-94-a8-e6-9e-b6-e6-9e-84-e8-ae-be-e8-ae-a101-e5-9f-ba-e7-a1-80-e6-9e-b6-e6-9e-84-check><a href=/docs/71.%E9%80%9A%E7%94%A8/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A101-%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-71-e9-80-9a-e7-94-a8-e6-9e-b6-e6-9e-84-e8-ae-be-e8-ae-a101-e5-9f-ba-e7-a1-80-e6-9e-b6-e6-9e-84><span>架构设计01-基础架构</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-71-e9-80-9a-e7-94-a8-e6-9e-b6-e6-9e-84-e8-ae-be-e8-ae-a102-e9-ab-98-e6-80-a7-e8-83-bd-e6-9e-b6-e6-9e-84-e6-a8-a1-e5-bc-8f-li><input type=checkbox id=m-docs-71-e9-80-9a-e7-94-a8-e6-9e-b6-e6-9e-84-e8-ae-be-e8-ae-a102-e9-ab-98-e6-80-a7-e8-83-bd-e6-9e-b6-e6-9e-84-e6-a8-a1-e5-bc-8f-check>
<label for=m-docs-71-e9-80-9a-e7-94-a8-e6-9e-b6-e6-9e-84-e8-ae-be-e8-ae-a102-e9-ab-98-e6-80-a7-e8-83-bd-e6-9e-b6-e6-9e-84-e6-a8-a1-e5-bc-8f-check><a href=/docs/71.%E9%80%9A%E7%94%A8/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A102-%E9%AB%98%E6%80%A7%E8%83%BD%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-71-e9-80-9a-e7-94-a8-e6-9e-b6-e6-9e-84-e8-ae-be-e8-ae-a102-e9-ab-98-e6-80-a7-e8-83-bd-e6-9e-b6-e6-9e-84-e6-a8-a1-e5-bc-8f><span>架构设计02-高性能架构模式</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-71-e9-80-9a-e7-94-a8-e6-9e-b6-e6-9e-84-e8-ae-be-e8-ae-a103-e9-ab-98-e5-8f-af-e7-94-a8-e6-9e-b6-e6-9e-84-e6-a8-a1-e5-bc-8f-li><input type=checkbox id=m-docs-71-e9-80-9a-e7-94-a8-e6-9e-b6-e6-9e-84-e8-ae-be-e8-ae-a103-e9-ab-98-e5-8f-af-e7-94-a8-e6-9e-b6-e6-9e-84-e6-a8-a1-e5-bc-8f-check>
<label for=m-docs-71-e9-80-9a-e7-94-a8-e6-9e-b6-e6-9e-84-e8-ae-be-e8-ae-a103-e9-ab-98-e5-8f-af-e7-94-a8-e6-9e-b6-e6-9e-84-e6-a8-a1-e5-bc-8f-check><a href=/docs/71.%E9%80%9A%E7%94%A8/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A103-%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-71-e9-80-9a-e7-94-a8-e6-9e-b6-e6-9e-84-e8-ae-be-e8-ae-a103-e9-ab-98-e5-8f-af-e7-94-a8-e6-9e-b6-e6-9e-84-e6-a8-a1-e5-bc-8f><span>架构设计03-高可用架构模式</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-71-e9-80-9a-e7-94-a8-e6-9e-b6-e6-9e-84-e8-ae-be-e8-ae-a104-e5-8f-af-e6-89-a9-e5-b1-95-e6-9e-b6-e6-9e-84-e6-a8-a1-e5-bc-8f-li><input type=checkbox id=m-docs-71-e9-80-9a-e7-94-a8-e6-9e-b6-e6-9e-84-e8-ae-be-e8-ae-a104-e5-8f-af-e6-89-a9-e5-b1-95-e6-9e-b6-e6-9e-84-e6-a8-a1-e5-bc-8f-check>
<label for=m-docs-71-e9-80-9a-e7-94-a8-e6-9e-b6-e6-9e-84-e8-ae-be-e8-ae-a104-e5-8f-af-e6-89-a9-e5-b1-95-e6-9e-b6-e6-9e-84-e6-a8-a1-e5-bc-8f-check><a href=/docs/71.%E9%80%9A%E7%94%A8/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A104-%E5%8F%AF%E6%89%A9%E5%B1%95%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-71-e9-80-9a-e7-94-a8-e6-9e-b6-e6-9e-84-e8-ae-be-e8-ae-a104-e5-8f-af-e6-89-a9-e5-b1-95-e6-9e-b6-e6-9e-84-e6-a8-a1-e5-bc-8f><span>架构设计04-可扩展架构模式</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-71-e9-80-9a-e7-94-a8-e6-9e-b6-e6-9e-84-e8-ae-be-e8-ae-a105-e6-9e-b6-e6-9e-84-e5-ae-9e-e6-88-98-li><input type=checkbox id=m-docs-71-e9-80-9a-e7-94-a8-e6-9e-b6-e6-9e-84-e8-ae-be-e8-ae-a105-e6-9e-b6-e6-9e-84-e5-ae-9e-e6-88-98-check>
<label for=m-docs-71-e9-80-9a-e7-94-a8-e6-9e-b6-e6-9e-84-e8-ae-be-e8-ae-a105-e6-9e-b6-e6-9e-84-e5-ae-9e-e6-88-98-check><a href=/docs/71.%E9%80%9A%E7%94%A8/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A105-%E6%9E%B6%E6%9E%84%E5%AE%9E%E6%88%98/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-71-e9-80-9a-e7-94-a8-e6-9e-b6-e6-9e-84-e8-ae-be-e8-ae-a105-e6-9e-b6-e6-9e-84-e5-ae-9e-e6-88-98><span>架构设计05-架构实战</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-71-e9-80-9a-e7-94-a8-e6-9e-b6-e6-9e-84-e8-ae-be-e8-ae-a106-e5-ae-9e-e8-b7-b5-li><input type=checkbox id=m-docs-71-e9-80-9a-e7-94-a8-e6-9e-b6-e6-9e-84-e8-ae-be-e8-ae-a106-e5-ae-9e-e8-b7-b5-check>
<label for=m-docs-71-e9-80-9a-e7-94-a8-e6-9e-b6-e6-9e-84-e8-ae-be-e8-ae-a106-e5-ae-9e-e8-b7-b5-check><a href=/docs/71.%E9%80%9A%E7%94%A8/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A106-%E5%AE%9E%E8%B7%B5/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-71-e9-80-9a-e7-94-a8-e6-9e-b6-e6-9e-84-e8-ae-be-e8-ae-a106-e5-ae-9e-e8-b7-b5><span>架构设计06-实践</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-91-e8-af-bb-e4-b9-a6-e7-ac-94-e8-ae-b0-li><input type=checkbox id=m-docs-91-e8-af-bb-e4-b9-a6-e7-ac-94-e8-ae-b0-check>
<label for=m-docs-91-e8-af-bb-e4-b9-a6-e7-ac-94-e8-ae-b0-check><a href=/docs/91.%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-91-e8-af-bb-e4-b9-a6-e7-ac-94-e8-ae-b0><span>读书笔记</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-91-e8-af-bb-e4-b9-a6-e7-ac-94-e8-ae-b0-e5-a4-a7-e8-af-9d-e8-ae-be-e8-ae-a1-e6-a8-a1-e5-bc-8f-li><input type=checkbox id=m-docs-91-e8-af-bb-e4-b9-a6-e7-ac-94-e8-ae-b0-e5-a4-a7-e8-af-9d-e8-ae-be-e8-ae-a1-e6-a8-a1-e5-bc-8f-check>
<label for=m-docs-91-e8-af-bb-e4-b9-a6-e7-ac-94-e8-ae-b0-e5-a4-a7-e8-af-9d-e8-ae-be-e8-ae-a1-e6-a8-a1-e5-bc-8f-check><a href=/docs/91.%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E5%A4%A7%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-91-e8-af-bb-e4-b9-a6-e7-ac-94-e8-ae-b0-e5-a4-a7-e8-af-9d-e8-ae-be-e8-ae-a1-e6-a8-a1-e5-bc-8f><span>大话设计模式</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-91-e8-af-bb-e4-b9-a6-e7-ac-94-e8-ae-b0-e4-bb-a3-e7-a0-81-e6-95-b4-e6-b4-81-e4-b9-8b-e9-81-93-li><input type=checkbox id=m-docs-91-e8-af-bb-e4-b9-a6-e7-ac-94-e8-ae-b0-e4-bb-a3-e7-a0-81-e6-95-b4-e6-b4-81-e4-b9-8b-e9-81-93-check>
<label for=m-docs-91-e8-af-bb-e4-b9-a6-e7-ac-94-e8-ae-b0-e4-bb-a3-e7-a0-81-e6-95-b4-e6-b4-81-e4-b9-8b-e9-81-93-check><a href=/docs/91.%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E4%BB%A3%E7%A0%81%E6%95%B4%E6%B4%81%E4%B9%8B%E9%81%93/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-91-e8-af-bb-e4-b9-a6-e7-ac-94-e8-ae-b0-e4-bb-a3-e7-a0-81-e6-95-b4-e6-b4-81-e4-b9-8b-e9-81-93><span>代码整洁之道</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-91-e8-af-bb-e4-b9-a6-e7-ac-94-e8-ae-b0-e5-af-b9-e4-bc-aa-e5-bf-83-e7-90-86-e5-ad-a6-e8-af-b4-e4-b8-8d-li><input type=checkbox id=m-docs-91-e8-af-bb-e4-b9-a6-e7-ac-94-e8-ae-b0-e5-af-b9-e4-bc-aa-e5-bf-83-e7-90-86-e5-ad-a6-e8-af-b4-e4-b8-8d-check>
<label for=m-docs-91-e8-af-bb-e4-b9-a6-e7-ac-94-e8-ae-b0-e5-af-b9-e4-bc-aa-e5-bf-83-e7-90-86-e5-ad-a6-e8-af-b4-e4-b8-8d-check><a href=/docs/91.%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E5%AF%B9%E4%BC%AA%E5%BF%83%E7%90%86%E5%AD%A6%E8%AF%B4%E4%B8%8D/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-91-e8-af-bb-e4-b9-a6-e7-ac-94-e8-ae-b0-e5-af-b9-e4-bc-aa-e5-bf-83-e7-90-86-e5-ad-a6-e8-af-b4-e4-b8-8d><span>对伪心理学说不</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docs-99-e7-94-9f-e6-b4-bb-e5-b8-b8-e8-af-86-li><input type=checkbox id=m-docs-99-e7-94-9f-e6-b4-bb-e5-b8-b8-e8-af-86-check>
<label for=m-docs-99-e7-94-9f-e6-b4-bb-e5-b8-b8-e8-af-86-check><a href=/docs/99.%E7%94%9F%E6%B4%BB%E5%B8%B8%E8%AF%86/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docs-99-e7-94-9f-e6-b4-bb-e5-b8-b8-e8-af-86><span>生活常识</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docs-99-e7-94-9f-e6-b4-bb-e5-b8-b8-e8-af-86-e6-80-a5-e6-95-91-e7-9f-a5-e8-af-86-li><input type=checkbox id=m-docs-99-e7-94-9f-e6-b4-bb-e5-b8-b8-e8-af-86-e6-80-a5-e6-95-91-e7-9f-a5-e8-af-86-check>
<label for=m-docs-99-e7-94-9f-e6-b4-bb-e5-b8-b8-e8-af-86-e6-80-a5-e6-95-91-e7-9f-a5-e8-af-86-check><a href=/docs/99.%E7%94%9F%E6%B4%BB%E5%B8%B8%E8%AF%86/%E6%80%A5%E6%95%91%E7%9F%A5%E8%AF%86/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docs-99-e7-94-9f-e6-b4-bb-e5-b8-b8-e8-af-86-e6-80-a5-e6-95-91-e7-9f-a5-e8-af-86><span>急救知识</span></a></label></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/chnherb/chnherb.github.io/tree/master/content/zh-cn/docs/41.%e5%88%86%e5%b8%83%e5%bc%8f/Raft-02.raftexample%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90.md class=td-page-meta--view target=_blank rel=noopener><i class="fa fa-file-alt fa-fw"></i> 查看页面源码</a>
<a href=https://github.com/chnherb/chnherb.github.io/edit/master/content/zh-cn/docs/41.%e5%88%86%e5%b8%83%e5%bc%8f/Raft-02.raftexample%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90.md class=td-page-meta--edit target=_blank rel=noopener><i class="fa fa-edit fa-fw"></i> 编辑此页</a>
<a href="https://github.com/chnherb/chnherb.github.io/new/master/content/zh-cn/docs/41.%e5%88%86%e5%b8%83%e5%bc%8f/Raft-02.raftexample%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class=td-page-meta--child target=_blank rel=noopener><i class="fa fa-edit fa-fw"></i> 添加子页面</a>
<a href="https://github.com/chnherb/chnherb.github.io/issues/new?title=Raft-02.raftexample%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90" class=td-page-meta--issue target=_blank rel=noopener><i class="fab fa-github fa-fw"></i> 提交文档问题</a>
<a href=https://github.com/chnherb/chnherb.github.io/issues/new class=td-page-meta--project-issue target=_blank rel=noopener><i class="fas fa-tasks fa-fw"></i> 提交项目问题</a>
<a id=print href=/docs/41.%E5%88%86%E5%B8%83%E5%BC%8F/_print/><i class="fa fa-print fa-fw"></i> 整节打印</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#基本概念>基本概念</a></li><li><a href=#raftexample>raftexample</a><ul><li><a href=#简介>简介</a></li><li><a href=#总体架构图>总体架构图</a></li><li><a href=#启动>启动</a></li><li><a href=#newraftnode>newRaftNode</a></li><li><a href=#startraft>startRaft</a></li><li><a href=#servechannels>serveChannels</a></li></ul></li><li><a href=#领导者选举>领导者选举</a><ul><li><a href=#启动节点>启动节点</a></li><li><a href=#发送心跳包>发送心跳包</a><ul><li><a href=#leader>Leader</a></li><li><a href=#follower>Follower</a></li><li><a href=#candidate>Candidate</a></li></ul></li><li><a href=#leader-选举>Leader 选举</a><ul><li><a href=#接收心跳>接收心跳</a></li><li><a href=#发起竞选>发起竞选</a></li><li><a href=#接受消息并投票>接受消息并投票</a></li><li><a href=#candidate-统计投票>Candidate 统计投票</a></li></ul></li></ul></li><li><a href=#日志同步>日志同步</a><ul><li><a href=#wal-日志>WAL 日志</a></li><li><a href=#同步日志>同步日志</a></li></ul></li><li><a href=#实战>实战</a><ul><li><a href=#api-设计>API 设计</a></li><li><a href=#复制状态机>复制状态机</a></li><li><a href=#多存储引擎>多存储引擎</a><ul><li><a href=#boltdb>boltdb</a></li><li><a href=#leveldb>leveldb</a></li></ul></li><li><a href=#读写流程>读写流程</a></li></ul></li><li><a href=#总结>总结</a></li><li><a href=#reference>Reference</a></li></ul></nav></div><div class="taxonomy taxonomy-terms-cloud taxo-tags"><h5 class=taxonomy-title>Tag Cloud</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=/tags/AED/ data-taxonomy-term=AED><span class=taxonomy-label>AED</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/CPR/ data-taxonomy-term=CPR><span class=taxonomy-label>CPR</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/Docker/ data-taxonomy-term=Docker><span class=taxonomy-label>Docker</span><span class=taxonomy-count>4</span></a></li><li><a class=taxonomy-term href=/tags/ES/ data-taxonomy-term=ES><span class=taxonomy-label>ES</span><span class=taxonomy-count>5</span></a></li><li><a class=taxonomy-term href=/tags/Hbase/ data-taxonomy-term=Hbase><span class=taxonomy-label>Hbase</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/IO%E6%A8%A1%E5%9E%8B/ data-taxonomy-term=IO%E6%A8%A1%E5%9E%8B><span class=taxonomy-label>IO模型</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/JVM/ data-taxonomy-term=JVM><span class=taxonomy-label>JVM</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/Kafka/ data-taxonomy-term=Kafka><span class=taxonomy-label>Kafka</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/LSM/ data-taxonomy-term=LSM><span class=taxonomy-label>LSM</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/LevelDB/ data-taxonomy-term=LevelDB><span class=taxonomy-label>LevelDB</span><span class=taxonomy-count>7</span></a></li><li><a class=taxonomy-term href=/tags/Log4j2/ data-taxonomy-term=Log4j2><span class=taxonomy-label>Log4j2</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/MySQL/ data-taxonomy-term=MySQL><span class=taxonomy-label>MySQL</span><span class=taxonomy-count>9</span></a></li><li><a class=taxonomy-term href=/tags/Mybatis/ data-taxonomy-term=Mybatis><span class=taxonomy-label>Mybatis</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/Netty/ data-taxonomy-term=Netty><span class=taxonomy-label>Netty</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/OAuth2/ data-taxonomy-term=OAuth2><span class=taxonomy-label>OAuth2</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/PostgreSQL/ data-taxonomy-term=PostgreSQL><span class=taxonomy-label>PostgreSQL</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/QUIC/ data-taxonomy-term=QUIC><span class=taxonomy-label>QUIC</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/RocketMQ/ data-taxonomy-term=RocketMQ><span class=taxonomy-label>RocketMQ</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/SPDY/ data-taxonomy-term=SPDY><span class=taxonomy-label>SPDY</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/SQL-Join/ data-taxonomy-term=SQL-Join><span class=taxonomy-label>SQL Join</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/SQL-engine/ data-taxonomy-term=SQL-engine><span class=taxonomy-label>SQL engine</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/SQL-parser/ data-taxonomy-term=SQL-parser><span class=taxonomy-label>SQL parser</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=/tags/Shebang/ data-taxonomy-term=Shebang><span class=taxonomy-label>Shebang</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/Skywalking/ data-taxonomy-term=Skywalking><span class=taxonomy-label>Skywalking</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=/tags/Solr/ data-taxonomy-term=Solr><span class=taxonomy-label>Solr</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/Spring/ data-taxonomy-term=Spring><span class=taxonomy-label>Spring</span><span class=taxonomy-count>7</span></a></li><li><a class=taxonomy-term href=/tags/SpringBoot/ data-taxonomy-term=SpringBoot><span class=taxonomy-label>SpringBoot</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/SpringMVC/ data-taxonomy-term=SpringMVC><span class=taxonomy-label>SpringMVC</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/annotation/ data-taxonomy-term=annotation><span class=taxonomy-label>annotation</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/architecture/ data-taxonomy-term=architecture><span class=taxonomy-label>architecture</span><span class=taxonomy-count>6</span></a></li><li><a class=taxonomy-term href=/tags/awk/ data-taxonomy-term=awk><span class=taxonomy-label>awk</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/bean/ data-taxonomy-term=bean><span class=taxonomy-label>bean</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/bytecode/ data-taxonomy-term=bytecode><span class=taxonomy-label>bytecode</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/concurrent/ data-taxonomy-term=concurrent><span class=taxonomy-label>concurrent</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=/tags/cron/ data-taxonomy-term=cron><span class=taxonomy-label>cron</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/curl/ data-taxonomy-term=curl><span class=taxonomy-label>curl</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/daemon/ data-taxonomy-term=daemon><span class=taxonomy-label>daemon</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/distributed/ data-taxonomy-term=distributed><span class=taxonomy-label>distributed</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=/tags/fastjson/ data-taxonomy-term=fastjson><span class=taxonomy-label>fastjson</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/find/ data-taxonomy-term=find><span class=taxonomy-label>find</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/gitbook/ data-taxonomy-term=gitbook><span class=taxonomy-label>gitbook</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/github/ data-taxonomy-term=github><span class=taxonomy-label>github</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/goreman/ data-taxonomy-term=goreman><span class=taxonomy-label>goreman</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/grep/ data-taxonomy-term=grep><span class=taxonomy-label>grep</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/hdfs/ data-taxonomy-term=hdfs><span class=taxonomy-label>hdfs</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=/tags/http/ data-taxonomy-term=http><span class=taxonomy-label>http</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/hugo/ data-taxonomy-term=hugo><span class=taxonomy-label>hugo</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/ipvs/ data-taxonomy-term=ipvs><span class=taxonomy-label>ipvs</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/json/ data-taxonomy-term=json><span class=taxonomy-label>json</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/JVM/ data-taxonomy-term=JVM><span class=taxonomy-label>JVM</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/k8s/ data-taxonomy-term=k8s><span class=taxonomy-label>k8s</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=/tags/lock/ data-taxonomy-term=lock><span class=taxonomy-label>lock</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/log/ data-taxonomy-term=log><span class=taxonomy-label>log</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/lombok/ data-taxonomy-term=lombok><span class=taxonomy-label>lombok</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/lvs/ data-taxonomy-term=lvs><span class=taxonomy-label>lvs</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/mod/ data-taxonomy-term=mod><span class=taxonomy-label>mod</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/process/ data-taxonomy-term=process><span class=taxonomy-label>process</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/protocol/ data-taxonomy-term=protocol><span class=taxonomy-label>protocol</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/pydemo/ data-taxonomy-term=pydemo><span class=taxonomy-label>pydemo</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/raft/ data-taxonomy-term=raft><span class=taxonomy-label>raft</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=/tags/sed/ data-taxonomy-term=sed><span class=taxonomy-label>sed</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/selenium/ data-taxonomy-term=selenium><span class=taxonomy-label>selenium</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/shell/ data-taxonomy-term=shell><span class=taxonomy-label>shell</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/socat/ data-taxonomy-term=socat><span class=taxonomy-label>socat</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/ssh/ data-taxonomy-term=ssh><span class=taxonomy-label>ssh</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/supervisor/ data-taxonomy-term=supervisor><span class=taxonomy-label>supervisor</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/systemd/ data-taxonomy-term=systemd><span class=taxonomy-label>systemd</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/util/ data-taxonomy-term=util><span class=taxonomy-label>util</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/util-cli/ data-taxonomy-term=util-cli><span class=taxonomy-label>util-cli</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/web/ data-taxonomy-term=web><span class=taxonomy-label>web</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/wget/ data-taxonomy-term=wget><span class=taxonomy-label>wget</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/zookeeper/ data-taxonomy-term=zookeeper><span class=taxonomy-label>zookeeper</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=/tags/%E5%90%8E%E5%8F%B0%E8%BF%9B%E7%A8%8B/ data-taxonomy-term=%E5%90%8E%E5%8F%B0%E8%BF%9B%E7%A8%8B><span class=taxonomy-label>后台进程</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/%E5%9B%BE/ data-taxonomy-term=%E5%9B%BE><span class=taxonomy-label>图</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=/tags/%E5%BF%AB%E6%8D%B7%E9%94%AE/ data-taxonomy-term=%E5%BF%AB%E6%8D%B7%E9%94%AE><span class=taxonomy-label>快捷键</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/ data-taxonomy-term=%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84><span class=taxonomy-label>数据结构</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=/tags/%E7%AE%97%E6%B3%95/ data-taxonomy-term=%E7%AE%97%E6%B3%95><span class=taxonomy-label>算法</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=/tags/%E7%BA%A2%E9%BB%91%E6%A0%91/ data-taxonomy-term=%E7%BA%A2%E9%BB%91%E6%A0%91><span class=taxonomy-label>红黑树</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/%E8%B7%B3%E8%A1%A8/ data-taxonomy-term=%E8%B7%B3%E8%A1%A8><span class=taxonomy-label>跳表</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/%E9%9B%AA%E8%8A%B1%E7%AE%97%E6%B3%95/ data-taxonomy-term=%E9%9B%AA%E8%8A%B1%E7%AE%97%E6%B3%95><span class=taxonomy-label>雪花算法</span><span class=taxonomy-count>1</span></a></li></ul></div><div class="taxonomy taxonomy-terms-cloud taxo-categories"><h5 class=taxonomy-title>Categories</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=/categories/APM/ data-taxonomy-term=APM><span class=taxonomy-label>APM</span><span class=taxonomy-count>4</span></a></li><li><a class=taxonomy-term href=/categories/bigdata/ data-taxonomy-term=bigdata><span class=taxonomy-label>bigdata</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=/categories/Ceph/ data-taxonomy-term=Ceph><span class=taxonomy-label>Ceph</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/categories/ClickHouse/ data-taxonomy-term=ClickHouse><span class=taxonomy-label>ClickHouse</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/categories/Container/ data-taxonomy-term=Container><span class=taxonomy-label>Container</span><span class=taxonomy-count>7</span></a></li><li><a class=taxonomy-term href=/categories/Cpp/ data-taxonomy-term=Cpp><span class=taxonomy-label>Cpp</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/categories/DB/ data-taxonomy-term=DB><span class=taxonomy-label>DB</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/categories/ES/ data-taxonomy-term=ES><span class=taxonomy-label>ES</span><span class=taxonomy-count>10</span></a></li><li><a class=taxonomy-term href=/categories/Goland/ data-taxonomy-term=Goland><span class=taxonomy-label>Goland</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/categories/Golang/ data-taxonomy-term=Golang><span class=taxonomy-label>Golang</span><span class=taxonomy-count>5</span></a></li><li><a class=taxonomy-term href=/categories/IO/ data-taxonomy-term=IO><span class=taxonomy-label>IO</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=/categories/Java/ data-taxonomy-term=Java><span class=taxonomy-label>Java</span><span class=taxonomy-count>16</span></a></li><li><a class=taxonomy-term href=/categories/JavaExtension/ data-taxonomy-term=JavaExtension><span class=taxonomy-label>JavaExtension</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=/categories/MQ/ data-taxonomy-term=MQ><span class=taxonomy-label>MQ</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=/categories/MySQL/ data-taxonomy-term=MySQL><span class=taxonomy-label>MySQL</span><span class=taxonomy-count>9</span></a></li><li><a class=taxonomy-term href=/categories/Netty/ data-taxonomy-term=Netty><span class=taxonomy-label>Netty</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/categories/Python/ data-taxonomy-term=Python><span class=taxonomy-label>Python</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=/categories/RPC/ data-taxonomy-term=RPC><span class=taxonomy-label>RPC</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=/categories/Redis/ data-taxonomy-term=Redis><span class=taxonomy-label>Redis</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=/categories/SQL-engine/ data-taxonomy-term=SQL-engine><span class=taxonomy-label>SQL engine</span><span class=taxonomy-count>4</span></a></li><li><a class=taxonomy-term href=/categories/Spark/ data-taxonomy-term=Spark><span class=taxonomy-label>Spark</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/categories/TiDB/ data-taxonomy-term=TiDB><span class=taxonomy-label>TiDB</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=/categories/auth/ data-taxonomy-term=auth><span class=taxonomy-label>auth</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/categories/bigdata/ data-taxonomy-term=bigdata><span class=taxonomy-label>bigdata</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=/categories/common/ data-taxonomy-term=common><span class=taxonomy-label>common</span><span class=taxonomy-count>7</span></a></li><li><a class=taxonomy-term href=/categories/Cpp/ data-taxonomy-term=Cpp><span class=taxonomy-label>Cpp</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/categories/DB/ data-taxonomy-term=DB><span class=taxonomy-label>DB</span><span class=taxonomy-count>8</span></a></li><li><a class=taxonomy-term href=/categories/distributed/ data-taxonomy-term=distributed><span class=taxonomy-label>distributed</span><span class=taxonomy-count>9</span></a></li><li><a class=taxonomy-term href=/categories/file-sys/ data-taxonomy-term=file-sys><span class=taxonomy-label>file sys</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/categories/full-text-search/ data-taxonomy-term=full-text-search><span class=taxonomy-label>full-text search</span><span class=taxonomy-count>5</span></a></li><li><a class=taxonomy-term href=/categories/github/ data-taxonomy-term=github><span class=taxonomy-label>github</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/categories/http/ data-taxonomy-term=http><span class=taxonomy-label>http</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/categories/jvm/ data-taxonomy-term=jvm><span class=taxonomy-label>jvm</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/categories/linux/ data-taxonomy-term=linux><span class=taxonomy-label>linux</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=/categories/os/ data-taxonomy-term=os><span class=taxonomy-label>os</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/categories/port-forward/ data-taxonomy-term=port-forward><span class=taxonomy-label>port forward</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/categories/process/ data-taxonomy-term=process><span class=taxonomy-label>process</span><span class=taxonomy-count>7</span></a></li><li><a class=taxonomy-term href=/categories/protocol/ data-taxonomy-term=protocol><span class=taxonomy-label>protocol</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/categories/safe/ data-taxonomy-term=safe><span class=taxonomy-label>safe</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=/categories/shell/ data-taxonomy-term=shell><span class=taxonomy-label>shell</span><span class=taxonomy-count>7</span></a></li><li><a class=taxonomy-term href=/categories/springboot/ data-taxonomy-term=springboot><span class=taxonomy-label>springboot</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=/categories/util/ data-taxonomy-term=util><span class=taxonomy-label>util</span><span class=taxonomy-count>4</span></a></li><li><a class=taxonomy-term href=/categories/%E5%9B%BE/ data-taxonomy-term=%E5%9B%BE><span class=taxonomy-label>图</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=/categories/%E6%80%A5%E6%95%91%E7%9F%A5%E8%AF%86/ data-taxonomy-term=%E6%80%A5%E6%95%91%E7%9F%A5%E8%AF%86><span class=taxonomy-label>急救知识</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/ data-taxonomy-term=%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84><span class=taxonomy-label>数据结构</span><span class=taxonomy-count>5</span></a></li><li><a class=taxonomy-term href=/categories/%E7%AE%97%E6%B3%95/ data-taxonomy-term=%E7%AE%97%E6%B3%95><span class=taxonomy-label>算法</span><span class=taxonomy-count>3</span></a></li></ul></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/docs/>Documentation</a></li><li class=breadcrumb-item><a href=/docs/41.%E5%88%86%E5%B8%83%E5%BC%8F/>分布式</a></li><li class="breadcrumb-item active" aria-current=page><a href=/docs/41.%E5%88%86%E5%B8%83%E5%BC%8F/Raft-02.raftexample%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/>Raft-02.raftexample源码分析</a></li></ol></nav><div class=td-content><h1>Raft-02.raftexample源码分析</h1><header class=article-meta><div class="taxonomy taxonomy-terms-article taxo-tags"><h5 class=taxonomy-title>Tags:</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=/tags/raft/ data-taxonomy-term=raft><span class=taxonomy-label>raft</span></a></li></ul></div><div class="taxonomy taxonomy-terms-article taxo-categories"><h5 class=taxonomy-title>Categories:</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=/categories/distributed/ data-taxonomy-term=distributed><span class=taxonomy-label>distributed</span></a></li></ul></div></header><h1 id=前言>前言</h1><p>本文源码分析代码参考 etcd v3.5.0 中 raft 代码：</p><p><a href=https://github.com/etcd-io/etcd/tree/v3.5.0/contrib/raftexample>https://github.com/etcd-io/etcd/tree/v3.5.0/contrib/raftexample</a></p><p>Etcd 将 raft 协议实现为一个 library，然后本身作为一个应用使用它。此外，etcd 还提供了一个叫 raftexample 的示例程序。</p><p>在 etcd 中，raft 作为底层的共识模块，运行在一个 goroutine 里，通过 channel 接受上层（etcdserver）的消息，并将处理结果通过另一个 channel 返回给上层应用，交互过程大致如下：</p><p><img src=../imgs/raft_sourcecode20220904_1.png alt=raft_sourcecode20220904_1.png></p><p>这种全异步地交互方式好处是提高了性能，坏处是难以测试，增加代码阅读难度。</p><h1 id=基本概念>基本概念</h1><p>源码中定义的一些变量概念</p><ul><li><p>Node: 对 etcd-raft 模块具体实现的一层封装，方便上层模块使用 etcd-raft 模块；</p></li><li><p>上层模块: etcd-raft 的调用者，上层模块通过Node提供的API与底层的 etcd-raft 模块进行交互；</p></li><li><p>Cluster: 表示一个集群,其中记录了该集群的基础信息；</p></li><li><p>Member: 组层Cluster的元素之一，其中封装了一个节点的基本信息；</p></li><li><p>Peer: 集群中某个节点对集群中另一个节点的称呼；</p></li><li><p>Entry记录: 节点之间的传递是通过 message 进行的，每条消息中可以携带多条 Entry 记录,每条Entry对应一条一个独立的操作<style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>Entry</span> <span style=color:#a90d91>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#177500>// Term：表示该Entry所在的任期。
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#000>Term</span>  <span style=color:#a90d91>uint64</span>    <span style=color:#c41a16>`protobuf:&#34;varint,2,opt,name=Term&#34; json:&#34;Term&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#177500>// Index:当前这个entry在整个raft日志中的位置索引,有了Term和Index之后，一个`log entry`就能被唯一标识。  
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#000>Index</span> <span style=color:#a90d91>uint64</span>    <span style=color:#c41a16>`protobuf:&#34;varint,3,opt,name=Index&#34; json:&#34;Index&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#177500>// 当前entry的类型
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#177500>// 目前etcd支持两种类型：EntryNormal和EntryConfChange 
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#177500>// EntryNormaln表示普通的数据操作
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#177500>// EntryConfChange表示集群的变更操作
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#000>Type</span>  <span style=color:#000>EntryType</span> <span style=color:#c41a16>`protobuf:&#34;varint,1,opt,name=Type,enum=raftpb.EntryType&#34; json:&#34;Type&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#177500>// 序列化后的具体操作数据
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#000>Data</span>  []<span style=color:#a90d91>byte</span>    <span style=color:#c41a16>`protobuf:&#34;bytes,4,opt,name=Data&#34; json:&#34;Data,omitempty&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div></p></li><li><p>Message: 是所有消息的抽象，包括各种消息所需要的字段，raft集群中各个节点之前的通讯都是通过这个message进行的。<style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>Message</span> <span style=color:#a90d91>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#177500>// 该字段定义了不同的消息类型，etcd-raft就是通过不同的消息类型来进行处理的，etcd中一共定义了19种类型
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#000>Type</span> <span style=color:#000>MessageType</span> <span style=color:#c41a16>`protobuf:&#34;varint,1,opt,name=type,enum=raftpb.MessageType&#34; json:&#34;type&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#177500>// 消息的目标节点 ID，在急群中每个节点都有一个唯一的id作为标识
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#000>To</span>   <span style=color:#a90d91>uint64</span>      <span style=color:#c41a16>`protobuf:&#34;varint,2,opt,name=to&#34; json:&#34;to&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#177500>// 发送消息的节点ID
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#000>From</span> <span style=color:#a90d91>uint64</span>      <span style=color:#c41a16>`protobuf:&#34;varint,3,opt,name=from&#34; json:&#34;from&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#177500>// 整个消息发出去时，所处的任期
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#000>Term</span> <span style=color:#a90d91>uint64</span>      <span style=color:#c41a16>`protobuf:&#34;varint,4,opt,name=term&#34; json:&#34;term&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#177500>// 该消息携带的第一条Entry记录的的Term值
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#000>LogTerm</span>    <span style=color:#a90d91>uint64</span>   <span style=color:#c41a16>`protobuf:&#34;varint,5,opt,name=logTerm&#34; json:&#34;logTerm&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#177500>// 索引值，该索引值和消息的类型有关,不同的消息类型代表的含义不同
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#000>Index</span>      <span style=color:#a90d91>uint64</span>   <span style=color:#c41a16>`protobuf:&#34;varint,6,opt,name=index&#34; json:&#34;index&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#177500>// 需要存储的日志信息
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#000>Entries</span>    []<span style=color:#000>Entry</span>  <span style=color:#c41a16>`protobuf:&#34;bytes,7,rep,name=entries&#34; json:&#34;entries&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#177500>// 已经提交的日志的索引值，用来向别人同步日志的提交信息。
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#000>Commit</span>     <span style=color:#a90d91>uint64</span>   <span style=color:#c41a16>`protobuf:&#34;varint,8,opt,name=commit&#34; json:&#34;commit&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#177500>// 在传输快照时，该字段保存了快照数据
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#000>Snapshot</span>   <span style=color:#000>Snapshot</span> <span style=color:#c41a16>`protobuf:&#34;bytes,9,opt,name=snapshot&#34; json:&#34;snapshot&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#177500>// 主要用于响应类型的消息，表示是否拒绝收到的消息。  
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#000>Reject</span>     <span style=color:#a90d91>bool</span>     <span style=color:#c41a16>`protobuf:&#34;varint,10,opt,name=reject&#34; json:&#34;reject&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#177500>// Follower 节点拒绝 eader 节点的消息之后，会在该字段记录 一个Entry索引值供Leader节点。
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#000>RejectHint</span> <span style=color:#a90d91>uint64</span>   <span style=color:#c41a16>`protobuf:&#34;varint,11,opt,name=rejectHint&#34; json:&#34;rejectHint&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#177500>// 携带的一些上下文的信息
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#000>Context</span>    []<span style=color:#a90d91>byte</span>   <span style=color:#c41a16>`protobuf:&#34;bytes,12,opt,name=context&#34; json:&#34;context,omitempty&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br></p></li><li><p>raftLog: Raft中日志同步的核心就是集群中leader如何同步日志到各个follower。日志的管理是在raftLog结构上完成的。<style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>raftLog</span> <span style=color:#a90d91>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#177500>// 用于保存自从最后一次snapshot之后提交的数据
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#000>storage</span> <span style=color:#000>Storage</span>
</span></span><span style=display:flex><span>	<span style=color:#177500>// 用于保存还没有持久化的数据和快照，这些数据最终都会保存到storage中
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#000>unstable</span> <span style=color:#000>unstable</span>
</span></span><span style=display:flex><span>	<span style=color:#177500>// 当天提交的日志数据索引
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#000>committed</span> <span style=color:#a90d91>uint64</span>
</span></span><span style=display:flex><span>	<span style=color:#177500>// committed保存是写入持久化存储中的最高index，而applied保存的是传入状态机中的最高index
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#177500>// 即一条日志首先要提交成功（即committed），才能被applied到状态机中
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#177500>// 因此以下不等式一直成立：applied &lt;= committed
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#000>applied</span> <span style=color:#a90d91>uint64</span>
</span></span><span style=display:flex><span>	<span style=color:#000>logger</span> <span style=color:#000>Logger</span>
</span></span><span style=display:flex><span>	<span style=color:#177500>// 调用 nextEnts 时，返回的日志项集合的最大的大小
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#177500>// nextEnts 函数返回应用程序已经可以应用到状态机的日志项集合
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#000>maxNextEntsSize</span> <span style=color:#a90d91>uint64</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div></p></li></ul><h1 id=raftexample>raftexample</h1><h2 id=简介>简介</h2><p>raftexample 是一个 etcd raft library 的使用示例。它为Raft一致性算法的键值对集群存储提供了一个简单的 REST API。</p><h2 id=总体架构图>总体架构图</h2><p><img src=../imgs/raft_sourcecode20220904_2.png alt=raft_sourcecode20220904_2.png></p><h2 id=启动>启动</h2><p>该包提供了goreman启动集群的方式，按照 README 使用 goreman start 启动，可以很清楚的看到 raft 在启动过程中的选举过程，能够很好的帮助理解 raft 的选举过程。</p><p>程序入口：</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>contrib</span><span style=color:#000>/</span><span style=color:#000>raftexample</span><span style=color:#000>/</span><span style=color:#000>main</span>.<span style=color:#a90d91>go</span>:<span style=color:#1c01ce>24</span>
</span></span></code></pre></td></tr></table></div></div></div><p>下面介绍主要的函数</p><h2 id=newraftnode>newRaftNode</h2><p>在该函数中主要完成了 raftNode 的初始化 。在该方法中会使用上层模块传入的配置信息（其中包括 proposeC 通道和 confChangeC 通道）来创建raftNode实例，同时会创建 commitC 通道和 errorC 通道返回给上层模块使用 。这样上层模块就可以通过这几个通道与 rafeNode 实例进行交互。另外，newRaftNode() 函数中还会启动一个独立的后台 goroutine 来完成回放 WAL 日志、 启动网络组件等初始化操作。</p><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#177500>// contrib/raftexample/raft.go:87
</span></span></span><span style=display:flex><span><span style=color:#177500>// raftNode 初始化
</span></span></span><span style=display:flex><span><span style=color:#177500>// 使用上层模块传入的配置信息来创建 raftNode 实例，
</span></span></span><span style=display:flex><span><span style=color:#177500>// 同时创建 commitC 通道和 errorC 通道返回给上层模块使用
</span></span></span><span style=display:flex><span><span style=color:#177500>// 上层应用通过这几个 channel 就能和 raftNode 进行交互
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>func</span> <span style=color:#000>newRaftNode</span>(<span style=color:#000>id</span> <span style=color:#a90d91>int</span>, <span style=color:#000>peers</span> []<span style=color:#a90d91>string</span>, <span style=color:#000>join</span> <span style=color:#a90d91>bool</span>, <span style=color:#000>getSnapshot</span> <span style=color:#a90d91>func</span>() ([]<span style=color:#a90d91>byte</span>, <span style=color:#a90d91>error</span>), <span style=color:#000>proposeC</span> <span style=color:#000>&lt;-</span><span style=color:#a90d91>chan</span> <span style=color:#a90d91>string</span>,
</span></span><span style=display:flex><span>   <span style=color:#000>confChangeC</span> <span style=color:#000>&lt;-</span><span style=color:#a90d91>chan</span> <span style=color:#000>raftpb</span>.<span style=color:#000>ConfChange</span>) (<span style=color:#000>&lt;-</span><span style=color:#a90d91>chan</span> <span style=color:#000>*</span><span style=color:#000>commit</span>, <span style=color:#000>&lt;-</span><span style=color:#a90d91>chan</span> <span style=color:#a90d91>error</span>, <span style=color:#000>&lt;-</span><span style=color:#a90d91>chan</span> <span style=color:#000>*</span><span style=color:#000>snap</span>.<span style=color:#000>Snapshotter</span>) {
</span></span><span style=display:flex><span>   <span style=color:#177500>// channel，主要传输 Entry 记录
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#177500>// raftNode 会将 etcd-raft 模块返回的待应用 Entry 记录（封装在Ready实例中〉写入commitC通道，
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#177500>// 另一方面，kvstore 会从 commitC 通道中读取这些待应用的 Entry 记录井保存其中的键值对信息。
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>commitC</span> <span style=color:#000>:=</span> <span style=color:#a90d91>make</span>(<span style=color:#a90d91>chan</span> <span style=color:#000>*</span><span style=color:#000>commit</span>)
</span></span><span style=display:flex><span>   <span style=color:#000>errorC</span> <span style=color:#000>:=</span> <span style=color:#a90d91>make</span>(<span style=color:#a90d91>chan</span> <span style=color:#a90d91>error</span>)
</span></span><span style=display:flex><span>   <span style=color:#000>rc</span> <span style=color:#000>:=</span> <span style=color:#000>&amp;</span><span style=color:#000>raftNode</span>{
</span></span><span style=display:flex><span>      <span style=color:#000>proposeC</span>:    <span style=color:#000>proposeC</span>,
</span></span><span style=display:flex><span>      <span style=color:#000>confChangeC</span>: <span style=color:#000>confChangeC</span>,
</span></span><span style=display:flex><span>      <span style=color:#000>commitC</span>:     <span style=color:#000>commitC</span>,
</span></span><span style=display:flex><span>      <span style=color:#000>errorC</span>:      <span style=color:#000>errorC</span>,
</span></span><span style=display:flex><span>      <span style=color:#000>id</span>:          <span style=color:#000>id</span>,
</span></span><span style=display:flex><span>      <span style=color:#000>peers</span>:       <span style=color:#000>peers</span>,
</span></span><span style=display:flex><span>      <span style=color:#000>join</span>:        <span style=color:#000>join</span>,
</span></span><span style=display:flex><span>      <span style=color:#177500>// 初始化存放 WAL 日志和 Snapshot 文件的的目录
</span></span></span><span style=display:flex><span><span style=color:#177500></span>      <span style=color:#000>waldir</span>:      <span style=color:#000>fmt</span>.<span style=color:#000>Sprintf</span>(<span style=color:#c41a16>&#34;raftexample-%d&#34;</span>, <span style=color:#000>id</span>),
</span></span><span style=display:flex><span>      <span style=color:#000>snapdir</span>:     <span style=color:#000>fmt</span>.<span style=color:#000>Sprintf</span>(<span style=color:#c41a16>&#34;raftexample-%d-snap&#34;</span>, <span style=color:#000>id</span>),
</span></span><span style=display:flex><span>      <span style=color:#000>getSnapshot</span>: <span style=color:#000>getSnapshot</span>,
</span></span><span style=display:flex><span>      <span style=color:#000>snapCount</span>:   <span style=color:#000>defaultSnapshotCount</span>,
</span></span><span style=display:flex><span>      <span style=color:#000>stopc</span>:       <span style=color:#a90d91>make</span>(<span style=color:#a90d91>chan</span> <span style=color:#a90d91>struct</span>{}),
</span></span><span style=display:flex><span>      <span style=color:#000>httpstopc</span>:   <span style=color:#a90d91>make</span>(<span style=color:#a90d91>chan</span> <span style=color:#a90d91>struct</span>{}),
</span></span><span style=display:flex><span>      <span style=color:#000>httpdonec</span>:   <span style=color:#a90d91>make</span>(<span style=color:#a90d91>chan</span> <span style=color:#a90d91>struct</span>{}),
</span></span><span style=display:flex><span>      <span style=color:#000>logger</span>: <span style=color:#000>zap</span>.<span style=color:#000>NewExample</span>(),
</span></span><span style=display:flex><span>      <span style=color:#000>snapshotterReady</span>: <span style=color:#a90d91>make</span>(<span style=color:#a90d91>chan</span> <span style=color:#000>*</span><span style=color:#000>snap</span>.<span style=color:#000>Snapshotter</span>, <span style=color:#1c01ce>1</span>),
</span></span><span style=display:flex><span>      <span style=color:#177500>// rest of structure populated after WAL replay
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   }
</span></span><span style=display:flex><span>   <span style=color:#177500>// 启动一个goroutine，完成剩余的初始化工作
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#a90d91>go</span> <span style=color:#000>rc</span>.<span style=color:#000>startRaft</span>()
</span></span><span style=display:flex><span>   <span style=color:#a90d91>return</span> <span style=color:#000>commitC</span>, <span style=color:#000>errorC</span>, <span style=color:#000>rc</span>.<span style=color:#000>snapshotterReady</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br><h2 id=startraft>startRaft</h2><ol><li>创建 Snapshotter，并将该 Snapshotter 实例返回给上层模块；</li><li>创建 WAL 实例，然后加载快照并回放 WAL 日志；</li><li>创建 raft.Config 实例，其中包含了启动 etcd-raft 模块的所有配置；</li><li>初始化底层 etcd-raft 模块，得到 node 实例；</li><li>创建 Transport 实例，该实例负责集群中各个节点之间的网络通信，其具体实现在 raft-http 包中；</li><li>建立与集群中其他节点的网络连接；</li><li>启动网络组件，其中会监听当前节点与集群中其他节点之间的网络连接，并进行节点之间的消息读写；</li><li>启动两个后台的 goroutine，它们主要工作是处理上层模块与底层 etcd-raft 模块的交互，但处理的具体内容不同，后面会详细介绍这两个 goroutine 的处理流程。</li></ol><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>func</span> (<span style=color:#000>rc</span> <span style=color:#000>*</span><span style=color:#000>raftNode</span>) <span style=color:#000>startRaft</span>() {
</span></span><span style=display:flex><span>   <span style=color:#a90d91>if</span> !<span style=color:#000>fileutil</span>.<span style=color:#000>Exist</span>(<span style=color:#000>rc</span>.<span style=color:#000>snapdir</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a90d91>if</span> <span style=color:#000>err</span> <span style=color:#000>:=</span> <span style=color:#000>os</span>.<span style=color:#000>Mkdir</span>(<span style=color:#000>rc</span>.<span style=color:#000>snapdir</span>, <span style=color:#1c01ce>0750</span>); <span style=color:#000>err</span> <span style=color:#000>!=</span> <span style=color:#a90d91>nil</span> {
</span></span><span style=display:flex><span>         <span style=color:#000>log</span>.<span style=color:#000>Fatalf</span>(<span style=color:#c41a16>&#34;raftexample: cannot create dir for snapshot (%v)&#34;</span>, <span style=color:#000>err</span>)
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#000>rc</span>.<span style=color:#000>snapshotter</span> = <span style=color:#000>snap</span>.<span style=color:#000>New</span>(<span style=color:#000>zap</span>.<span style=color:#000>NewExample</span>(), <span style=color:#000>rc</span>.<span style=color:#000>snapdir</span>)
</span></span><span style=display:flex><span>   <span style=color:#177500>// 创建 WAL 实例，然后加载快照并回放 WAL 日志
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>oldwal</span> <span style=color:#000>:=</span> <span style=color:#000>wal</span>.<span style=color:#000>Exist</span>(<span style=color:#000>rc</span>.<span style=color:#000>waldir</span>)
</span></span><span style=display:flex><span>   <span style=color:#177500>// replayWAL() 方法首先会读取快照数据，
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#177500>// 在快照数据中记录了该快照包含的最后一条 Entry 记录的 Term 值 和 索引值。
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#177500>// 然后根据 Term 值 和 索引值确定读取 WAL 日志文件的位置，读取日志记录。
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>rc</span>.<span style=color:#000>wal</span> = <span style=color:#000>rc</span>.<span style=color:#000>replayWAL</span>()
</span></span><span style=display:flex><span>   <span style=color:#177500>// signal replay has finished
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>rc</span>.<span style=color:#000>snapshotterReady</span> <span style=color:#000>&lt;-</span> <span style=color:#000>rc</span>.<span style=color:#000>snapshotter</span>
</span></span><span style=display:flex><span>   <span style=color:#000>rpeers</span> <span style=color:#000>:=</span> <span style=color:#a90d91>make</span>([]<span style=color:#000>raft</span>.<span style=color:#000>Peer</span>, <span style=color:#a90d91>len</span>(<span style=color:#000>rc</span>.<span style=color:#000>peers</span>))
</span></span><span style=display:flex><span>   <span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#a90d91>range</span> <span style=color:#000>rpeers</span> {
</span></span><span style=display:flex><span>      <span style=color:#000>rpeers</span>[<span style=color:#000>i</span>] = <span style=color:#000>raft</span>.<span style=color:#000>Peer</span>{<span style=color:#000>ID</span>: <span style=color:#a90d91>uint64</span>(<span style=color:#000>i</span> <span style=color:#000>+</span> <span style=color:#1c01ce>1</span>)}
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#177500>// 创建 raft.Config 实例
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>c</span> <span style=color:#000>:=</span> <span style=color:#000>&amp;</span><span style=color:#000>raft</span>.<span style=color:#000>Config</span>{
</span></span><span style=display:flex><span>      <span style=color:#000>ID</span>:                        <span style=color:#a90d91>uint64</span>(<span style=color:#000>rc</span>.<span style=color:#000>id</span>),
</span></span><span style=display:flex><span>      <span style=color:#177500>// 选举超时
</span></span></span><span style=display:flex><span><span style=color:#177500></span>      <span style=color:#000>ElectionTick</span>:              <span style=color:#1c01ce>10</span>,
</span></span><span style=display:flex><span>      <span style=color:#177500>// 心跳超时
</span></span></span><span style=display:flex><span><span style=color:#177500></span>      <span style=color:#000>HeartbeatTick</span>:             <span style=color:#1c01ce>1</span>,
</span></span><span style=display:flex><span>      <span style=color:#000>Storage</span>:                   <span style=color:#000>rc</span>.<span style=color:#000>raftStorage</span>,
</span></span><span style=display:flex><span>      <span style=color:#000>MaxSizePerMsg</span>:             <span style=color:#1c01ce>1024</span> <span style=color:#000>*</span> <span style=color:#1c01ce>1024</span>,
</span></span><span style=display:flex><span>      <span style=color:#000>MaxInflightMsgs</span>:           <span style=color:#1c01ce>256</span>,
</span></span><span style=display:flex><span>      <span style=color:#000>MaxUncommittedEntriesSize</span>: <span style=color:#1c01ce>1</span> <span style=color:#000>&lt;&lt;</span> <span style=color:#1c01ce>30</span>,
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#177500>// 初始化底层的 etcd-raft 模块，根据 WAL 日志回放情况判断首次启动还是重新启动
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#a90d91>if</span> <span style=color:#000>oldwal</span> <span style=color:#000>||</span> <span style=color:#000>rc</span>.<span style=color:#000>join</span> {
</span></span><span style=display:flex><span>      <span style=color:#000>rc</span>.<span style=color:#000>node</span> = <span style=color:#000>raft</span>.<span style=color:#000>RestartNode</span>(<span style=color:#000>c</span>)
</span></span><span style=display:flex><span>   } <span style=color:#a90d91>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#177500>// 首次启动 
</span></span></span><span style=display:flex><span><span style=color:#177500></span>      <span style=color:#000>rc</span>.<span style=color:#000>node</span> = <span style=color:#000>raft</span>.<span style=color:#000>StartNode</span>(<span style=color:#000>c</span>, <span style=color:#000>rpeers</span>)
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#177500>// 创建 Transport 实例并启动，其负责 raft 节点之间的网络通信服务
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>rc</span>.<span style=color:#000>transport</span> = <span style=color:#000>&amp;</span><span style=color:#000>rafthttp</span>.<span style=color:#000>Transport</span>{
</span></span><span style=display:flex><span>      <span style=color:#000>Logger</span>:      <span style=color:#000>rc</span>.<span style=color:#000>logger</span>,
</span></span><span style=display:flex><span>      <span style=color:#000>ID</span>:          <span style=color:#000>types</span>.<span style=color:#000>ID</span>(<span style=color:#000>rc</span>.<span style=color:#000>id</span>),
</span></span><span style=display:flex><span>      <span style=color:#000>ClusterID</span>:   <span style=color:#1c01ce>0x1000</span>,
</span></span><span style=display:flex><span>      <span style=color:#000>Raft</span>:        <span style=color:#000>rc</span>,
</span></span><span style=display:flex><span>      <span style=color:#000>ServerStats</span>: <span style=color:#000>stats</span>.<span style=color:#000>NewServerStats</span>(<span style=color:#c41a16>&#34;&#34;</span>, <span style=color:#c41a16>&#34;&#34;</span>),
</span></span><span style=display:flex><span>      <span style=color:#000>LeaderStats</span>: <span style=color:#000>stats</span>.<span style=color:#000>NewLeaderStats</span>(<span style=color:#000>zap</span>.<span style=color:#000>NewExample</span>(), <span style=color:#000>strconv</span>.<span style=color:#000>Itoa</span>(<span style=color:#000>rc</span>.<span style=color:#000>id</span>)),
</span></span><span style=display:flex><span>      <span style=color:#000>ErrorC</span>:      <span style=color:#a90d91>make</span>(<span style=color:#a90d91>chan</span> <span style=color:#a90d91>error</span>),
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#177500>// 启动网络服务相关组件
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>rc</span>.<span style=color:#000>transport</span>.<span style=color:#000>Start</span>()
</span></span><span style=display:flex><span>   <span style=color:#177500>// 建立与集群中其它节点的连接
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#a90d91>range</span> <span style=color:#000>rc</span>.<span style=color:#000>peers</span> {
</span></span><span style=display:flex><span>      <span style=color:#a90d91>if</span> <span style=color:#000>i</span><span style=color:#000>+</span><span style=color:#1c01ce>1</span> <span style=color:#000>!=</span> <span style=color:#000>rc</span>.<span style=color:#000>id</span> {
</span></span><span style=display:flex><span>         <span style=color:#000>rc</span>.<span style=color:#000>transport</span>.<span style=color:#000>AddPeer</span>(<span style=color:#000>types</span>.<span style=color:#000>ID</span>(<span style=color:#000>i</span><span style=color:#000>+</span><span style=color:#1c01ce>1</span>), []<span style=color:#a90d91>string</span>{<span style=color:#000>rc</span>.<span style=color:#000>peers</span>[<span style=color:#000>i</span>]})
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#177500>// 启动协程，监听当前节点与集群中其他节点之间的网络连接
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#a90d91>go</span> <span style=color:#000>rc</span>.<span style=color:#000>serveRaft</span>()
</span></span><span style=display:flex><span>   <span style=color:#177500>// 启动后台协程，处理上层应用与底层 etcd-raft 模块的交互
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#a90d91>go</span> <span style=color:#000>rc</span>.<span style=color:#000>serveChannels</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br><h2 id=servechannels>serveChannels</h2><p>用于处理上次应用于底层 etcd-raft 模块的交互</p><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">68
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">69
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">70
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">71
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">72
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">73
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">74
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">75
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">76
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">77
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">78
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">79
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">80
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">81
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">82
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">83
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">84
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">85
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">86
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">87
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">88
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">89
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">90
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">91
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">92
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">93
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">94
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#177500>// 单独启动一个后台协程负责上层模块传递给 etcd-raft 模块的数据
</span></span></span><span style=display:flex><span><span style=color:#177500>// 主要是 proposeC、confChangeC 两个通道
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>func</span> (<span style=color:#000>rc</span> <span style=color:#000>*</span><span style=color:#000>raftNode</span>) <span style=color:#000>serveChannels</span>() {
</span></span><span style=display:flex><span>   <span style=color:#177500>// 获取快照数据和快照元数据
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>snap</span>, <span style=color:#000>err</span> <span style=color:#000>:=</span> <span style=color:#000>rc</span>.<span style=color:#000>raftStorage</span>.<span style=color:#000>Snapshot</span>()
</span></span><span style=display:flex><span>   <span style=color:#a90d91>if</span> <span style=color:#000>err</span> <span style=color:#000>!=</span> <span style=color:#a90d91>nil</span> {
</span></span><span style=display:flex><span>      <span style=color:#a90d91>panic</span>(<span style=color:#000>err</span>)
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#000>rc</span>.<span style=color:#000>confState</span> = <span style=color:#000>snap</span>.<span style=color:#000>Metadata</span>.<span style=color:#000>ConfState</span>
</span></span><span style=display:flex><span>   <span style=color:#000>rc</span>.<span style=color:#000>snapshotIndex</span> = <span style=color:#000>snap</span>.<span style=color:#000>Metadata</span>.<span style=color:#000>Index</span>
</span></span><span style=display:flex><span>   <span style=color:#000>rc</span>.<span style=color:#000>appliedIndex</span> = <span style=color:#000>snap</span>.<span style=color:#000>Metadata</span>.<span style=color:#000>Index</span>
</span></span><span style=display:flex><span>   <span style=color:#a90d91>defer</span> <span style=color:#000>rc</span>.<span style=color:#000>wal</span>.<span style=color:#000>Close</span>()
</span></span><span style=display:flex><span>   <span style=color:#177500>// 定时器，推进逻辑时钟。100ms 是 etcd-raft 组件的最小时间单位
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>ticker</span> <span style=color:#000>:=</span> <span style=color:#000>time</span>.<span style=color:#000>NewTicker</span>(<span style=color:#1c01ce>100</span> <span style=color:#000>*</span> <span style=color:#000>time</span>.<span style=color:#000>Millisecond</span>)
</span></span><span style=display:flex><span>   <span style=color:#a90d91>defer</span> <span style=color:#000>ticker</span>.<span style=color:#000>Stop</span>()
</span></span><span style=display:flex><span>   <span style=color:#177500>// 单独的协程负责接收 proposeC、confChangeC 的数据传递给 etcd-raft 组件处理 
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#177500>// send proposals over raft
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#a90d91>go</span> <span style=color:#a90d91>func</span>() {
</span></span><span style=display:flex><span>      <span style=color:#000>confChangeCount</span> <span style=color:#000>:=</span> <span style=color:#a90d91>uint64</span>(<span style=color:#1c01ce>0</span>)
</span></span><span style=display:flex><span>      <span style=color:#a90d91>for</span> <span style=color:#000>rc</span>.<span style=color:#000>proposeC</span> <span style=color:#000>!=</span> <span style=color:#a90d91>nil</span> <span style=color:#000>&amp;&amp;</span> <span style=color:#000>rc</span>.<span style=color:#000>confChangeC</span> <span style=color:#000>!=</span> <span style=color:#a90d91>nil</span> {
</span></span><span style=display:flex><span>         <span style=color:#a90d91>select</span> {
</span></span><span style=display:flex><span>         <span style=color:#a90d91>case</span> <span style=color:#000>prop</span>, <span style=color:#000>ok</span> <span style=color:#000>:=</span> <span style=color:#000>&lt;-</span><span style=color:#000>rc</span>.<span style=color:#000>proposeC</span>:
</span></span><span style=display:flex><span>            <span style=color:#a90d91>if</span> !<span style=color:#000>ok</span> {
</span></span><span style=display:flex><span>               <span style=color:#177500>// 异常时将 proposeC 置空
</span></span></span><span style=display:flex><span><span style=color:#177500></span>               <span style=color:#000>rc</span>.<span style=color:#000>proposeC</span> = <span style=color:#a90d91>nil</span>
</span></span><span style=display:flex><span>            } <span style=color:#a90d91>else</span> {
</span></span><span style=display:flex><span>               <span style=color:#177500>// 阻塞知道消息处理
</span></span></span><span style=display:flex><span><span style=color:#177500></span>               <span style=color:#177500>// blocks until accepted by raft state machine
</span></span></span><span style=display:flex><span><span style=color:#177500></span>               <span style=color:#000>rc</span>.<span style=color:#000>node</span>.<span style=color:#000>Propose</span>(<span style=color:#000>context</span>.<span style=color:#000>TODO</span>(), []<span style=color:#a90d91>byte</span>(<span style=color:#000>prop</span>))
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>         <span style=color:#177500>// 接收上层应用通过 confChangeC 传递的数据
</span></span></span><span style=display:flex><span><span style=color:#177500></span>         <span style=color:#a90d91>case</span> <span style=color:#000>cc</span>, <span style=color:#000>ok</span> <span style=color:#000>:=</span> <span style=color:#000>&lt;-</span><span style=color:#000>rc</span>.<span style=color:#000>confChangeC</span>:
</span></span><span style=display:flex><span>            <span style=color:#a90d91>if</span> !<span style=color:#000>ok</span> {
</span></span><span style=display:flex><span>               <span style=color:#177500>// 异常时将 confChangeC 置空
</span></span></span><span style=display:flex><span><span style=color:#177500></span>               <span style=color:#000>rc</span>.<span style=color:#000>confChangeC</span> = <span style=color:#a90d91>nil</span>
</span></span><span style=display:flex><span>            } <span style=color:#a90d91>else</span> {
</span></span><span style=display:flex><span>               <span style=color:#000>confChangeCount</span><span style=color:#000>++</span>
</span></span><span style=display:flex><span>               <span style=color:#000>cc</span>.<span style=color:#000>ID</span> = <span style=color:#000>confChangeCount</span>
</span></span><span style=display:flex><span>               <span style=color:#000>rc</span>.<span style=color:#000>node</span>.<span style=color:#000>ProposeConfChange</span>(<span style=color:#000>context</span>.<span style=color:#000>TODO</span>(), <span style=color:#000>cc</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>         }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#177500>// 关闭 stopc 通道，触发调用 rafeNode.stop()
</span></span></span><span style=display:flex><span><span style=color:#177500></span>      <span style=color:#177500>// client closed channel; shutdown raft if not already
</span></span></span><span style=display:flex><span><span style=color:#177500></span>      <span style=color:#a90d91>close</span>(<span style=color:#000>rc</span>.<span style=color:#000>stopc</span>)
</span></span><span style=display:flex><span>   }()
</span></span><span style=display:flex><span>   <span style=color:#177500>// 处理 etcd-raft 模块返回给上层模块的数据及其他相关操作
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#177500>// event loop on raft state machine updates
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#a90d91>for</span> {
</span></span><span style=display:flex><span>      <span style=color:#a90d91>select</span> {
</span></span><span style=display:flex><span>      <span style=color:#a90d91>case</span> <span style=color:#000>&lt;-</span><span style=color:#000>ticker</span>.<span style=color:#000>C</span>:
</span></span><span style=display:flex><span>         <span style=color:#177500>// 触发 tricker 定时器
</span></span></span><span style=display:flex><span><span style=color:#177500></span>         <span style=color:#000>rc</span>.<span style=color:#000>node</span>.<span style=color:#000>Tick</span>()
</span></span><span style=display:flex><span>      <span style=color:#177500>// 读取 node.readyc 通道(etcd-raft组件与上层应用交互的主要channel之一)
</span></span></span><span style=display:flex><span><span style=color:#177500></span>      <span style=color:#177500>// Ready 实例封装了很多信息
</span></span></span><span style=display:flex><span><span style=color:#177500></span>      <span style=color:#177500>// store raft entries to wal, then publish over commit channel
</span></span></span><span style=display:flex><span><span style=color:#177500></span>      <span style=color:#a90d91>case</span> <span style=color:#000>rd</span> <span style=color:#000>:=</span> <span style=color:#000>&lt;-</span><span style=color:#000>rc</span>.<span style=color:#000>node</span>.<span style=color:#000>Ready</span>():
</span></span><span style=display:flex><span>         <span style=color:#177500>// 将当前组件状态信息和待持久化的 Entry 记录保存到 WAL 日志文件中
</span></span></span><span style=display:flex><span><span style=color:#177500></span>         <span style=color:#177500>// 这样即使宕机，信息也可以在节点下次启动时，通过前面回放 WAL 日志的方式恢复
</span></span></span><span style=display:flex><span><span style=color:#177500></span>         <span style=color:#000>rc</span>.<span style=color:#000>wal</span>.<span style=color:#000>Save</span>(<span style=color:#000>rd</span>.<span style=color:#000>HardState</span>, <span style=color:#000>rd</span>.<span style=color:#000>Entries</span>)
</span></span><span style=display:flex><span>         <span style=color:#177500>// 检测组件生成新的快照数据
</span></span></span><span style=display:flex><span><span style=color:#177500></span>         <span style=color:#a90d91>if</span> !<span style=color:#000>raft</span>.<span style=color:#000>IsEmptySnap</span>(<span style=color:#000>rd</span>.<span style=color:#000>Snapshot</span>) {
</span></span><span style=display:flex><span>            <span style=color:#177500>// 新的快照数据写入到快照文件中
</span></span></span><span style=display:flex><span><span style=color:#177500></span>            <span style=color:#000>rc</span>.<span style=color:#000>saveSnap</span>(<span style=color:#000>rd</span>.<span style=color:#000>Snapshot</span>)
</span></span><span style=display:flex><span>            <span style=color:#177500>// 将新快照持久化到 raftStorage
</span></span></span><span style=display:flex><span><span style=color:#177500></span>            <span style=color:#000>rc</span>.<span style=color:#000>raftStorage</span>.<span style=color:#000>ApplySnapshot</span>(<span style=color:#000>rd</span>.<span style=color:#000>Snapshot</span>)
</span></span><span style=display:flex><span>            <span style=color:#177500>// 通知上层应用加载新快照
</span></span></span><span style=display:flex><span><span style=color:#177500></span>            <span style=color:#000>rc</span>.<span style=color:#000>publishSnapshot</span>(<span style=color:#000>rd</span>.<span style=color:#000>Snapshot</span>)
</span></span><span style=display:flex><span>         }
</span></span><span style=display:flex><span>         <span style=color:#177500>// 将待持久化的 Entry 记录追加到 raftStorage 中完成初始化
</span></span></span><span style=display:flex><span><span style=color:#177500></span>         <span style=color:#000>rc</span>.<span style=color:#000>raftStorage</span>.<span style=color:#000>Append</span>(<span style=color:#000>rd</span>.<span style=color:#000>Entries</span>)
</span></span><span style=display:flex><span>         <span style=color:#177500>// 将待发送消息发送到指定节点
</span></span></span><span style=display:flex><span><span style=color:#177500></span>         <span style=color:#000>rc</span>.<span style=color:#000>transport</span>.<span style=color:#000>Send</span>(<span style=color:#000>rd</span>.<span style=color:#000>Messages</span>)
</span></span><span style=display:flex><span>         <span style=color:#177500>// 将已提交、待应用的 Entry 记录应用到上层应用的状态机中
</span></span></span><span style=display:flex><span><span style=color:#177500></span>         <span style=color:#000>applyDoneC</span>, <span style=color:#000>ok</span> <span style=color:#000>:=</span> <span style=color:#000>rc</span>.<span style=color:#000>publishEntries</span>(<span style=color:#000>rc</span>.<span style=color:#000>entriesToApply</span>(<span style=color:#000>rd</span>.<span style=color:#000>CommittedEntries</span>))
</span></span><span style=display:flex><span>         <span style=color:#a90d91>if</span> !<span style=color:#000>ok</span> {
</span></span><span style=display:flex><span>            <span style=color:#000>rc</span>.<span style=color:#000>stop</span>()
</span></span><span style=display:flex><span>            <span style=color:#a90d91>return</span>
</span></span><span style=display:flex><span>         }
</span></span><span style=display:flex><span>         <span style=color:#177500>// WAL 日志量和 raftLog.storage 中的 Entry 记录会不断增加
</span></span></span><span style=display:flex><span><span style=color:#177500></span>         <span style=color:#177500>// 节点每处理 1000 条(默认值) Entry 记录会触发一次创建快照的记录
</span></span></span><span style=display:flex><span><span style=color:#177500></span>         <span style=color:#177500>// 同时 WAL 会释放一些日志文件的句柄，raftLog.storage 也会压缩其保存的 Entry 记录
</span></span></span><span style=display:flex><span><span style=color:#177500></span>         <span style=color:#000>rc</span>.<span style=color:#000>maybeTriggerSnapshot</span>(<span style=color:#000>applyDoneC</span>)
</span></span><span style=display:flex><span>         <span style=color:#177500>// 上层应用处理完该 Ready 实例，通知组件准备返回下一个 Ready 实例
</span></span></span><span style=display:flex><span><span style=color:#177500></span>         <span style=color:#000>rc</span>.<span style=color:#000>node</span>.<span style=color:#000>Advance</span>()
</span></span><span style=display:flex><span>      <span style=color:#a90d91>case</span> <span style=color:#000>err</span> <span style=color:#000>:=</span> <span style=color:#000>&lt;-</span><span style=color:#000>rc</span>.<span style=color:#000>transport</span>.<span style=color:#000>ErrorC</span>:
</span></span><span style=display:flex><span>         <span style=color:#000>rc</span>.<span style=color:#000>writeError</span>(<span style=color:#000>err</span>)
</span></span><span style=display:flex><span>         <span style=color:#a90d91>return</span>
</span></span><span style=display:flex><span>      <span style=color:#a90d91>case</span> <span style=color:#000>&lt;-</span><span style=color:#000>rc</span>.<span style=color:#000>stopc</span>:
</span></span><span style=display:flex><span>         <span style=color:#000>rc</span>.<span style=color:#000>stop</span>()
</span></span><span style=display:flex><span>         <span style=color:#a90d91>return</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br><h1 id=领导者选举>领导者选举</h1><h2 id=启动节点>启动节点</h2><p>Node 初始化时是 Follower 状态，集群的节点初次启动时会通过 StartNode() 启动创建对应的 node 实例和底层的 raft 实例。StartNode() 方法根据传入的 config 配置创建 raft 实例并初始raft 使用的相关组件。</p><p>代码入口：</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-plain data-lang=plain><span style=display:flex><span>newRaftNode() -&gt; startRaft() -&gt; StartNode()
</span></span></code></pre></td></tr></table></div></div></div><p>StartNode 启动节点<style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">68
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">69
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">70
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-plain data-lang=plain><span style=display:flex><span>// raft/node.go:218
</span></span><span style=display:flex><span>// Peer封装了节点 ID, 且记录了当前集群中全部节点 ID
</span></span><span style=display:flex><span>func StartNode(c *Config, peers []Peer) Node {
</span></span><span style=display:flex><span>   if len(peers) == 0 {
</span></span><span style=display:flex><span>      panic(&#34;no peers given; use RestartNode instead&#34;)
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   // 根据 config 初始化 RawNode，并且也初始化一个 raft
</span></span><span style=display:flex><span>   rn, err := NewRawNode(c)
</span></span><span style=display:flex><span>   if err != nil {
</span></span><span style=display:flex><span>      panic(err)
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   // 第一次使用初始化 RawNode
</span></span><span style=display:flex><span>   err = rn.Bootstrap(peers)
</span></span><span style=display:flex><span>   if err != nil {
</span></span><span style=display:flex><span>      c.Logger.Warningf(&#34;error occurred during starting a new node: %v&#34;, err)
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   // 初始化 node 实例
</span></span><span style=display:flex><span>   n := newNode(rn)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   go n.run()
</span></span><span style=display:flex><span>   return &amp;n
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>func NewRawNode(config *Config) (*RawNode, error) {
</span></span><span style=display:flex><span>   // 调用初始化 newRaft
</span></span><span style=display:flex><span>   r := newRaft(config)
</span></span><span style=display:flex><span>   rn := &amp;RawNode{
</span></span><span style=display:flex><span>      raft: r,
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   rn.prevSoftSt = r.softState()
</span></span><span style=display:flex><span>   rn.prevHardSt = r.hardState()
</span></span><span style=display:flex><span>   return rn, nil
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>func newRaft(c *Config) *raft {
</span></span><span style=display:flex><span>   if err := c.validate(); err != nil {
</span></span><span style=display:flex><span>      panic(err.Error())
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   raftlog := newLogWithSize(c.Storage, c.Logger, c.MaxCommittedSizePerReady)
</span></span><span style=display:flex><span>   hs, cs, err := c.Storage.InitialState()
</span></span><span style=display:flex><span>   if err != nil {
</span></span><span style=display:flex><span>      panic(err) // TODO(bdarnell)
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   r := &amp;raft{
</span></span><span style=display:flex><span>      id:                        c.ID,
</span></span><span style=display:flex><span>      lead:                      None,
</span></span><span style=display:flex><span>      isLearner:                 false,
</span></span><span style=display:flex><span>      raftLog:                   raftlog,
</span></span><span style=display:flex><span>      maxMsgSize:                c.MaxSizePerMsg,
</span></span><span style=display:flex><span>      maxUncommittedSize:        c.MaxUncommittedEntriesSize,
</span></span><span style=display:flex><span>      prs:                       tracker.MakeProgressTracker(c.MaxInflightMsgs),
</span></span><span style=display:flex><span>      electionTimeout:           c.ElectionTick,
</span></span><span style=display:flex><span>      heartbeatTimeout:          c.HeartbeatTick,
</span></span><span style=display:flex><span>      logger:                    c.Logger,
</span></span><span style=display:flex><span>      checkQuorum:               c.CheckQuorum,
</span></span><span style=display:flex><span>      preVote:                   c.PreVote,
</span></span><span style=display:flex><span>      readOnly:                  newReadOnly(c.ReadOnlyOption),
</span></span><span style=display:flex><span>      disableProposalForwarding: c.DisableProposalForwarding,
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   ...
</span></span><span style=display:flex><span>   // 启动时都是 Follower 状态
</span></span><span style=display:flex><span>   r.becomeFollower(r.Term, None)
</span></span><span style=display:flex><span>   var nodesStrs []string
</span></span><span style=display:flex><span>   for _, n := range r.prs.VoterNodes() {
</span></span><span style=display:flex><span>      nodesStrs = append(nodesStrs, fmt.Sprintf(&#34;%x&#34;, n))
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   r.logger.Infof(&#34;newRaft %x [peers: [%s], term: %d, commit: %d, applied: %d, lastindex: %d, lastterm: %d]&#34;,
</span></span><span style=display:flex><span>      r.id, strings.Join(nodesStrs, &#34;,&#34;), r.Term, r.raftLog.committed, r.raftLog.applied, r.raftLog.lastIndex(), r.raftLog.lastTerm())
</span></span><span style=display:flex><span>   return r
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br></p><p>node 节点初始化时，所有 node 开始都被初始化为 Follower 状态。
run方法调用：</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-plain data-lang=plain><span style=display:flex><span>StartNode() -&gt; go n.run()
</span></span></code></pre></td></tr></table></div></div></div><p>run方法：<style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>func</span> (<span style=color:#000>n</span> <span style=color:#000>*</span><span style=color:#000>node</span>) <span style=color:#000>run</span>() {
</span></span><span style=display:flex><span>   <span style=color:#000>...</span>
</span></span><span style=display:flex><span>   <span style=color:#a90d91>for</span> {
</span></span><span style=display:flex><span>      <span style=color:#000>...</span>
</span></span><span style=display:flex><span>      <span style=color:#a90d91>select</span> {
</span></span><span style=display:flex><span>      <span style=color:#a90d91>case</span> <span style=color:#000>pm</span> <span style=color:#000>:=</span> <span style=color:#000>&lt;-</span><span style=color:#000>propc</span>:
</span></span><span style=display:flex><span>         <span style=color:#000>...</span>
</span></span><span style=display:flex><span>         <span style=color:#000>err</span> <span style=color:#000>:=</span> <span style=color:#000>r</span>.<span style=color:#000>Step</span>(<span style=color:#000>m</span>)
</span></span><span style=display:flex><span>         <span style=color:#000>...</span>
</span></span><span style=display:flex><span>      <span style=color:#a90d91>case</span> <span style=color:#000>m</span> <span style=color:#000>:=</span> <span style=color:#000>&lt;-</span><span style=color:#000>n</span>.<span style=color:#000>recvc</span>:
</span></span><span style=display:flex><span>         <span style=color:#177500>// filter out response message from unknown From.
</span></span></span><span style=display:flex><span><span style=color:#177500></span>         <span style=color:#a90d91>if</span> <span style=color:#000>pr</span> <span style=color:#000>:=</span> <span style=color:#000>r</span>.<span style=color:#000>prs</span>.<span style=color:#000>Progress</span>[<span style=color:#000>m</span>.<span style=color:#000>From</span>]; <span style=color:#000>pr</span> <span style=color:#000>!=</span> <span style=color:#a90d91>nil</span> <span style=color:#000>||</span> !<span style=color:#000>IsResponseMsg</span>(<span style=color:#000>m</span>.<span style=color:#000>Type</span>) {
</span></span><span style=display:flex><span>            <span style=color:#000>r</span>.<span style=color:#000>Step</span>(<span style=color:#000>m</span>)
</span></span><span style=display:flex><span>         }
</span></span><span style=display:flex><span>      <span style=color:#a90d91>case</span> <span style=color:#000>cc</span> <span style=color:#000>:=</span> <span style=color:#000>&lt;-</span><span style=color:#000>n</span>.<span style=color:#000>confc</span>:
</span></span><span style=display:flex><span>         <span style=color:#000>...</span>
</span></span><span style=display:flex><span>      <span style=color:#a90d91>case</span> <span style=color:#000>&lt;-</span><span style=color:#000>n</span>.<span style=color:#000>tickc</span>:
</span></span><span style=display:flex><span>         <span style=color:#000>n</span>.<span style=color:#000>rn</span>.<span style=color:#000>Tick</span>()
</span></span><span style=display:flex><span>      <span style=color:#a90d91>case</span> <span style=color:#000>readyc</span> <span style=color:#000>&lt;-</span> <span style=color:#000>rd</span>:
</span></span><span style=display:flex><span>         <span style=color:#000>n</span>.<span style=color:#000>rn</span>.<span style=color:#000>acceptReady</span>(<span style=color:#000>rd</span>)
</span></span><span style=display:flex><span>         <span style=color:#000>advancec</span> = <span style=color:#000>n</span>.<span style=color:#000>advancec</span>
</span></span><span style=display:flex><span>      <span style=color:#a90d91>case</span> <span style=color:#000>&lt;-</span><span style=color:#000>advancec</span>:
</span></span><span style=display:flex><span>         <span style=color:#000>n</span>.<span style=color:#000>rn</span>.<span style=color:#000>Advance</span>(<span style=color:#000>rd</span>)
</span></span><span style=display:flex><span>         <span style=color:#000>rd</span> = <span style=color:#000>Ready</span>{}
</span></span><span style=display:flex><span>         <span style=color:#000>advancec</span> = <span style=color:#a90d91>nil</span>
</span></span><span style=display:flex><span>      <span style=color:#a90d91>case</span> <span style=color:#000>c</span> <span style=color:#000>:=</span> <span style=color:#000>&lt;-</span><span style=color:#000>n</span>.<span style=color:#000>status</span>:
</span></span><span style=display:flex><span>         <span style=color:#000>c</span> <span style=color:#000>&lt;-</span> <span style=color:#000>getStatus</span>(<span style=color:#000>r</span>)
</span></span><span style=display:flex><span>      <span style=color:#a90d91>case</span> <span style=color:#000>&lt;-</span><span style=color:#000>n</span>.<span style=color:#000>stop</span>:
</span></span><span style=display:flex><span>         <span style=color:#a90d91>close</span>(<span style=color:#000>n</span>.<span style=color:#000>done</span>)
</span></span><span style=display:flex><span>         <span style=color:#a90d91>return</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br></p><p>这里主要是通过 for - select - channel 监听 channel 信息来处理不同请求。
其中 propc 和 recvc 拿到上层应用传来的消息会提交给 raft 层的 Step 函数处理。</p><p>Step 函数是 etcd-raft 模块负责各类信息的入口。</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>func</span> (<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>) <span style=color:#000>Step</span>(<span style=color:#000>m</span> <span style=color:#000>pb</span>.<span style=color:#000>Message</span>) <span style=color:#a90d91>error</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>...</span>
</span></span><span style=display:flex><span>   <span style=color:#a90d91>switch</span> <span style=color:#000>m</span>.<span style=color:#000>Type</span> {
</span></span><span style=display:flex><span>   <span style=color:#a90d91>case</span> <span style=color:#000>pb</span>.<span style=color:#000>MsgHup</span>:
</span></span><span style=display:flex><span>      <span style=color:#000>...</span>
</span></span><span style=display:flex><span>   <span style=color:#a90d91>case</span> <span style=color:#000>pb</span>.<span style=color:#000>MsgVote</span>, <span style=color:#000>pb</span>.<span style=color:#000>MsgPreVote</span>:
</span></span><span style=display:flex><span>      <span style=color:#000>...</span>
</span></span><span style=display:flex><span>   <span style=color:#a90d91>default</span>:
</span></span><span style=display:flex><span>      <span style=color:#000>err</span> <span style=color:#000>:=</span> <span style=color:#000>r</span>.<span style=color:#000>step</span>(<span style=color:#000>r</span>, <span style=color:#000>m</span>)
</span></span><span style=display:flex><span>      <span style=color:#000>...</span>
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#a90d91>return</span> <span style=color:#a90d91>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><p>Step 函数中最后的 default 里的 step 被实现为一个状态机，其 step 属性是一个函数指针，根据当前节点的不同角色指向不同的消息处理函数：stepLeader/stepFollower/stepCandidate。同样还有一个 tick 函数指针，根据角色不同也有有不同的处理函数 tickHeartbeat 和 tickElection，分别用来触发定时心跳和选举检测。</p><h2 id=发送心跳包>发送心跳包</h2><h3 id=leader>Leader</h3><p>当一个节点成为 Leader 时，会将节点的定时器设置为 tickHearbeat，然后周期性调用以维持 Leader 地位。</p><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#177500>// raft/raft.go:724
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>func</span> (<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>) <span style=color:#000>becomeLeader</span>() {
</span></span><span style=display:flex><span>   <span style=color:#177500>// 检测当前节点的状态，禁止从 Follower 状态切换成 Leader 状态
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#177500>// TODO(xiangli) remove the panic when the raft implementation is stable
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#a90d91>if</span> <span style=color:#000>r</span>.<span style=color:#000>state</span> <span style=color:#000>==</span> <span style=color:#000>StateFollower</span> {
</span></span><span style=display:flex><span>      <span style=color:#a90d91>panic</span>(<span style=color:#c41a16>&#34;invalid transition [follower -&gt; leader]&#34;</span>)
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#177500>// 将 step 设置为 stepLeader
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>r</span>.<span style=color:#000>step</span> = <span style=color:#000>stepLeader</span>
</span></span><span style=display:flex><span>   <span style=color:#000>r</span>.<span style=color:#000>reset</span>(<span style=color:#000>r</span>.<span style=color:#000>Term</span>)
</span></span><span style=display:flex><span>   <span style=color:#177500>// 设置心跳函数
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>r</span>.<span style=color:#000>tick</span> = <span style=color:#000>r</span>.<span style=color:#000>tickHeartbeat</span>
</span></span><span style=display:flex><span>   <span style=color:#177500>// 设置 lead 的 id
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>r</span>.<span style=color:#000>lead</span> = <span style=color:#000>r</span>.<span style=color:#000>id</span>
</span></span><span style=display:flex><span>   <span style=color:#177500>// 更新当前角色
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>r</span>.<span style=color:#000>state</span> = <span style=color:#000>StateLeader</span>   
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> (<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>) <span style=color:#000>tickHeartbeat</span>() {
</span></span><span style=display:flex><span>   <span style=color:#177500>// 心跳计数器递增
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>r</span>.<span style=color:#000>heartbeatElapsed</span><span style=color:#000>++</span>
</span></span><span style=display:flex><span>   <span style=color:#177500>// 选举计数器递增
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>r</span>.<span style=color:#000>electionElapsed</span><span style=color:#000>++</span>
</span></span><span style=display:flex><span>   <span style=color:#a90d91>if</span> <span style=color:#000>r</span>.<span style=color:#000>electionElapsed</span> <span style=color:#000>&gt;=</span> <span style=color:#000>r</span>.<span style=color:#000>electionTimeout</span> {
</span></span><span style=display:flex><span>      <span style=color:#000>r</span>.<span style=color:#000>electionElapsed</span> = <span style=color:#1c01ce>0</span>
</span></span><span style=display:flex><span>      <span style=color:#177500>// 检测当前节点时大多数节点保持连通
</span></span></span><span style=display:flex><span><span style=color:#177500></span>      <span style=color:#a90d91>if</span> <span style=color:#000>r</span>.<span style=color:#000>checkQuorum</span> {
</span></span><span style=display:flex><span>         <span style=color:#a90d91>if</span> <span style=color:#000>err</span> <span style=color:#000>:=</span> <span style=color:#000>r</span>.<span style=color:#000>Step</span>(<span style=color:#000>pb</span>.<span style=color:#000>Message</span>{<span style=color:#000>From</span>: <span style=color:#000>r</span>.<span style=color:#000>id</span>, <span style=color:#000>Type</span>: <span style=color:#000>pb</span>.<span style=color:#000>MsgCheckQuorum</span>}); <span style=color:#000>err</span> <span style=color:#000>!=</span> <span style=color:#a90d91>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#000>r</span>.<span style=color:#000>logger</span>.<span style=color:#000>Debugf</span>(<span style=color:#c41a16>&#34;error occurred during checking sending heartbeat: %v&#34;</span>, <span style=color:#000>err</span>)
</span></span><span style=display:flex><span>         }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#177500>// If current leader cannot transfer leadership in electionTimeout, it becomes leader again.
</span></span></span><span style=display:flex><span><span style=color:#177500></span>      <span style=color:#a90d91>if</span> <span style=color:#000>r</span>.<span style=color:#000>state</span> <span style=color:#000>==</span> <span style=color:#000>StateLeader</span> <span style=color:#000>&amp;&amp;</span> <span style=color:#000>r</span>.<span style=color:#000>leadTransferee</span> <span style=color:#000>!=</span> <span style=color:#000>None</span> {
</span></span><span style=display:flex><span>         <span style=color:#000>r</span>.<span style=color:#000>abortLeaderTransfer</span>()
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#a90d91>if</span> <span style=color:#000>r</span>.<span style=color:#000>state</span> <span style=color:#000>!=</span> <span style=color:#000>StateLeader</span> {
</span></span><span style=display:flex><span>      <span style=color:#a90d91>return</span>
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#a90d91>if</span> <span style=color:#000>r</span>.<span style=color:#000>heartbeatElapsed</span> <span style=color:#000>&gt;=</span> <span style=color:#000>r</span>.<span style=color:#000>heartbeatTimeout</span> {
</span></span><span style=display:flex><span>      <span style=color:#000>r</span>.<span style=color:#000>heartbeatElapsed</span> = <span style=color:#1c01ce>0</span>
</span></span><span style=display:flex><span>      <span style=color:#a90d91>if</span> <span style=color:#000>err</span> <span style=color:#000>:=</span> <span style=color:#000>r</span>.<span style=color:#000>Step</span>(<span style=color:#000>pb</span>.<span style=color:#000>Message</span>{<span style=color:#000>From</span>: <span style=color:#000>r</span>.<span style=color:#000>id</span>, <span style=color:#000>Type</span>: <span style=color:#000>pb</span>.<span style=color:#000>MsgBeat</span>}); <span style=color:#000>err</span> <span style=color:#000>!=</span> <span style=color:#a90d91>nil</span> {
</span></span><span style=display:flex><span>         <span style=color:#000>r</span>.<span style=color:#000>logger</span>.<span style=color:#000>Debugf</span>(<span style=color:#c41a16>&#34;error occurred during checking sending heartbeat: %v&#34;</span>, <span style=color:#000>err</span>)
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br><p>becomeLeader 中 step 被设置成 stepLeader，所以会调用 stepLeader 来处理 leader 中对应的消息。然后调用 bcastHeartbeat 向所有节点发送心跳。<style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>stepLeader</span>(<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>, <span style=color:#000>m</span> <span style=color:#000>pb</span>.<span style=color:#000>Message</span>) <span style=color:#a90d91>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#177500>// These message types do not require any progress for m.From.
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#a90d91>switch</span> <span style=color:#000>m</span>.<span style=color:#000>Type</span> {
</span></span><span style=display:flex><span>	<span style=color:#a90d91>case</span> <span style=color:#000>pb</span>.<span style=color:#000>MsgBeat</span>:
</span></span><span style=display:flex><span>		<span style=color:#177500>// 向所有节点发送心跳
</span></span></span><span style=display:flex><span><span style=color:#177500></span>		<span style=color:#000>r</span>.<span style=color:#000>bcastHeartbeat</span>()
</span></span><span style=display:flex><span>		<span style=color:#a90d91>return</span> <span style=color:#a90d91>nil</span>
</span></span><span style=display:flex><span>	<span style=color:#a90d91>case</span> <span style=color:#000>pb</span>.<span style=color:#000>MsgCheckQuorum</span>:
</span></span><span style=display:flex><span>		<span style=color:#177500>// 检测是否和大部分节点保持连通
</span></span></span><span style=display:flex><span><span style=color:#177500></span>		<span style=color:#177500>// 如果不连通则切换到 Follower 状态
</span></span></span><span style=display:flex><span><span style=color:#177500></span>		<span style=color:#a90d91>if</span> !<span style=color:#000>r</span>.<span style=color:#000>prs</span>.<span style=color:#000>QuorumActive</span>() {
</span></span><span style=display:flex><span>			<span style=color:#000>r</span>.<span style=color:#000>logger</span>.<span style=color:#000>Warningf</span>(<span style=color:#c41a16>&#34;%x stepped down to follower since quorum is not active&#34;</span>, <span style=color:#000>r</span>.<span style=color:#000>id</span>)
</span></span><span style=display:flex><span>			<span style=color:#000>r</span>.<span style=color:#000>becomeFollower</span>(<span style=color:#000>r</span>.<span style=color:#000>Term</span>, <span style=color:#000>None</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#a90d91>return</span> <span style=color:#a90d91>nil</span>
</span></span><span style=display:flex><span>		<span style=color:#000>...</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>// bcastHeartbeat sends RPC, without entries to all the peers.
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>func</span> (<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>) <span style=color:#000>bcastHeartbeat</span>() {
</span></span><span style=display:flex><span>   <span style=color:#000>lastCtx</span> <span style=color:#000>:=</span> <span style=color:#000>r</span>.<span style=color:#000>readOnly</span>.<span style=color:#000>lastPendingRequestCtx</span>()
</span></span><span style=display:flex><span>   <span style=color:#177500>// 下面函数都会调用 sendHeartbeat
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#a90d91>if</span> <span style=color:#a90d91>len</span>(<span style=color:#000>lastCtx</span>) <span style=color:#000>==</span> <span style=color:#1c01ce>0</span> {
</span></span><span style=display:flex><span>      <span style=color:#000>r</span>.<span style=color:#000>bcastHeartbeatWithCtx</span>(<span style=color:#a90d91>nil</span>)
</span></span><span style=display:flex><span>   } <span style=color:#a90d91>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#000>r</span>.<span style=color:#000>bcastHeartbeatWithCtx</span>([]<span style=color:#a90d91>byte</span>(<span style=color:#000>lastCtx</span>))
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500>// 向指定的节点发送消息
</span></span></span><span style=display:flex><span><span style=color:#177500>// sendHeartbeat sends a heartbeat RPC to the given peer.
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>func</span> (<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>) <span style=color:#000>sendHeartbeat</span>(<span style=color:#000>to</span> <span style=color:#a90d91>uint64</span>, <span style=color:#000>ctx</span> []<span style=color:#a90d91>byte</span>) {
</span></span><span style=display:flex><span>   <span style=color:#177500>// Attach the commit as min(to.matched, r.committed).
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#177500>// When the leader sends out heartbeat message,
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#177500>// the receiver(follower) might not be matched with the leader
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#177500>// or it might not have all the committed entries.
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#177500>// The leader MUST NOT forward the follower&#39;s commit to
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#177500>// an unmatched index.
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>commit</span> <span style=color:#000>:=</span> <span style=color:#000>min</span>(<span style=color:#000>r</span>.<span style=color:#000>prs</span>.<span style=color:#000>Progress</span>[<span style=color:#000>to</span>].<span style=color:#000>Match</span>, <span style=color:#000>r</span>.<span style=color:#000>raftLog</span>.<span style=color:#000>committed</span>)
</span></span><span style=display:flex><span>   <span style=color:#000>m</span> <span style=color:#000>:=</span> <span style=color:#000>pb</span>.<span style=color:#000>Message</span>{
</span></span><span style=display:flex><span>      <span style=color:#000>To</span>:      <span style=color:#000>to</span>,
</span></span><span style=display:flex><span>      <span style=color:#177500>// 发送 MsgHeartbeat 类型的数据
</span></span></span><span style=display:flex><span><span style=color:#177500></span>      <span style=color:#000>Type</span>:    <span style=color:#000>pb</span>.<span style=color:#000>MsgHeartbeat</span>,
</span></span><span style=display:flex><span>      <span style=color:#000>Commit</span>:  <span style=color:#000>commit</span>,
</span></span><span style=display:flex><span>      <span style=color:#000>Context</span>: <span style=color:#000>ctx</span>,
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#000>r</span>.<span style=color:#000>send</span>(<span style=color:#000>m</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br></p><p>最终的心跳通过 MsgHeartbeat 的消息类型进行发送，通知它们目前 Leader 的存活状态，重置所有 Follower 持有的超时计时器。</p><h3 id=follower>Follower</h3><p>Follower 节点行为：</p><ol><li>接收来自 Leader 的 RPC 消息 MsgHearbeat；</li><li>重置当前节点的选举超时时间；</li><li>回复 Leader 自己存活。<style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>nc</span> <span style=color:#000>stepFollower</span>(<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>, <span style=color:#000>m</span> <span style=color:#000>pb</span>.<span style=color:#000>Message</span>) <span style=color:#a90d91>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#a90d91>switch</span> <span style=color:#000>m</span>.<span style=color:#000>Type</span> {
</span></span><span style=display:flex><span>	<span style=color:#a90d91>case</span> <span style=color:#000>pb</span>.<span style=color:#000>MsgProp</span>:
</span></span><span style=display:flex><span>		<span style=color:#000>...</span>
</span></span><span style=display:flex><span>	<span style=color:#a90d91>case</span> <span style=color:#000>pb</span>.<span style=color:#000>MsgHeartbeat</span>:
</span></span><span style=display:flex><span>		<span style=color:#000>r</span>.<span style=color:#000>electionElapsed</span> = <span style=color:#1c01ce>0</span>
</span></span><span style=display:flex><span>		<span style=color:#000>r</span>.<span style=color:#000>lead</span> = <span style=color:#000>m</span>.<span style=color:#000>From</span>
</span></span><span style=display:flex><span>		<span style=color:#000>r</span>.<span style=color:#000>handleHeartbeat</span>(<span style=color:#000>m</span>)
</span></span><span style=display:flex><span>		<span style=color:#000>...</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a90d91>return</span> <span style=color:#a90d91>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> (<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>) <span style=color:#000>handleHeartbeat</span>(<span style=color:#000>m</span> <span style=color:#000>pb</span>.<span style=color:#000>Message</span>) {
</span></span><span style=display:flex><span>	<span style=color:#000>r</span>.<span style=color:#000>raftLog</span>.<span style=color:#000>commitTo</span>(<span style=color:#000>m</span>.<span style=color:#000>Commit</span>)
</span></span><span style=display:flex><span>	<span style=color:#000>r</span>.<span style=color:#000>send</span>(<span style=color:#000>pb</span>.<span style=color:#000>Message</span>{<span style=color:#000>To</span>: <span style=color:#000>m</span>.<span style=color:#000>From</span>, <span style=color:#000>Type</span>: <span style=color:#000>pb</span>.<span style=color:#000>MsgHeartbeatResp</span>, <span style=color:#000>Context</span>: <span style=color:#000>m</span>.<span style=color:#000>Context</span>})
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div></li></ol><h3 id=candidate>Candidate</h3><p>Candidate 来处理 MsgHeartbeat 的信息，是先把自己变成 Follower，然后和上面的 Follower 一样，回复 Leader 自己存活。</p><style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#177500>// stepCandidate is shared by StateCandidate and StatePreCandidate; the difference is
</span></span></span><span style=display:flex><span><span style=color:#177500>// whether they respond to MsgVoteResp or MsgPreVoteResp.
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>func</span> <span style=color:#000>stepCandidate</span>(<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>, <span style=color:#000>m</span> <span style=color:#000>pb</span>.<span style=color:#000>Message</span>) <span style=color:#a90d91>error</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>...</span>
</span></span><span style=display:flex><span>   <span style=color:#a90d91>switch</span> <span style=color:#000>m</span>.<span style=color:#000>Type</span> {
</span></span><span style=display:flex><span>   <span style=color:#000>...</span>
</span></span><span style=display:flex><span>   <span style=color:#a90d91>case</span> <span style=color:#000>pb</span>.<span style=color:#000>MsgHeartbeat</span>:
</span></span><span style=display:flex><span>      <span style=color:#000>r</span>.<span style=color:#000>becomeFollower</span>(<span style=color:#000>m</span>.<span style=color:#000>Term</span>, <span style=color:#000>m</span>.<span style=color:#000>From</span>) <span style=color:#177500>// always m.Term == r.Term
</span></span></span><span style=display:flex><span><span style=color:#177500></span>      <span style=color:#000>r</span>.<span style=color:#000>handleHeartbeat</span>(<span style=color:#000>m</span>)
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#000>...</span>
</span></span><span style=display:flex><span>   <span style=color:#a90d91>return</span> <span style=color:#a90d91>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> (<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>) <span style=color:#000>handleHeartbeat</span>(<span style=color:#000>m</span> <span style=color:#000>pb</span>.<span style=color:#000>Message</span>) {
</span></span><span style=display:flex><span>   <span style=color:#000>r</span>.<span style=color:#000>raftLog</span>.<span style=color:#000>commitTo</span>(<span style=color:#000>m</span>.<span style=color:#000>Commit</span>)
</span></span><span style=display:flex><span>   <span style=color:#000>r</span>.<span style=color:#000>send</span>(<span style=color:#000>pb</span>.<span style=color:#000>Message</span>{<span style=color:#000>To</span>: <span style=color:#000>m</span>.<span style=color:#000>From</span>, <span style=color:#000>Type</span>: <span style=color:#000>pb</span>.<span style=color:#000>MsgHeartbeatResp</span>, <span style=color:#000>Context</span>: <span style=color:#000>m</span>.<span style=color:#000>Context</span>})
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><p>当 Leader 收到返回信息时，会将对应节点设置为 RecentActive，表示该节点目前存活。<style>.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}.code-collapse1{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:100%}</style><div class=code-collapse1><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>stepLeader</span>(<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>, <span style=color:#000>m</span> <span style=color:#000>pb</span>.<span style=color:#000>Message</span>) <span style=color:#a90d91>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#000>...</span>
</span></span><span style=display:flex><span>	<span style=color:#177500>// 根据 from，取出当前的 Follower 的 Progress
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#000>pr</span> <span style=color:#000>:=</span> <span style=color:#000>r</span>.<span style=color:#000>prs</span>.<span style=color:#000>Progress</span>[<span style=color:#000>m</span>.<span style=color:#000>From</span>]
</span></span><span style=display:flex><span>	<span style=color:#a90d91>if</span> <span style=color:#000>pr</span> <span style=color:#000>==</span> <span style=color:#a90d91>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#000>r</span>.<span style=color:#000>logger</span>.<span style=color:#000>Debugf</span>(<span style=color:#c41a16>&#34;%x no progress available for %x&#34;</span>, <span style=color:#000>r</span>.<span style=color:#000>id</span>, <span style=color:#000>m</span>.<span style=color:#000>From</span>)
</span></span><span style=display:flex><span>		<span style=color:#a90d91>return</span> <span style=color:#a90d91>nil</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a90d91>switch</span> <span style=color:#000>m</span>.<span style=color:#000>Type</span> {
</span></span><span style=display:flex><span>	<span style=color:#a90d91>case</span> <span style=color:#000>pb</span>.<span style=color:#000>MsgHeartbeatResp</span>:
</span></span><span style=display:flex><span>		<span style=color:#000>pr</span>.<span style=color:#000>RecentActive</span> = <span style=color:#a90d91>true</span>
</span></span><span style=display:flex><span>		<span style=color:#000>...</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a90d91>return</span> <span style=color:#a90d91>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div></p><p>如果 Follower 在一定的时间内，没有收到 Leader 节点的消息，就会发起新一轮的选举，重新选一个 Leader 节点。</p><h2 id=leader-选举>Leader 选举</h2><h3 id=接收心跳>接收心跳</h3><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>func</span> (<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>) <span style=color:#000>becomeFollower</span>(<span style=color:#000>term</span> <span style=color:#a90d91>uint64</span>, <span style=color:#000>lead</span> <span style=color:#a90d91>uint64</span>) {
</span></span><span style=display:flex><span>	<span style=color:#000>r</span>.<span style=color:#000>step</span> = <span style=color:#000>stepFollower</span>
</span></span><span style=display:flex><span>	<span style=color:#000>r</span>.<span style=color:#000>reset</span>(<span style=color:#000>term</span>)
</span></span><span style=display:flex><span>	<span style=color:#000>r</span>.<span style=color:#000>tick</span> = <span style=color:#000>r</span>.<span style=color:#000>tickElection</span>
</span></span><span style=display:flex><span>	<span style=color:#000>r</span>.<span style=color:#000>lead</span> = <span style=color:#000>lead</span>
</span></span><span style=display:flex><span>	<span style=color:#000>r</span>.<span style=color:#000>state</span> = <span style=color:#000>StateFollower</span>
</span></span><span style=display:flex><span>	<span style=color:#000>r</span>.<span style=color:#000>logger</span>.<span style=color:#000>Infof</span>(<span style=color:#c41a16>&#34;%x became follower at term %d&#34;</span>, <span style=color:#000>r</span>.<span style=color:#000>id</span>, <span style=color:#000>r</span>.<span style=color:#000>Term</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#177500>// follower以及candidate的tick函数，在r.electionTimeout之后被调用
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>func</span> (<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>) <span style=color:#000>tickElection</span>() {
</span></span><span style=display:flex><span>	<span style=color:#000>r</span>.<span style=color:#000>electionElapsed</span><span style=color:#000>++</span>
</span></span><span style=display:flex><span>	<span style=color:#177500>// promotable返回是否可以被提升为leader
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#177500>// pastElectionTimeout检测当前的候选超时间是否过期
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#a90d91>if</span> <span style=color:#000>r</span>.<span style=color:#000>promotable</span>() <span style=color:#000>&amp;&amp;</span> <span style=color:#000>r</span>.<span style=color:#000>pastElectionTimeout</span>() {
</span></span><span style=display:flex><span>		<span style=color:#000>r</span>.<span style=color:#000>electionElapsed</span> = <span style=color:#1c01ce>0</span>
</span></span><span style=display:flex><span>		<span style=color:#177500>// 发起选举
</span></span></span><span style=display:flex><span><span style=color:#177500></span>		<span style=color:#000>r</span>.<span style=color:#000>Step</span>(<span style=color:#000>pb</span>.<span style=color:#000>Message</span>{<span style=color:#000>From</span>: <span style=color:#000>r</span>.<span style=color:#000>id</span>, <span style=color:#000>Type</span>: <span style=color:#000>pb</span>.<span style=color:#000>MsgHup</span>})
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br><p>小结：</p><ol><li>如果可以成为 Leader</li><li>当没有收到 Leader 心跳且候选超时时间过期；</li><li>则重新发起新的选举请求；</li></ol><h3 id=发起竞选>发起竞选</h3><p>Step 函数接收 MsgHup 这个类型的消息后会调用 campaign 函数，进入竞选状态。</p><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>func</span> (<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>) <span style=color:#000>Step</span>(<span style=color:#000>m</span> <span style=color:#000>pb</span>.<span style=color:#000>Message</span>) <span style=color:#a90d91>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#177500>//...
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#a90d91>switch</span> <span style=color:#000>m</span>.<span style=color:#000>Type</span> {
</span></span><span style=display:flex><span>	<span style=color:#a90d91>case</span> <span style=color:#000>pb</span>.<span style=color:#000>MsgHup</span>:
</span></span><span style=display:flex><span>		<span style=color:#a90d91>if</span> <span style=color:#000>r</span>.<span style=color:#000>preVote</span> {
</span></span><span style=display:flex><span>			<span style=color:#000>r</span>.<span style=color:#000>hup</span>(<span style=color:#000>campaignPreElection</span>)
</span></span><span style=display:flex><span>		} <span style=color:#a90d91>else</span> {
</span></span><span style=display:flex><span>			<span style=color:#000>r</span>.<span style=color:#000>hup</span>(<span style=color:#000>campaignElection</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> (<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>) <span style=color:#000>hup</span>(<span style=color:#000>t</span> <span style=color:#000>CampaignType</span>) {
</span></span><span style=display:flex><span>	<span style=color:#000>...</span>
</span></span><span style=display:flex><span>	<span style=color:#000>r</span>.<span style=color:#000>campaign</span>(<span style=color:#000>t</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> (<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>) <span style=color:#000>campaign</span>(<span style=color:#000>t</span> <span style=color:#000>CampaignType</span>) {
</span></span><span style=display:flex><span>	<span style=color:#000>...</span>
</span></span><span style=display:flex><span>	<span style=color:#a90d91>if</span> <span style=color:#000>t</span> <span style=color:#000>==</span> <span style=color:#000>campaignPreElection</span> {
</span></span><span style=display:flex><span>		<span style=color:#000>r</span>.<span style=color:#000>becomePreCandidate</span>()
</span></span><span style=display:flex><span>		<span style=color:#000>voteMsg</span> = <span style=color:#000>pb</span>.<span style=color:#000>MsgPreVote</span>
</span></span><span style=display:flex><span>		<span style=color:#177500>// PreVote RPCs are sent for the next term before we&#39;ve incremented r.Term.
</span></span></span><span style=display:flex><span><span style=color:#177500></span>		<span style=color:#000>term</span> = <span style=color:#000>r</span>.<span style=color:#000>Term</span> <span style=color:#000>+</span> <span style=color:#1c01ce>1</span>
</span></span><span style=display:flex><span>	} <span style=color:#a90d91>else</span> {
</span></span><span style=display:flex><span>		<span style=color:#177500>// 切换到Candidate状态
</span></span></span><span style=display:flex><span><span style=color:#177500></span>		<span style=color:#000>r</span>.<span style=color:#000>becomeCandidate</span>()
</span></span><span style=display:flex><span>		<span style=color:#000>voteMsg</span> = <span style=color:#000>pb</span>.<span style=color:#000>MsgVote</span>
</span></span><span style=display:flex><span>		<span style=color:#000>term</span> = <span style=color:#000>r</span>.<span style=color:#000>Term</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#177500>// 统计当前节点收到的选票 并统计其得票数是否超过半数，这次检测主要是为单节点设置的
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#177500>// 判断是否是单节点
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#a90d91>if</span> <span style=color:#000>_</span>, <span style=color:#000>_</span>, <span style=color:#000>res</span> <span style=color:#000>:=</span> <span style=color:#000>r</span>.<span style=color:#000>poll</span>(<span style=color:#000>r</span>.<span style=color:#000>id</span>, <span style=color:#000>voteRespMsgType</span>(<span style=color:#000>voteMsg</span>), <span style=color:#a90d91>true</span>); <span style=color:#000>res</span> <span style=color:#000>==</span> <span style=color:#000>quorum</span>.<span style=color:#000>VoteWon</span> {
</span></span><span style=display:flex><span>		<span style=color:#a90d91>if</span> <span style=color:#000>t</span> <span style=color:#000>==</span> <span style=color:#000>campaignPreElection</span> {
</span></span><span style=display:flex><span>			<span style=color:#000>r</span>.<span style=color:#000>campaign</span>(<span style=color:#000>campaignElection</span>)
</span></span><span style=display:flex><span>		} <span style=color:#a90d91>else</span> {
</span></span><span style=display:flex><span>			<span style=color:#177500>// 是单节点的话直接变成 Leader
</span></span></span><span style=display:flex><span><span style=color:#177500></span>			<span style=color:#000>r</span>.<span style=color:#000>becomeLeader</span>()
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#a90d91>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#000>...</span>
</span></span><span style=display:flex><span>	<span style=color:#177500>// 向集群中的所有节点发送信息请求投票
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#a90d91>for</span> <span style=color:#000>_</span>, <span style=color:#000>id</span> <span style=color:#000>:=</span> <span style=color:#a90d91>range</span> <span style=color:#000>ids</span> {
</span></span><span style=display:flex><span>		<span style=color:#177500>// 跳过自身的节点
</span></span></span><span style=display:flex><span><span style=color:#177500></span>		<span style=color:#a90d91>if</span> <span style=color:#000>id</span> <span style=color:#000>==</span> <span style=color:#000>r</span>.<span style=color:#000>id</span> {
</span></span><span style=display:flex><span>			<span style=color:#a90d91>continue</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#000>r</span>.<span style=color:#000>logger</span>.<span style=color:#000>Infof</span>(<span style=color:#c41a16>&#34;%x [logterm: %d, index: %d] sent %s request to %x at term %d&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#000>r</span>.<span style=color:#000>id</span>, <span style=color:#000>r</span>.<span style=color:#000>raftLog</span>.<span style=color:#000>lastTerm</span>(), <span style=color:#000>r</span>.<span style=color:#000>raftLog</span>.<span style=color:#000>lastIndex</span>(), <span style=color:#000>voteMsg</span>, <span style=color:#000>id</span>, <span style=color:#000>r</span>.<span style=color:#000>Term</span>)
</span></span><span style=display:flex><span>		<span style=color:#a90d91>var</span> <span style=color:#000>ctx</span> []<span style=color:#a90d91>byte</span>
</span></span><span style=display:flex><span>		<span style=color:#a90d91>if</span> <span style=color:#000>t</span> <span style=color:#000>==</span> <span style=color:#000>campaignTransfer</span> {
</span></span><span style=display:flex><span>			<span style=color:#000>ctx</span> = []<span style=color:#a90d91>byte</span>(<span style=color:#000>t</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#000>r</span>.<span style=color:#000>send</span>(<span style=color:#000>pb</span>.<span style=color:#000>Message</span>{<span style=color:#000>Term</span>: <span style=color:#000>term</span>, <span style=color:#000>To</span>: <span style=color:#000>id</span>, <span style=color:#000>Type</span>: <span style=color:#000>voteMsg</span>, <span style=color:#000>Index</span>: <span style=color:#000>r</span>.<span style=color:#000>raftLog</span>.<span style=color:#000>lastIndex</span>(), <span style=color:#000>LogTerm</span>: <span style=color:#000>r</span>.<span style=color:#000>raftLog</span>.<span style=color:#000>lastTerm</span>(), <span style=color:#000>Context</span>: <span style=color:#000>ctx</span>})
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br><p>切换到 campaign 状态，然后发送自己的 term 消息，请求投票。
campaignPreElection 的作用：</p><blockquote><p>当系统之前出现分区，在分区消失后恢复时，可能会造成某个被 split 的 Followe r的 Term 数值很大。
对服务器进行分区时，它将不会收到 heartbeat 包，每次 electionTimeout 后成为 Candidate 都会递增 Term。
服务器在一段时间后恢复连接时，Term 的值将会变得很大，然后引入的重新选举会导致导致临时的延迟与可用性问题。
PreElection 阶段并不会真正增加当前节点的 Term，它的主要作用是得到当前集群能否成功选举出一个 Leader 的答案，避免上面这种情况的发生。</p></blockquote><h3 id=接受消息并投票>接受消息并投票</h3><p>投票需要满足的条件：</p><ol><li><strong>当前节点没有给任何节点投票</strong>或者 <strong>投票的节点 term 大于本节点的</strong>或者 <strong>是之前已经投票的节点</strong>；</li><li>该节点的消息是最新的。</li></ol><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>func</span> (<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>) <span style=color:#000>Step</span>(<span style=color:#000>m</span> <span style=color:#000>pb</span>.<span style=color:#000>Message</span>) <span style=color:#a90d91>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#000>...</span>
</span></span><span style=display:flex><span>	<span style=color:#a90d91>switch</span> <span style=color:#000>m</span>.<span style=color:#000>Type</span> {
</span></span><span style=display:flex><span>	<span style=color:#a90d91>case</span> <span style=color:#000>pb</span>.<span style=color:#000>MsgVote</span>, <span style=color:#000>pb</span>.<span style=color:#000>MsgPreVote</span>:
</span></span><span style=display:flex><span>		<span style=color:#177500>// We can vote if this is a repeat of a vote we&#39;ve already cast...
</span></span></span><span style=display:flex><span><span style=color:#177500></span>		<span style=color:#000>canVote</span> <span style=color:#000>:=</span> <span style=color:#000>r</span>.<span style=color:#000>Vote</span> <span style=color:#000>==</span> <span style=color:#000>m</span>.<span style=color:#000>From</span> <span style=color:#000>||</span>
</span></span><span style=display:flex><span>			<span style=color:#177500>// ...we haven&#39;t voted and we don&#39;t think there&#39;s a leader yet in this term...
</span></span></span><span style=display:flex><span><span style=color:#177500></span>			(<span style=color:#000>r</span>.<span style=color:#000>Vote</span> <span style=color:#000>==</span> <span style=color:#000>None</span> <span style=color:#000>&amp;&amp;</span> <span style=color:#000>r</span>.<span style=color:#000>lead</span> <span style=color:#000>==</span> <span style=color:#000>None</span>) <span style=color:#000>||</span>
</span></span><span style=display:flex><span>			<span style=color:#177500>// ...or this is a PreVote for a future term...
</span></span></span><span style=display:flex><span><span style=color:#177500></span>			(<span style=color:#000>m</span>.<span style=color:#000>Type</span> <span style=color:#000>==</span> <span style=color:#000>pb</span>.<span style=color:#000>MsgPreVote</span> <span style=color:#000>&amp;&amp;</span> <span style=color:#000>m</span>.<span style=color:#000>Term</span> &gt; <span style=color:#000>r</span>.<span style=color:#000>Term</span>)
</span></span><span style=display:flex><span>		<span style=color:#177500>// ...and we believe the candidate is up to date.
</span></span></span><span style=display:flex><span><span style=color:#177500></span>		<span style=color:#a90d91>if</span> <span style=color:#000>canVote</span> <span style=color:#000>&amp;&amp;</span> <span style=color:#000>r</span>.<span style=color:#000>raftLog</span>.<span style=color:#000>isUpToDate</span>(<span style=color:#000>m</span>.<span style=color:#000>Index</span>, <span style=color:#000>m</span>.<span style=color:#000>LogTerm</span>) {
</span></span><span style=display:flex><span>			<span style=color:#177500>// 如果当前没有给任何节点投票（r.Vote == None） 
</span></span></span><span style=display:flex><span><span style=color:#177500></span>            <span style=color:#177500>// 或者 投票的节点 term 大于本节点的（m.Term &gt; r.Term）
</span></span></span><span style=display:flex><span><span style=color:#177500></span>			<span style=color:#177500>// 或者 是之前已经投票的节点（r.Vote == m.From）
</span></span></span><span style=display:flex><span><span style=color:#177500></span>			<span style=color:#177500>// 同时还满足该节点的消息是最新的（r.raftLog.isUpToDate(m.Index, m.LogTerm)），
</span></span></span><span style=display:flex><span><span style=color:#177500></span>            <span style=color:#177500>// 那么就接收这个节点的投票
</span></span></span><span style=display:flex><span><span style=color:#177500></span>			<span style=color:#000>r</span>.<span style=color:#000>logger</span>.<span style=color:#000>Infof</span>(<span style=color:#c41a16>&#34;%x [logterm: %d, index: %d, vote: %x] cast %s for %x [logterm: %d, index: %d] at term %d&#34;</span>,
</span></span><span style=display:flex><span>				<span style=color:#000>r</span>.<span style=color:#000>id</span>, <span style=color:#000>r</span>.<span style=color:#000>raftLog</span>.<span style=color:#000>lastTerm</span>(), <span style=color:#000>r</span>.<span style=color:#000>raftLog</span>.<span style=color:#000>lastIndex</span>(), <span style=color:#000>r</span>.<span style=color:#000>Vote</span>, <span style=color:#000>m</span>.<span style=color:#000>Type</span>, <span style=color:#000>m</span>.<span style=color:#000>From</span>, <span style=color:#000>m</span>.<span style=color:#000>LogTerm</span>, <span style=color:#000>m</span>.<span style=color:#000>Index</span>, <span style=color:#000>r</span>.<span style=color:#000>Term</span>)
</span></span><span style=display:flex><span>			<span style=color:#000>r</span>.<span style=color:#000>send</span>(<span style=color:#000>pb</span>.<span style=color:#000>Message</span>{<span style=color:#000>To</span>: <span style=color:#000>m</span>.<span style=color:#000>From</span>, <span style=color:#000>Term</span>: <span style=color:#000>m</span>.<span style=color:#000>Term</span>, <span style=color:#000>Type</span>: <span style=color:#000>voteRespMsgType</span>(<span style=color:#000>m</span>.<span style=color:#000>Type</span>)})
</span></span><span style=display:flex><span>			<span style=color:#a90d91>if</span> <span style=color:#000>m</span>.<span style=color:#000>Type</span> <span style=color:#000>==</span> <span style=color:#000>pb</span>.<span style=color:#000>MsgVote</span> {
</span></span><span style=display:flex><span>				<span style=color:#177500>// 保存给哪个节点投票
</span></span></span><span style=display:flex><span><span style=color:#177500></span>				<span style=color:#000>r</span>.<span style=color:#000>electionElapsed</span> = <span style=color:#1c01ce>0</span>
</span></span><span style=display:flex><span>				<span style=color:#000>r</span>.<span style=color:#000>Vote</span> = <span style=color:#000>m</span>.<span style=color:#000>From</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		} <span style=color:#a90d91>else</span> {
</span></span><span style=display:flex><span>			<span style=color:#000>r</span>.<span style=color:#000>logger</span>.<span style=color:#000>Infof</span>(<span style=color:#c41a16>&#34;%x [logterm: %d, index: %d, vote: %x] rejected %s from %x [logterm: %d, index: %d] at term %d&#34;</span>,
</span></span><span style=display:flex><span>				<span style=color:#000>r</span>.<span style=color:#000>id</span>, <span style=color:#000>r</span>.<span style=color:#000>raftLog</span>.<span style=color:#000>lastTerm</span>(), <span style=color:#000>r</span>.<span style=color:#000>raftLog</span>.<span style=color:#000>lastIndex</span>(), <span style=color:#000>r</span>.<span style=color:#000>Vote</span>, <span style=color:#000>m</span>.<span style=color:#000>Type</span>, <span style=color:#000>m</span>.<span style=color:#000>From</span>, <span style=color:#000>m</span>.<span style=color:#000>LogTerm</span>, <span style=color:#000>m</span>.<span style=color:#000>Index</span>, <span style=color:#000>r</span>.<span style=color:#000>Term</span>)
</span></span><span style=display:flex><span>			<span style=color:#000>r</span>.<span style=color:#000>send</span>(<span style=color:#000>pb</span>.<span style=color:#000>Message</span>{<span style=color:#000>To</span>: <span style=color:#000>m</span>.<span style=color:#000>From</span>, <span style=color:#000>Term</span>: <span style=color:#000>r</span>.<span style=color:#000>Term</span>, <span style=color:#000>Type</span>: <span style=color:#000>voteRespMsgType</span>(<span style=color:#000>m</span>.<span style=color:#000>Type</span>), <span style=color:#000>Reject</span>: <span style=color:#a90d91>true</span>})
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#000>...</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a90d91>return</span> <span style=color:#a90d91>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br><h3 id=candidate-统计投票>Candidate 统计投票</h3><p>Candidate 节点接收到投票信息，然后统计投票数量</p><ol><li>如果投票数大于节点数的一半，成为 Leader；</li><li>如果不满足则变成 Follower；</li></ol><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>stepCandidate</span>(<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>, <span style=color:#000>m</span> <span style=color:#000>pb</span>.<span style=color:#000>Message</span>) <span style=color:#a90d91>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#177500>// Only handle vote responses corresponding to our candidacy (while in
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#177500>// StateCandidate, we may get stale MsgPreVoteResp messages in this term from
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#177500>// our pre-candidate state).
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#a90d91>var</span> <span style=color:#000>myVoteRespType</span> <span style=color:#000>pb</span>.<span style=color:#000>MessageType</span>
</span></span><span style=display:flex><span>	<span style=color:#a90d91>if</span> <span style=color:#000>r</span>.<span style=color:#000>state</span> <span style=color:#000>==</span> <span style=color:#000>StatePreCandidate</span> {
</span></span><span style=display:flex><span>		<span style=color:#000>myVoteRespType</span> = <span style=color:#000>pb</span>.<span style=color:#000>MsgPreVoteResp</span>
</span></span><span style=display:flex><span>	} <span style=color:#a90d91>else</span> {
</span></span><span style=display:flex><span>		<span style=color:#000>myVoteRespType</span> = <span style=color:#000>pb</span>.<span style=color:#000>MsgVoteResp</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a90d91>switch</span> <span style=color:#000>m</span>.<span style=color:#000>Type</span> {
</span></span><span style=display:flex><span>	<span style=color:#a90d91>case</span> <span style=color:#000>myVoteRespType</span>:
</span></span><span style=display:flex><span>		<span style=color:#177500>// 计算当前集群中给自己投票的节点数
</span></span></span><span style=display:flex><span><span style=color:#177500></span>		<span style=color:#000>gr</span>, <span style=color:#000>rj</span>, <span style=color:#000>res</span> <span style=color:#000>:=</span> <span style=color:#000>r</span>.<span style=color:#000>poll</span>(<span style=color:#000>m</span>.<span style=color:#000>From</span>, <span style=color:#000>m</span>.<span style=color:#000>Type</span>, !<span style=color:#000>m</span>.<span style=color:#000>Reject</span>)
</span></span><span style=display:flex><span>		<span style=color:#000>r</span>.<span style=color:#000>logger</span>.<span style=color:#000>Infof</span>(<span style=color:#c41a16>&#34;%x has received %d %s votes and %d vote rejections&#34;</span>, <span style=color:#000>r</span>.<span style=color:#000>id</span>, <span style=color:#000>gr</span>, <span style=color:#000>m</span>.<span style=color:#000>Type</span>, <span style=color:#000>rj</span>)
</span></span><span style=display:flex><span>		<span style=color:#a90d91>switch</span> <span style=color:#000>res</span> {
</span></span><span style=display:flex><span>		<span style=color:#177500>// 大多数得票
</span></span></span><span style=display:flex><span><span style=color:#177500></span>		<span style=color:#a90d91>case</span> <span style=color:#000>quorum</span>.<span style=color:#000>VoteWon</span>:
</span></span><span style=display:flex><span>			<span style=color:#a90d91>if</span> <span style=color:#000>r</span>.<span style=color:#000>state</span> <span style=color:#000>==</span> <span style=color:#000>StatePreCandidate</span> {
</span></span><span style=display:flex><span>				<span style=color:#000>r</span>.<span style=color:#000>campaign</span>(<span style=color:#000>campaignElection</span>)
</span></span><span style=display:flex><span>			} <span style=color:#a90d91>else</span> {
</span></span><span style=display:flex><span>				<span style=color:#177500>// 如果进行投票的节点数量正好是半数以上节点数量
</span></span></span><span style=display:flex><span><span style=color:#177500></span>				<span style=color:#000>r</span>.<span style=color:#000>becomeLeader</span>()
</span></span><span style=display:flex><span>				<span style=color:#177500>// 向集群中其他节点广播 MsgApp 消息
</span></span></span><span style=display:flex><span><span style=color:#177500></span>				<span style=color:#000>r</span>.<span style=color:#000>bcastAppend</span>()
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#177500>// 票数不够
</span></span></span><span style=display:flex><span><span style=color:#177500></span>		<span style=color:#a90d91>case</span> <span style=color:#000>quorum</span>.<span style=color:#000>VoteLost</span>:
</span></span><span style=display:flex><span>			<span style=color:#177500>// pb.MsgPreVoteResp contains future term of pre-candidate
</span></span></span><span style=display:flex><span><span style=color:#177500></span>			<span style=color:#177500>// m.Term &gt; r.Term; reuse r.Term
</span></span></span><span style=display:flex><span><span style=color:#177500></span>			<span style=color:#177500>// 切换到 Follower
</span></span></span><span style=display:flex><span><span style=color:#177500></span>			<span style=color:#000>r</span>.<span style=color:#000>becomeFollower</span>(<span style=color:#000>r</span>.<span style=color:#000>Term</span>, <span style=color:#000>None</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#000>...</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a90d91>return</span> <span style=color:#a90d91>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br><p>每当收到一个 MsgVoteResp 类型的消息时，就会设置当前节点持有的 votes 数组，更新其中存储的节点投票状态，如果收到大多数的节点票数，切换成 Leader，向其他的节点发送当前节点当选的消息，通知其余节点更新 Raft 结构体中的 Term 等信息。
状态切换：</p><p><img src=../imgs/raft_sourcecode20220904_3.png alt=raft_sourcecode20220904_3.png></p><p>PreCandidate 是为了防止在分区的情况下，某个 split 的 Follower 的 Term 数值变得很大。</p><p>不同节点之间的切换，调用对应的 bacome* 方法就可以。需要注意每个 bacome* 中的 step 和 tick。</p><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>func</span> (<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>) <span style=color:#000>becomeFollower</span>(<span style=color:#000>term</span> <span style=color:#a90d91>uint64</span>, <span style=color:#000>lead</span> <span style=color:#a90d91>uint64</span>) {
</span></span><span style=display:flex><span>	<span style=color:#000>r</span>.<span style=color:#000>step</span> = <span style=color:#000>stepFollower</span>
</span></span><span style=display:flex><span>	<span style=color:#000>r</span>.<span style=color:#000>reset</span>(<span style=color:#000>term</span>)
</span></span><span style=display:flex><span>	<span style=color:#000>r</span>.<span style=color:#000>tick</span> = <span style=color:#000>r</span>.<span style=color:#000>tickElection</span>
</span></span><span style=display:flex><span>	<span style=color:#000>r</span>.<span style=color:#000>lead</span> = <span style=color:#000>lead</span>
</span></span><span style=display:flex><span>	<span style=color:#000>r</span>.<span style=color:#000>state</span> = <span style=color:#000>StateFollower</span>
</span></span><span style=display:flex><span>	<span style=color:#000>r</span>.<span style=color:#000>logger</span>.<span style=color:#000>Infof</span>(<span style=color:#c41a16>&#34;%x became follower at term %d&#34;</span>, <span style=color:#000>r</span>.<span style=color:#000>id</span>, <span style=color:#000>r</span>.<span style=color:#000>Term</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> (<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>) <span style=color:#000>becomeCandidate</span>() {
</span></span><span style=display:flex><span>	<span style=color:#177500>// TODO(xiangli) remove the panic when the raft implementation is stable
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#a90d91>if</span> <span style=color:#000>r</span>.<span style=color:#000>state</span> <span style=color:#000>==</span> <span style=color:#000>StateLeader</span> {
</span></span><span style=display:flex><span>		<span style=color:#a90d91>panic</span>(<span style=color:#c41a16>&#34;invalid transition [leader -&gt; candidate]&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#000>r</span>.<span style=color:#000>step</span> = <span style=color:#000>stepCandidate</span>
</span></span><span style=display:flex><span>	<span style=color:#000>r</span>.<span style=color:#000>reset</span>(<span style=color:#000>r</span>.<span style=color:#000>Term</span> <span style=color:#000>+</span> <span style=color:#1c01ce>1</span>)
</span></span><span style=display:flex><span>	<span style=color:#000>r</span>.<span style=color:#000>tick</span> = <span style=color:#000>r</span>.<span style=color:#000>tickElection</span>
</span></span><span style=display:flex><span>	<span style=color:#000>r</span>.<span style=color:#000>Vote</span> = <span style=color:#000>r</span>.<span style=color:#000>id</span>
</span></span><span style=display:flex><span>	<span style=color:#000>r</span>.<span style=color:#000>state</span> = <span style=color:#000>StateCandidate</span>
</span></span><span style=display:flex><span>	<span style=color:#000>r</span>.<span style=color:#000>logger</span>.<span style=color:#000>Infof</span>(<span style=color:#c41a16>&#34;%x became candidate at term %d&#34;</span>, <span style=color:#000>r</span>.<span style=color:#000>id</span>, <span style=color:#000>r</span>.<span style=color:#000>Term</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br><p>step 属性是一个函数指针，根据当前节点的不同角色，指向不同的消息处理函数，如 stepLeader/stepFollower/stepCandidate。
tick 也是一个函数指针，根据角色的不同，也会在 tickHeartbeat 和 tickElection 之间来回切换，分别用来触发定时心跳和选举检测。</p><h1 id=日志同步>日志同步</h1><h2 id=wal-日志>WAL 日志</h2><p>WAL（Write Ahead Log）主要的作用是记录整个数据变化的全部历程。etcd 中所有数据的修改在提交前，都要先写入到 WAL 中。这使得etcd拥有两个重要功能：</p><ul><li>故障快速恢复</li></ul><blockquote><p>数据遭到破坏时，可以通过执行所有 WAL 中记录的修改操作，快速从最原始的数据恢复到数据损坏前的状态。</p></blockquote><ul><li>数据回滚（undo）/重做（redo）</li></ul><blockquote><p>所有的修改操作都被记录在 WAL 中，需要回滚或重做，只需要反向或正向执行日志中的操作即可，类似 MySQL 。</p></blockquote><p>etcd中处理 Entry 记录的流程图（摘自【etcd技术内幕】)</p><p><img src=../imgs/raft_sourcecode20220904_4.png alt=raft_sourcecode20220904_4.png></p><p>具体流程如下：</p><ol><li>客户端向 etcd 集群发起一次请求，请求中封装的 Entry 首先会交给 etcd-raft 处理，etcd-raft 会将 Entry 记录保存到 raftLog.unstable 中；</li><li>etcd-raft 将 Entry 记录封装到 Ready 实例中，返回给上层模块进行持久化；</li><li>上层模块收到持久化的 Ready 记录后，会记录到 WAL 文件中然后持久化，最后通知 etcd-raft 模块进行处理；</li><li>etcd-raft 将该 Entry 记录从 unstable 中移到 storage 中保存；</li><li>当 Entry 记录被复制到集群中的半数以上节点时，该记录会被 Leader 节点认为已经提交，封装到 Ready 实例中通知上层模块；</li><li>此时上层模块将该 Ready 实例封装的 Entry 记录应用到状态机上。</li></ol><h2 id=同步日志>同步日志</h2><p>etcd 中 Leader 节点数据 同步 到 Follower 流程图：</p><p><img src=../imgs/raft_sourcecode20220904_5.png alt=raft_sourcecode20220904_5.png></p><p>etcd 日志保存的总体流程如下：</p><p>1、集群某个节点收到 client 的 put 请求要求修改数据。节点会生成一个 Type 为 MsgProp 的Message，发送给 Leader。</p><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#177500>// 生成MsgProp消息
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>func</span> (<span style=color:#000>n</span> <span style=color:#000>*</span><span style=color:#000>node</span>) <span style=color:#000>Propose</span>(<span style=color:#000>ctx</span> <span style=color:#000>context</span>.<span style=color:#000>Context</span>, <span style=color:#000>data</span> []<span style=color:#a90d91>byte</span>) <span style=color:#a90d91>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#a90d91>return</span> <span style=color:#000>n</span>.<span style=color:#000>stepWait</span>(<span style=color:#000>ctx</span>, <span style=color:#000>pb</span>.<span style=color:#000>Message</span>{<span style=color:#000>Type</span>: <span style=color:#000>pb</span>.<span style=color:#000>MsgProp</span>, <span style=color:#000>Entries</span>: []<span style=color:#000>pb</span>.<span style=color:#000>Entry</span>{{<span style=color:#000>Data</span>: <span style=color:#000>data</span>}}})
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>stepFollower</span>(<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>, <span style=color:#000>m</span> <span style=color:#000>pb</span>.<span style=color:#000>Message</span>) <span style=color:#a90d91>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#a90d91>switch</span> <span style=color:#000>m</span>.<span style=color:#000>Type</span> {
</span></span><span style=display:flex><span>	<span style=color:#a90d91>case</span> <span style=color:#000>pb</span>.<span style=color:#000>MsgProp</span>:
</span></span><span style=display:flex><span>		<span style=color:#a90d91>if</span> <span style=color:#000>r</span>.<span style=color:#000>lead</span> <span style=color:#000>==</span> <span style=color:#000>None</span> {
</span></span><span style=display:flex><span>			<span style=color:#000>r</span>.<span style=color:#000>logger</span>.<span style=color:#000>Infof</span>(<span style=color:#c41a16>&#34;%x no leader at term %d; dropping proposal&#34;</span>, <span style=color:#000>r</span>.<span style=color:#000>id</span>, <span style=color:#000>r</span>.<span style=color:#000>Term</span>)
</span></span><span style=display:flex><span>			<span style=color:#a90d91>return</span> <span style=color:#000>ErrProposalDropped</span>
</span></span><span style=display:flex><span>		} <span style=color:#a90d91>else</span> <span style=color:#a90d91>if</span> <span style=color:#000>r</span>.<span style=color:#000>disableProposalForwarding</span> {
</span></span><span style=display:flex><span>			<span style=color:#000>r</span>.<span style=color:#000>logger</span>.<span style=color:#000>Infof</span>(<span style=color:#c41a16>&#34;%x not forwarding to leader %x at term %d; dropping proposal&#34;</span>, <span style=color:#000>r</span>.<span style=color:#000>id</span>, <span style=color:#000>r</span>.<span style=color:#000>lead</span>, <span style=color:#000>r</span>.<span style=color:#000>Term</span>)
</span></span><span style=display:flex><span>			<span style=color:#a90d91>return</span> <span style=color:#000>ErrProposalDropped</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#177500>// 设置发送的目标为leader
</span></span></span><span style=display:flex><span><span style=color:#177500></span>		<span style=color:#177500>// 将信息发送给leader
</span></span></span><span style=display:flex><span><span style=color:#177500></span>		<span style=color:#000>m</span>.<span style=color:#000>To</span> = <span style=color:#000>r</span>.<span style=color:#000>lead</span>
</span></span><span style=display:flex><span>		<span style=color:#000>r</span>.<span style=color:#000>send</span>(<span style=color:#000>m</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a90d91>return</span> <span style=color:#a90d91>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br><p>2、Leader 收到 Message 后，会处理 Message 中的日志条目，将其 append 到 raftLog 的unstable 的日志中，并且调用 bcastAppend() 广播 append 日志的消息。<style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>stepLeader</span>(<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>, <span style=color:#000>m</span> <span style=color:#000>pb</span>.<span style=color:#000>Message</span>) <span style=color:#a90d91>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#177500>// These message types do not require any progress for m.From.
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#a90d91>switch</span> <span style=color:#000>m</span>.<span style=color:#000>Type</span> {
</span></span><span style=display:flex><span>		<span style=color:#000>...</span>
</span></span><span style=display:flex><span>	<span style=color:#a90d91>case</span> <span style=color:#000>pb</span>.<span style=color:#000>MsgProp</span>:
</span></span><span style=display:flex><span>		<span style=color:#000>...</span>
</span></span><span style=display:flex><span>		<span style=color:#177500>// 将Entry记录追加到当前节点的raftlog中
</span></span></span><span style=display:flex><span><span style=color:#177500></span>		<span style=color:#a90d91>if</span> !<span style=color:#000>r</span>.<span style=color:#000>appendEntry</span>(<span style=color:#000>m</span>.<span style=color:#000>Entries</span><span style=color:#000>...</span>) {
</span></span><span style=display:flex><span>			<span style=color:#a90d91>return</span> <span style=color:#000>ErrProposalDropped</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#177500>// 向其他节点复制Entry记录
</span></span></span><span style=display:flex><span><span style=color:#177500></span>		<span style=color:#000>r</span>.<span style=color:#000>bcastAppend</span>()
</span></span><span style=display:flex><span>		<span style=color:#a90d91>return</span> <span style=color:#a90d91>nil</span>
</span></span><span style=display:flex><span>		<span style=color:#000>...</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a90d91>return</span> <span style=color:#a90d91>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> (<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>) <span style=color:#000>maybeSendAppend</span>(<span style=color:#000>to</span> <span style=color:#a90d91>uint64</span>, <span style=color:#000>sendIfEmpty</span> <span style=color:#a90d91>bool</span>) <span style=color:#a90d91>bool</span> {
</span></span><span style=display:flex><span>	<span style=color:#000>pr</span> <span style=color:#000>:=</span> <span style=color:#000>r</span>.<span style=color:#000>prs</span>.<span style=color:#000>Progress</span>[<span style=color:#000>to</span>]
</span></span><span style=display:flex><span>	<span style=color:#a90d91>if</span> <span style=color:#000>pr</span>.<span style=color:#000>IsPaused</span>() {
</span></span><span style=display:flex><span>		<span style=color:#a90d91>return</span> <span style=color:#a90d91>false</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#000>m</span> <span style=color:#000>:=</span> <span style=color:#000>pb</span>.<span style=color:#000>Message</span>{}
</span></span><span style=display:flex><span>	<span style=color:#000>m</span>.<span style=color:#000>To</span> = <span style=color:#000>to</span>
</span></span><span style=display:flex><span>	<span style=color:#000>...</span>
</span></span><span style=display:flex><span>	<span style=color:#000>m</span>.<span style=color:#000>Type</span> = <span style=color:#000>pb</span>.<span style=color:#000>MsgApp</span>
</span></span><span style=display:flex><span>	<span style=color:#000>m</span>.<span style=color:#000>Index</span> = <span style=color:#000>pr</span>.<span style=color:#000>Next</span> <span style=color:#000>-</span> <span style=color:#1c01ce>1</span>
</span></span><span style=display:flex><span>	<span style=color:#000>m</span>.<span style=color:#000>LogTerm</span> = <span style=color:#000>term</span>
</span></span><span style=display:flex><span>	<span style=color:#000>m</span>.<span style=color:#000>Entries</span> = <span style=color:#000>ents</span>
</span></span><span style=display:flex><span>	<span style=color:#000>m</span>.<span style=color:#000>Commit</span> = <span style=color:#000>r</span>.<span style=color:#000>raftLog</span>.<span style=color:#000>committed</span>
</span></span><span style=display:flex><span>	<span style=color:#a90d91>if</span> <span style=color:#000>n</span> <span style=color:#000>:=</span> <span style=color:#a90d91>len</span>(<span style=color:#000>m</span>.<span style=color:#000>Entries</span>); <span style=color:#000>n</span> <span style=color:#000>!=</span> <span style=color:#1c01ce>0</span> {
</span></span><span style=display:flex><span>		<span style=color:#a90d91>switch</span> <span style=color:#000>pr</span>.<span style=color:#000>State</span> {
</span></span><span style=display:flex><span>		<span style=color:#177500>// optimistically increase the next when in StateReplicate
</span></span></span><span style=display:flex><span><span style=color:#177500></span>		<span style=color:#a90d91>case</span> <span style=color:#000>tracker</span>.<span style=color:#000>StateReplicate</span>:
</span></span><span style=display:flex><span>			<span style=color:#000>last</span> <span style=color:#000>:=</span> <span style=color:#000>m</span>.<span style=color:#000>Entries</span>[<span style=color:#000>n</span><span style=color:#000>-</span><span style=color:#1c01ce>1</span>].<span style=color:#000>Index</span>
</span></span><span style=display:flex><span>			<span style=color:#000>pr</span>.<span style=color:#000>OptimisticUpdate</span>(<span style=color:#000>last</span>)
</span></span><span style=display:flex><span>			<span style=color:#000>pr</span>.<span style=color:#000>Inflights</span>.<span style=color:#000>Add</span>(<span style=color:#000>last</span>)
</span></span><span style=display:flex><span>		<span style=color:#a90d91>case</span> <span style=color:#000>tracker</span>.<span style=color:#000>StateProbe</span>:
</span></span><span style=display:flex><span>			<span style=color:#000>pr</span>.<span style=color:#000>ProbeSent</span> = <span style=color:#a90d91>true</span>
</span></span><span style=display:flex><span>		<span style=color:#a90d91>default</span>:
</span></span><span style=display:flex><span>			<span style=color:#000>r</span>.<span style=color:#000>logger</span>.<span style=color:#000>Panicf</span>(<span style=color:#c41a16>&#34;%x is sending append in unhandled state %s&#34;</span>, <span style=color:#000>r</span>.<span style=color:#000>id</span>, <span style=color:#000>pr</span>.<span style=color:#000>State</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#000>r</span>.<span style=color:#000>send</span>(<span style=color:#000>m</span>)
</span></span><span style=display:flex><span>	<span style=color:#a90d91>return</span> <span style=color:#a90d91>true</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br></p><p>3、Leader 中的消息最终会以 MsgApp 类型的消息通知 Follower，Follower 收到信息之后，同 Leader 一样先将缓存中的日志条目持久化到磁盘中，并将当前已经持久化的最新日志 index 返回给 Leader。<style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>stepFollower</span>(<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>, <span style=color:#000>m</span> <span style=color:#000>pb</span>.<span style=color:#000>Message</span>) <span style=color:#a90d91>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#a90d91>switch</span> <span style=color:#000>m</span>.<span style=color:#000>Type</span> {
</span></span><span style=display:flex><span>	<span style=color:#a90d91>case</span> <span style=color:#000>pb</span>.<span style=color:#000>MsgApp</span>:
</span></span><span style=display:flex><span>		<span style=color:#000>r</span>.<span style=color:#000>electionElapsed</span> = <span style=color:#1c01ce>0</span>
</span></span><span style=display:flex><span>		<span style=color:#000>r</span>.<span style=color:#000>lead</span> = <span style=color:#000>m</span>.<span style=color:#000>From</span>
</span></span><span style=display:flex><span>		<span style=color:#000>r</span>.<span style=color:#000>handleAppendEntries</span>(<span style=color:#000>m</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a90d91>return</span> <span style=color:#a90d91>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> (<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>) <span style=color:#000>handleAppendEntries</span>(<span style=color:#000>m</span> <span style=color:#000>pb</span>.<span style=color:#000>Message</span>) {
</span></span><span style=display:flex><span>	<span style=color:#000>...</span>.
</span></span><span style=display:flex><span>	<span style=color:#a90d91>if</span> <span style=color:#000>mlastIndex</span>, <span style=color:#000>ok</span> <span style=color:#000>:=</span> <span style=color:#000>r</span>.<span style=color:#000>raftLog</span>.<span style=color:#000>maybeAppend</span>(<span style=color:#000>m</span>.<span style=color:#000>Index</span>, <span style=color:#000>m</span>.<span style=color:#000>LogTerm</span>, <span style=color:#000>m</span>.<span style=color:#000>Commit</span>, <span style=color:#000>m</span>.<span style=color:#000>Entries</span><span style=color:#000>...</span>); <span style=color:#000>ok</span> {
</span></span><span style=display:flex><span>		<span style=color:#000>r</span>.<span style=color:#000>send</span>(<span style=color:#000>pb</span>.<span style=color:#000>Message</span>{<span style=color:#000>To</span>: <span style=color:#000>m</span>.<span style=color:#000>From</span>, <span style=color:#000>Type</span>: <span style=color:#000>pb</span>.<span style=color:#000>MsgAppResp</span>, <span style=color:#000>Index</span>: <span style=color:#000>mlastIndex</span>})
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#000>...</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#177500>// maybeAppend returns (0, false) if the entries cannot be appended. Otherwise,
</span></span></span><span style=display:flex><span><span style=color:#177500>// it returns (last index of new entries, true).
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>func</span> (<span style=color:#000>l</span> <span style=color:#000>*</span><span style=color:#000>raftLog</span>) <span style=color:#000>maybeAppend</span>(<span style=color:#000>index</span>, <span style=color:#000>logTerm</span>, <span style=color:#000>committed</span> <span style=color:#a90d91>uint64</span>, <span style=color:#000>ents</span> <span style=color:#000>...</span><span style=color:#000>pb</span>.<span style=color:#000>Entry</span>) (<span style=color:#000>lastnewi</span> <span style=color:#a90d91>uint64</span>, <span style=color:#000>ok</span> <span style=color:#a90d91>bool</span>) {
</span></span><span style=display:flex><span>	<span style=color:#000>...</span>
</span></span><span style=display:flex><span>	<span style=color:#000>l</span>.<span style=color:#000>commitTo</span>(<span style=color:#000>min</span>(<span style=color:#000>committed</span>, <span style=color:#000>lastnewi</span>))
</span></span><span style=display:flex><span>	<span style=color:#000>...</span>
</span></span><span style=display:flex><span>	<span style=color:#a90d91>return</span> <span style=color:#1c01ce>0</span>, <span style=color:#a90d91>false</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> (<span style=color:#000>l</span> <span style=color:#000>*</span><span style=color:#000>raftLog</span>) <span style=color:#000>commitTo</span>(<span style=color:#000>tocommit</span> <span style=color:#a90d91>uint64</span>) {
</span></span><span style=display:flex><span>	<span style=color:#177500>// never decrease commit
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#a90d91>if</span> <span style=color:#000>l</span>.<span style=color:#000>committed</span> &lt; <span style=color:#000>tocommit</span> {
</span></span><span style=display:flex><span>		<span style=color:#a90d91>if</span> <span style=color:#000>l</span>.<span style=color:#000>lastIndex</span>() &lt; <span style=color:#000>tocommit</span> {
</span></span><span style=display:flex><span>			<span style=color:#000>l</span>.<span style=color:#000>logger</span>.<span style=color:#000>Panicf</span>(<span style=color:#c41a16>&#34;tocommit(%d) is out of range [lastIndex(%d)]. Was the raft log corrupted, truncated, or lost?&#34;</span>, <span style=color:#000>tocommit</span>, <span style=color:#000>l</span>.<span style=color:#000>lastIndex</span>())
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#000>l</span>.<span style=color:#000>committed</span> = <span style=color:#000>tocommit</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br></p><p>4、最后leader收到大多数的follower的确认，commit自己的log，同时再次广播通知follower自己已经提交了。<style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>stepLeader</span>(<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>, <span style=color:#000>m</span> <span style=color:#000>pb</span>.<span style=color:#000>Message</span>) <span style=color:#a90d91>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#177500>// These message types do not require any progress for m.From.
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#a90d91>switch</span> <span style=color:#000>m</span>.<span style=color:#000>Type</span> {
</span></span><span style=display:flex><span>		<span style=color:#000>...</span>
</span></span><span style=display:flex><span>	<span style=color:#a90d91>case</span> <span style=color:#000>pb</span>.<span style=color:#000>MsgAppResp</span>:
</span></span><span style=display:flex><span>		<span style=color:#000>pr</span>.<span style=color:#000>RecentActive</span> = <span style=color:#a90d91>true</span>
</span></span><span style=display:flex><span>		<span style=color:#a90d91>if</span> <span style=color:#000>r</span>.<span style=color:#000>maybeCommit</span>() {
</span></span><span style=display:flex><span>			<span style=color:#000>releasePendingReadIndexMessages</span>(<span style=color:#000>r</span>)
</span></span><span style=display:flex><span>			<span style=color:#177500>// 如果可以commit日志，那么广播append消息
</span></span></span><span style=display:flex><span><span style=color:#177500></span>			<span style=color:#000>r</span>.<span style=color:#000>bcastAppend</span>()
</span></span><span style=display:flex><span>		} <span style=color:#a90d91>else</span> <span style=color:#a90d91>if</span> <span style=color:#000>oldPaused</span> {
</span></span><span style=display:flex><span>			<span style=color:#177500>// 如果该节点之前状态是暂停，继续发送append消息给它
</span></span></span><span style=display:flex><span><span style=color:#177500></span>			<span style=color:#000>r</span>.<span style=color:#000>sendAppend</span>(<span style=color:#000>m</span>.<span style=color:#000>From</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#000>...</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a90d91>return</span> <span style=color:#a90d91>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#177500>// 尝试提交索引，如果已经提交返回true
</span></span></span><span style=display:flex><span><span style=color:#177500>// 然后应该调用bcastAppend通知所有的follower
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>func</span> (<span style=color:#000>r</span> <span style=color:#000>*</span><span style=color:#000>raft</span>) <span style=color:#000>maybeCommit</span>() <span style=color:#a90d91>bool</span> {
</span></span><span style=display:flex><span>	<span style=color:#000>mci</span> <span style=color:#000>:=</span> <span style=color:#000>r</span>.<span style=color:#000>prs</span>.<span style=color:#000>Committed</span>()
</span></span><span style=display:flex><span>	<span style=color:#a90d91>return</span> <span style=color:#000>r</span>.<span style=color:#000>raftLog</span>.<span style=color:#000>maybeCommit</span>(<span style=color:#000>mci</span>, <span style=color:#000>r</span>.<span style=color:#000>Term</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#177500>// 提交修改committed就可以了
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#a90d91>func</span> (<span style=color:#000>l</span> <span style=color:#000>*</span><span style=color:#000>raftLog</span>) <span style=color:#000>commitTo</span>(<span style=color:#000>tocommit</span> <span style=color:#a90d91>uint64</span>) {
</span></span><span style=display:flex><span>	<span style=color:#177500>// never decrease commit
</span></span></span><span style=display:flex><span><span style=color:#177500></span>	<span style=color:#a90d91>if</span> <span style=color:#000>l</span>.<span style=color:#000>committed</span> &lt; <span style=color:#000>tocommit</span> {
</span></span><span style=display:flex><span>		<span style=color:#a90d91>if</span> <span style=color:#000>l</span>.<span style=color:#000>lastIndex</span>() &lt; <span style=color:#000>tocommit</span> {
</span></span><span style=display:flex><span>			<span style=color:#000>l</span>.<span style=color:#000>logger</span>.<span style=color:#000>Panicf</span>(<span style=color:#c41a16>&#34;tocommit(%d) is out of range [lastIndex(%d)]. Was the raft log corrupted, truncated, or lost?&#34;</span>, <span style=color:#000>tocommit</span>, <span style=color:#000>l</span>.<span style=color:#000>lastIndex</span>())
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#000>l</span>.<span style=color:#000>committed</span> = <span style=color:#000>tocommit</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br></p><h1 id=实战>实战</h1><p>利用 raft 算法库实现一个分布式存储，此算法库已被广泛应用在 etcd、cockroachdb、dgraph 等开源项目中。</p><p>总体架构：</p><p><img src=../imgs/raft_sourcecode20220904_6.png alt=raft_sourcecode20220904_6.png></p><h2 id=api-设计>API 设计</h2><p>API 由一组接口定义和协议组成，设计 API 会考虑如下因素：</p><ul><li><p>性能
如 etcd v2 使用的是 HTTP/1.x，性能上无法满足大规模 Kubernetes 集群等场景的诉求，etcd v3 使用的是基于 HTTP/2 的 gRPC 协议</p></li><li><p>易用性、可调试性
有的内部高并发服务为了性能会使用 UDP 协议，相比 HTTP 协议，UDP 协议在易用性、可调试性存在一定差距</p></li><li><p>开发效率、跨平台、可移植性
相比基于裸 UDP、TCP 协议设计的接口，如果使用 Protobuf 等 IDL 语言，支持跨平台、代码自动生成，开发效率更高。</p></li><li><p>安全性
使用 HTTPS 协议可对通信数据加密更安全，可适用于不安全的网络环境（比如公网传输）</p></li><li><p>接口幂等性
基于 raftexample 定制开发，因此日志持久化存储、网络都使用的是 etcd 自带的 WAL 和 rafthttp 模块。</p></li></ul><p>WAL模块中提供了核心的保存未持久化的日志条目和快照功能接口；rafthttp模块基于 HTTP 协议提供了各个节点间的消息发送能力</p><h2 id=复制状态机>复制状态机</h2><p>复制状态机由共识模块、日志模块、状态机组成。</p><p><img src=../imgs/raft_sourcecode20220904_7.png alt=raft_sourcecode20220904_7.png></p><p>复制状态机的写请求流程：</p><ul><li>client 发起一个写请求；</li><li>server 向 Raft 共识模块提交请求，共识模块生成一个写提案日志条目。若 server 是 Leader，则把日志条目广播给其他节点，并持久化日志条目到 WAL 中；</li><li>当一半以上节点持久化日志条目后，Leader 的共识模块将此日志条目标记为已提交（committed），并通知其他节点提交；</li><li>server 从共识模块获取已经提交的日志条目，异步应用到状态机存储中（boltdb/leveldb/memory），然后返回给 client。</li></ul><h2 id=多存储引擎>多存储引擎</h2><p>raftexample 本身只支持内存存储。通过将 KV 存储接口进行抽象化设计，实现支持多存储引擎。KVStore interface 的定义如下所示。</p><style>.highlight{overflow-y:auto;max-height:500px;overflow-x:auto;max-width:130%}.td-content .highlight{margin-top:.5rem;margin-bottom:.5rem}</style><details class=code-collapse><summary>Expand/Collapse Code Block</summary><div class=highlight><div style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>type</span> <span style=color:#000>KVStore</span> <span style=color:#a90d91>interface</span> {
</span></span><span style=display:flex><span>   <span style=color:#177500>// LookUp get key value
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>Lookup</span>(<span style=color:#000>key</span> <span style=color:#a90d91>string</span>) (<span style=color:#a90d91>string</span>, <span style=color:#a90d91>bool</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#177500>// Propose propose kv request into raft state machine
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>Propose</span>(<span style=color:#000>k</span>, <span style=color:#000>v</span> <span style=color:#a90d91>string</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#177500>// ReadCommits consume entry from raft state machine into KvStore map until error
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>ReadCommits</span>(<span style=color:#000>commitC</span> <span style=color:#000>&lt;-</span><span style=color:#a90d91>chan</span> <span style=color:#000>*</span><span style=color:#a90d91>string</span>, <span style=color:#000>errorC</span> <span style=color:#000>&lt;-</span><span style=color:#a90d91>chan</span> <span style=color:#a90d91>error</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#177500>// Snapshot return KvStore snapshot
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>Snapshot</span>() ([]<span style=color:#a90d91>byte</span>, <span style=color:#a90d91>error</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#177500>// RecoverFromSnapshot recover data from snapshot
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>RecoverFromSnapshot</span>(<span style=color:#000>snapshot</span> []<span style=color:#a90d91>byte</span>) <span style=color:#a90d91>error</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#177500>// Close close backend databases
</span></span></span><span style=display:flex><span><span style=color:#177500></span>   <span style=color:#000>Close</span>() <span style=color:#000>err</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></details><br><p>存储引擎的选型及基本原理</p><h3 id=boltdb>boltdb</h3><p>github 链接：<a href=https://github.com/etcd-io/bbolt>https://github.com/etcd-io/bbolt</a></p><p>boltdb 是一个基于 B+ tree 实现的存储引擎库。</p><p>boltdb 适用于读多写少，一般情况下可直接从内存中基于 B+ tree 遍历，快速获取数据返回给 client，不涉及经过磁盘 I/O。</p><p>对于写请求，基于 B+ tree 查找写入位置，更新 key-value。事务提交时，写请求包括 B+ tree 重平衡、分裂、持久化 dirty page、持久化 freelist、持久化 meta page 流程。同时，dirty page 分布位置可能分散，这里是随机写磁盘 I/O。</p><h3 id=leveldb>leveldb</h3><p>github 链接：<a href=https://github.com/google/leveldb>https://github.com/google/leveldb</a> 和 <a href=https://github.com/syndtr/goleveldb>https://github.com/syndtr/goleveldb</a></p><p>写多读少最简单的自然就是通过写内存最快，但是内存空间有限，无法支撑大容量的数据存储，且不持久化数据会丢失。</p><p>可以通过将数据顺序追加到文件末尾（AOF）来提升写速度。<a href=https://en.wikipedia.org/wiki/Bitcask>Bitcask</a>存储模型就是采用 AOF 模式，把写请求顺序追加到文件。Facebook 的图片存储<a href=https://www.usenix.org/legacy/event/osdi10/tech/full_papers/Beaver.pdf>Haystack</a>也是使用类似的方案来解决大规模写入痛点。</p><p><a href=https://en.wikipedia.org/wiki/Bitcask>Bitcask</a>存储模型通过内存哈希表维护各个 key-value 数据的索引，实现了快速查找 key-value 数据。虽然内存只保存 key 索引信息，但是当 key 较多时对内存要求依然较高。</p><p>leveldb 是基于 LSM tree(log-structured merge-tree) 实现的 key-value 存储（架构可参考：<a href=https://microsoft.github.io/MLOS/notebooks/LevelDbTuning/>https://microsoft.github.io/MLOS/notebooks/LevelDbTuning/</a>），提升写性能的核心思路同样是将随机写转化为顺序写磁盘 WAL 文件和内存。</p><h2 id=读写流程>读写流程</h2><p>写流程：</p><ul><li>client 通过 curl 发送 HTTP PUT 请求到 server；</li><li>server 收到后，将消息写入到 KVStore 的 ProposeC 管道；</li><li>raftNode 循环逻辑将消息通过 Raft 模块的 Propose 接口提交；</li><li>Raft 模块输出 Ready 结构，server 将日志条目持久化后，并发送给其他节点；</li><li>集群多数节点持久化此日志条目后，这个日志条目被提交给存储状态机 KVStore 执行；</li><li>KVStore 根据启动的 backend 存储引擎名称，调用对应的 Put 接口即可。
<img src=../imgs/raft_sourcecode20220904_8.png alt=raft_sourcecode20220904_8.png></li></ul><p>读流程：</p><ul><li>client 通过 curl 发送 HTTP Get 请求到 server；</li><li>server 收到后，根据 KVStore 的存储引擎，从后端查询出对应的 key-value 数据。
<img src=../imgs/raft_sourcecode20220904_9.png alt=raft_sourcecode20220904_9.png></li></ul><h1 id=总结>总结</h1><ol><li>etcd 中的 raft 是作为一个 library 被使用的。这个库仅仅实现了对应的 raft 算法；</li><li>etcd-raft 这种实现的过程，其中的 step 和 tick 被设计成了函数指针，根据不同的角色来防止不同的函数；</li><li>为了防止出现网络分区 Term 数值变得很大的场景，引入了 PreCandidate；</li><li>etcd 中所有的数据都是通过 Leader 分发到 Follower，通过日志的复制确认机制，保证绝大多数的 Follower 都能同步到消息。</li></ol><h1 id=reference>Reference</h1><p><a href=https://blog.betacat.io/post/raft-implementation-in-etcd/>Raft 在 etcd 中的实现</a></p><p><a href=https://www.codedump.info/post/20180922-etcd-raft/>etcd Raft库解析</a></p><p><a href=https://github.com/lichuang/etcd-3.1.10-codedump>etcd Raft 源码注释解析</a></p><p><a href=https://www.cnblogs.com/ricklz/p/15155095.html>etcd学习(6)-etcd实现raft源码解读</a></p><p>《etcd技术内幕》</p><p><a href=https://zhuanlan.zhihu.com/p/91314329>raftexample 源码解读</a></p><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href=https://github.com/chnherb/chnherb.github.io/issues/new>tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href=https://github.com/chnherb/chnherb.github.io/issues/new>tell us how we can improve</a>.</p></div><script>const yesButton=document.querySelector(".feedback--answer-yes"),noButton=document.querySelector(".feedback--answer-no"),yesResponse=document.querySelector(".feedback--response-yes"),noResponse=document.querySelector(".feedback--response-no"),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=e=>{if(typeof ga!="function")return;const t={command:"send",hitType:"event",category:"Helpful",action:"click",label:window.location.pathname,value:e};ga(t.command,t.hitType,t.category,t.action,t.label,t.value)};yesButton.addEventListener("click",()=>{yesResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(1)}),noButton.addEventListener("click",()=>{noResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(0)})</script><br></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2023 The Herb 保留所有权利</small>
<small class=ml-1><a href=# target=_blank rel=noopener>隐私政策</a></small><p class=mt-2><a href=/about/>Herbdocs</a></p></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.91798a335c881f1b6b805085ba4aa22d1dbd2b0b18d105d05189fa104ddae350.js integrity="sha256-kXmKM1yIHxtrgFCFukqiLR29KwsY0QXQUYn6EE3a41A=" crossorigin=anonymous></script></body></html>