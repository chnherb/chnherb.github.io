---
categories: [""]
tags: [""]
title: "Quorum机制"
# linkTitle: ""
weight: 10
description: >

---

# 简介

Quorum（多数派）机制，是一种分布式系统中常用的，用来保证数据冗余和最终一致性的投票算法，其主要数学思想来源于鸽巢原理。

除了 **Quorum机制** 以外，最简单的机制是采用**主从复制机制**。


# WARO机制

分布式系统利用多台计算机协同解决单台计算机无法解决的计算存储等问题，但系统运行过程中，网络异常、节点宕机等异常情况的发生几乎是避免不了的。

为了保证系统正常运行，提供可靠服务，分布式系统对于数据的存储采用了多份数据副本来保证可靠性。副本不仅可以用于备份，还可以提供服务。

副本的引入带来的问题是怎么保证每个节点的数据一致性。

最简单的方法就是 WARO（Write All Read Only）机制。WARO是一种简单的副本控制协议。当客户端请求向某副本更新数据时，只有当所有的副本都更新成功之后，这次写操作才算成功，否则视为失败。而读取数据时，只需要查询其中一个副本数据就可以返回。

WARO机制对于频繁更新数据的系统不够友好，写操作时延现象非常明显，在并发较高或连续执行等场景下效率更低。可以看出写服务和读服务承受的压力不均衡， WARO牺牲了写服务的可用性，最大程度地增强了读服务的可用性。而 Quorum 就是写服务和读服务之间进行一个折中。

# Quorum机制

## 介绍

分布式系统中的每一份数据拷贝对象都被赋予一票。每一个读操作获得的票数必须大于最小读票数（read quorum）（Vr），每个写操作获得的票数必须大于最小写票数（write quorum）(Vw）才能读或者写。如果系统有V票（意味着一个数据对象有V份冗余拷贝），那么最小读写票数(quorum)应满足如下限制：

1. Vr + Vw > V
2. Vw > V/2
第一条规则保证了一个数据不会被同时读写。当一个写操作请求过来的时候，它必须要获得Vw个冗余拷贝的许可。而剩下的数量是V-Vw 不够Vr，因此不能再有读请求过来了。同理，当读请求获得了 Vr 个冗余拷贝的许可时，写请求就无法获得许可。

第二条规则保证了数据的串行化修改。一份数据的冗余拷贝不可能同时被两个写请求修改。

## 机制分析

**无法保证强一致性**

强一致性就是：**任何时刻任何用户或节点都可以读到最近一次成功提交的副本数据**。强一致性是程度最高的一致性要求，也是实践中最难实现的。

读取最新的数据：

因此当读取数据时，如果读取到数据版本较低不满足要求时，需要继续再去其它节点上读取数据。在已经知道最近成功提交的数据版本号的前提下，最多读 Vr 个副本就可以读到最新数据了。

如何确定读到最高版本号的数据：继续读副本，直到读到的最高版本号副本出现了 Vw 次。

# 



